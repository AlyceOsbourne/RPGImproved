/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => AdvancedCanvasPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian9 = require("obsidian");

// src/settings.ts
var import_obsidian = require("obsidian");
var NODE_TYPES_ON_DOUBLE_CLICK = {
  "text": "Text",
  "file": "File"
};
var DEFAULT_SETTINGS = {
  nodeTypeOnDoubleClick: Object.keys(NODE_TYPES_ON_DOUBLE_CLICK).first(),
  defaultTextNodeWidth: 260,
  defaultTextNodeHeight: 60,
  defaultFileNodeWidth: 400,
  defaultFileNodeHeight: 400,
  shapesFeatureEnabled: true,
  edgesStylingFeatureEnabled: true,
  edgeStylePathfinderGridResolution: 10,
  edgeStylePathfinderPathLiveUpdate: true,
  edgeStylePathfinderPathRounded: true,
  commandsFeatureEnabled: true,
  zoomToClonedNode: true,
  cloneNodeMargin: 20,
  expandNodeStepSize: 20,
  betterReadonlyEnabled: true,
  disableNodePopup: false,
  disableZoom: false,
  disablePan: false,
  collapsibleGroupsFeatureEnabled: true,
  collapsedGroupPreviewOnDrag: true,
  stickersFeatureEnabled: true,
  presentationFeatureEnabled: true,
  defaultSlideSize: "1200x675",
  wrapInSlidePadding: 20,
  useArrowKeysToChangeSlides: true,
  zoomToSlideWithoutPadding: true,
  slideTransitionAnimationDuration: 0.5,
  slideTransitionAnimationIntensity: 1.25,
  canvasEncapsulationEnabled: true,
  portalsFeatureEnabled: true,
  maintainClosedPortalSize: true,
  showEdgesIntoDisabledPortals: true
};
var _SettingsManager = class _SettingsManager {
  constructor(plugin) {
    this.plugin = plugin;
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.plugin.loadData());
    this.plugin.app.workspace.trigger(_SettingsManager.SETTINGS_CHANGED_EVENT);
  }
  async saveSettings() {
    await this.plugin.saveData(this.settings);
  }
  getSetting(key) {
    return this.settings[key];
  }
  async setSetting(data) {
    this.settings = Object.assign(this.settings, data);
    await this.saveSettings();
    this.plugin.app.workspace.trigger(_SettingsManager.SETTINGS_CHANGED_EVENT);
  }
  addSettingsTab() {
    this.settingsTab = new AdvancedCanvasPluginSettingTab(this.plugin, this);
    this.plugin.addSettingTab(this.settingsTab);
  }
};
_SettingsManager.SETTINGS_CHANGED_EVENT = "advanced-canvas:settings-changed";
var SettingsManager = _SettingsManager;
var AdvancedCanvasPluginSettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(plugin, settingsManager) {
    super(plugin.app, plugin);
    this.settingsManager = settingsManager;
  }
  display() {
    let { containerEl } = this;
    containerEl.empty();
    new import_obsidian.Setting(containerEl).setHeading().setName("General");
    new import_obsidian.Setting(containerEl).setName("Node type on double click").setDesc("The type of node that will be created when double clicking on the canvas.").addDropdown(
      (dropdown) => dropdown.addOptions(NODE_TYPES_ON_DOUBLE_CLICK).setValue(this.settingsManager.getSetting("nodeTypeOnDoubleClick")).onChange(async (value) => await this.settingsManager.setSetting({ nodeTypeOnDoubleClick: value }))
    );
    new import_obsidian.Setting(containerEl).setName("Default text node width").setDesc("The default width of a text node.").addText(
      (text) => text.setValue(this.settingsManager.getSetting("defaultTextNodeWidth").toString()).onChange(async (value) => await this.settingsManager.setSetting({ defaultTextNodeWidth: Math.max(1, parseInt(value)) }))
    );
    new import_obsidian.Setting(containerEl).setName("Default text node height").setDesc("The default height of a text node.").addText(
      (text) => text.setValue(this.settingsManager.getSetting("defaultTextNodeHeight").toString()).onChange(async (value) => await this.settingsManager.setSetting({ defaultTextNodeHeight: Math.max(1, parseInt(value)) }))
    );
    new import_obsidian.Setting(containerEl).setName("Default file node width").setDesc("The default width of a file node.").addText(
      (text) => text.setValue(this.settingsManager.getSetting("defaultFileNodeWidth").toString()).onChange(async (value) => await this.settingsManager.setSetting({ defaultFileNodeWidth: Math.max(1, parseInt(value)) }))
    );
    new import_obsidian.Setting(containerEl).setName("Default file node height").setDesc("The default height of a file node.").addText(
      (text) => text.setValue(this.settingsManager.getSetting("defaultFileNodeHeight").toString()).onChange(async (value) => await this.settingsManager.setSetting({ defaultFileNodeHeight: Math.max(1, parseInt(value)) }))
    );
    this.createFeatureHeading(
      containerEl,
      "Shapes",
      "Shape your nodes for creating e.g. mind maps or flow charts.",
      "shapesFeatureEnabled"
    );
    this.createFeatureHeading(
      containerEl,
      "Edges styling",
      "Style your edges with different path styles.",
      "edgesStylingFeatureEnabled"
    );
    new import_obsidian.Setting(containerEl).setName("A* grid resolution").setDesc("The resolution of the grid when using the A* path style. The lower the value, the more precise the path will be. But it will also take longer to calculate.").addText(
      (text) => text.setValue(this.settingsManager.getSetting("edgeStylePathfinderGridResolution").toString()).onChange(async (value) => await this.settingsManager.setSetting({ edgeStylePathfinderGridResolution: Math.max(5, parseInt(value)) }))
    );
    new import_obsidian.Setting(containerEl).setName("Live update A* path").setDesc("When enabled, the A* path style will be updated live while dragging the edge.").addToggle(
      (toggle) => toggle.setValue(this.settingsManager.getSetting("edgeStylePathfinderPathLiveUpdate")).onChange(async (value) => await this.settingsManager.setSetting({ edgeStylePathfinderPathLiveUpdate: value }))
    );
    new import_obsidian.Setting(containerEl).setName("A* rounded path").setDesc("When enabled, the A* path style will be rounded.").addToggle(
      (toggle) => toggle.setValue(this.settingsManager.getSetting("edgeStylePathfinderPathRounded")).onChange(async (value) => await this.settingsManager.setSetting({ edgeStylePathfinderPathRounded: value }))
    );
    this.createFeatureHeading(
      containerEl,
      "Extended commands",
      "Add more commands to the canvas.",
      "commandsFeatureEnabled"
    );
    new import_obsidian.Setting(containerEl).setName("Zoom to cloned node").setDesc("When enabled, the canvas will zoom to the cloned node.").addToggle(
      (toggle) => toggle.setValue(this.settingsManager.getSetting("zoomToClonedNode")).onChange(async (value) => await this.settingsManager.setSetting({ zoomToClonedNode: value }))
    );
    new import_obsidian.Setting(containerEl).setName("Clone node margin").setDesc("The margin between the cloned node and the source node.").addText(
      (text) => text.setValue(this.settingsManager.getSetting("cloneNodeMargin").toString()).onChange(async (value) => await this.settingsManager.setSetting({ cloneNodeMargin: parseInt(value) }))
    );
    new import_obsidian.Setting(containerEl).setName("Expand node step size").setDesc("The step size for expanding the node.").addText(
      (text) => text.setValue(this.settingsManager.getSetting("expandNodeStepSize").toString()).onChange(async (value) => await this.settingsManager.setSetting({ expandNodeStepSize: parseInt(value) }))
    );
    this.createFeatureHeading(
      containerEl,
      "Better readonly",
      "Improve the readonly mode.",
      "betterReadonlyEnabled"
    );
    this.createFeatureHeading(
      containerEl,
      "Collapsible groups",
      "Group nodes can be collapsed and expanded to keep the canvas organized.",
      "collapsibleGroupsFeatureEnabled"
    );
    new import_obsidian.Setting(containerEl).setName("Collapsed group preview on drag").setDesc("When enabled, a group that is collapsed show its border while dragging a node.").addToggle(
      (toggle) => toggle.setValue(this.settingsManager.getSetting("collapsedGroupPreviewOnDrag")).onChange(async (value) => await this.settingsManager.setSetting({ collapsedGroupPreviewOnDrag: value }))
    );
    this.createFeatureHeading(
      containerEl,
      "Stickers",
      "Convert an image node to a sticker by supporting transparency and removing the border.",
      "stickersFeatureEnabled"
    );
    this.createFeatureHeading(
      containerEl,
      "Presentations",
      "Create a presentation from your canvas.",
      "presentationFeatureEnabled"
    );
    new import_obsidian.Setting(containerEl).setName("Default slide ratio").setDesc("The default ratio of the slide. For example, 16:9 is 1200x675 and 3:2 is 1350x900.").addText(
      (text) => text.setValue(this.settingsManager.getSetting("defaultSlideSize")).onChange(async (value) => await this.settingsManager.setSetting({ defaultSlideSize: value.replace(" ", "") }))
    );
    new import_obsidian.Setting(containerEl).setName("Wrap in slide padding").setDesc("The padding of the slide when wrapping the canvas in a slide.").addText(
      (text) => text.setValue(this.settingsManager.getSetting("wrapInSlidePadding").toString()).onChange(async (value) => await this.settingsManager.setSetting({ wrapInSlidePadding: parseInt(value) }))
    );
    new import_obsidian.Setting(containerEl).setName("Use arrow keys to change slides").setDesc("When enabled, you can use the arrow keys to change slides in presentation mode.").addToggle(
      (toggle) => toggle.setValue(this.settingsManager.getSetting("useArrowKeysToChangeSlides")).onChange(async (value) => await this.settingsManager.setSetting({ useArrowKeysToChangeSlides: value }))
    );
    new import_obsidian.Setting(containerEl).setName("Zoom to slide without padding").setDesc("When enabled, the canvas will zoom to the slide without padding.").addToggle(
      (toggle) => toggle.setValue(this.settingsManager.getSetting("zoomToSlideWithoutPadding")).onChange(async (value) => await this.settingsManager.setSetting({ zoomToSlideWithoutPadding: value }))
    );
    new import_obsidian.Setting(containerEl).setName("Slide transition animation duration").setDesc("The duration of the slide transition animation in seconds. Set to 0 to disable the animation.").addText(
      (text) => text.setValue(this.settingsManager.getSetting("slideTransitionAnimationDuration").toString()).onChange(async (value) => await this.settingsManager.setSetting({ slideTransitionAnimationDuration: parseFloat(value) }))
    );
    new import_obsidian.Setting(containerEl).setName("Slide transition animation intensity").setDesc("The intensity of the slide transition animation. The higher the value, the more the canvas will zoom out before zooming in on the next slide.").addText(
      (text) => text.setValue(this.settingsManager.getSetting("slideTransitionAnimationIntensity").toString()).onChange(async (value) => await this.settingsManager.setSetting({ slideTransitionAnimationIntensity: parseFloat(value) }))
    );
    this.createFeatureHeading(
      containerEl,
      "Canvas encapsulation",
      "Encapsulate a selection of nodes and edges into a new canvas.",
      "canvasEncapsulationEnabled"
    );
    this.createFeatureHeading(
      containerEl,
      "Portals",
      "Create portals to other canvases.",
      "portalsFeatureEnabled"
    );
    new import_obsidian.Setting(containerEl).setName("Maintain closed portal size").setDesc("When enabled, closing a portal will change the size of the portal to the original, closed size.").addToggle(
      (toggle) => toggle.setValue(this.settingsManager.getSetting("maintainClosedPortalSize")).onChange(async (value) => await this.settingsManager.setSetting({ maintainClosedPortalSize: value }))
    );
    new import_obsidian.Setting(containerEl).setName("Show edges into disabled portals").setDesc("When enabled, edges into disabled portals will be shown by an edge to the portal node.").addToggle(
      (toggle) => toggle.setValue(this.settingsManager.getSetting("showEdgesIntoDisabledPortals")).onChange(async (value) => await this.settingsManager.setSetting({ showEdgesIntoDisabledPortals: value }))
    );
  }
  createFeatureHeading(containerEl, label, description, settingsKey) {
    return new import_obsidian.Setting(containerEl).setHeading().setName(label).setDesc(description).addToggle(
      (toggle) => toggle.setTooltip("Requires a reload to take effect.").setValue(this.settingsManager.getSetting(settingsKey)).onChange(async (value) => {
        await this.settingsManager.setSetting({ [settingsKey]: value });
        new import_obsidian.Notice("Reload obsidian to apply the changes.");
      })
    );
  }
};

// src/utils/canvas-helper.ts
var import_obsidian2 = require("obsidian");

// src/utils/bbox-helper.ts
function combineBBoxes(bboxes) {
  let minX = Infinity;
  let minY = Infinity;
  let maxX = -Infinity;
  let maxY = -Infinity;
  for (let bbox of bboxes) {
    minX = Math.min(minX, bbox.minX);
    minY = Math.min(minY, bbox.minY);
    maxX = Math.max(maxX, bbox.maxX);
    maxY = Math.max(maxY, bbox.maxY);
  }
  return { minX, minY, maxX, maxY };
}
function scaleBBox(bbox, scale) {
  let diffX = (scale - 1) * (bbox.maxX - bbox.minX);
  let diffY = (scale - 1) * (bbox.maxY - bbox.minY);
  return {
    minX: bbox.minX - diffX / 2,
    maxX: bbox.maxX + diffX / 2,
    minY: bbox.minY - diffY / 2,
    maxY: bbox.maxY + diffY / 2
  };
}
function insideBBox(position, bbox, canTouchEdge) {
  var _a, _b, _c, _d;
  const providedBBox = {
    minX: (_a = position.minX) != null ? _a : position.x,
    minY: (_b = position.minY) != null ? _b : position.y,
    maxX: (_c = position.maxX) != null ? _c : position.x,
    maxY: (_d = position.maxY) != null ? _d : position.y
  };
  return canTouchEdge ? providedBBox.minX >= bbox.minX && providedBBox.maxX <= bbox.maxX && providedBBox.minY >= bbox.minY && providedBBox.maxY <= bbox.maxY : providedBBox.minX > bbox.minX && providedBBox.maxX < bbox.maxX && providedBBox.minY > bbox.minY && providedBBox.maxY < bbox.maxY;
}
function enlargeBBox(bbox, padding) {
  return {
    minX: bbox.minX - padding,
    minY: bbox.minY - padding,
    maxX: bbox.maxX + padding,
    maxY: bbox.maxY + padding
  };
}
function getCenterOfBBoxSide(bbox, side) {
  switch (side) {
    case "top":
      return { x: (bbox.minX + bbox.maxX) / 2, y: bbox.minY };
    case "right":
      return { x: bbox.maxX, y: (bbox.minY + bbox.maxY) / 2 };
    case "bottom":
      return { x: (bbox.minX + bbox.maxX) / 2, y: bbox.maxY };
    case "left":
      return { x: bbox.minX, y: (bbox.minY + bbox.maxY) / 2 };
  }
}
function bboxFromNodeData(nodeData) {
  return {
    minX: nodeData.x,
    minY: nodeData.y,
    maxX: nodeData.x + nodeData.width,
    maxY: nodeData.y + nodeData.height
  };
}

// src/utils/canvas-helper.ts
function canvasCommand(plugin, check, run) {
  return (checking) => {
    const canvas = plugin.getCurrentCanvas();
    if (checking)
      return canvas !== null && check(canvas);
    if (canvas)
      run(canvas);
    return true;
  };
}
function createQuickSettingsButton(menuOption) {
  const quickSetting = document.createElement("div");
  if (menuOption.id)
    quickSetting.id = menuOption.id;
  quickSetting.classList.add("canvas-control-item");
  (0, import_obsidian2.setIcon)(quickSetting, menuOption.icon);
  (0, import_obsidian2.setTooltip)(quickSetting, menuOption.label, { placement: "left" });
  quickSetting.addEventListener("click", () => {
    var _a;
    return (_a = menuOption.callback) == null ? void 0 : _a.call(menuOption);
  });
  return quickSetting;
}
function addQuickSettingsButton(controlGroup, element) {
  var _a;
  if (element.id)
    (_a = controlGroup.querySelector(`#${element.id}`)) == null ? void 0 : _a.remove();
  controlGroup.appendChild(element);
}
function createCardMenuOption(canvas, menuOption, previewNodeSize, onPlaced) {
  const menuOptionElement = document.createElement("div");
  if (menuOption.id)
    menuOptionElement.id = menuOption.id;
  menuOptionElement.classList.add("canvas-card-menu-button");
  menuOptionElement.classList.add("mod-draggable");
  (0, import_obsidian2.setIcon)(menuOptionElement, menuOption.icon);
  (0, import_obsidian2.setTooltip)(menuOptionElement, menuOption.label, { placement: "top" });
  menuOptionElement.addEventListener("click", (_e) => {
    onPlaced(canvas, getCenterCoordinates(canvas, previewNodeSize()));
  });
  menuOptionElement.addEventListener("pointerdown", (e) => {
    canvas.dragTempNode(e, previewNodeSize(), (pos) => {
      canvas.deselectAll();
      onPlaced(canvas, pos);
    });
  });
  return menuOptionElement;
}
function addCardMenuOption(canvas, element) {
  var _a;
  if (element.id)
    (_a = canvas == null ? void 0 : canvas.cardMenuEl.querySelector(`#${element.id}`)) == null ? void 0 : _a.remove();
  canvas == null ? void 0 : canvas.cardMenuEl.appendChild(element);
}
function createPopupMenuOption(menuOption) {
  const menuOptionElement = document.createElement("button");
  if (menuOption.id)
    menuOptionElement.id = menuOption.id;
  menuOptionElement.classList.add("clickable-icon");
  (0, import_obsidian2.setIcon)(menuOptionElement, menuOption.icon);
  (0, import_obsidian2.setTooltip)(menuOptionElement, menuOption.label, { placement: "top" });
  menuOptionElement.addEventListener("click", () => {
    var _a;
    return (_a = menuOption.callback) == null ? void 0 : _a.call(menuOption);
  });
  return menuOptionElement;
}
function createExpandablePopupMenuOption(menuOption, subMenuOptions) {
  const menuOptionElement = createPopupMenuOption({
    ...menuOption,
    callback: () => {
      var _a, _b, _c;
      const submenuId = `${menuOption.id}-submenu`;
      if (menuOptionElement.classList.contains("is-active")) {
        menuOptionElement.classList.remove("is-active");
        (_b = (_a = menuOptionElement.parentElement) == null ? void 0 : _a.querySelector(`#${submenuId}`)) == null ? void 0 : _b.remove();
        return;
      }
      menuOptionElement.classList.add("is-active");
      const submenu = document.createElement("div");
      submenu.id = submenuId;
      submenu.classList.add("canvas-submenu");
      for (const subMenuOption of subMenuOptions) {
        const subMenuOptionElement = createPopupMenuOption(subMenuOption);
        submenu.appendChild(subMenuOptionElement);
      }
      (_c = menuOptionElement.parentElement) == null ? void 0 : _c.appendChild(submenu);
    }
  });
  return menuOptionElement;
}
function addPopupMenuOption(canvas, element, index = -1) {
  var _a, _b;
  const popupMenuEl = (_a = canvas == null ? void 0 : canvas.menu) == null ? void 0 : _a.menuEl;
  if (!popupMenuEl)
    return;
  if (element.id)
    (_b = popupMenuEl.querySelector(`#${element.id}`)) == null ? void 0 : _b.remove();
  const sisterElement = index >= 0 ? popupMenuEl.children[index] : popupMenuEl.children[popupMenuEl.children.length + index];
  popupMenuEl.insertAfter(element, sisterElement);
}
function getCenterCoordinates(canvas, nodeSize) {
  const viewBounds = canvas.getViewportBBox();
  return {
    x: (viewBounds.minX + viewBounds.maxX) / 2 - nodeSize.width / 2,
    y: (viewBounds.minY + viewBounds.maxY) / 2 - nodeSize.height / 2
  };
}
function getBBox(canvasNodes) {
  let minX = Infinity;
  let minY = Infinity;
  let maxX = -Infinity;
  let maxY = -Infinity;
  for (const node of canvasNodes) {
    const nodeData = node.getData ? node.getData() : node;
    minX = Math.min(minX, nodeData.x);
    minY = Math.min(minY, nodeData.y);
    maxX = Math.max(maxX, nodeData.x + nodeData.width);
    maxY = Math.max(maxY, nodeData.y + nodeData.height);
  }
  return { minX, minY, maxX, maxY };
}
function zoomToBBox(canvas, bbox) {
  const PADDING_CORRECTION_FACTOR = 1 / 1.1;
  const zoomedBBox = scaleBBox(bbox, PADDING_CORRECTION_FACTOR);
  canvas.zoomToBbox(zoomedBBox);
  const scaleFactor = Math.min(
    canvas.canvasRect.width / (bbox.maxX - bbox.minX),
    canvas.canvasRect.height / (bbox.maxY - bbox.minY)
  );
  canvas.tZoom = Math.log2(scaleFactor);
}

// src/core/events.ts
var PLUGIN_EVENT_PREFIX = "advanced-canvas";
var CanvasEvent = {
  CanvasChanged: `${PLUGIN_EVENT_PREFIX}:canvas-changed`,
  ViewportChanged: {
    Before: `${PLUGIN_EVENT_PREFIX}:viewport-changed:before`,
    After: `${PLUGIN_EVENT_PREFIX}:viewport-changed:after`
  },
  NodeMoved: `${PLUGIN_EVENT_PREFIX}:node-moved`,
  DoubleClick: `${PLUGIN_EVENT_PREFIX}:double-click`,
  DraggingStateChanged: `${PLUGIN_EVENT_PREFIX}:dragging-state-changed`,
  NodeAdded: `${PLUGIN_EVENT_PREFIX}:node-added`,
  EdgeAdded: `${PLUGIN_EVENT_PREFIX}:edge-added`,
  NodeRemoved: `${PLUGIN_EVENT_PREFIX}:node-removed`,
  EdgeRemoved: `${PLUGIN_EVENT_PREFIX}:edge-removed`,
  NodeChanged: `${PLUGIN_EVENT_PREFIX}:node-changed`,
  EdgeChanged: `${PLUGIN_EVENT_PREFIX}:edge-changed`,
  NodeBBoxRequested: `${PLUGIN_EVENT_PREFIX}:node-bbox-requested`,
  EdgeCenterRequested: `${PLUGIN_EVENT_PREFIX}:edge-center-requested`,
  ContainingNodesRequested: `${PLUGIN_EVENT_PREFIX}:containing-nodes-requested`,
  SelectionChanged: `${PLUGIN_EVENT_PREFIX}:selection-changed`,
  ZoomToBbox: {
    Before: `${PLUGIN_EVENT_PREFIX}:zoom-to-bbox:before`,
    After: `${PLUGIN_EVENT_PREFIX}:zoom-to-bbox:after`
  },
  PopupMenuCreated: `${PLUGIN_EVENT_PREFIX}:popup-menu-created`,
  NodeInteraction: `${PLUGIN_EVENT_PREFIX}:node-interaction`,
  Undo: `${PLUGIN_EVENT_PREFIX}:undo`,
  Redo: `${PLUGIN_EVENT_PREFIX}:redo`,
  ReadonlyChanged: `${PLUGIN_EVENT_PREFIX}:readonly-changed`,
  DataRequested: `${PLUGIN_EVENT_PREFIX}:data-requested`,
  LoadData: `${PLUGIN_EVENT_PREFIX}:load-data`,
  CanvasSaved: {
    Before: `${PLUGIN_EVENT_PREFIX}:canvas-saved:before`,
    After: `${PLUGIN_EVENT_PREFIX}:canvas-saved:after`
  }
};

// src/canvas-extensions/shapes-canvas-extension.ts
var SHAPES = [
  {
    menuName: "Default",
    icon: "circle-off"
  },
  {
    id: "oval",
    menuName: "Oval",
    icon: "oval"
  },
  {
    id: "centered-rectangle",
    menuName: "Rectangle",
    icon: "rectangle-horizontal"
  },
  {
    id: "diamond",
    menuName: "Diamond",
    icon: "diamond"
  },
  {
    id: "parallelogram",
    menuName: "Parallelogram",
    icon: "parallelogram"
  },
  {
    id: "circle",
    menuName: "Circle",
    icon: "circle"
  },
  {
    id: "predefined-process",
    menuName: "Predefined process",
    icon: "predefined-process"
  },
  {
    id: "document",
    menuName: "Document",
    icon: "document"
  },
  {
    id: "database",
    menuName: "Database",
    icon: "database-shape"
  }
];
var ShapesCanvasExtension = class {
  constructor(plugin) {
    this.plugin = plugin;
    if (!this.plugin.settings.getSetting("shapesFeatureEnabled"))
      return;
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.PopupMenuCreated,
      (canvas) => this.onPopupMenuCreated(canvas)
    ));
  }
  onPopupMenuCreated(canvas) {
    if (canvas.readonly || !this.hasValidNodeInSelection(canvas))
      return;
    const nestedMenuOptions = SHAPES.map((shape) => ({
      label: shape.menuName,
      icon: shape.icon,
      callback: () => this.setShapeForSelection(canvas, shape)
    }));
    const menuOption = createExpandablePopupMenuOption({
      id: "node-shape-option",
      label: "Node shape",
      icon: "shapes"
    }, nestedMenuOptions);
    addPopupMenuOption(canvas, menuOption);
  }
  hasValidNodeInSelection(canvas) {
    const selectedNodesData = canvas.getSelectionData().nodes;
    for (const nodeData of selectedNodesData) {
      if (nodeData.type === "text")
        return true;
    }
    return false;
  }
  setShapeForSelection(canvas, shape) {
    const selectedNodesData = canvas.getSelectionData().nodes;
    for (const nodeData of selectedNodesData) {
      if (nodeData.type !== "text")
        continue;
      const node = canvas.nodes.get(nodeData.id);
      if (!node)
        continue;
      node.setData({ ...nodeData, shape: shape.id });
    }
  }
};

// node_modules/monkey-around/mjs/index.js
function around(obj, factories) {
  const removers = Object.keys(factories).map((key) => around1(obj, key, factories[key]));
  return removers.length === 1 ? removers[0] : function() {
    removers.forEach((r) => r());
  };
}
function around1(obj, method, createWrapper) {
  const original = obj[method], hadOwn = obj.hasOwnProperty(method);
  let current = createWrapper(original);
  if (original)
    Object.setPrototypeOf(current, original);
  Object.setPrototypeOf(wrapper, current);
  obj[method] = wrapper;
  return remove;
  function wrapper(...args) {
    if (current === original && obj[method] === wrapper)
      remove();
    return current.apply(this, args);
  }
  function remove() {
    if (obj[method] === wrapper) {
      if (hadOwn)
        obj[method] = original;
      else
        delete obj[method];
    }
    if (current === original)
      return;
    current = original;
    Object.setPrototypeOf(wrapper, original || Function);
  }
}

// src/utils/patch-helper.ts
function patchObjectPrototype(plugin, target, functions) {
  const uninstaller = around(target.constructor.prototype, functions);
  plugin.register(uninstaller);
}
function patchObjectInstance(plugin, target, functions) {
  const uninstaller = around(target, functions);
  plugin.register(uninstaller);
}

// src/core/canvas-patcher.ts
var CanvasPatcher = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.applyPatches();
  }
  async applyPatches() {
    var _a, _b, _c;
    const that = this;
    const canvasView = (_c = (_b = (_a = this.plugin.app.workspace.getLeavesOfType("canvas")) == null ? void 0 : _a.first()) == null ? void 0 : _b.view) != null ? _c : await new Promise((resolve) => {
      const uninstall = around(this.plugin.app.internalPlugins.plugins.canvas.views, {
        canvas: (next) => function(...args) {
          const result = next.call(this, ...args);
          resolve(result);
          uninstall();
          return result;
        }
      });
      this.plugin.register(uninstall);
    });
    patchObjectPrototype(this.plugin, canvasView, {
      getViewData: (_next) => function(..._args) {
        var _a2;
        const canvasData = this.canvas.getData();
        canvasData.metadata = (_a2 = this.canvas.metadata) != null ? _a2 : {};
        return JSON.stringify(canvasData, null, 2);
      },
      setViewData: (next) => function(json, ...args) {
        const result = next.call(this, json, ...args);
        try {
          this.canvas.metadata = JSON.parse(json).metadata;
        } catch (_e) {
          this.canvas.metadata = {};
        }
        that.triggerWorkspaceEvent(CanvasEvent.CanvasChanged, this.canvas);
        return result;
      }
    });
    patchObjectPrototype(this.plugin, canvasView.canvas, {
      markViewportChanged: (next) => function(...args) {
        that.triggerWorkspaceEvent(CanvasEvent.ViewportChanged.Before, this);
        const result = next.call(this, ...args);
        that.triggerWorkspaceEvent(CanvasEvent.ViewportChanged.After, this);
        return result;
      },
      markMoved: (next) => function(node) {
        const result = next.call(this, node);
        that.triggerWorkspaceEvent(CanvasEvent.NodeMoved, this, node);
        return result;
      },
      onDoubleClick: (next) => function(event) {
        const preventDefault = { value: false };
        that.triggerWorkspaceEvent(CanvasEvent.DoubleClick, this, event, preventDefault);
        if (!preventDefault.value)
          next.call(this, event);
      },
      setDragging: (next) => function(dragging) {
        const result = next.call(this, dragging);
        that.triggerWorkspaceEvent(CanvasEvent.DraggingStateChanged, this, dragging);
        return result;
      },
      getContainingNodes: (next) => function(bbox) {
        const result = next.call(this, bbox);
        that.triggerWorkspaceEvent(CanvasEvent.ContainingNodesRequested, this, bbox, result);
        return result;
      },
      updateSelection: (next) => function(update) {
        const oldSelection = new Set(this.selection);
        const result = next.call(this, update);
        that.triggerWorkspaceEvent(CanvasEvent.SelectionChanged, this, oldSelection, (update2) => next.call(this, update2));
        return result;
      },
      addNode: (next) => function(node) {
        that.patchNode(node);
        return next.call(this, node);
      },
      addEdge: (next) => function(edge) {
        that.patchEdge(edge);
        return next.call(this, edge);
      },
      removeNode: (next) => function(node) {
        const result = next.call(this, node);
        that.triggerWorkspaceEvent(CanvasEvent.NodeRemoved, this, node);
        return result;
      },
      removeEdge: (next) => function(edge) {
        const result = next.call(this, edge);
        that.triggerWorkspaceEvent(CanvasEvent.EdgeRemoved, this, edge);
        return result;
      },
      zoomToBbox: (next) => function(bbox) {
        that.triggerWorkspaceEvent(CanvasEvent.ZoomToBbox.Before, this, bbox);
        const result = next.call(this, bbox);
        that.triggerWorkspaceEvent(CanvasEvent.ZoomToBbox.After, this, bbox);
        return result;
      },
      setReadonly: (next) => function(readonly) {
        const result = next.call(this, readonly);
        that.triggerWorkspaceEvent(CanvasEvent.ReadonlyChanged, this, readonly);
        return result;
      },
      undo: (next) => function(...args) {
        const result = next.call(this, ...args);
        this.importData(this.getData(), true);
        that.triggerWorkspaceEvent(CanvasEvent.Undo, this);
        return result;
      },
      redo: (next) => function(...args) {
        const result = next.call(this, ...args);
        this.importData(this.getData(), true);
        that.triggerWorkspaceEvent(CanvasEvent.Redo, this);
        return result;
      },
      getData: (next) => function(...args) {
        const result = next.call(this, ...args);
        that.triggerWorkspaceEvent(CanvasEvent.DataRequested, this, result);
        return result;
      },
      importData: (next) => function(data, clearCanvas, silent) {
        const targetFilePath = this.view.file.path;
        const setData = (data2) => {
          if (!this.view.file || this.view.file.path !== targetFilePath)
            return;
          this.importData(data2, true, true);
          that.emitEventsForUnknownDataChanges(this);
        };
        if (!silent)
          that.triggerWorkspaceEvent(CanvasEvent.LoadData, this, data, setData);
        const result = next.call(this, data, clearCanvas);
        that.emitEventsForUnknownDataChanges(this);
        return result;
      },
      requestSave: (next) => function(...args) {
        that.triggerWorkspaceEvent(CanvasEvent.CanvasSaved.Before, this);
        const result = next.call(this, ...args);
        that.triggerWorkspaceEvent(CanvasEvent.CanvasSaved.After, this);
        return result;
      }
    });
    patchObjectPrototype(this.plugin, canvasView.canvas.menu, {
      render: (next) => function(...args) {
        const result = next.call(this, ...args);
        that.triggerWorkspaceEvent(CanvasEvent.PopupMenuCreated, this.canvas);
        next.call(this);
        return result;
      }
    });
    patchObjectPrototype(this.plugin, canvasView.canvas.nodeInteractionLayer, {
      setTarget: (next) => function(node) {
        const result = next.call(this, node);
        that.triggerWorkspaceEvent(CanvasEvent.NodeInteraction, this.canvas, node);
        return result;
      }
    });
    this.plugin.app.workspace.iterateAllLeaves((leaf) => {
      if (leaf.view.getViewType() !== "canvas")
        return;
      const canvasView2 = leaf.view;
      canvasView2.leaf.rebuildView();
    });
  }
  patchNode(node) {
    const that = this;
    patchObjectInstance(this.plugin, node, {
      setData: (next) => function(...args) {
        const result = next.call(this, ...args);
        if (node.initialized && !node.isDirty) {
          node.isDirty = true;
          that.triggerWorkspaceEvent(CanvasEvent.NodeChanged, this.canvas, node);
          delete node.isDirty;
        }
        this.canvas.data = this.canvas.getData();
        this.canvas.view.requestSave();
        return result;
      },
      getBBox: (next) => function(...args) {
        const result = next.call(this, ...args);
        that.triggerWorkspaceEvent(CanvasEvent.NodeBBoxRequested, this.canvas, node, result);
        return result;
      }
    });
    this.runAfterInitialized(node, () => {
      this.triggerWorkspaceEvent(CanvasEvent.NodeAdded, node.canvas, node);
      this.triggerWorkspaceEvent(CanvasEvent.NodeChanged, node.canvas, node);
    });
  }
  patchEdge(edge) {
    const that = this;
    patchObjectInstance(this.plugin, edge, {
      setData: (next) => function(...args) {
        const result = next.call(this, ...args);
        if (edge.initialized && !edge.isDirty) {
          edge.isDirty = true;
          that.triggerWorkspaceEvent(CanvasEvent.EdgeChanged, this.canvas, edge);
          delete edge.isDirty;
        }
        this.canvas.data = this.canvas.getData();
        this.canvas.view.requestSave();
        return result;
      },
      render: (next) => function(...args) {
        const result = next.call(this, ...args);
        that.triggerWorkspaceEvent(CanvasEvent.EdgeChanged, this.canvas, edge);
        return result;
      },
      getCenter: (next) => function(...args) {
        const result = next.call(this, ...args);
        that.triggerWorkspaceEvent(CanvasEvent.EdgeCenterRequested, this.canvas, edge, result);
        return result;
      }
    });
    this.runAfterInitialized(edge, () => {
      this.triggerWorkspaceEvent(CanvasEvent.EdgeAdded, edge.canvas, edge);
    });
  }
  runAfterInitialized(canvasElement, onReady) {
    if (canvasElement.initialized) {
      onReady();
      return;
    }
    const that = this;
    const uninstall = around(canvasElement, {
      initialize: (next) => function(...args) {
        const result = next.call(this, ...args);
        onReady();
        uninstall();
        return result;
      }
    });
    that.plugin.register(uninstall);
  }
  emitEventsForUnknownDataChanges(canvas) {
    canvas.nodes.forEach((node) => this.runAfterInitialized(node, () => {
      this.triggerWorkspaceEvent(CanvasEvent.NodeChanged, node.canvas, node);
    }));
    canvas.edges.forEach((edge) => this.runAfterInitialized(edge, () => {
      this.triggerWorkspaceEvent(CanvasEvent.EdgeChanged, edge.canvas, edge);
    }));
  }
  triggerWorkspaceEvent(event, ...args) {
    this.plugin.app.workspace.trigger(event, ...args);
  }
};

// src/canvas-extensions/group-canvas-extension.ts
var GROUP_NODE_SIZE = { width: 300, height: 300 };
var GroupCanvasExtension = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.CanvasChanged,
      (canvas) => {
        addCardMenuOption(
          canvas,
          createCardMenuOption(
            canvas,
            {
              id: "create-group",
              label: "Drag to add group",
              icon: "group"
            },
            () => GROUP_NODE_SIZE,
            (canvas2, pos) => {
              canvas2.createGroupNode({
                pos,
                size: GROUP_NODE_SIZE
              });
            }
          )
        );
      }
    ));
  }
};

// src/canvas-extensions/presentation-canvas-extension.ts
var import_obsidian3 = require("obsidian");
var START_SLIDE_NAME = "Start Slide";
var DEFAULT_SLIDE_NAME = "New Slide";
var PresentationCanvasExtension = class {
  constructor(plugin) {
    this.savedViewport = null;
    this.isPresentationMode = false;
    this.visitedNodes = [];
    this.plugin = plugin;
    if (!this.plugin.settings.getSetting("presentationFeatureEnabled"))
      return;
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      "canvas:selection-menu",
      (menu, canvas) => {
        menu.addItem(
          (item) => item.setTitle("Wrap in slide").setIcon("gallery-vertical").onClick(() => this.addSlide(
            canvas,
            void 0,
            enlargeBBox(combineBBoxes(
              [...canvas.selection.values()].map((element) => element.getBBox())
            ), this.plugin.settings.getSetting("wrapInSlidePadding"))
          ))
        );
      }
    ));
    this.plugin.addCommand({
      id: "create-new-slide",
      name: "Create new slide",
      checkCallback: canvasCommand(
        this.plugin,
        (canvas) => !canvas.readonly && !this.isPresentationMode,
        (canvas) => this.addSlide(canvas)
      )
    });
    this.plugin.addCommand({
      id: "start-presentation",
      name: "Start presentation",
      checkCallback: canvasCommand(
        this.plugin,
        (_canvas) => !this.isPresentationMode,
        (canvas) => this.startPresentation(canvas)
      )
    });
    this.plugin.addCommand({
      id: "previous-node",
      name: "Previous node",
      checkCallback: canvasCommand(
        this.plugin,
        (_canvas) => this.isPresentationMode,
        (canvas) => this.previousNode(canvas)
      )
    });
    this.plugin.addCommand({
      id: "next-node",
      name: "Next node",
      checkCallback: canvasCommand(
        this.plugin,
        (_canvas) => this.isPresentationMode,
        (canvas) => this.nextNode(canvas)
      )
    });
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.CanvasChanged,
      (canvas) => this.onCanvasChanged(canvas)
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.PopupMenuCreated,
      (canvas) => this.onPopupMenuCreated(canvas)
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.NodeMoved,
      (canvas, node) => this.onNodeMoved(canvas, node)
    ));
  }
  onCanvasChanged(canvas) {
    addCardMenuOption(
      canvas,
      createCardMenuOption(
        canvas,
        {
          id: "new-slide",
          label: "Drag to add slide",
          icon: "gallery-vertical"
        },
        () => this.getDefaultSlideSize(),
        (canvas2, pos) => this.addSlide(canvas2, pos)
      )
    );
  }
  onPopupMenuCreated(canvas) {
    const selectedNodesData = canvas.getSelectionData().nodes;
    if (canvas.readonly || selectedNodesData.length !== 1 || canvas.selection.size > 1)
      return;
    const selectedNode = canvas.nodes.get(selectedNodesData[0].id);
    if (!selectedNode)
      return;
    addPopupMenuOption(
      canvas,
      createPopupMenuOption({
        id: "start-node",
        label: "Set as start slide",
        icon: "play",
        callback: () => this.setStartNode(canvas, selectedNode)
      })
    );
  }
  onNodeMoved(_canvas, node) {
    const nodeData = node.getData();
    if (!nodeData.sideRatio)
      return;
    const nodeBBox = node.getBBox();
    const nodeSize = {
      width: nodeBBox.maxX - nodeBBox.minX,
      height: nodeBBox.maxY - nodeBBox.minY
    };
    const nodeAspectRatio = nodeSize.width / nodeSize.height;
    if (nodeAspectRatio < nodeData.sideRatio)
      nodeSize.width = nodeSize.height * nodeData.sideRatio;
    else
      nodeSize.height = nodeSize.width / nodeData.sideRatio;
    node.setData({
      ...nodeData,
      width: nodeSize.width,
      height: nodeSize.height
    });
  }
  getStartNode(canvas) {
    for (const [_, node] of canvas.nodes) {
      if (node.getData().isStartNode)
        return node;
    }
    return void 0;
  }
  setStartNode(canvas, node) {
    if (!node)
      return;
    const startNode = this.getStartNode(canvas);
    if (startNode)
      startNode.setData({ ...startNode.getData(), isStartNode: false });
    if (node !== startNode)
      node.setData({ ...node.getData(), isStartNode: true });
  }
  getDefaultSlideSize() {
    const slideSizeString = this.plugin.settings.getSetting("defaultSlideSize");
    const slideSizeArray = slideSizeString.split("x").map((value) => parseInt(value));
    return { width: slideSizeArray[0], height: slideSizeArray[1] };
  }
  getSlideAspectRatio() {
    const slideSize = this.getDefaultSlideSize();
    return slideSize.width / slideSize.height;
  }
  addSlide(canvas, pos, bbox) {
    const isStartNode = this.getStartNode(canvas) == null;
    const slideSize = this.getDefaultSlideSize();
    const slideAspectRatio = this.getSlideAspectRatio();
    if (bbox) {
      const bboxWidth = bbox.maxX - bbox.minX;
      const bboxHeight = bbox.maxY - bbox.minY;
      if (bboxWidth / bboxHeight > slideAspectRatio) {
        slideSize.width = bboxWidth;
        slideSize.height = bboxWidth / slideAspectRatio;
      } else {
        slideSize.height = bboxHeight;
        slideSize.width = bboxHeight * slideAspectRatio;
      }
      pos = {
        x: bbox.minX,
        y: bbox.minY
      };
    }
    if (!pos)
      pos = getCenterCoordinates(canvas, this.getDefaultSlideSize());
    const groupNode = canvas.createGroupNode({
      pos,
      size: slideSize,
      label: isStartNode ? START_SLIDE_NAME : DEFAULT_SLIDE_NAME,
      focus: false
    });
    groupNode.setData({
      ...groupNode.getData(),
      sideRatio: slideAspectRatio,
      isStartNode: isStartNode ? true : void 0
    });
  }
  async animateNodeTransition(canvas, fromNode, toNode) {
    const useCustomZoomFunction = this.plugin.settings.getSetting("zoomToSlideWithoutPadding");
    const animationDurationMs = this.plugin.settings.getSetting("slideTransitionAnimationDuration") * 1e3;
    if (animationDurationMs > 0 && fromNode) {
      const animationIntensity = this.plugin.settings.getSetting("slideTransitionAnimationIntensity");
      const currentNodeBBoxEnlarged = scaleBBox(fromNode.getBBox(), animationIntensity);
      if (useCustomZoomFunction)
        zoomToBBox(canvas, currentNodeBBoxEnlarged);
      else
        canvas.zoomToBbox(currentNodeBBoxEnlarged);
      await sleep(animationDurationMs / 2);
      const nextNodeBBoxEnlarged = scaleBBox(toNode.getBBox(), animationIntensity);
      if (useCustomZoomFunction)
        zoomToBBox(canvas, nextNodeBBoxEnlarged);
      else
        canvas.zoomToBbox(nextNodeBBoxEnlarged);
      await sleep(animationDurationMs / 2);
    }
    let nodeBBox = toNode.getBBox();
    if (useCustomZoomFunction)
      zoomToBBox(canvas, nodeBBox);
    else
      canvas.zoomToBbox(nodeBBox);
  }
  async startPresentation(canvas) {
    const startNode = this.getStartNode(canvas);
    if (!startNode) {
      new import_obsidian3.Notice("No start node found. Please mark a node as a start node trough the popup menu.");
      return;
    }
    this.visitedNodes = [];
    this.savedViewport = {
      x: canvas.tx,
      y: canvas.ty,
      zoom: canvas.tZoom
    };
    canvas.wrapperEl.focus();
    canvas.wrapperEl.requestFullscreen();
    canvas.wrapperEl.classList.add("presentation-mode");
    canvas.setReadonly(true);
    if (this.plugin.settings.getSetting("useArrowKeysToChangeSlides")) {
      canvas.wrapperEl.onkeydown = (e) => {
        if (e.key === "ArrowRight")
          this.nextNode(canvas);
        else if (e.key === "ArrowLeft")
          this.previousNode(canvas);
      };
    }
    const fullscreenModalObserver = new MutationObserver((mutationRecords) => {
      mutationRecords.forEach((mutationRecord) => {
        mutationRecord.addedNodes.forEach((node) => {
          var _a;
          document.body.removeChild(node);
          (_a = document.fullscreenElement) == null ? void 0 : _a.appendChild(node);
        });
      });
      const inputField = document.querySelector(".prompt-input");
      if (inputField)
        inputField.focus();
    });
    fullscreenModalObserver.observe(document.body, { childList: true });
    canvas.wrapperEl.onfullscreenchange = (_e) => {
      if (document.fullscreenElement)
        return;
      fullscreenModalObserver.disconnect();
      this.endPresentation(canvas);
    };
    this.isPresentationMode = true;
    await sleep(500);
    this.visitedNodes.push(startNode);
    this.animateNodeTransition(canvas, void 0, startNode);
  }
  endPresentation(canvas) {
    canvas.wrapperEl.onkeydown = null;
    canvas.wrapperEl.onfullscreenchange = null;
    canvas.setReadonly(false);
    canvas.wrapperEl.classList.remove("presentation-mode");
    if (document.fullscreenElement)
      document.exitFullscreen();
    canvas.setViewport(this.savedViewport.x, this.savedViewport.y, this.savedViewport.zoom);
    this.isPresentationMode = false;
  }
  nextNode(canvas) {
    var _a;
    const fromNode = this.visitedNodes.last();
    if (!fromNode)
      return;
    const outgoingEdges = canvas.getEdgesForNode(fromNode).filter((edge) => edge.from.node === fromNode);
    let toNode = (_a = outgoingEdges.first()) == null ? void 0 : _a.to.node;
    if (outgoingEdges.length > 1) {
      const sortedEdges = outgoingEdges.sort((a, b) => {
        if (!a.label)
          return 1;
        if (!b.label)
          return -1;
        return a.label.localeCompare(b.label);
      });
      const traversedEdgesCount = this.visitedNodes.filter((visitedNode) => visitedNode == fromNode).length - 1;
      const nextEdge = sortedEdges[traversedEdgesCount];
      toNode = nextEdge.to.node;
    }
    if (toNode) {
      this.visitedNodes.push(toNode);
      this.animateNodeTransition(canvas, fromNode, toNode);
    } else {
      this.animateNodeTransition(canvas, fromNode, fromNode);
    }
  }
  previousNode(canvas) {
    const fromNode = this.visitedNodes.pop();
    if (!fromNode)
      return;
    let toNode = this.visitedNodes.last();
    if (!toNode) {
      toNode = fromNode;
      this.visitedNodes.push(fromNode);
    }
    this.animateNodeTransition(canvas, fromNode, toNode);
  }
};

// src/canvas-extensions/node-data-tagger-canvas-extension.ts
function getExposedNodeData(settings) {
  const exposedData = [];
  if (settings.getSetting("stickersFeatureEnabled"))
    exposedData.push("isSticker");
  if (settings.getSetting("shapesFeatureEnabled"))
    exposedData.push("shape");
  if (settings.getSetting("collapsibleGroupsFeatureEnabled"))
    exposedData.push("isCollapsed");
  if (settings.getSetting("presentationFeatureEnabled"))
    exposedData.push("isStartNode");
  if (settings.getSetting("portalsFeatureEnabled"))
    exposedData.push("portalToFile", "portalId");
  return exposedData;
}
var NodeDataTaggerCanvasExtension = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.NodeChanged,
      (_canvas, node) => {
        const nodeData = node == null ? void 0 : node.getData();
        if (!nodeData)
          return;
        for (const dataKey of getExposedNodeData(this.plugin.settings)) {
          const dataValue = nodeData[dataKey];
          if (!dataValue)
            delete node.nodeEl.dataset[dataKey];
          else
            node.nodeEl.dataset[dataKey] = dataValue;
        }
      }
    ));
  }
};

// src/canvas-extensions/interaction-tagger-canvas-extension.ts
var TARGET_NODE_DATASET_PREFIX = "target";
var InteractionTaggerCanvasExtension = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.NodeInteraction,
      (canvas, node) => {
        const interactionEl = canvas.nodeInteractionLayer.interactionEl;
        if (!interactionEl)
          return;
        for (const dataKey of getExposedNodeData(this.plugin.settings)) {
          const datasetKey = TARGET_NODE_DATASET_PREFIX + dataKey.toString().charAt(0).toUpperCase() + dataKey.toString().slice(1);
          const dataValue = node == null ? void 0 : node.getData()[dataKey];
          if (!dataValue)
            delete interactionEl.dataset[datasetKey];
          else
            interactionEl.dataset[datasetKey] = dataValue;
        }
      }
    ));
  }
};

// src/canvas-extensions/readonly-canvas-extension.ts
var ReadonlyCanvasExtension = class {
  constructor(plugin) {
    this.plugin = plugin;
    const that = this;
    if (!this.plugin.settings.getSetting("betterReadonlyEnabled"))
      return;
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.PopupMenuCreated,
      (canvas, _node) => this.updatePopupMenu(canvas)
    ));
    let movingToBBox = false;
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.ViewportChanged.Before,
      (canvas) => {
        var _a, _b, _c, _d, _e, _f;
        if (movingToBBox) {
          movingToBBox = false;
          that.updateLockedZoom(canvas);
          that.updateLockedPan(canvas);
          return;
        }
        if (!canvas.readonly)
          return;
        if (that.plugin.settings.getSetting("disableZoom")) {
          canvas.zoom = (_a = canvas.lockedZoom) != null ? _a : canvas.zoom;
          canvas.tZoom = (_b = canvas.lockedZoom) != null ? _b : canvas.tZoom;
        }
        if (that.plugin.settings.getSetting("disablePan")) {
          canvas.x = (_c = canvas.lockedX) != null ? _c : canvas.x;
          canvas.tx = (_d = canvas.lockedX) != null ? _d : canvas.tx;
          canvas.y = (_e = canvas.lockedY) != null ? _e : canvas.y;
          canvas.ty = (_f = canvas.lockedY) != null ? _f : canvas.ty;
        }
      }
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.ZoomToBbox.Before,
      () => movingToBBox = true
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.ReadonlyChanged,
      (canvas, _readonly) => {
        this.updatePopupMenu(canvas);
        this.updateLockedZoom(canvas);
        this.updateLockedPan(canvas);
      }
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.CanvasChanged,
      (canvas) => this.addQuickSettings(canvas)
    ));
  }
  addQuickSettings(canvas) {
    var _a;
    const settingsContainer = (_a = canvas.quickSettingsButton) == null ? void 0 : _a.parentElement;
    if (!settingsContainer)
      return;
    addQuickSettingsButton(
      settingsContainer,
      this.createToggle({
        id: "disable-node-popup",
        label: "Disable node popup",
        icon: "arrow-up-right-from-circle",
        callback: () => this.updatePopupMenu(canvas)
      }, "disableNodePopup")
    );
    addQuickSettingsButton(
      settingsContainer,
      this.createToggle({
        id: "disable-zoom",
        label: "Disable zoom",
        icon: "zoom-in",
        callback: () => this.updateLockedZoom(canvas)
      }, "disableZoom")
    );
    addQuickSettingsButton(
      settingsContainer,
      this.createToggle({
        id: "disable-pan",
        label: "Disable pan",
        icon: "move",
        callback: () => this.updateLockedPan(canvas)
      }, "disablePan")
    );
  }
  createToggle(menuOption, settingKey) {
    const toggle = createQuickSettingsButton({
      ...menuOption,
      callback: () => (async () => {
        var _a;
        const newValue = !this.plugin.settings.getSetting(settingKey);
        await this.plugin.settings.setSetting({ [settingKey]: newValue });
        toggle.dataset.toggled = this.plugin.settings.getSetting(settingKey).toString();
        (_a = menuOption.callback) == null ? void 0 : _a.call(this);
      })()
    });
    toggle.classList.add("show-while-readonly");
    toggle.dataset.toggled = this.plugin.settings.getSetting(settingKey).toString();
    return toggle;
  }
  updatePopupMenu(canvas) {
    const hidden = canvas.readonly && this.plugin.settings.getSetting("disableNodePopup");
    canvas.menu.menuEl.style.visibility = hidden ? "hidden" : "visible";
  }
  updateLockedZoom(canvas) {
    canvas.lockedZoom = canvas.tZoom;
  }
  updateLockedPan(canvas) {
    canvas.lockedX = canvas.tx;
    canvas.lockedY = canvas.ty;
  }
};

// src/utils/modal-helper.ts
var import_obsidian4 = require("obsidian");

// src/utils/path-helper.ts
function extension(path) {
  return path.includes(".") ? path.split(".").pop() : void 0;
}

// src/utils/modal-helper.ts
var FileNameModal = class extends import_obsidian4.SuggestModal {
  constructor(app, parentPath, fileExtension) {
    super(app);
    this.parentPath = parentPath;
    this.fileExtension = fileExtension;
  }
  getSuggestions(query) {
    const queryWithoutExtension = query.replace(new RegExp(`\\.${this.fileExtension}$`), "");
    if (queryWithoutExtension === "")
      return [];
    const queryWithExtension = queryWithoutExtension + "." + this.fileExtension;
    const suggestions = [`${this.parentPath}/${queryWithExtension}`, queryWithExtension].filter((s) => this.app.vault.getAbstractFileByPath(s) === null);
    return suggestions;
  }
  renderSuggestion(text, el) {
    el.setText(text);
  }
  onChooseSuggestion(_text, _evt) {
  }
  awaitInput() {
    return new Promise((resolve, _reject) => {
      this.onChooseSuggestion = (text) => {
        resolve(text);
      };
      this.open();
    });
  }
};
var FileSelectModal = class extends import_obsidian4.SuggestModal {
  constructor(app, extensionsRegex, suggestNewFile = false) {
    super(app);
    this.files = this.app.vault.getFiles().map((file) => file.path).filter((path) => {
      var _a;
      return (_a = extension(path)) == null ? void 0 : _a.match(extensionsRegex != null ? extensionsRegex : /.*/);
    });
    this.suggestNewFile = suggestNewFile;
    this.setPlaceholder("Type to search...");
    this.setInstructions([{
      command: "\u2191\u2193",
      purpose: "to navigate"
    }, {
      command: "\u21B5",
      purpose: "to open"
    }, {
      command: "shift \u21B5",
      purpose: "to create"
    }, {
      command: "esc",
      purpose: "to dismiss"
    }]);
    this.scope.register(["Shift"], "Enter", (e) => {
      this.onChooseSuggestion(this.inputEl.value, e);
      this.close();
    });
  }
  getSuggestions(query) {
    const suggestions = this.files.filter((path) => path.toLowerCase().includes(query.toLowerCase()));
    if (suggestions.length === 0 && this.suggestNewFile)
      suggestions.push(query);
    return suggestions;
  }
  renderSuggestion(path, el) {
    const simplifiedPath = path.replace(/\.md$/, "");
    el.setText(simplifiedPath);
  }
  onChooseSuggestion(_path, _evt) {
  }
  awaitInput() {
    return new Promise((resolve, _reject) => {
      this.onChooseSuggestion = (path, _evt) => {
        const file = this.app.vault.getAbstractFileByPath(path);
        if (file instanceof import_obsidian4.TFile) {
          resolve(file);
          return;
        }
        if (!this.suggestNewFile)
          return;
        if (extension(path) === void 0)
          path += ".md";
        const newFile = this.app.vault.create(path, "");
        resolve(newFile);
      };
      this.open();
    });
  }
};

// src/canvas-extensions/encapsulate-canvas-extension.ts
var ENCAPSULATED_FILE_NODE_SIZE = { width: 300, height: 300 };
var EncapsulateCanvasExtension = class {
  constructor(plugin) {
    this.plugin = plugin;
    if (!this.plugin.settings.getSetting("canvasEncapsulationEnabled"))
      return;
    this.plugin.addCommand({
      id: "encapsulate-selection",
      name: "Encapsulate selection",
      checkCallback: canvasCommand(
        this.plugin,
        (canvas) => !canvas.readonly && canvas.selection.size > 0,
        (canvas) => this.encapsulateSelection(canvas)
      )
    });
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      "canvas:selection-menu",
      (menu, canvas) => {
        menu.addItem(
          (item) => item.setTitle("Encapsulate").setIcon("file-plus").onClick(() => this.encapsulateSelection(canvas))
        );
      }
    ));
  }
  async encapsulateSelection(canvas) {
    var _a;
    const selection = canvas.getSelectionData();
    const sourceFileFolder = (_a = canvas.view.file.parent) == null ? void 0 : _a.path;
    if (!sourceFileFolder)
      return;
    const targetFilePath = await new FileNameModal(
      this.plugin.app,
      sourceFileFolder,
      "canvas"
    ).awaitInput();
    const newFileData = { nodes: selection.nodes, edges: selection.edges };
    const file = await this.plugin.app.vault.create(targetFilePath, JSON.stringify(newFileData, null, 2));
    for (const nodeData of selection.nodes) {
      const node = canvas.nodes.get(nodeData.id);
      if (node)
        canvas.removeNode(node);
    }
    canvas.createFileNode({
      pos: {
        x: selection.center.x - ENCAPSULATED_FILE_NODE_SIZE.width / 2,
        y: selection.center.y - ENCAPSULATED_FILE_NODE_SIZE.height / 2
      },
      size: ENCAPSULATED_FILE_NODE_SIZE,
      file
    });
  }
};

// src/canvas-extensions/commands-canvas-extension.ts
var DIRECTIONS = ["up", "down", "left", "right"];
var CommandsCanvasExtension = class {
  constructor(plugin) {
    this.plugin = plugin;
    if (!this.plugin.settings.getSetting("commandsFeatureEnabled"))
      return;
    this.plugin.addCommand({
      id: "create-text-node",
      name: "Create text node",
      checkCallback: canvasCommand(
        this.plugin,
        (canvas) => !canvas.readonly,
        (canvas) => this.createTextNode(canvas)
      )
    });
    this.plugin.addCommand({
      id: "create-file-node",
      name: "Create file node",
      checkCallback: canvasCommand(
        this.plugin,
        (canvas) => !canvas.readonly,
        (canvas) => this.createFileNode(canvas)
      )
    });
    this.plugin.addCommand({
      id: "select-all-edges",
      name: "Select all edges",
      checkCallback: canvasCommand(
        this.plugin,
        (_canvas) => true,
        (canvas) => canvas.updateSelection(
          () => canvas.selection = new Set(canvas.edges.values())
        )
      )
    });
    this.plugin.addCommand({
      id: "zoom-to-selection",
      name: "Zoom to selection",
      checkCallback: canvasCommand(
        this.plugin,
        (canvas) => canvas.selection.size > 0,
        (canvas) => canvas.zoomToSelection()
      )
    });
    for (const direction of DIRECTIONS) {
      this.plugin.addCommand({
        id: `clone-node-${direction}`,
        name: `Clone node ${direction}`,
        checkCallback: canvasCommand(
          this.plugin,
          (canvas) => {
            var _a;
            return !canvas.readonly && canvas.selection.size === 1 && ((_a = canvas.selection.values().next().value) == null ? void 0 : _a.getData().type) === "text";
          },
          (canvas) => this.cloneNode(canvas, direction)
        )
      });
      this.plugin.addCommand({
        id: `expand-node-${direction}`,
        name: `Expand node ${direction}`,
        checkCallback: canvasCommand(
          this.plugin,
          (canvas) => !canvas.readonly && canvas.selection.size === 1,
          (canvas) => this.expandNode(canvas, direction)
        )
      });
    }
  }
  createTextNode(canvas) {
    const size = canvas.config.defaultTextNodeDimensions;
    const pos = getCenterCoordinates(canvas, size);
    canvas.createTextNode({ pos, size });
  }
  async createFileNode(canvas) {
    const size = canvas.config.defaultFileNodeDimensions;
    const pos = getCenterCoordinates(canvas, size);
    const file = await new FileSelectModal(this.plugin.app, void 0, true).awaitInput();
    canvas.createFileNode({ pos, size, file });
  }
  cloneNode(canvas, cloneDirection) {
    const sourceNode = canvas.selection.values().next().value;
    if (!sourceNode)
      return;
    const sourceNodeData = sourceNode.getData();
    const nodeMargin = this.plugin.settings.getSetting("cloneNodeMargin");
    const offset = {
      x: (sourceNode.width + nodeMargin) * (cloneDirection === "left" ? -1 : cloneDirection === "right" ? 1 : 0),
      y: (sourceNode.height + nodeMargin) * (cloneDirection === "up" ? -1 : cloneDirection === "down" ? 1 : 0)
    };
    const clonedNode = canvas.createTextNode({
      pos: {
        x: sourceNode.x + offset.x,
        y: sourceNode.y + offset.y
      },
      size: {
        width: sourceNode.width,
        height: sourceNode.height
      }
    });
    clonedNode.setData({
      ...clonedNode.getData(),
      color: sourceNodeData.color,
      shape: sourceNodeData.shape
    });
    if (this.plugin.settings.getSetting("zoomToClonedNode"))
      canvas.zoomToBbox(clonedNode.getBBox());
  }
  expandNode(canvas, expandDirection) {
    const node = canvas.selection.values().next().value;
    if (!node)
      return;
    const expandNodeStepSize = this.plugin.settings.getSetting("expandNodeStepSize");
    const expand = {
      x: expandDirection === "left" ? -1 : expandDirection === "right" ? 1 : 0,
      y: expandDirection === "up" ? -1 : expandDirection === "down" ? 1 : 0
    };
    node.setData({
      ...node.getData(),
      width: node.width + expand.x * expandNodeStepSize,
      height: node.height + expand.y * expandNodeStepSize
    });
  }
};

// src/canvas-extensions/portals-canvas-extension.ts
var import_obsidian5 = require("obsidian");
var PORTAL_PADDING = 50;
var MIN_OPEN_PORTAL_SIZE = { width: 200, height: 200 };
var PortalsCanvasExtension = class {
  constructor(plugin) {
    this.plugin = plugin;
    if (!this.plugin.settings.getSetting("portalsFeatureEnabled"))
      return;
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.PopupMenuCreated,
      (canvas) => this.updatePopupMenu(canvas)
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.NodeRemoved,
      (canvas, node) => this.onNodeRemoved(canvas, node)
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.NodeMoved,
      (canvas, node) => this.onNodeMoved(canvas, node)
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.DraggingStateChanged,
      (canvas, startedDragging) => this.onDraggingStateChanged(canvas, startedDragging)
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.ContainingNodesRequested,
      (canvas, bbox, nodes) => this.onContainingNodesRequested(canvas, bbox, nodes)
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.SelectionChanged,
      (canvas, oldSelection, updateSelection) => this.onSelectionChanged(canvas, oldSelection, updateSelection)
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.EdgeChanged,
      (canvas, edge) => this.onEdgeChanged(canvas, edge)
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.DataRequested,
      (canvas, data) => this.removePortalCanvasData(canvas, data)
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.LoadData,
      (canvas, data, setData) => {
        this.getCanvasDataWithPortals(canvas, data).then((newData) => {
          if (newData.nodes.length === data.nodes.length && newData.edges.length === data.edges.length)
            return;
          setData(newData);
        });
      }
    ));
  }
  updatePopupMenu(canvas) {
    if (canvas.readonly)
      return;
    const selectedFileNodes = canvas.getSelectionData().nodes.map((nodeData) => {
      var _a;
      const node = canvas.nodes.get(nodeData.id);
      if (!node)
        return null;
      if (nodeData.type !== "file")
        return null;
      if (((_a = node.file) == null ? void 0 : _a.extension) === "canvas")
        return node;
      if (nodeData.portalToFile)
        this.setPortalOpen(canvas, node, false);
      return null;
    }).filter((node) => node !== null);
    if (selectedFileNodes.length !== 1)
      return;
    const portalNode = selectedFileNodes[0];
    const portalNodeData = portalNode.getData();
    if (portalNodeData.portalToFile && portalNodeData.file !== portalNodeData.portalToFile) {
      this.setPortalOpen(canvas, portalNode, true);
    }
    addPopupMenuOption(
      canvas,
      createPopupMenuOption({
        id: "toggle-portal",
        label: portalNodeData.portalToFile ? "Close portal" : "Open portal",
        icon: portalNodeData.portalToFile ? "door-open" : "door-closed",
        callback: () => {
          this.setPortalOpen(canvas, portalNode, portalNodeData.portalToFile === void 0);
          this.updatePopupMenu(canvas);
        }
      })
    );
  }
  setPortalOpen(canvas, portalNode, open) {
    const portalNodeData = portalNode.getData();
    portalNode.setData({
      ...portalNodeData,
      portalToFile: open ? portalNodeData.file : void 0
    });
    canvas.setData(canvas.getData());
  }
  onNodeRemoved(canvas, node) {
    var _a, _b, _c, _d;
    const nodeData = node.getData();
    if (nodeData.type !== "file" || !nodeData.portalToFile)
      return;
    Object.keys((_b = (_a = nodeData.portalIdMaps) == null ? void 0 : _a.nodeIdMap) != null ? _b : {}).map((refNodeId) => canvas.nodes.get(refNodeId)).filter((node2) => node2 !== void 0).forEach((node2) => canvas.removeNode(node2));
    Object.keys((_d = (_c = nodeData.portalIdMaps) == null ? void 0 : _c.edgeIdMap) != null ? _d : {}).map((refEdgeId) => canvas.edges.get(refEdgeId)).filter((edge) => edge !== void 0).forEach((edge) => canvas.removeEdge(edge));
  }
  onEdgeChanged(_canvas, edge) {
    const isUnsaved = edge.from.node !== void 0 && edge.to.node !== void 0 && // Edge not fully connected
    (edge.from.node.getData().portalId !== void 0 && edge.to.node.getData().portalId !== void 0) && // Both nodes are from portal
    edge.getData().portalId === void 0;
    edge.setData({
      ...edge.getData(),
      isUnsaved: isUnsaved ? true : void 0
    });
  }
  onContainingNodesRequested(_canvas, _bbox, nodes) {
    nodes.splice(0, nodes.length, ...nodes.filter((node) => node.getData().portalId === void 0));
  }
  onSelectionChanged(canvas, oldSelection, updateSelection) {
    updateSelection(() => {
      const updatedSelection = Array.from(canvas.selection).filter((node) => node.getData().portalId === void 0);
      canvas.selection = new Set(updatedSelection);
    });
    const previouslySelectedPortalNodesIds = Array.from(oldSelection).filter((node) => node.getData().portalToFile !== void 0).flatMap((node) => {
      const portalNodeData = node.getData();
      const nestedPortalsIds = this.getNestedPortalsIds(canvas, portalNodeData.id);
      return [portalNodeData.id, ...nestedPortalsIds];
    });
    for (const node of canvas.nodes.values()) {
      const nodeData = node.getData();
      if (nodeData.portalId === void 0 || !previouslySelectedPortalNodesIds.includes(nodeData.portalId))
        continue;
      node.updateZIndex();
    }
  }
  getNestedPortalsIds(canvas, portalId) {
    const nestedPortalsIds = [];
    for (const node of canvas.nodes.values()) {
      const nodeData = node.getData();
      if (nodeData.portalId === portalId) {
        nestedPortalsIds.push(nodeData.id);
        nestedPortalsIds.push(...this.getNestedPortalsIds(canvas, nodeData.id));
      }
    }
    return nestedPortalsIds;
  }
  onDraggingStateChanged(canvas, startedDragging) {
    var _a;
    if (!canvas.getSelectionData().nodes.some((node) => node.type === "file" && node.portalToFile))
      return;
    if (startedDragging) {
      const objectSnappingEnabled = canvas.options.snapToObjects;
      this.restoreObjectSnappingState = () => canvas.toggleObjectSnapping(objectSnappingEnabled);
      if (objectSnappingEnabled)
        canvas.toggleObjectSnapping(false);
    } else
      (_a = this.restoreObjectSnappingState) == null ? void 0 : _a.call(this);
  }
  onNodeMoved(canvas, node) {
    const nodeData = node.getData();
    if (nodeData.type !== "file" || !nodeData.portalToFile)
      return;
    this.onOpenPortalMoved(canvas, node);
  }
  onOpenPortalMoved(canvas, portalNode) {
    var _a;
    let portalNodeData = portalNode.getData();
    const nestedNodesIdMap = (_a = portalNode.getData().portalIdMaps) == null ? void 0 : _a.nodeIdMap;
    if (!nestedNodesIdMap)
      return;
    const nestedNodes = Object.keys(nestedNodesIdMap).map((refNodeId) => canvas.nodes.get(refNodeId)).filter((node) => node !== void 0);
    const sourceBBox = getBBox(nestedNodes);
    const targetSize = this.getPortalSize(sourceBBox);
    if (portalNodeData.width !== targetSize.width || portalNodeData.height !== targetSize.height) {
      portalNode.setData({
        ...portalNodeData,
        width: targetSize.width,
        height: targetSize.height
      });
      return;
    }
    const portalOffset = {
      x: portalNodeData.x - sourceBBox.minX + PORTAL_PADDING,
      y: portalNodeData.y - sourceBBox.minY + PORTAL_PADDING
    };
    for (const nestedNode of nestedNodes) {
      const nestedNodeData = nestedNode.getData();
      nestedNode.setData({
        ...nestedNodeData,
        x: nestedNodeData.x + portalOffset.x,
        y: nestedNodeData.y + portalOffset.y
      });
    }
  }
  removePortalCanvasData(_canvas, data) {
    var _a, _b;
    data.edges = data.edges.filter((edgeData) => {
      var _a2, _b2;
      if (edgeData.portalId !== void 0)
        return false;
      const fromNodeData = data.nodes.find((nodeData) => nodeData.id === edgeData.fromNode);
      const toNodeData = data.nodes.find((nodeData) => nodeData.id === edgeData.toNode);
      if (!fromNodeData || !toNodeData)
        return true;
      if (fromNodeData.portalId === void 0 && toNodeData.portalId === void 0) {
        return true;
      } else if (fromNodeData.portalId !== void 0 && toNodeData.portalId !== void 0) {
        return false;
      } else {
        const fromPortalNodeData = fromNodeData.portalId !== void 0 ? fromNodeData : toNodeData;
        const notFromPortalNodeData = fromNodeData.portalId !== void 0 ? toNodeData : fromNodeData;
        notFromPortalNodeData.edgesToNodeFromPortal = (_a2 = notFromPortalNodeData.edgesToNodeFromPortal) != null ? _a2 : {};
        notFromPortalNodeData.edgesToNodeFromPortal[fromPortalNodeData.portalId] = (_b2 = notFromPortalNodeData.edgesToNodeFromPortal[fromPortalNodeData.portalId]) != null ? _b2 : [];
        notFromPortalNodeData.edgesToNodeFromPortal[fromPortalNodeData.portalId].push(edgeData);
        return false;
      }
    });
    data.nodes = data.nodes.filter((nodeData) => nodeData.portalId === void 0);
    for (const portalNodeData of data.nodes) {
      if (portalNodeData.type !== "file")
        continue;
      if (this.plugin.settings.getSetting("maintainClosedPortalSize")) {
        portalNodeData.width = (_a = portalNodeData.closedPortalWidth) != null ? _a : portalNodeData.width;
        portalNodeData.height = (_b = portalNodeData.closedPortalHeight) != null ? _b : portalNodeData.height;
      }
      delete portalNodeData.closedPortalWidth;
      delete portalNodeData.closedPortalHeight;
      delete portalNodeData.portalIdMaps;
    }
  }
  async getCanvasDataWithPortals(canvas, dataRef) {
    const data = JSON.parse(JSON.stringify(dataRef));
    const addedData = await Promise.all(data.nodes.map((nodeData) => this.tryOpenPortal(canvas, nodeData)));
    for (const newData of addedData) {
      data.nodes.push(...newData.nodes);
      data.edges.push(...newData.edges);
    }
    for (const originNodeData of data.nodes) {
      if (originNodeData.edgesToNodeFromPortal === void 0)
        continue;
      for (const [relativePortalId, edges] of Object.entries(originNodeData.edgesToNodeFromPortal)) {
        const idPrefix = originNodeData.portalId ? `${originNodeData.portalId}-` : "";
        const portalId = `${idPrefix}${relativePortalId}`;
        const targetPortalData = data.nodes.find((nodeData) => nodeData.id === portalId);
        if (!targetPortalData) {
          delete originNodeData.edgesToNodeFromPortal[portalId];
          continue;
        }
        if (targetPortalData.portalToFile) {
          data.edges.push(...edges.map((edge) => ({
            ...edge,
            portalId: originNodeData.portalId,
            fromNode: `${idPrefix}${edge.fromNode}`,
            toNode: `${idPrefix}${edge.toNode}`
          })));
          delete originNodeData.edgesToNodeFromPortal[portalId];
        } else if (this.plugin.settings.getSetting("showEdgesIntoDisabledPortals")) {
          data.edges.push(...edges.map((edge) => {
            const fromNodeId = `${idPrefix}${edge.fromNode}`;
            const fromNode = data.nodes.find((nodeData) => nodeData.id === fromNodeId);
            const toNodeId = `${idPrefix}${edge.toNode}`;
            return {
              ...edge,
              fromNode: fromNode ? fromNodeId : portalId,
              toNode: fromNode ? portalId : toNodeId,
              portalId
              // Mark it as temporary
            };
          }));
        }
      }
      if (Object.keys(originNodeData.edgesToNodeFromPortal).length === 0)
        delete originNodeData.edgesToNodeFromPortal;
    }
    return data;
  }
  async tryOpenPortal(canvas, portalNodeData) {
    var _a, _b;
    const addedData = { nodes: [], edges: [] };
    if (portalNodeData.type !== "file" || !portalNodeData.portalToFile)
      return addedData;
    portalNodeData.portalToFile = portalNodeData.file;
    if (portalNodeData.portalToFile === canvas.view.file.path) {
      portalNodeData.portalToFile = void 0;
      return addedData;
    }
    const portalFile = this.plugin.app.vault.getAbstractFileByPath(portalNodeData.file);
    if (!(portalFile instanceof import_obsidian5.TFile) || portalFile.extension !== "canvas") {
      portalNodeData.portalToFile = void 0;
      return addedData;
    }
    const portalFileData = JSON.parse(await this.plugin.app.vault.cachedRead(portalFile));
    if (!portalFileData) {
      portalNodeData.portalToFile = void 0;
      return addedData;
    }
    portalNodeData.portalIdMaps = {
      nodeIdMap: {},
      edgeIdMap: {}
    };
    const sourceMinCoordinates = getBBox(portalFileData.nodes);
    const portalOffset = {
      x: portalNodeData.x - sourceMinCoordinates.minX + PORTAL_PADDING,
      y: portalNodeData.y - sourceMinCoordinates.minY + PORTAL_PADDING
    };
    for (const nodeDataFromPortal of portalFileData.nodes) {
      const refNodeId = `${portalNodeData.id}-${nodeDataFromPortal.id}`;
      portalNodeData.portalIdMaps.nodeIdMap[refNodeId] = nodeDataFromPortal.id;
      const addedNode = {
        ...nodeDataFromPortal,
        id: refNodeId,
        x: nodeDataFromPortal.x + portalOffset.x,
        y: nodeDataFromPortal.y + portalOffset.y,
        portalId: portalNodeData.id
      };
      addedData.nodes.push(addedNode);
      const nestedNodes = await this.tryOpenPortal(canvas, addedNode);
      addedData.nodes.push(...nestedNodes.nodes);
      addedData.edges.push(...nestedNodes.edges);
    }
    for (const edgeDataFromPortal of portalFileData.edges) {
      const refEdgeId = `${portalNodeData.id}-${edgeDataFromPortal.id}`;
      portalNodeData.portalIdMaps.edgeIdMap[refEdgeId] = edgeDataFromPortal.id;
      const fromRefNode = (_a = Object.entries(portalNodeData.portalIdMaps.nodeIdMap).find(([_refNodeId, nodeId]) => nodeId === edgeDataFromPortal.fromNode)) == null ? void 0 : _a[0];
      const toRefNode = (_b = Object.entries(portalNodeData.portalIdMaps.nodeIdMap).find(([_refNodeId, nodeId]) => nodeId === edgeDataFromPortal.toNode)) == null ? void 0 : _b[0];
      addedData.edges.push({
        ...edgeDataFromPortal,
        id: refEdgeId,
        fromNode: fromRefNode,
        toNode: toRefNode,
        portalId: portalNodeData.id
      });
    }
    const nestedNodesBBox = getBBox(addedData.nodes);
    const targetSize = this.getPortalSize(nestedNodesBBox);
    portalNodeData.closedPortalWidth = portalNodeData.width;
    portalNodeData.closedPortalHeight = portalNodeData.height;
    portalNodeData.width = targetSize.width;
    portalNodeData.height = targetSize.height;
    return addedData;
  }
  getPortalSize(sourceBBox) {
    const sourceSize = {
      width: sourceBBox.maxX - sourceBBox.minX,
      height: sourceBBox.maxY - sourceBBox.minY
    };
    const targetSize = {
      width: Math.max(sourceSize.width + PORTAL_PADDING * 2, MIN_OPEN_PORTAL_SIZE.width),
      height: Math.max(sourceSize.height + PORTAL_PADDING * 2, MIN_OPEN_PORTAL_SIZE.height)
    };
    if (!Number.isFinite(targetSize.width))
      targetSize.width = MIN_OPEN_PORTAL_SIZE.width;
    if (!Number.isFinite(targetSize.height))
      targetSize.height = MIN_OPEN_PORTAL_SIZE.height;
    return targetSize;
  }
};

// src/utils/icons-helper.ts
var import_obsidian6 = require("obsidian");
var CUSTOM_ICONS = {
  "oval": `<rect rx="31.25" height="62.5" width="93.75" y="18.75" x="3.125" stroke-width="8.333" stroke="currentColor" fill="transparent"/>`,
  "parallelogram": `<rect transform="skewX(-20)" rx="5" height="50" width="70" y="25" x="35" stroke-width="8.333" stroke="currentColor" fill="transparent"/>`,
  "predefined-process": `
    <g stroke-width="2" stroke="currentColor" fill="none" transform="matrix(4.166667,0,0,4.166667,0,0)">
      <path d="M 4.999687 3 L 19.000312 3 C 20.104688 3 21 3.895312 21 4.999687 L 21 19.000312 C 21 20.104688 20.104688 21 19.000312 21 L 4.999687 21 C 3.895312 21 3 20.104688 3 19.000312 L 3 4.999687 C 3 3.895312 3.895312 3 4.999687 3 Z M 4.999687 3 "/>
      <path d="M 7 3 L 7 21 "/>
      <path d="M 17 3 L 17 21 "/>
    </g>
  `,
  "document": `<path transform="translate(0, 5)" stroke="currentColor" fill="none" stroke-width="8.333" d="M83.75 25C85.82 25 87.5 26.68 87.5 28.75L87.5 64.375Q68.75 54.25 50 64.375 31.25 74.5 12.5 64.375L12.5 30.625 12.5 28.75C12.5 26.68 14.18 25 16.25 25Z"/>`,
  "database-shape": `
    <g transform="translate(20, 20)" stroke-width="8.333" stroke="currentColor" fill="none">
      <path d="M 1 51 L 1 11 C 1 5.48 14.43 1 31 1 C 47.57 1 61 5.48 61 11 L 61 51 C 61 56.52 47.57 61 31 61 C 14.43 61 1 56.52 1 51 Z"/>
      <path d="M 1 11 C 1 16.52 14.43 21 31 21 C 47.57 21 61 16.52 61 11"/>
    </g>
  `,
  "dotted-line": `<path stroke="currentColor" fill="none" stroke-width="8.5" stroke-dasharray="8.5" d="M20.85 50h58.5"/>`,
  "short-dashed-line": `<path stroke="currentColor" fill="none" stroke-width="8.5" stroke-dasharray="10" d="M20.85 50h58.5"/>`,
  "long-dashed-line": `<path stroke="currentColor" fill="none" stroke-width="8.5" stroke-dasharray="20" d="M20.85 50h58.5"/>`
};
var IconsHelper = class {
  static addIcons() {
    for (const [id, svg] of Object.entries(CUSTOM_ICONS)) {
      (0, import_obsidian6.addIcon)(id, svg);
    }
  }
};

// src/canvas-extensions/stickers-canvas-extension.ts
var IMAGE_FILE_EXTENSIONS = ["bmp", "png", "jpg", "jpeg", "gif", "svg", "webp", "avif"];
var StickersCanvasExtension = class {
  constructor(plugin) {
    this.plugin = plugin;
    if (!this.plugin.settings.getSetting("stickersFeatureEnabled"))
      return;
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.PopupMenuCreated,
      (canvas) => this.onPopupMenuCreated(canvas)
    ));
  }
  onPopupMenuCreated(canvas) {
    if (canvas.readonly || !this.hasValidNodeInSelection(canvas))
      return;
    addPopupMenuOption(
      canvas,
      createPopupMenuOption({
        id: "sticker-option",
        label: "Toggle sticker",
        icon: "badge",
        callback: () => this.toggleStickerForSelection(canvas)
      })
    );
  }
  hasValidNodeInSelection(canvas) {
    var _a, _b;
    const selectedNodesData = canvas.getSelectionData().nodes;
    for (const nodeData of selectedNodesData) {
      if (nodeData.type !== "file")
        continue;
      const nodeFileExtension = (_b = (_a = nodeData.file) == null ? void 0 : _a.split(".").pop()) == null ? void 0 : _b.toLowerCase();
      if (!nodeFileExtension)
        continue;
      if (!IMAGE_FILE_EXTENSIONS.includes(nodeFileExtension))
        continue;
      return true;
    }
    return false;
  }
  toggleStickerForSelection(canvas) {
    const selectedNodesData = canvas.getSelectionData().nodes;
    for (const nodeData of selectedNodesData) {
      if (nodeData.type !== "file")
        continue;
      const node = canvas.nodes.get(nodeData.id);
      if (!node)
        continue;
      const wasSticker = node.getData().isSticker;
      node.setData({ ...nodeData, isSticker: wasSticker ? void 0 : true });
    }
  }
};

// src/utils/a-star-helper.ts
var DIRECTIONS2 = [
  { dx: 1, dy: 0 },
  { dx: -1, dy: 0 },
  { dx: 0, dy: 1 },
  { dx: 0, dy: -1 },
  { dx: 1, dy: 1 },
  { dx: -1, dy: 1 },
  { dx: 1, dy: -1 },
  { dx: -1, dy: -1 }
];
var DIAGONAL_COST = Math.sqrt(2);
var Node = class {
  constructor(x, y) {
    this.x = x;
    this.y = y;
    this.gCost = 0;
    this.hCost = 0;
    this.fCost = 0;
    this.parent = null;
  }
  // Only check for x and y, not gCost, hCost, fCost, or parent
  inList(nodes) {
    return nodes.some((n) => n.x === this.x && n.y === this.y);
  }
};
function heuristic(node, end) {
  return Math.abs(node.x - end.x) + Math.abs(node.y - end.y);
}
function isTouchingObstacle(node, obstacles) {
  return obstacles.some((obstacle) => insideBBox(node, obstacle, true));
}
function isInsideObstacle(node, obstacles) {
  return obstacles.some((obstacle) => insideBBox(node, obstacle, false));
}
function getMovementCost(direction) {
  return direction.dx !== 0 && direction.dy !== 0 ? DIAGONAL_COST : 1;
}
function getPossibleNeighbors(node, obstacles, gridResolution) {
  const neighbors = [];
  for (const direction of DIRECTIONS2) {
    const neighbor = new Node(
      node.x + direction.dx * gridResolution,
      node.y + direction.dy * gridResolution
    );
    neighbor.gCost = node.gCost + getMovementCost(direction);
    if (isInsideObstacle(neighbor, obstacles))
      continue;
    neighbors.push(neighbor);
  }
  return neighbors;
}
function reconstructPath(node) {
  const path = [];
  while (node) {
    path.push(node);
    node = node.parent;
  }
  return path.reverse();
}
function aStar(fromPos, fromSide, toPos, toSide, obstacles, gridResolution) {
  const start = new Node(
    Math.floor(fromPos.x / gridResolution) * gridResolution,
    Math.floor(fromPos.y / gridResolution) * gridResolution
  );
  if (fromSide === "right" && fromPos.x !== start.x)
    start.x += gridResolution;
  if (fromSide === "bottom" && fromPos.y !== start.y)
    start.y += gridResolution;
  const end = new Node(
    Math.floor(toPos.x / gridResolution) * gridResolution,
    Math.floor(toPos.y / gridResolution) * gridResolution
  );
  if (toSide === "right" && toPos.x !== end.x)
    end.x += gridResolution;
  if (toSide === "bottom" && toPos.y !== end.y)
    end.y += gridResolution;
  if (isInsideObstacle(start, obstacles) || isInsideObstacle(end, obstacles))
    return null;
  const openSet = [start];
  const closedSet = [];
  while (openSet.length > 0) {
    let current = null;
    let lowestFCost = Infinity;
    for (const node of openSet) {
      if (node.fCost < lowestFCost) {
        current = node;
        lowestFCost = node.fCost;
      }
    }
    if (!current)
      return null;
    openSet.splice(openSet.indexOf(current), 1);
    closedSet.push(current);
    if (current.x === end.x && current.y === end.y) {
      return [fromPos, ...reconstructPath(current), toPos].map((node) => ({ x: node.x, y: node.y }));
    }
    if (!(current.x === start.x && current.y === start.y) && isTouchingObstacle(current, obstacles))
      continue;
    for (const neighbor of getPossibleNeighbors(current, obstacles, gridResolution)) {
      if (neighbor.inList(closedSet))
        continue;
      const tentativeGCost = current.gCost + getMovementCost({
        dx: neighbor.x - current.x,
        dy: neighbor.y - current.y
      });
      if (!neighbor.inList(openSet) || tentativeGCost < neighbor.gCost) {
        neighbor.parent = current;
        neighbor.gCost = tentativeGCost;
        neighbor.hCost = heuristic(neighbor, end);
        neighbor.fCost = neighbor.gCost + neighbor.hCost;
        openSet.push(neighbor);
      }
    }
  }
  return null;
}

// src/utils/svg-path-helper.ts
function pathArrayToSvgPath(positions, rounded = false) {
  const tension = 0.2;
  let newPositions = [...positions];
  if (rounded && positions.length > 2) {
    newPositions = [positions[0]];
    for (let i = 1; i < positions.length - 2; i++) {
      const p1 = positions[i];
      const p2 = positions[i + 1];
      const p3 = positions[i + 2];
      const t1 = (1 - tension) / 2;
      const t2 = 1 - t1;
      const x = t2 * t2 * t2 * p1.x + 3 * t2 * t2 * t1 * p2.x + 3 * t2 * t1 * t1 * p3.x + t1 * t1 * t1 * p2.x;
      const y = t2 * t2 * t2 * p1.y + 3 * t2 * t2 * t1 * p2.y + 3 * t2 * t1 * t1 * p3.y + t1 * t1 * t1 * p2.y;
      newPositions.push({ x, y });
    }
    const lastPoint = positions[positions.length - 1];
    newPositions.push(lastPoint);
  }
  for (let i = 0; i < newPositions.length - 2; i++) {
    const p1 = newPositions[i];
    const p2 = newPositions[i + 1];
    const p3 = newPositions[i + 2];
    const currentDirection = {
      x: p2.x - p1.x,
      y: p2.y - p1.y
    };
    const nextDirection = {
      x: p3.x - p2.x,
      y: p3.y - p2.y
    };
    if (currentDirection.x !== nextDirection.x && currentDirection.y !== nextDirection.y)
      continue;
    newPositions.splice(i + 1, 1);
    i--;
  }
  return newPositions.map(
    (position, index) => `${index === 0 ? "M" : "L"} ${position.x} ${position.y}`
  ).join(" ");
}

// src/canvas-extensions/edges-style-canvas-extension.ts
var STYLES_MENU_OPTIONS = [
  {
    id: void 0,
    label: "Default",
    icon: "minus"
  },
  {
    id: "long-dashed",
    label: "Dashed (long)",
    icon: "long-dashed-line"
  },
  {
    id: "short-dashed",
    label: "Dashed",
    icon: "short-dashed-line"
  },
  {
    id: "dotted",
    label: "Dotted",
    icon: "dotted-line"
  }
];
var ROUTES_MENU_OPTIONS = [
  {
    id: void 0,
    label: "Default",
    icon: "route"
  },
  {
    id: "direct",
    label: "Direct",
    icon: "minus"
  },
  {
    id: "square",
    label: "Square",
    icon: "corner-down-right"
  },
  {
    id: "a-star",
    label: "A*",
    icon: "navigation"
  }
];
var EdgesStyleCanvasExtension = class {
  constructor(plugin) {
    this.plugin = plugin;
    if (!this.plugin.settings.getSetting("edgesStylingFeatureEnabled"))
      return;
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.PopupMenuCreated,
      (canvas) => this.onPopupMenuCreated(canvas)
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.EdgeChanged,
      (canvas, edge) => this.onEdgeChanged(canvas, edge)
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.EdgeCenterRequested,
      (canvas, edge, center) => this.onEdgeCenterRequested(canvas, edge, center)
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.NodeAdded,
      (canvas, _node) => this.updateAllEdges(canvas)
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.NodeRemoved,
      (canvas, _node) => this.updateAllEdges(canvas)
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.DraggingStateChanged,
      (canvas, isDragging) => {
        if (!isDragging)
          this.updateAllEdges(canvas);
      }
    ));
  }
  onPopupMenuCreated(canvas) {
    const selectedEdges = [...canvas.selection].filter((item) => item.path !== void 0);
    if (canvas.readonly || selectedEdges.length === 0)
      return;
    const pathStyleNestedOptions = STYLES_MENU_OPTIONS.map((style) => ({
      ...style,
      id: void 0,
      callback: () => this.setStyleForSelection(canvas, selectedEdges, style.id)
    }));
    const pathStyleMenuOption = createExpandablePopupMenuOption({
      id: "edge-style-option",
      label: "Edge style",
      icon: "minus"
    }, pathStyleNestedOptions);
    addPopupMenuOption(canvas, pathStyleMenuOption, -2);
    const pathRouteNestedOptions = ROUTES_MENU_OPTIONS.map((route) => ({
      ...route,
      id: void 0,
      callback: () => this.setPathRouteForSelection(canvas, selectedEdges, route.id)
    }));
    const pathRouteMenuOption = createExpandablePopupMenuOption({
      id: "edge-path-route-option",
      label: "Edge path route",
      icon: "route"
    }, pathRouteNestedOptions);
    addPopupMenuOption(canvas, pathRouteMenuOption, -2);
  }
  setStyleForSelection(_canvas, selectedEdges, styleId) {
    for (const edge of selectedEdges) {
      edge.setData({ ...edge.getData(), edgeStyle: styleId });
    }
  }
  setPathRouteForSelection(_canvas, selectedEdges, pathRouteTypeId) {
    for (const edge of selectedEdges) {
      edge.setData({ ...edge.getData(), edgePathRoute: pathRouteTypeId });
    }
  }
  updateAllEdges(canvas) {
    for (const edge of canvas.edges.values()) {
      this.onEdgeChanged(canvas, edge);
    }
  }
  onEdgeChanged(canvas, edge) {
    var _a, _b, _c;
    if (!edge.bezier)
      return;
    edge.updatePath();
    edge.center = void 0;
    const pathRouteType = (_a = edge.getData().edgePathRoute) != null ? _a : "default";
    if (pathRouteType === "default") {
      (_b = edge.labelElement) == null ? void 0 : _b.render();
      return;
    }
    const fromPos = edge.from.end === "none" ? getCenterOfBBoxSide(edge.from.node.getBBox(), edge.from.side) : edge.bezier.from;
    const toPos = edge.to.end === "none" ? getCenterOfBBoxSide(edge.to.node.getBBox(), edge.to.side) : edge.bezier.to;
    let newPath = edge.path.display.getAttribute("d");
    if (pathRouteType === "direct") {
      newPath = pathArrayToSvgPath([fromPos, toPos], false);
      edge.center = {
        x: (fromPos.x + toPos.x) / 2,
        y: (fromPos.y + toPos.y) / 2
      };
    } else if (pathRouteType === "square") {
      let pathArray = [];
      if (edge.from.side === "bottom" || edge.from.side === "top") {
        pathArray = [
          fromPos,
          { x: fromPos.x, y: fromPos.y + (toPos.y - fromPos.y) / 2 },
          { x: toPos.x, y: fromPos.y + (toPos.y - fromPos.y) / 2 },
          toPos
        ];
      } else {
        pathArray = [
          fromPos,
          { x: fromPos.x + (toPos.x - fromPos.x) / 2, y: fromPos.y },
          { x: fromPos.x + (toPos.x - fromPos.x) / 2, y: toPos.y },
          toPos
        ];
      }
      newPath = pathArrayToSvgPath(pathArray, false);
      edge.center = {
        x: (fromPos.x + toPos.x) / 2,
        y: (fromPos.y + toPos.y) / 2
      };
    } else if (pathRouteType === "a-star") {
      if (canvas.isDragging && !this.plugin.settings.getSetting("edgeStylePathfinderPathLiveUpdate"))
        return;
      const nodeBBoxes = [...canvas.nodes.values()].filter((node) => {
        const nodeData = node.getData();
        const isGroup = nodeData.type === "group";
        const isOpenPortal = nodeData.portalToFile !== void 0;
        return !isGroup && !isOpenPortal;
      }).map((node) => node.getBBox());
      const gridResolution = this.plugin.settings.getSetting("edgeStylePathfinderGridResolution");
      const pathArray = aStar(fromPos, edge.from.side, toPos, edge.to.side, nodeBBoxes, gridResolution);
      if (!pathArray)
        return;
      const roundedPath = this.plugin.settings.getSetting("edgeStylePathfinderPathRounded");
      const svgPath = pathArrayToSvgPath(pathArray, roundedPath);
      newPath = svgPath;
      edge.center = pathArray[Math.floor(pathArray.length / 2)];
    }
    edge.path.interaction.setAttr("d", newPath);
    edge.path.display.setAttr("d", newPath);
    (_c = edge.labelElement) == null ? void 0 : _c.render();
  }
  onEdgeCenterRequested(_canvas, edge, center) {
    var _a, _b, _c, _d;
    center.x = (_b = (_a = edge.center) == null ? void 0 : _a.x) != null ? _b : center.x;
    center.y = (_d = (_c = edge.center) == null ? void 0 : _c.y) != null ? _d : center.y;
  }
};

// src/canvas-extensions/edge-data-tagger-canvas-extension.ts
function getExposedEdgeData(settings) {
  const exposedData = [];
  if (settings.getSetting("edgesStylingFeatureEnabled"))
    exposedData.push("edgeStyle");
  if (settings.getSetting("portalsFeatureEnabled"))
    exposedData.push("isUnsaved");
  return exposedData;
}
var EdgeDataTaggerCanvasExtension = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.EdgeChanged,
      (_canvas, edge) => {
        const edgeData = edge == null ? void 0 : edge.getData();
        if (!edgeData)
          return;
        for (const dataKey of getExposedEdgeData(this.plugin.settings)) {
          const dataValue = edgeData[dataKey];
          if (!dataValue)
            delete edge.path.display.dataset[dataKey];
          else
            edge.path.display.dataset[dataKey] = dataValue;
        }
      }
    ));
  }
};

// src/utils/debug-helper.ts
var DebugHelper = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.NodeAdded,
      (_canvas, _node) => console.count("\u{1F7E2} NodeAdded")
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.NodeChanged,
      (_canvas, _node) => console.count("\u{1F7E1} NodeChanged")
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.EdgeAdded,
      (_canvas, _edge) => console.count("\u{1F7E2} EdgeAdded")
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.EdgeChanged,
      (_canvas, _edge) => console.count("\u{1F7E1} EdgeChanged")
    ));
  }
};

// src/canvas-extensions/better-default-settings-canvas-extension.ts
var BetterDefaultSettingsCanvasExtension = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      SettingsManager.SETTINGS_CHANGED_EVENT,
      () => this.applySettings(this.plugin.getCurrentCanvas())
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.CanvasChanged,
      (canvas) => this.applySettings(canvas)
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.DoubleClick,
      (canvas, event, preventDefault) => this.onDoubleClick(canvas, event, preventDefault)
    ));
    this.applySettings(this.plugin.getCurrentCanvas());
  }
  applySettings(canvas) {
    if (!canvas)
      return;
    canvas.config.defaultTextNodeDimensions = {
      width: this.plugin.settings.getSetting("defaultTextNodeWidth"),
      height: this.plugin.settings.getSetting("defaultTextNodeHeight")
    };
    canvas.config.defaultFileNodeDimensions = {
      width: this.plugin.settings.getSetting("defaultFileNodeWidth"),
      height: this.plugin.settings.getSetting("defaultFileNodeHeight")
    };
  }
  async onDoubleClick(canvas, event, preventDefault) {
    if (event.defaultPrevented || event.target !== canvas.wrapperEl || canvas.isDragging || canvas.readonly)
      return;
    preventDefault.value = true;
    var pos = canvas.posFromEvt(event);
    switch (this.plugin.settings.getSetting("nodeTypeOnDoubleClick")) {
      case "file":
        const file = await new FileSelectModal(this.plugin.app, void 0, true).awaitInput();
        canvas.createFileNode({
          pos,
          position: "center",
          file
        });
        break;
      default:
        canvas.createTextNode({
          pos,
          position: "center"
        });
        break;
    }
  }
};

// src/canvas-extensions/color-palette-canvas-extension.ts
var DEFAULT_COLORS_COUNT = 6;
var CUSTOM_COLORS_MOD_STYLES_ID = "mod-custom-colors";
var ColorPaletteCanvasExtension = class {
  constructor(plugin) {
    this.observer = null;
    this.plugin = plugin;
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      "window-open",
      (_win, _window) => this.updateCustomColorModStyleClasses()
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      "css-change",
      () => this.updateCustomColorModStyleClasses()
    ));
    this.updateCustomColorModStyleClasses();
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.PopupMenuCreated,
      (canvas) => this.patchColorSelection(canvas)
    ));
    this.plugin.register(() => {
      var _a;
      return (_a = this.observer) == null ? void 0 : _a.disconnect();
    });
  }
  updateCustomColorModStyleClasses() {
    var _a;
    const customCss = this.getCustomColors().map((colorId) => `
      .mod-canvas-color-${colorId} {
        --canvas-color: var(--canvas-color-${colorId});
      }
    `).join("");
    for (const win of this.plugin.windowsManager.windows) {
      const doc = win.document;
      (_a = doc.getElementById(CUSTOM_COLORS_MOD_STYLES_ID)) == null ? void 0 : _a.remove();
      const customColorModStyle = doc.createElement("style");
      customColorModStyle.id = CUSTOM_COLORS_MOD_STYLES_ID;
      doc.head.appendChild(customColorModStyle);
      customColorModStyle.textContent = customCss;
    }
  }
  patchColorSelection(canvas) {
    if (this.observer)
      this.observer.disconnect();
    this.observer = new MutationObserver((mutations) => {
      const colorMenuOpened = mutations.some(
        (mutation) => Object.values(mutation.addedNodes).some(
          (node) => node instanceof HTMLElement && node.classList.contains("canvas-submenu") && Object.values(node.childNodes).some(
            (node2) => node2 instanceof HTMLElement && node2.classList.contains("canvas-color-picker-item")
          )
        )
      );
      if (!colorMenuOpened)
        return;
      const submenu = canvas.menu.menuEl.querySelector(".canvas-submenu");
      if (!submenu)
        return;
      const currentNodeColor = canvas.getSelectionData().nodes.map((node) => node.color).last();
      for (const colorId of this.getCustomColors()) {
        const customColorMenuItem = this.createColorMenuItem(canvas, colorId);
        if (currentNodeColor === colorId)
          customColorMenuItem.classList.add("is-active");
        submenu.insertBefore(customColorMenuItem, submenu.lastChild);
      }
    });
    this.observer.observe(canvas.menu.menuEl, { childList: true });
  }
  createColorMenuItem(canvas, colorId) {
    const menuItem = document.createElement("div");
    menuItem.classList.add("canvas-color-picker-item");
    menuItem.classList.add(`mod-canvas-color-${colorId}`);
    menuItem.addEventListener("click", () => {
      menuItem.classList.add("is-active");
      for (const item of canvas.selection) {
        item.setColor(colorId);
      }
      canvas.requestSave();
    });
    return menuItem;
  }
  getCustomColors() {
    const colors = [];
    while (true) {
      const colorId = (DEFAULT_COLORS_COUNT + colors.length + 1).toString();
      if (!getComputedStyle(document.body).getPropertyValue(`--canvas-color-${colorId}`))
        break;
      colors.push(colorId);
    }
    return colors;
  }
};

// src/canvas-extensions/collapsible-groups-canvas-extension.ts
var import_obsidian7 = require("obsidian");
var COLLAPSE_BUTTON_ID = "group-collapse-button";
var CollapsibleGroupsCanvasExtension = class {
  constructor(plugin) {
    this.plugin = plugin;
    if (!this.plugin.settings.getSetting("collapsibleGroupsFeatureEnabled"))
      return;
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.NodeChanged,
      (canvas, node) => this.onNodeChanged(canvas, node)
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.NodeBBoxRequested,
      (canvas, node, bbox) => this.onNodeBBoxRequested(canvas, node, bbox)
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.DataRequested,
      (_canvas, data) => this.expandCollapsedNodes(data)
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.LoadData,
      (_canvas, data, _setData) => this.collapseNodes(data)
    ));
  }
  onNodeChanged(canvas, groupNode) {
    var _a, _b;
    const groupNodeData = groupNode.getData();
    if (groupNodeData.type !== "group")
      return;
    (_a = groupNode.nodeEl) == null ? void 0 : _a.querySelectorAll(`#${COLLAPSE_BUTTON_ID}`).forEach((el) => el.remove());
    const collapseButton = document.createElement("span");
    collapseButton.id = COLLAPSE_BUTTON_ID;
    (0, import_obsidian7.setIcon)(collapseButton, groupNodeData.isCollapsed ? "plus-circle" : "minus-circle");
    collapseButton.onclick = () => {
      this.setCollapsed(canvas, groupNode, groupNode.getData().isCollapsed ? void 0 : true);
    };
    (_b = groupNode.labelEl) == null ? void 0 : _b.insertAdjacentElement("afterend", collapseButton);
  }
  setCollapsed(canvas, groupNode, collapsed) {
    groupNode.setData({ ...groupNode.getData(), isCollapsed: collapsed });
    canvas.setData(canvas.getData());
  }
  onNodeBBoxRequested(_canvas, node, bbox) {
    var _a, _b;
    const nodeData = node.getData();
    if (nodeData.type !== "group" || !nodeData.isCollapsed)
      return;
    bbox.maxX = bbox.minX + ((_b = (_a = node.nodeEl) == null ? void 0 : _a.getBoundingClientRect().width) != null ? _b : 0);
    bbox.maxY = bbox.minY;
  }
  expandCollapsedNodes(data) {
    data.nodes = data.nodes.flatMap((groupNodeData) => {
      const collapsedData = groupNodeData.collapsedData;
      if (collapsedData === void 0)
        return [groupNodeData];
      groupNodeData.collapsedData = void 0;
      data.edges.push(...collapsedData.edges);
      return [groupNodeData, ...collapsedData.nodes.map((nodeData) => ({
        ...nodeData,
        // Restore the relative position of the node to the group
        x: nodeData.x + groupNodeData.x,
        y: nodeData.y + groupNodeData.y
      }))];
    });
  }
  collapseNodes(data) {
    data.nodes.forEach((groupNodeData) => {
      if (!groupNodeData.isCollapsed)
        return;
      const groupNodeBBox = bboxFromNodeData(groupNodeData);
      const containedNodesData = data.nodes.filter(
        (nodeData) => nodeData.id !== groupNodeData.id && insideBBox(bboxFromNodeData(nodeData), groupNodeBBox, false)
      );
      const containedEdgesData = data.edges.filter((edgeData) => {
        return containedNodesData.some((nodeData) => nodeData.id === edgeData.fromNode) || containedNodesData.some((nodeData) => nodeData.id === edgeData.toNode);
      });
      data.nodes = data.nodes.filter((nodeData) => !containedNodesData.includes(nodeData));
      data.edges = data.edges.filter((edgeData) => !containedEdgesData.includes(edgeData));
      groupNodeData.collapsedData = {
        nodes: containedNodesData.map((nodeData) => ({
          ...nodeData,
          // Store the relative position of the node to the group
          x: nodeData.x - groupNodeData.x,
          y: nodeData.y - groupNodeData.y
        })),
        edges: containedEdgesData
      };
    });
  }
};

// src/windows-manager.ts
var WindowsManager = class {
  constructor(plugin) {
    this.windows = [window];
    this.plugin = plugin;
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      "window-open",
      (_win, window2) => this.windows.push(window2)
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      "window-close",
      (_win, window2) => this.windows = this.windows.filter((w) => w !== window2)
    ));
  }
};

// src/canvas-extensions/canvas-wrapper-data-tagger-canvas-extension.ts
var EXPOSED_SETTINGS = [
  "collapsibleGroupsFeatureEnabled",
  "collapsedGroupPreviewOnDrag"
];
var CanvasWrapperDataTaggerCanvasExtension = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      SettingsManager.SETTINGS_CHANGED_EVENT,
      () => this.updateExposedSettings(this.plugin.getCurrentCanvas())
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.CanvasChanged,
      (canvas) => this.updateExposedSettings(canvas)
    ));
    this.plugin.registerEvent(this.plugin.app.workspace.on(
      CanvasEvent.DraggingStateChanged,
      (canvas, dragging) => {
        if (dragging)
          canvas.wrapperEl.dataset.isDragging = "true";
        else
          delete canvas.wrapperEl.dataset.isDragging;
      }
    ));
  }
  updateExposedSettings(canvas) {
    if (!canvas)
      return;
    for (const setting of EXPOSED_SETTINGS) {
      canvas.wrapperEl.dataset[setting] = this.plugin.settings.getSetting(setting).toString();
    }
  }
};

// src/canvas-extensions/properties-canvas-extension.ts
var import_obsidian8 = require("obsidian");
var PropertiesCanvasExtension = class {
  constructor(plugin) {
    this.previousCssclasses = [];
    this.plugin = plugin;
    plugin.registerEvent(plugin.app.workspace.on(
      CanvasEvent.CanvasChanged,
      (canvas) => this.onCanvasChanged(canvas)
    ));
  }
  onCanvasChanged(canvas) {
    var _a;
    this.updateCssClasses(canvas);
    const settingsContainer = (_a = canvas.quickSettingsButton) == null ? void 0 : _a.parentElement;
    if (!settingsContainer)
      return;
    addQuickSettingsButton(
      settingsContainer,
      createQuickSettingsButton({
        id: "properties",
        label: "Properties",
        icon: "settings-2",
        callback: () => this.openPropertiesDialog(canvas)
      })
    );
  }
  updateCssClasses(canvas) {
    var _a;
    this.previousCssclasses.forEach((cssclass) => {
      canvas.wrapperEl.classList.remove(cssclass);
    });
    this.previousCssclasses = ((_a = canvas.metadata.properties) == null ? void 0 : _a.cssclasses) || [];
    this.previousCssclasses.forEach((cssclass) => {
      canvas.wrapperEl.classList.add(cssclass);
    });
  }
  async openPropertiesDialog(canvas) {
    await new PropertiesModal(this.plugin.app, canvas).awaitDialog();
    this.updateCssClasses(canvas);
  }
};
var PropertiesModal = class extends import_obsidian8.Modal {
  constructor(app, canvas) {
    super(app);
    this.canvas = canvas;
  }
  onOpen() {
    new import_obsidian8.Setting(this.contentEl).setHeading().setName("Properties");
    new import_obsidian8.Setting(this.contentEl).setName("cssclasses").setTooltip("Add classes to the canvas wrapper element. Separate multiple classes with spaces.").addText(
      (text) => {
        var _a, _b;
        return text.setValue((_b = (_a = this.canvas.metadata.properties) == null ? void 0 : _a.cssclasses) == null ? void 0 : _b.join(" ")).onChange((value) => {
          this.canvas.metadata.properties = this.canvas.metadata.properties || {};
          this.canvas.metadata.properties.cssclasses = value.split(" ");
        });
      }
    ).settingEl.classList.add("properties-field");
  }
  onClose() {
  }
  awaitDialog() {
    return new Promise((resolve) => {
      this.onClose = () => {
        this.contentEl.empty();
        resolve();
      };
      this.open();
    });
  }
};

// src/main.ts
var CANVAS_EXTENSIONS = [
  CanvasWrapperDataTaggerCanvasExtension,
  NodeDataTaggerCanvasExtension,
  EdgeDataTaggerCanvasExtension,
  InteractionTaggerCanvasExtension,
  BetterDefaultSettingsCanvasExtension,
  CommandsCanvasExtension,
  PropertiesCanvasExtension,
  ReadonlyCanvasExtension,
  GroupCanvasExtension,
  CollapsibleGroupsCanvasExtension,
  EncapsulateCanvasExtension,
  ColorPaletteCanvasExtension,
  StickersCanvasExtension,
  ShapesCanvasExtension,
  EdgesStyleCanvasExtension,
  PresentationCanvasExtension,
  PortalsCanvasExtension
];
var AdvancedCanvasPlugin = class extends import_obsidian9.Plugin {
  async onload() {
    IconsHelper.addIcons();
    this.settings = new SettingsManager(this);
    await this.settings.loadSettings();
    this.settings.addSettingsTab();
    this.windowsManager = new WindowsManager(this);
    this.canvasEventEmitter = new CanvasPatcher(this);
    this.canvasExtensions = CANVAS_EXTENSIONS.map((Extension) => new Extension(this));
  }
  onunload() {
  }
  getCurrentCanvasView() {
    const canvasView = this.app.workspace.getActiveViewOfType(import_obsidian9.ItemView);
    if ((canvasView == null ? void 0 : canvasView.getViewType()) !== "canvas")
      return null;
    return canvasView;
  }
  getCurrentCanvas() {
    var _a;
    return ((_a = this.getCurrentCanvasView()) == null ? void 0 : _a.canvas) || null;
  }
  // this.app.plugins.plugins["advanced-canvas"].enableDebugMode()
  enableDebugMode() {
    if (this.debugHelper)
      return;
    this.debugHelper = new DebugHelper(this);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL3NldHRpbmdzLnRzIiwgInNyYy91dGlscy9jYW52YXMtaGVscGVyLnRzIiwgInNyYy91dGlscy9iYm94LWhlbHBlci50cyIsICJzcmMvY29yZS9ldmVudHMudHMiLCAic3JjL2NhbnZhcy1leHRlbnNpb25zL3NoYXBlcy1jYW52YXMtZXh0ZW5zaW9uLnRzIiwgIm5vZGVfbW9kdWxlcy9tb25rZXktYXJvdW5kL21qcy9pbmRleC5qcyIsICJzcmMvdXRpbHMvcGF0Y2gtaGVscGVyLnRzIiwgInNyYy9jb3JlL2NhbnZhcy1wYXRjaGVyLnRzIiwgInNyYy9jYW52YXMtZXh0ZW5zaW9ucy9ncm91cC1jYW52YXMtZXh0ZW5zaW9uLnRzIiwgInNyYy9jYW52YXMtZXh0ZW5zaW9ucy9wcmVzZW50YXRpb24tY2FudmFzLWV4dGVuc2lvbi50cyIsICJzcmMvY2FudmFzLWV4dGVuc2lvbnMvbm9kZS1kYXRhLXRhZ2dlci1jYW52YXMtZXh0ZW5zaW9uLnRzIiwgInNyYy9jYW52YXMtZXh0ZW5zaW9ucy9pbnRlcmFjdGlvbi10YWdnZXItY2FudmFzLWV4dGVuc2lvbi50cyIsICJzcmMvY2FudmFzLWV4dGVuc2lvbnMvcmVhZG9ubHktY2FudmFzLWV4dGVuc2lvbi50cyIsICJzcmMvdXRpbHMvbW9kYWwtaGVscGVyLnRzIiwgInNyYy91dGlscy9wYXRoLWhlbHBlci50cyIsICJzcmMvY2FudmFzLWV4dGVuc2lvbnMvZW5jYXBzdWxhdGUtY2FudmFzLWV4dGVuc2lvbi50cyIsICJzcmMvY2FudmFzLWV4dGVuc2lvbnMvY29tbWFuZHMtY2FudmFzLWV4dGVuc2lvbi50cyIsICJzcmMvY2FudmFzLWV4dGVuc2lvbnMvcG9ydGFscy1jYW52YXMtZXh0ZW5zaW9uLnRzIiwgInNyYy91dGlscy9pY29ucy1oZWxwZXIudHMiLCAic3JjL2NhbnZhcy1leHRlbnNpb25zL3N0aWNrZXJzLWNhbnZhcy1leHRlbnNpb24udHMiLCAic3JjL3V0aWxzL2Etc3Rhci1oZWxwZXIudHMiLCAic3JjL3V0aWxzL3N2Zy1wYXRoLWhlbHBlci50cyIsICJzcmMvY2FudmFzLWV4dGVuc2lvbnMvZWRnZXMtc3R5bGUtY2FudmFzLWV4dGVuc2lvbi50cyIsICJzcmMvY2FudmFzLWV4dGVuc2lvbnMvZWRnZS1kYXRhLXRhZ2dlci1jYW52YXMtZXh0ZW5zaW9uLnRzIiwgInNyYy91dGlscy9kZWJ1Zy1oZWxwZXIudHMiLCAic3JjL2NhbnZhcy1leHRlbnNpb25zL2JldHRlci1kZWZhdWx0LXNldHRpbmdzLWNhbnZhcy1leHRlbnNpb24udHMiLCAic3JjL2NhbnZhcy1leHRlbnNpb25zL2NvbG9yLXBhbGV0dGUtY2FudmFzLWV4dGVuc2lvbi50cyIsICJzcmMvY2FudmFzLWV4dGVuc2lvbnMvY29sbGFwc2libGUtZ3JvdXBzLWNhbnZhcy1leHRlbnNpb24udHMiLCAic3JjL3dpbmRvd3MtbWFuYWdlci50cyIsICJzcmMvY2FudmFzLWV4dGVuc2lvbnMvY2FudmFzLXdyYXBwZXItZGF0YS10YWdnZXItY2FudmFzLWV4dGVuc2lvbi50cyIsICJzcmMvY2FudmFzLWV4dGVuc2lvbnMvcHJvcGVydGllcy1jYW52YXMtZXh0ZW5zaW9uLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgeyBJdGVtVmlldywgUGx1Z2luIH0gZnJvbSAnb2JzaWRpYW4nXHJcbmltcG9ydCBTZXR0aW5nc01hbmFnZXIgZnJvbSAnLi9zZXR0aW5ncydcclxuaW1wb3J0IFNoYXBlc0NhbnZhc0V4dGVuc2lvbiBmcm9tICcuL2NhbnZhcy1leHRlbnNpb25zL3NoYXBlcy1jYW52YXMtZXh0ZW5zaW9uJ1xyXG5pbXBvcnQgeyBDYW52YXMsIENhbnZhc1ZpZXcgfSBmcm9tICcuL0B0eXBlcy9DYW52YXMnXHJcbmltcG9ydCBDYW52YXNQYXRjaGVyIGZyb20gJy4vY29yZS9jYW52YXMtcGF0Y2hlcidcclxuaW1wb3J0IEdyb3VwQ2FudmFzRXh0ZW5zaW9uIGZyb20gJy4vY2FudmFzLWV4dGVuc2lvbnMvZ3JvdXAtY2FudmFzLWV4dGVuc2lvbidcclxuaW1wb3J0IFByZXNlbnRhdGlvbkNhbnZhc0V4dGVuc2lvbiBmcm9tICcuL2NhbnZhcy1leHRlbnNpb25zL3ByZXNlbnRhdGlvbi1jYW52YXMtZXh0ZW5zaW9uJ1xyXG5pbXBvcnQgSW50ZXJhY3Rpb25UYWdnZXJDYW52YXNFeHRlbnNpb24gZnJvbSAnLi9jYW52YXMtZXh0ZW5zaW9ucy9pbnRlcmFjdGlvbi10YWdnZXItY2FudmFzLWV4dGVuc2lvbidcclxuaW1wb3J0IE5vZGVEYXRhVGFnZ2VyQ2FudmFzRXh0ZW5zaW9uIGZyb20gJy4vY2FudmFzLWV4dGVuc2lvbnMvbm9kZS1kYXRhLXRhZ2dlci1jYW52YXMtZXh0ZW5zaW9uJ1xyXG5pbXBvcnQgUmVhZG9ubHlDYW52YXNFeHRlbnNpb24gZnJvbSAnLi9jYW52YXMtZXh0ZW5zaW9ucy9yZWFkb25seS1jYW52YXMtZXh0ZW5zaW9uJ1xyXG5pbXBvcnQgRW5jYXBzdWxhdGVDYW52YXNFeHRlbnNpb24gZnJvbSAnLi9jYW52YXMtZXh0ZW5zaW9ucy9lbmNhcHN1bGF0ZS1jYW52YXMtZXh0ZW5zaW9uJ1xyXG5pbXBvcnQgQ29tbWFuZHNDYW52YXNFeHRlbnNpb24gZnJvbSAnLi9jYW52YXMtZXh0ZW5zaW9ucy9jb21tYW5kcy1jYW52YXMtZXh0ZW5zaW9uJ1xyXG5pbXBvcnQgUG9ydGFsc0NhbnZhc0V4dGVuc2lvbiBmcm9tICcuL2NhbnZhcy1leHRlbnNpb25zL3BvcnRhbHMtY2FudmFzLWV4dGVuc2lvbidcclxuaW1wb3J0IEljb25zSGVscGVyIGZyb20gJy4vdXRpbHMvaWNvbnMtaGVscGVyJ1xyXG5pbXBvcnQgU3RpY2tlcnNDYW52YXNFeHRlbnNpb24gZnJvbSAnLi9jYW52YXMtZXh0ZW5zaW9ucy9zdGlja2Vycy1jYW52YXMtZXh0ZW5zaW9uJ1xyXG5pbXBvcnQgRWRnZXNTdHlsZUNhbnZhc0V4dGVuc2lvbiBmcm9tICcuL2NhbnZhcy1leHRlbnNpb25zL2VkZ2VzLXN0eWxlLWNhbnZhcy1leHRlbnNpb24nXHJcbmltcG9ydCBFZGdlRGF0YVRhZ2dlckNhbnZhc0V4dGVuc2lvbiBmcm9tICcuL2NhbnZhcy1leHRlbnNpb25zL2VkZ2UtZGF0YS10YWdnZXItY2FudmFzLWV4dGVuc2lvbidcclxuaW1wb3J0IERlYnVnSGVscGVyIGZyb20gJy4vdXRpbHMvZGVidWctaGVscGVyJ1xyXG5pbXBvcnQgQmV0dGVyRGVmYXVsdFNldHRpbmdzQ2FudmFzRXh0ZW5zaW9uIGZyb20gJy4vY2FudmFzLWV4dGVuc2lvbnMvYmV0dGVyLWRlZmF1bHQtc2V0dGluZ3MtY2FudmFzLWV4dGVuc2lvbidcclxuaW1wb3J0IENvbG9yUGFsZXR0ZUNhbnZhc0V4dGVuc2lvbiBmcm9tICcuL2NhbnZhcy1leHRlbnNpb25zL2NvbG9yLXBhbGV0dGUtY2FudmFzLWV4dGVuc2lvbidcclxuaW1wb3J0IENvbGxhcHNpYmxlR3JvdXBzQ2FudmFzRXh0ZW5zaW9uIGZyb20gJy4vY2FudmFzLWV4dGVuc2lvbnMvY29sbGFwc2libGUtZ3JvdXBzLWNhbnZhcy1leHRlbnNpb24nXHJcbmltcG9ydCBXaW5kb3dzTWFuYWdlciBmcm9tICcuL3dpbmRvd3MtbWFuYWdlcidcclxuaW1wb3J0IENhbnZhc1dyYXBwZXJEYXRhVGFnZ2VyQ2FudmFzRXh0ZW5zaW9uIGZyb20gJy4vY2FudmFzLWV4dGVuc2lvbnMvY2FudmFzLXdyYXBwZXItZGF0YS10YWdnZXItY2FudmFzLWV4dGVuc2lvbidcclxuaW1wb3J0IFByb3BlcnRpZXNDYW52YXNFeHRlbnNpb24gZnJvbSAnLi9jYW52YXMtZXh0ZW5zaW9ucy9wcm9wZXJ0aWVzLWNhbnZhcy1leHRlbnNpb24nXHJcblxyXG5jb25zdCBDQU5WQVNfRVhURU5TSU9OUzogYW55W10gPSBbXHJcbiAgQ2FudmFzV3JhcHBlckRhdGFUYWdnZXJDYW52YXNFeHRlbnNpb24sXHJcbiAgTm9kZURhdGFUYWdnZXJDYW52YXNFeHRlbnNpb24sXHJcbiAgRWRnZURhdGFUYWdnZXJDYW52YXNFeHRlbnNpb24sXHJcbiAgSW50ZXJhY3Rpb25UYWdnZXJDYW52YXNFeHRlbnNpb24sXHJcbiAgQmV0dGVyRGVmYXVsdFNldHRpbmdzQ2FudmFzRXh0ZW5zaW9uLFxyXG4gIENvbW1hbmRzQ2FudmFzRXh0ZW5zaW9uLFxyXG4gIFByb3BlcnRpZXNDYW52YXNFeHRlbnNpb24sXHJcbiAgUmVhZG9ubHlDYW52YXNFeHRlbnNpb24sXHJcbiAgR3JvdXBDYW52YXNFeHRlbnNpb24sXHJcbiAgQ29sbGFwc2libGVHcm91cHNDYW52YXNFeHRlbnNpb24sXHJcbiAgRW5jYXBzdWxhdGVDYW52YXNFeHRlbnNpb24sXHJcbiAgQ29sb3JQYWxldHRlQ2FudmFzRXh0ZW5zaW9uLFxyXG4gIFN0aWNrZXJzQ2FudmFzRXh0ZW5zaW9uLFxyXG4gIFNoYXBlc0NhbnZhc0V4dGVuc2lvbixcclxuICBFZGdlc1N0eWxlQ2FudmFzRXh0ZW5zaW9uLFxyXG4gIFByZXNlbnRhdGlvbkNhbnZhc0V4dGVuc2lvbixcclxuICBQb3J0YWxzQ2FudmFzRXh0ZW5zaW9uXHJcbl1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFkdmFuY2VkQ2FudmFzUGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcclxuICBzZXR0aW5nczogU2V0dGluZ3NNYW5hZ2VyXHJcbiAgd2luZG93c01hbmFnZXI6IFdpbmRvd3NNYW5hZ2VyXHJcbiAgZGVidWdIZWxwZXI6IERlYnVnSGVscGVyXHJcblxyXG4gIGNhbnZhc0V2ZW50RW1pdHRlcjogQ2FudmFzUGF0Y2hlclxyXG4gIGNhbnZhc0V4dGVuc2lvbnM6IGFueVtdXHJcblxyXG5cdGFzeW5jIG9ubG9hZCgpIHtcclxuICAgIEljb25zSGVscGVyLmFkZEljb25zKClcclxuICAgIFxyXG4gICAgdGhpcy5zZXR0aW5ncyA9IG5ldyBTZXR0aW5nc01hbmFnZXIodGhpcylcclxuICAgIGF3YWl0IHRoaXMuc2V0dGluZ3MubG9hZFNldHRpbmdzKClcclxuICAgIHRoaXMuc2V0dGluZ3MuYWRkU2V0dGluZ3NUYWIoKVxyXG5cclxuICAgIHRoaXMud2luZG93c01hbmFnZXIgPSBuZXcgV2luZG93c01hbmFnZXIodGhpcylcclxuXHJcbiAgICB0aGlzLmNhbnZhc0V2ZW50RW1pdHRlciA9IG5ldyBDYW52YXNQYXRjaGVyKHRoaXMpXHJcbiAgICB0aGlzLmNhbnZhc0V4dGVuc2lvbnMgPSBDQU5WQVNfRVhURU5TSU9OUy5tYXAoKEV4dGVuc2lvbikgPT4gbmV3IEV4dGVuc2lvbih0aGlzKSlcclxuXHR9XHJcblxyXG4gIG9udW5sb2FkKCkge31cclxuXHJcbiAgZ2V0Q3VycmVudENhbnZhc1ZpZXcoKTogQ2FudmFzVmlld3xudWxsIHtcclxuICAgIGNvbnN0IGNhbnZhc1ZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShJdGVtVmlldylcclxuICAgIGlmIChjYW52YXNWaWV3Py5nZXRWaWV3VHlwZSgpICE9PSAnY2FudmFzJykgcmV0dXJuIG51bGxcclxuICAgIHJldHVybiBjYW52YXNWaWV3IGFzIENhbnZhc1ZpZXdcclxuICB9XHJcblxyXG4gIGdldEN1cnJlbnRDYW52YXMoKTogQ2FudmFzfG51bGwge1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0Q3VycmVudENhbnZhc1ZpZXcoKT8uY2FudmFzIHx8IG51bGxcclxuICB9XHJcblxyXG4gIC8vIHRoaXMuYXBwLnBsdWdpbnMucGx1Z2luc1tcImFkdmFuY2VkLWNhbnZhc1wiXS5lbmFibGVEZWJ1Z01vZGUoKVxyXG4gIGVuYWJsZURlYnVnTW9kZSgpIHtcclxuICAgIGlmICh0aGlzLmRlYnVnSGVscGVyKSByZXR1cm5cclxuICAgIHRoaXMuZGVidWdIZWxwZXIgPSBuZXcgRGVidWdIZWxwZXIodGhpcylcclxuICB9XHJcbn0iLCAiaW1wb3J0IHsgTm90aWNlLCBQbHVnaW5TZXR0aW5nVGFiLCBTZXR0aW5nIH0gZnJvbSBcIm9ic2lkaWFuXCJcclxuaW1wb3J0IEFkdmFuY2VkQ2FudmFzUGx1Z2luIGZyb20gXCIuL21haW5cIlxyXG5cclxuY29uc3QgTk9ERV9UWVBFU19PTl9ET1VCTEVfQ0xJQ0sgPSB7XHJcbiAgJ3RleHQnOiAnVGV4dCcsXHJcbiAgJ2ZpbGUnOiAnRmlsZSdcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBBZHZhbmNlZENhbnZhc1BsdWdpblNldHRpbmdzIHtcclxuICBub2RlVHlwZU9uRG91YmxlQ2xpY2s6IHN0cmluZ1xyXG4gIGRlZmF1bHRUZXh0Tm9kZVdpZHRoOiBudW1iZXJcclxuICBkZWZhdWx0VGV4dE5vZGVIZWlnaHQ6IG51bWJlclxyXG4gIGRlZmF1bHRGaWxlTm9kZVdpZHRoOiBudW1iZXJcclxuICBkZWZhdWx0RmlsZU5vZGVIZWlnaHQ6IG51bWJlclxyXG5cclxuICBzaGFwZXNGZWF0dXJlRW5hYmxlZDogYm9vbGVhblxyXG5cclxuICBlZGdlc1N0eWxpbmdGZWF0dXJlRW5hYmxlZDogYm9vbGVhblxyXG4gIGVkZ2VTdHlsZVBhdGhmaW5kZXJHcmlkUmVzb2x1dGlvbjogbnVtYmVyXHJcbiAgZWRnZVN0eWxlUGF0aGZpbmRlclBhdGhMaXZlVXBkYXRlOiBib29sZWFuXHJcbiAgZWRnZVN0eWxlUGF0aGZpbmRlclBhdGhSb3VuZGVkOiBib29sZWFuXHJcblxyXG4gIGNvbW1hbmRzRmVhdHVyZUVuYWJsZWQ6IGJvb2xlYW5cclxuICB6b29tVG9DbG9uZWROb2RlOiBib29sZWFuXHJcbiAgY2xvbmVOb2RlTWFyZ2luOiBudW1iZXJcclxuICBleHBhbmROb2RlU3RlcFNpemU6IG51bWJlclxyXG5cclxuICBiZXR0ZXJSZWFkb25seUVuYWJsZWQ6IGJvb2xlYW5cclxuICBkaXNhYmxlTm9kZVBvcHVwOiBib29sZWFuXHJcbiAgZGlzYWJsZVpvb206IGJvb2xlYW5cclxuICBkaXNhYmxlUGFuOiBib29sZWFuXHJcblxyXG4gIGNvbGxhcHNpYmxlR3JvdXBzRmVhdHVyZUVuYWJsZWQ6IGJvb2xlYW5cclxuICBjb2xsYXBzZWRHcm91cFByZXZpZXdPbkRyYWc6IGJvb2xlYW5cclxuXHJcbiAgc3RpY2tlcnNGZWF0dXJlRW5hYmxlZDogYm9vbGVhblxyXG5cclxuICBwcmVzZW50YXRpb25GZWF0dXJlRW5hYmxlZDogYm9vbGVhblxyXG4gIGRlZmF1bHRTbGlkZVNpemU6IHN0cmluZ1xyXG4gIHdyYXBJblNsaWRlUGFkZGluZzogbnVtYmVyXHJcbiAgdXNlQXJyb3dLZXlzVG9DaGFuZ2VTbGlkZXM6IGJvb2xlYW5cclxuICB6b29tVG9TbGlkZVdpdGhvdXRQYWRkaW5nOiBib29sZWFuXHJcbiAgc2xpZGVUcmFuc2l0aW9uQW5pbWF0aW9uRHVyYXRpb246IG51bWJlclxyXG4gIHNsaWRlVHJhbnNpdGlvbkFuaW1hdGlvbkludGVuc2l0eTogbnVtYmVyXHJcblxyXG4gIGNhbnZhc0VuY2Fwc3VsYXRpb25FbmFibGVkOiBib29sZWFuXHJcblxyXG4gIHBvcnRhbHNGZWF0dXJlRW5hYmxlZDogYm9vbGVhblxyXG4gIG1haW50YWluQ2xvc2VkUG9ydGFsU2l6ZTogYm9vbGVhblxyXG4gIHNob3dFZGdlc0ludG9EaXNhYmxlZFBvcnRhbHM6IGJvb2xlYW5cclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IERFRkFVTFRfU0VUVElOR1M6IFBhcnRpYWw8QWR2YW5jZWRDYW52YXNQbHVnaW5TZXR0aW5ncz4gPSB7XHJcbiAgbm9kZVR5cGVPbkRvdWJsZUNsaWNrOiBPYmplY3Qua2V5cyhOT0RFX1RZUEVTX09OX0RPVUJMRV9DTElDSykuZmlyc3QoKSxcclxuICBkZWZhdWx0VGV4dE5vZGVXaWR0aDogMjYwLFxyXG4gIGRlZmF1bHRUZXh0Tm9kZUhlaWdodDogNjAsXHJcbiAgZGVmYXVsdEZpbGVOb2RlV2lkdGg6IDQwMCxcclxuICBkZWZhdWx0RmlsZU5vZGVIZWlnaHQ6IDQwMCxcclxuXHJcbiAgc2hhcGVzRmVhdHVyZUVuYWJsZWQ6IHRydWUsXHJcblxyXG4gIGVkZ2VzU3R5bGluZ0ZlYXR1cmVFbmFibGVkOiB0cnVlLFxyXG4gIGVkZ2VTdHlsZVBhdGhmaW5kZXJHcmlkUmVzb2x1dGlvbjogMTAsXHJcbiAgZWRnZVN0eWxlUGF0aGZpbmRlclBhdGhMaXZlVXBkYXRlOiB0cnVlLFxyXG4gIGVkZ2VTdHlsZVBhdGhmaW5kZXJQYXRoUm91bmRlZDogdHJ1ZSxcclxuXHJcbiAgY29tbWFuZHNGZWF0dXJlRW5hYmxlZDogdHJ1ZSxcclxuICB6b29tVG9DbG9uZWROb2RlOiB0cnVlLFxyXG4gIGNsb25lTm9kZU1hcmdpbjogMjAsXHJcbiAgZXhwYW5kTm9kZVN0ZXBTaXplOiAyMCxcclxuXHJcbiAgYmV0dGVyUmVhZG9ubHlFbmFibGVkOiB0cnVlLFxyXG4gIGRpc2FibGVOb2RlUG9wdXA6IGZhbHNlLFxyXG4gIGRpc2FibGVab29tOiBmYWxzZSxcclxuICBkaXNhYmxlUGFuOiBmYWxzZSxcclxuXHJcbiAgY29sbGFwc2libGVHcm91cHNGZWF0dXJlRW5hYmxlZDogdHJ1ZSxcclxuICBjb2xsYXBzZWRHcm91cFByZXZpZXdPbkRyYWc6IHRydWUsXHJcblxyXG4gIHN0aWNrZXJzRmVhdHVyZUVuYWJsZWQ6IHRydWUsXHJcblxyXG4gIHByZXNlbnRhdGlvbkZlYXR1cmVFbmFibGVkOiB0cnVlLFxyXG4gIGRlZmF1bHRTbGlkZVNpemU6ICcxMjAweDY3NScsXHJcbiAgd3JhcEluU2xpZGVQYWRkaW5nOiAyMCxcclxuICB1c2VBcnJvd0tleXNUb0NoYW5nZVNsaWRlczogdHJ1ZSxcclxuICB6b29tVG9TbGlkZVdpdGhvdXRQYWRkaW5nOiB0cnVlLFxyXG4gIHNsaWRlVHJhbnNpdGlvbkFuaW1hdGlvbkR1cmF0aW9uOiAwLjUsXHJcbiAgc2xpZGVUcmFuc2l0aW9uQW5pbWF0aW9uSW50ZW5zaXR5OiAxLjI1LFxyXG5cclxuICBjYW52YXNFbmNhcHN1bGF0aW9uRW5hYmxlZDogdHJ1ZSxcclxuXHJcbiAgcG9ydGFsc0ZlYXR1cmVFbmFibGVkOiB0cnVlLFxyXG4gIG1haW50YWluQ2xvc2VkUG9ydGFsU2l6ZTogdHJ1ZSxcclxuICBzaG93RWRnZXNJbnRvRGlzYWJsZWRQb3J0YWxzOiB0cnVlXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNldHRpbmdzTWFuYWdlciB7XHJcbiAgc3RhdGljIFNFVFRJTkdTX0NIQU5HRURfRVZFTlQgPSAnYWR2YW5jZWQtY2FudmFzOnNldHRpbmdzLWNoYW5nZWQnXHJcblxyXG4gIHByaXZhdGUgcGx1Z2luOiBBZHZhbmNlZENhbnZhc1BsdWdpblxyXG4gIHByaXZhdGUgc2V0dGluZ3M6IEFkdmFuY2VkQ2FudmFzUGx1Z2luU2V0dGluZ3NcclxuICBwcml2YXRlIHNldHRpbmdzVGFiOiBBZHZhbmNlZENhbnZhc1BsdWdpblNldHRpbmdUYWJcclxuXHJcbiAgY29uc3RydWN0b3IocGx1Z2luOiBBZHZhbmNlZENhbnZhc1BsdWdpbikge1xyXG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW5cclxuICB9XHJcblxyXG4gIGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcclxuICAgIHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBhd2FpdCB0aGlzLnBsdWdpbi5sb2FkRGF0YSgpKVxyXG4gICAgdGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS50cmlnZ2VyKFNldHRpbmdzTWFuYWdlci5TRVRUSU5HU19DSEFOR0VEX0VWRU5UKVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgc2F2ZVNldHRpbmdzKCkge1xyXG4gICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZURhdGEodGhpcy5zZXR0aW5ncylcclxuICB9XHJcblxyXG4gIGdldFNldHRpbmc8VCBleHRlbmRzIGtleW9mIEFkdmFuY2VkQ2FudmFzUGx1Z2luU2V0dGluZ3M+KGtleTogVCk6IEFkdmFuY2VkQ2FudmFzUGx1Z2luU2V0dGluZ3NbVF0ge1xyXG4gICAgcmV0dXJuIHRoaXMuc2V0dGluZ3Nba2V5XVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgc2V0U2V0dGluZyhkYXRhOiBQYXJ0aWFsPEFkdmFuY2VkQ2FudmFzUGx1Z2luU2V0dGluZ3M+KSB7XHJcbiAgICB0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih0aGlzLnNldHRpbmdzLCBkYXRhKVxyXG4gICAgYXdhaXQgdGhpcy5zYXZlU2V0dGluZ3MoKVxyXG4gICAgdGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS50cmlnZ2VyKFNldHRpbmdzTWFuYWdlci5TRVRUSU5HU19DSEFOR0VEX0VWRU5UKVxyXG4gIH1cclxuXHJcbiAgYWRkU2V0dGluZ3NUYWIoKSB7XHJcbiAgICB0aGlzLnNldHRpbmdzVGFiID0gbmV3IEFkdmFuY2VkQ2FudmFzUGx1Z2luU2V0dGluZ1RhYih0aGlzLnBsdWdpbiwgdGhpcylcclxuICAgIHRoaXMucGx1Z2luLmFkZFNldHRpbmdUYWIodGhpcy5zZXR0aW5nc1RhYilcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBBZHZhbmNlZENhbnZhc1BsdWdpblNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcclxuICBzZXR0aW5nc01hbmFnZXI6IFNldHRpbmdzTWFuYWdlclxyXG5cclxuICBjb25zdHJ1Y3RvcihwbHVnaW46IEFkdmFuY2VkQ2FudmFzUGx1Z2luLCBzZXR0aW5nc01hbmFnZXI6IFNldHRpbmdzTWFuYWdlcikge1xyXG4gICAgc3VwZXIocGx1Z2luLmFwcCwgcGx1Z2luKVxyXG4gICAgdGhpcy5zZXR0aW5nc01hbmFnZXIgPSBzZXR0aW5nc01hbmFnZXJcclxuICB9XHJcblxyXG4gIGRpc3BsYXkoKTogdm9pZCB7XHJcbiAgICBsZXQgeyBjb250YWluZXJFbCB9ID0gdGhpc1xyXG4gICAgY29udGFpbmVyRWwuZW1wdHkoKVxyXG5cclxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAuc2V0SGVhZGluZygpXHJcbiAgICAgIC5zZXROYW1lKFwiR2VuZXJhbFwiKVxyXG5cclxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAuc2V0TmFtZShcIk5vZGUgdHlwZSBvbiBkb3VibGUgY2xpY2tcIilcclxuICAgICAgLnNldERlc2MoXCJUaGUgdHlwZSBvZiBub2RlIHRoYXQgd2lsbCBiZSBjcmVhdGVkIHdoZW4gZG91YmxlIGNsaWNraW5nIG9uIHRoZSBjYW52YXMuXCIpXHJcbiAgICAgIC5hZGREcm9wZG93bigoZHJvcGRvd24pID0+XHJcbiAgICAgICAgZHJvcGRvd25cclxuICAgICAgICAgIC5hZGRPcHRpb25zKE5PREVfVFlQRVNfT05fRE9VQkxFX0NMSUNLKVxyXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMuc2V0dGluZ3NNYW5hZ2VyLmdldFNldHRpbmcoJ25vZGVUeXBlT25Eb3VibGVDbGljaycpKVxyXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4gYXdhaXQgdGhpcy5zZXR0aW5nc01hbmFnZXIuc2V0U2V0dGluZyh7IG5vZGVUeXBlT25Eb3VibGVDbGljazogdmFsdWUgfSkpXHJcbiAgICAgICAgKVxyXG4gICAgXHJcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgLnNldE5hbWUoXCJEZWZhdWx0IHRleHQgbm9kZSB3aWR0aFwiKVxyXG4gICAgICAuc2V0RGVzYyhcIlRoZSBkZWZhdWx0IHdpZHRoIG9mIGEgdGV4dCBub2RlLlwiKVxyXG4gICAgICAuYWRkVGV4dCgodGV4dCkgPT5cclxuICAgICAgICB0ZXh0XHJcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5zZXR0aW5nc01hbmFnZXIuZ2V0U2V0dGluZygnZGVmYXVsdFRleHROb2RlV2lkdGgnKS50b1N0cmluZygpKVxyXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4gYXdhaXQgdGhpcy5zZXR0aW5nc01hbmFnZXIuc2V0U2V0dGluZyh7IGRlZmF1bHRUZXh0Tm9kZVdpZHRoOiBNYXRoLm1heCgxLCBwYXJzZUludCh2YWx1ZSkpIH0pKVxyXG4gICAgICApXHJcbiAgICBcclxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAuc2V0TmFtZShcIkRlZmF1bHQgdGV4dCBub2RlIGhlaWdodFwiKVxyXG4gICAgICAuc2V0RGVzYyhcIlRoZSBkZWZhdWx0IGhlaWdodCBvZiBhIHRleHQgbm9kZS5cIilcclxuICAgICAgLmFkZFRleHQoKHRleHQpID0+XHJcbiAgICAgICAgdGV4dFxyXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMuc2V0dGluZ3NNYW5hZ2VyLmdldFNldHRpbmcoJ2RlZmF1bHRUZXh0Tm9kZUhlaWdodCcpLnRvU3RyaW5nKCkpXHJcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiBhd2FpdCB0aGlzLnNldHRpbmdzTWFuYWdlci5zZXRTZXR0aW5nKHsgZGVmYXVsdFRleHROb2RlSGVpZ2h0OiBNYXRoLm1heCgxLCBwYXJzZUludCh2YWx1ZSkpIH0pKVxyXG4gICAgICApXHJcblxyXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgIC5zZXROYW1lKFwiRGVmYXVsdCBmaWxlIG5vZGUgd2lkdGhcIilcclxuICAgICAgLnNldERlc2MoXCJUaGUgZGVmYXVsdCB3aWR0aCBvZiBhIGZpbGUgbm9kZS5cIilcclxuICAgICAgLmFkZFRleHQoKHRleHQpID0+XHJcbiAgICAgICAgdGV4dFxyXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMuc2V0dGluZ3NNYW5hZ2VyLmdldFNldHRpbmcoJ2RlZmF1bHRGaWxlTm9kZVdpZHRoJykudG9TdHJpbmcoKSlcclxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IGF3YWl0IHRoaXMuc2V0dGluZ3NNYW5hZ2VyLnNldFNldHRpbmcoeyBkZWZhdWx0RmlsZU5vZGVXaWR0aDogTWF0aC5tYXgoMSwgcGFyc2VJbnQodmFsdWUpKSB9KSlcclxuICAgICAgKVxyXG5cclxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAuc2V0TmFtZShcIkRlZmF1bHQgZmlsZSBub2RlIGhlaWdodFwiKVxyXG4gICAgICAuc2V0RGVzYyhcIlRoZSBkZWZhdWx0IGhlaWdodCBvZiBhIGZpbGUgbm9kZS5cIilcclxuICAgICAgLmFkZFRleHQoKHRleHQpID0+XHJcbiAgICAgICAgdGV4dFxyXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMuc2V0dGluZ3NNYW5hZ2VyLmdldFNldHRpbmcoJ2RlZmF1bHRGaWxlTm9kZUhlaWdodCcpLnRvU3RyaW5nKCkpXHJcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiBhd2FpdCB0aGlzLnNldHRpbmdzTWFuYWdlci5zZXRTZXR0aW5nKHsgZGVmYXVsdEZpbGVOb2RlSGVpZ2h0OiBNYXRoLm1heCgxLCBwYXJzZUludCh2YWx1ZSkpIH0pKVxyXG4gICAgICApXHJcblxyXG4gICAgdGhpcy5jcmVhdGVGZWF0dXJlSGVhZGluZyhcclxuICAgICAgY29udGFpbmVyRWwsXHJcbiAgICAgIFwiU2hhcGVzXCIsXHJcbiAgICAgIFwiU2hhcGUgeW91ciBub2RlcyBmb3IgY3JlYXRpbmcgZS5nLiBtaW5kIG1hcHMgb3IgZmxvdyBjaGFydHMuXCIsXHJcbiAgICAgICdzaGFwZXNGZWF0dXJlRW5hYmxlZCdcclxuICAgIClcclxuXHJcbiAgICB0aGlzLmNyZWF0ZUZlYXR1cmVIZWFkaW5nKFxyXG4gICAgICBjb250YWluZXJFbCxcclxuICAgICAgXCJFZGdlcyBzdHlsaW5nXCIsXHJcbiAgICAgIFwiU3R5bGUgeW91ciBlZGdlcyB3aXRoIGRpZmZlcmVudCBwYXRoIHN0eWxlcy5cIixcclxuICAgICAgJ2VkZ2VzU3R5bGluZ0ZlYXR1cmVFbmFibGVkJ1xyXG4gICAgKVxyXG5cclxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAuc2V0TmFtZShcIkEqIGdyaWQgcmVzb2x1dGlvblwiKVxyXG4gICAgICAuc2V0RGVzYyhcIlRoZSByZXNvbHV0aW9uIG9mIHRoZSBncmlkIHdoZW4gdXNpbmcgdGhlIEEqIHBhdGggc3R5bGUuIFRoZSBsb3dlciB0aGUgdmFsdWUsIHRoZSBtb3JlIHByZWNpc2UgdGhlIHBhdGggd2lsbCBiZS4gQnV0IGl0IHdpbGwgYWxzbyB0YWtlIGxvbmdlciB0byBjYWxjdWxhdGUuXCIpXHJcbiAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PlxyXG4gICAgICAgIHRleHRcclxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnNldHRpbmdzTWFuYWdlci5nZXRTZXR0aW5nKCdlZGdlU3R5bGVQYXRoZmluZGVyR3JpZFJlc29sdXRpb24nKS50b1N0cmluZygpKVxyXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4gYXdhaXQgdGhpcy5zZXR0aW5nc01hbmFnZXIuc2V0U2V0dGluZyh7IGVkZ2VTdHlsZVBhdGhmaW5kZXJHcmlkUmVzb2x1dGlvbjogTWF0aC5tYXgoNSwgcGFyc2VJbnQodmFsdWUpKSB9KSlcclxuICAgICAgKVxyXG5cclxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAuc2V0TmFtZShcIkxpdmUgdXBkYXRlIEEqIHBhdGhcIilcclxuICAgICAgLnNldERlc2MoXCJXaGVuIGVuYWJsZWQsIHRoZSBBKiBwYXRoIHN0eWxlIHdpbGwgYmUgdXBkYXRlZCBsaXZlIHdoaWxlIGRyYWdnaW5nIHRoZSBlZGdlLlwiKVxyXG4gICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+XHJcbiAgICAgICAgdG9nZ2xlXHJcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5zZXR0aW5nc01hbmFnZXIuZ2V0U2V0dGluZygnZWRnZVN0eWxlUGF0aGZpbmRlclBhdGhMaXZlVXBkYXRlJykpXHJcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiBhd2FpdCB0aGlzLnNldHRpbmdzTWFuYWdlci5zZXRTZXR0aW5nKHsgZWRnZVN0eWxlUGF0aGZpbmRlclBhdGhMaXZlVXBkYXRlOiB2YWx1ZSB9KSlcclxuICAgICAgKVxyXG5cclxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAuc2V0TmFtZShcIkEqIHJvdW5kZWQgcGF0aFwiKVxyXG4gICAgICAuc2V0RGVzYyhcIldoZW4gZW5hYmxlZCwgdGhlIEEqIHBhdGggc3R5bGUgd2lsbCBiZSByb3VuZGVkLlwiKVxyXG4gICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+XHJcbiAgICAgICAgdG9nZ2xlXHJcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5zZXR0aW5nc01hbmFnZXIuZ2V0U2V0dGluZygnZWRnZVN0eWxlUGF0aGZpbmRlclBhdGhSb3VuZGVkJykpXHJcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiBhd2FpdCB0aGlzLnNldHRpbmdzTWFuYWdlci5zZXRTZXR0aW5nKHsgZWRnZVN0eWxlUGF0aGZpbmRlclBhdGhSb3VuZGVkOiB2YWx1ZSB9KSlcclxuICAgICAgKVxyXG5cclxuICAgIHRoaXMuY3JlYXRlRmVhdHVyZUhlYWRpbmcoXHJcbiAgICAgIGNvbnRhaW5lckVsLFxyXG4gICAgICBcIkV4dGVuZGVkIGNvbW1hbmRzXCIsXHJcbiAgICAgIFwiQWRkIG1vcmUgY29tbWFuZHMgdG8gdGhlIGNhbnZhcy5cIixcclxuICAgICAgJ2NvbW1hbmRzRmVhdHVyZUVuYWJsZWQnXHJcbiAgICApXHJcblxyXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgIC5zZXROYW1lKFwiWm9vbSB0byBjbG9uZWQgbm9kZVwiKVxyXG4gICAgICAuc2V0RGVzYyhcIldoZW4gZW5hYmxlZCwgdGhlIGNhbnZhcyB3aWxsIHpvb20gdG8gdGhlIGNsb25lZCBub2RlLlwiKVxyXG4gICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+XHJcbiAgICAgICAgdG9nZ2xlXHJcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5zZXR0aW5nc01hbmFnZXIuZ2V0U2V0dGluZygnem9vbVRvQ2xvbmVkTm9kZScpKVxyXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4gYXdhaXQgdGhpcy5zZXR0aW5nc01hbmFnZXIuc2V0U2V0dGluZyh7IHpvb21Ub0Nsb25lZE5vZGU6IHZhbHVlIH0pKVxyXG4gICAgICApXHJcblxyXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgIC5zZXROYW1lKFwiQ2xvbmUgbm9kZSBtYXJnaW5cIilcclxuICAgICAgLnNldERlc2MoXCJUaGUgbWFyZ2luIGJldHdlZW4gdGhlIGNsb25lZCBub2RlIGFuZCB0aGUgc291cmNlIG5vZGUuXCIpXHJcbiAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PlxyXG4gICAgICAgIHRleHRcclxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnNldHRpbmdzTWFuYWdlci5nZXRTZXR0aW5nKCdjbG9uZU5vZGVNYXJnaW4nKS50b1N0cmluZygpKVxyXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4gYXdhaXQgdGhpcy5zZXR0aW5nc01hbmFnZXIuc2V0U2V0dGluZyh7IGNsb25lTm9kZU1hcmdpbjogcGFyc2VJbnQodmFsdWUpIH0pKVxyXG4gICAgICApXHJcblxyXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgIC5zZXROYW1lKFwiRXhwYW5kIG5vZGUgc3RlcCBzaXplXCIpXHJcbiAgICAgIC5zZXREZXNjKFwiVGhlIHN0ZXAgc2l6ZSBmb3IgZXhwYW5kaW5nIHRoZSBub2RlLlwiKVxyXG4gICAgICAuYWRkVGV4dCgodGV4dCkgPT5cclxuICAgICAgICB0ZXh0XHJcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5zZXR0aW5nc01hbmFnZXIuZ2V0U2V0dGluZygnZXhwYW5kTm9kZVN0ZXBTaXplJykudG9TdHJpbmcoKSlcclxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IGF3YWl0IHRoaXMuc2V0dGluZ3NNYW5hZ2VyLnNldFNldHRpbmcoeyBleHBhbmROb2RlU3RlcFNpemU6IHBhcnNlSW50KHZhbHVlKSB9KSlcclxuICAgICAgKVxyXG5cclxuICAgIHRoaXMuY3JlYXRlRmVhdHVyZUhlYWRpbmcoXHJcbiAgICAgIGNvbnRhaW5lckVsLFxyXG4gICAgICBcIkJldHRlciByZWFkb25seVwiLFxyXG4gICAgICBcIkltcHJvdmUgdGhlIHJlYWRvbmx5IG1vZGUuXCIsXHJcbiAgICAgICdiZXR0ZXJSZWFkb25seUVuYWJsZWQnXHJcbiAgICApXHJcblxyXG4gICAgLyogV291bGQgcmVxdWlyZSBhIHNvbHV0aW9uIHRvIHN5bmMgdGhlIHNldHRpbmdzIHdpdGggdGhlIGNhbnZhcyAqL1xyXG4gICAgLypuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgLnNldE5hbWUoXCJEaXNhYmxlIG5vZGUgaW50ZXJhY3Rpb25cIilcclxuICAgICAgLnNldERlc2MoXCJXaGVuIGVuYWJsZWQsIHlvdSBjYW4ndCBpbnRlcmFjdCB3aXRoIHRoZSBub2RlcyB3aGVuIGluIHJlYWRvbmx5IG1vZGUuXCIpXHJcbiAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cclxuICAgICAgICB0b2dnbGVcclxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnNldHRpbmdzTWFuYWdlci5zZXR0aW5ncy5kaXNhYmxlTm9kZUludGVyYWN0aW9uKVxyXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4gYXdhaXQgdGhpcy5zZXR0aW5nc01hbmFnZXIuc2V0U2V0dGluZyh7IGRpc2FibGVOb2RlSW50ZXJhY3Rpb246IHZhbHVlIH0pKVxyXG4gICAgICApXHJcblxyXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgIC5zZXROYW1lKFwiRGlzYWJsZSBub2RlIHBvcHVwIG1lbnVcIilcclxuICAgICAgLnNldERlc2MoXCJXaGVuIGVuYWJsZWQsIHRoZSBub2RlIHBvcHVwIG1lbnUgd29uJ3Qgc2hvdyB3aGVuIGluIHJlYWRvbmx5IG1vZGUuIChJZiBub2RlIGludGVyYWN0aW9uIGlzIGRpc2FibGVkLCB0aGlzIHNldHRpbmcgaGFzIG5vIGVmZmVjdC4pXCIpXHJcbiAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cclxuICAgICAgICB0b2dnbGVcclxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnNldHRpbmdzTWFuYWdlci5zZXR0aW5ncy5kaXNhYmxlTm9kZVBvcHVwKVxyXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4gYXdhaXQgdGhpcy5zZXR0aW5nc01hbmFnZXIuc2V0U2V0dGluZyh7IGRpc2FibGVOb2RlUG9wdXA6IHZhbHVlIH0pKVxyXG4gICAgICApXHJcblxyXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgIC5zZXROYW1lKFwiRGlzYWJsZSB6b29tXCIpXHJcbiAgICAgIC5zZXREZXNjKFwiV2hlbiBlbmFibGVkLCB5b3UgY2FuJ3Qgem9vbSB3aGVuIGluIHJlYWRvbmx5IG1vZGUuXCIpXHJcbiAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cclxuICAgICAgICB0b2dnbGVcclxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnNldHRpbmdzTWFuYWdlci5zZXR0aW5ncy5kaXNhYmxlWm9vbSlcclxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IGF3YWl0IHRoaXMuc2V0dGluZ3NNYW5hZ2VyLnNldFNldHRpbmcoeyBkaXNhYmxlWm9vbTogdmFsdWUgfSkpXHJcbiAgICAgIClcclxuXHJcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgLnNldE5hbWUoXCJEaXNhYmxlIHBhblwiKVxyXG4gICAgICAuc2V0RGVzYyhcIldoZW4gZW5hYmxlZCwgeW91IGNhbid0IHBhbiB3aGVuIGluIHJlYWRvbmx5IG1vZGUuXCIpXHJcbiAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cclxuICAgICAgICB0b2dnbGVcclxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnNldHRpbmdzTWFuYWdlci5zZXR0aW5ncy5kaXNhYmxlUGFuKVxyXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4gYXdhaXQgdGhpcy5zZXR0aW5nc01hbmFnZXIuc2V0U2V0dGluZyh7IGRpc2FibGVQYW46IHZhbHVlIH0pKVxyXG4gICAgICApKi9cclxuXHJcbiAgICB0aGlzLmNyZWF0ZUZlYXR1cmVIZWFkaW5nKFxyXG4gICAgICBjb250YWluZXJFbCxcclxuICAgICAgXCJDb2xsYXBzaWJsZSBncm91cHNcIixcclxuICAgICAgXCJHcm91cCBub2RlcyBjYW4gYmUgY29sbGFwc2VkIGFuZCBleHBhbmRlZCB0byBrZWVwIHRoZSBjYW52YXMgb3JnYW5pemVkLlwiLFxyXG4gICAgICAnY29sbGFwc2libGVHcm91cHNGZWF0dXJlRW5hYmxlZCdcclxuICAgIClcclxuXHJcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgLnNldE5hbWUoXCJDb2xsYXBzZWQgZ3JvdXAgcHJldmlldyBvbiBkcmFnXCIpXHJcbiAgICAgIC5zZXREZXNjKFwiV2hlbiBlbmFibGVkLCBhIGdyb3VwIHRoYXQgaXMgY29sbGFwc2VkIHNob3cgaXRzIGJvcmRlciB3aGlsZSBkcmFnZ2luZyBhIG5vZGUuXCIpXHJcbiAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cclxuICAgICAgICB0b2dnbGVcclxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnNldHRpbmdzTWFuYWdlci5nZXRTZXR0aW5nKCdjb2xsYXBzZWRHcm91cFByZXZpZXdPbkRyYWcnKSlcclxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IGF3YWl0IHRoaXMuc2V0dGluZ3NNYW5hZ2VyLnNldFNldHRpbmcoeyBjb2xsYXBzZWRHcm91cFByZXZpZXdPbkRyYWc6IHZhbHVlIH0pKVxyXG4gICAgICApXHJcblxyXG4gICAgdGhpcy5jcmVhdGVGZWF0dXJlSGVhZGluZyhcclxuICAgICAgY29udGFpbmVyRWwsXHJcbiAgICAgIFwiU3RpY2tlcnNcIixcclxuICAgICAgXCJDb252ZXJ0IGFuIGltYWdlIG5vZGUgdG8gYSBzdGlja2VyIGJ5IHN1cHBvcnRpbmcgdHJhbnNwYXJlbmN5IGFuZCByZW1vdmluZyB0aGUgYm9yZGVyLlwiLFxyXG4gICAgICAnc3RpY2tlcnNGZWF0dXJlRW5hYmxlZCdcclxuICAgIClcclxuXHJcbiAgICB0aGlzLmNyZWF0ZUZlYXR1cmVIZWFkaW5nKFxyXG4gICAgICBjb250YWluZXJFbCxcclxuICAgICAgXCJQcmVzZW50YXRpb25zXCIsXHJcbiAgICAgIFwiQ3JlYXRlIGEgcHJlc2VudGF0aW9uIGZyb20geW91ciBjYW52YXMuXCIsXHJcbiAgICAgICdwcmVzZW50YXRpb25GZWF0dXJlRW5hYmxlZCdcclxuICAgIClcclxuXHJcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgLnNldE5hbWUoXCJEZWZhdWx0IHNsaWRlIHJhdGlvXCIpXHJcbiAgICAgIC5zZXREZXNjKFwiVGhlIGRlZmF1bHQgcmF0aW8gb2YgdGhlIHNsaWRlLiBGb3IgZXhhbXBsZSwgMTY6OSBpcyAxMjAweDY3NSBhbmQgMzoyIGlzIDEzNTB4OTAwLlwiKVxyXG4gICAgICAuYWRkVGV4dCgodGV4dCkgPT5cclxuICAgICAgICB0ZXh0XHJcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5zZXR0aW5nc01hbmFnZXIuZ2V0U2V0dGluZygnZGVmYXVsdFNsaWRlU2l6ZScpKVxyXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4gYXdhaXQgdGhpcy5zZXR0aW5nc01hbmFnZXIuc2V0U2V0dGluZyh7IGRlZmF1bHRTbGlkZVNpemU6IHZhbHVlLnJlcGxhY2UoJyAnLCAnJykgfSkpXHJcbiAgICAgIClcclxuXHJcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgLnNldE5hbWUoXCJXcmFwIGluIHNsaWRlIHBhZGRpbmdcIilcclxuICAgICAgLnNldERlc2MoXCJUaGUgcGFkZGluZyBvZiB0aGUgc2xpZGUgd2hlbiB3cmFwcGluZyB0aGUgY2FudmFzIGluIGEgc2xpZGUuXCIpXHJcbiAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PlxyXG4gICAgICAgIHRleHRcclxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnNldHRpbmdzTWFuYWdlci5nZXRTZXR0aW5nKCd3cmFwSW5TbGlkZVBhZGRpbmcnKS50b1N0cmluZygpKVxyXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4gYXdhaXQgdGhpcy5zZXR0aW5nc01hbmFnZXIuc2V0U2V0dGluZyh7IHdyYXBJblNsaWRlUGFkZGluZzogcGFyc2VJbnQodmFsdWUpIH0pKVxyXG4gICAgICApXHJcblxyXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgIC5zZXROYW1lKFwiVXNlIGFycm93IGtleXMgdG8gY2hhbmdlIHNsaWRlc1wiKVxyXG4gICAgICAuc2V0RGVzYyhcIldoZW4gZW5hYmxlZCwgeW91IGNhbiB1c2UgdGhlIGFycm93IGtleXMgdG8gY2hhbmdlIHNsaWRlcyBpbiBwcmVzZW50YXRpb24gbW9kZS5cIilcclxuICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PlxyXG4gICAgICAgIHRvZ2dsZVxyXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMuc2V0dGluZ3NNYW5hZ2VyLmdldFNldHRpbmcoJ3VzZUFycm93S2V5c1RvQ2hhbmdlU2xpZGVzJykpXHJcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiBhd2FpdCB0aGlzLnNldHRpbmdzTWFuYWdlci5zZXRTZXR0aW5nKHsgdXNlQXJyb3dLZXlzVG9DaGFuZ2VTbGlkZXM6IHZhbHVlIH0pKVxyXG4gICAgICApXHJcblxyXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgIC5zZXROYW1lKFwiWm9vbSB0byBzbGlkZSB3aXRob3V0IHBhZGRpbmdcIilcclxuICAgICAgLnNldERlc2MoXCJXaGVuIGVuYWJsZWQsIHRoZSBjYW52YXMgd2lsbCB6b29tIHRvIHRoZSBzbGlkZSB3aXRob3V0IHBhZGRpbmcuXCIpXHJcbiAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cclxuICAgICAgICB0b2dnbGVcclxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnNldHRpbmdzTWFuYWdlci5nZXRTZXR0aW5nKCd6b29tVG9TbGlkZVdpdGhvdXRQYWRkaW5nJykpXHJcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiBhd2FpdCB0aGlzLnNldHRpbmdzTWFuYWdlci5zZXRTZXR0aW5nKHsgem9vbVRvU2xpZGVXaXRob3V0UGFkZGluZzogdmFsdWUgfSkpXHJcbiAgICAgIClcclxuXHJcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgLnNldE5hbWUoXCJTbGlkZSB0cmFuc2l0aW9uIGFuaW1hdGlvbiBkdXJhdGlvblwiKVxyXG4gICAgICAuc2V0RGVzYyhcIlRoZSBkdXJhdGlvbiBvZiB0aGUgc2xpZGUgdHJhbnNpdGlvbiBhbmltYXRpb24gaW4gc2Vjb25kcy4gU2V0IHRvIDAgdG8gZGlzYWJsZSB0aGUgYW5pbWF0aW9uLlwiKVxyXG4gICAgICAuYWRkVGV4dCgodGV4dCkgPT5cclxuICAgICAgICB0ZXh0XHJcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5zZXR0aW5nc01hbmFnZXIuZ2V0U2V0dGluZygnc2xpZGVUcmFuc2l0aW9uQW5pbWF0aW9uRHVyYXRpb24nKS50b1N0cmluZygpKVxyXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4gYXdhaXQgdGhpcy5zZXR0aW5nc01hbmFnZXIuc2V0U2V0dGluZyh7IHNsaWRlVHJhbnNpdGlvbkFuaW1hdGlvbkR1cmF0aW9uOiBwYXJzZUZsb2F0KHZhbHVlKSB9KSlcclxuICAgICAgKVxyXG5cclxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAuc2V0TmFtZShcIlNsaWRlIHRyYW5zaXRpb24gYW5pbWF0aW9uIGludGVuc2l0eVwiKVxyXG4gICAgICAuc2V0RGVzYyhcIlRoZSBpbnRlbnNpdHkgb2YgdGhlIHNsaWRlIHRyYW5zaXRpb24gYW5pbWF0aW9uLiBUaGUgaGlnaGVyIHRoZSB2YWx1ZSwgdGhlIG1vcmUgdGhlIGNhbnZhcyB3aWxsIHpvb20gb3V0IGJlZm9yZSB6b29taW5nIGluIG9uIHRoZSBuZXh0IHNsaWRlLlwiKVxyXG4gICAgICAuYWRkVGV4dCgodGV4dCkgPT5cclxuICAgICAgICB0ZXh0XHJcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5zZXR0aW5nc01hbmFnZXIuZ2V0U2V0dGluZygnc2xpZGVUcmFuc2l0aW9uQW5pbWF0aW9uSW50ZW5zaXR5JykudG9TdHJpbmcoKSlcclxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IGF3YWl0IHRoaXMuc2V0dGluZ3NNYW5hZ2VyLnNldFNldHRpbmcoeyBzbGlkZVRyYW5zaXRpb25BbmltYXRpb25JbnRlbnNpdHk6IHBhcnNlRmxvYXQodmFsdWUpIH0pKVxyXG4gICAgICApXHJcblxyXG4gICAgdGhpcy5jcmVhdGVGZWF0dXJlSGVhZGluZyhcclxuICAgICAgY29udGFpbmVyRWwsXHJcbiAgICAgIFwiQ2FudmFzIGVuY2Fwc3VsYXRpb25cIixcclxuICAgICAgXCJFbmNhcHN1bGF0ZSBhIHNlbGVjdGlvbiBvZiBub2RlcyBhbmQgZWRnZXMgaW50byBhIG5ldyBjYW52YXMuXCIsXHJcbiAgICAgICdjYW52YXNFbmNhcHN1bGF0aW9uRW5hYmxlZCdcclxuICAgIClcclxuXHJcbiAgICB0aGlzLmNyZWF0ZUZlYXR1cmVIZWFkaW5nKFxyXG4gICAgICBjb250YWluZXJFbCxcclxuICAgICAgXCJQb3J0YWxzXCIsXHJcbiAgICAgIFwiQ3JlYXRlIHBvcnRhbHMgdG8gb3RoZXIgY2FudmFzZXMuXCIsXHJcbiAgICAgICdwb3J0YWxzRmVhdHVyZUVuYWJsZWQnXHJcbiAgICApXHJcblxyXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgIC5zZXROYW1lKFwiTWFpbnRhaW4gY2xvc2VkIHBvcnRhbCBzaXplXCIpXHJcbiAgICAgIC5zZXREZXNjKFwiV2hlbiBlbmFibGVkLCBjbG9zaW5nIGEgcG9ydGFsIHdpbGwgY2hhbmdlIHRoZSBzaXplIG9mIHRoZSBwb3J0YWwgdG8gdGhlIG9yaWdpbmFsLCBjbG9zZWQgc2l6ZS5cIilcclxuICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PlxyXG4gICAgICAgIHRvZ2dsZVxyXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMuc2V0dGluZ3NNYW5hZ2VyLmdldFNldHRpbmcoJ21haW50YWluQ2xvc2VkUG9ydGFsU2l6ZScpKVxyXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4gYXdhaXQgdGhpcy5zZXR0aW5nc01hbmFnZXIuc2V0U2V0dGluZyh7IG1haW50YWluQ2xvc2VkUG9ydGFsU2l6ZTogdmFsdWUgfSkpXHJcbiAgICAgIClcclxuXHJcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgLnNldE5hbWUoXCJTaG93IGVkZ2VzIGludG8gZGlzYWJsZWQgcG9ydGFsc1wiKVxyXG4gICAgICAuc2V0RGVzYyhcIldoZW4gZW5hYmxlZCwgZWRnZXMgaW50byBkaXNhYmxlZCBwb3J0YWxzIHdpbGwgYmUgc2hvd24gYnkgYW4gZWRnZSB0byB0aGUgcG9ydGFsIG5vZGUuXCIpXHJcbiAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cclxuICAgICAgICB0b2dnbGVcclxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnNldHRpbmdzTWFuYWdlci5nZXRTZXR0aW5nKCdzaG93RWRnZXNJbnRvRGlzYWJsZWRQb3J0YWxzJykpXHJcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiBhd2FpdCB0aGlzLnNldHRpbmdzTWFuYWdlci5zZXRTZXR0aW5nKHsgc2hvd0VkZ2VzSW50b0Rpc2FibGVkUG9ydGFsczogdmFsdWUgfSkpXHJcbiAgICAgIClcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY3JlYXRlRmVhdHVyZUhlYWRpbmcoY29udGFpbmVyRWw6IEhUTUxFbGVtZW50LCBsYWJlbDogc3RyaW5nLCBkZXNjcmlwdGlvbjogc3RyaW5nLCBzZXR0aW5nc0tleToga2V5b2YgQWR2YW5jZWRDYW52YXNQbHVnaW5TZXR0aW5ncyk6IFNldHRpbmcge1xyXG4gICAgcmV0dXJuIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAuc2V0SGVhZGluZygpXHJcbiAgICAgIC5zZXROYW1lKGxhYmVsKVxyXG4gICAgICAuc2V0RGVzYyhkZXNjcmlwdGlvbilcclxuICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PlxyXG4gICAgICAgIHRvZ2dsZVxyXG4gICAgICAgICAgLnNldFRvb2x0aXAoXCJSZXF1aXJlcyBhIHJlbG9hZCB0byB0YWtlIGVmZmVjdC5cIilcclxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnNldHRpbmdzTWFuYWdlci5nZXRTZXR0aW5nKHNldHRpbmdzS2V5KSBhcyBib29sZWFuKVxyXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLnNldHRpbmdzTWFuYWdlci5zZXRTZXR0aW5nKHsgW3NldHRpbmdzS2V5XTogdmFsdWUgfSlcclxuICAgICAgICAgICAgbmV3IE5vdGljZShcIlJlbG9hZCBvYnNpZGlhbiB0byBhcHBseSB0aGUgY2hhbmdlcy5cIilcclxuICAgICAgICAgIH0pXHJcbiAgICAgIClcclxuICB9XHJcbn0iLCAiaW1wb3J0IHsgc2V0SWNvbiwgc2V0VG9vbHRpcCB9IGZyb20gXCJvYnNpZGlhblwiXHJcbmltcG9ydCB7IEJCb3gsIENhbnZhcywgQ2FudmFzTm9kZSwgQ2FudmFzTm9kZURhdGEsIFBvc2l0aW9uLCBTaXplIH0gZnJvbSBcInNyYy9AdHlwZXMvQ2FudmFzXCJcclxuaW1wb3J0IEFkdmFuY2VkQ2FudmFzUGx1Z2luIGZyb20gXCJzcmMvbWFpblwiXHJcbmltcG9ydCAqIGFzIEJCb3hIZWxwZXIgZnJvbSBcInNyYy91dGlscy9iYm94LWhlbHBlclwiXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY2FudmFzQ29tbWFuZChwbHVnaW46IEFkdmFuY2VkQ2FudmFzUGx1Z2luLCBjaGVjazogKGNhbnZhczogQ2FudmFzKSA9PiBib29sZWFuLCBydW46IChjYW52YXM6IENhbnZhcykgPT4gdm9pZCk6IChjaGVja2luZzogYm9vbGVhbikgPT4gYm9vbGVhbiB7XHJcbiAgcmV0dXJuIChjaGVja2luZzogYm9vbGVhbikgPT4ge1xyXG4gICAgY29uc3QgY2FudmFzID0gcGx1Z2luLmdldEN1cnJlbnRDYW52YXMoKVxyXG4gICAgaWYgKGNoZWNraW5nKSByZXR1cm4gY2FudmFzICE9PSBudWxsICYmIGNoZWNrKGNhbnZhcylcclxuXHJcbiAgICBpZiAoY2FudmFzKSBydW4oY2FudmFzKVxyXG5cclxuICAgIHJldHVybiB0cnVlXHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIE1lbnVPcHRpb24ge1xyXG4gIGlkPzogc3RyaW5nXHJcbiAgbGFiZWw6IHN0cmluZ1xyXG4gIGljb246IHN0cmluZ1xyXG4gIGNhbGxiYWNrPzogKCkgPT4gdm9pZFxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlUXVpY2tTZXR0aW5nc0J1dHRvbihtZW51T3B0aW9uOiBNZW51T3B0aW9uKTogSFRNTEVsZW1lbnQge1xyXG4gIGNvbnN0IHF1aWNrU2V0dGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXHJcbiAgaWYgKG1lbnVPcHRpb24uaWQpIHF1aWNrU2V0dGluZy5pZCA9IG1lbnVPcHRpb24uaWRcclxuICBxdWlja1NldHRpbmcuY2xhc3NMaXN0LmFkZCgnY2FudmFzLWNvbnRyb2wtaXRlbScpXHJcbiAgc2V0SWNvbihxdWlja1NldHRpbmcsIG1lbnVPcHRpb24uaWNvbilcclxuICBzZXRUb29sdGlwKHF1aWNrU2V0dGluZywgbWVudU9wdGlvbi5sYWJlbCwgeyBwbGFjZW1lbnQ6ICdsZWZ0JyB9KVxyXG4gIHF1aWNrU2V0dGluZy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IG1lbnVPcHRpb24uY2FsbGJhY2s/LigpKVxyXG5cclxuICByZXR1cm4gcXVpY2tTZXR0aW5nXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBhZGRRdWlja1NldHRpbmdzQnV0dG9uKGNvbnRyb2xHcm91cDogSFRNTEVsZW1lbnQsIGVsZW1lbnQ6IEhUTUxFbGVtZW50KSB7XHJcbiAgaWYgKGVsZW1lbnQuaWQpIGNvbnRyb2xHcm91cC5xdWVyeVNlbGVjdG9yKGAjJHtlbGVtZW50LmlkfWApPy5yZW1vdmUoKVxyXG4gIGNvbnRyb2xHcm91cC5hcHBlbmRDaGlsZChlbGVtZW50KVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQ2FyZE1lbnVPcHRpb24oY2FudmFzOiBDYW52YXMsIG1lbnVPcHRpb246IE1lbnVPcHRpb24sIHByZXZpZXdOb2RlU2l6ZTogKCkgPT4gU2l6ZSwgb25QbGFjZWQ6IChjYW52YXM6IENhbnZhcywgcG9zOiBQb3NpdGlvbikgPT4gdm9pZCk6IEhUTUxFbGVtZW50IHtcclxuICBjb25zdCBtZW51T3B0aW9uRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXHJcbiAgaWYgKG1lbnVPcHRpb24uaWQpIG1lbnVPcHRpb25FbGVtZW50LmlkID0gbWVudU9wdGlvbi5pZFxyXG4gIG1lbnVPcHRpb25FbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2NhbnZhcy1jYXJkLW1lbnUtYnV0dG9uJylcclxuICBtZW51T3B0aW9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdtb2QtZHJhZ2dhYmxlJylcclxuICBzZXRJY29uKG1lbnVPcHRpb25FbGVtZW50LCBtZW51T3B0aW9uLmljb24pXHJcbiAgc2V0VG9vbHRpcChtZW51T3B0aW9uRWxlbWVudCwgbWVudU9wdGlvbi5sYWJlbCwgeyBwbGFjZW1lbnQ6ICd0b3AnIH0pXHJcblxyXG4gIG1lbnVPcHRpb25FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKF9lKSA9PiB7XHJcbiAgICBvblBsYWNlZChjYW52YXMsIGdldENlbnRlckNvb3JkaW5hdGVzKGNhbnZhcywgcHJldmlld05vZGVTaXplKCkpKVxyXG4gIH0pXHJcblxyXG4gIG1lbnVPcHRpb25FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJkb3duJywgKGUpID0+IHtcclxuICAgIGNhbnZhcy5kcmFnVGVtcE5vZGUoZSwgcHJldmlld05vZGVTaXplKCksIChwb3M6IFBvc2l0aW9uKSA9PiB7XHJcbiAgICAgIGNhbnZhcy5kZXNlbGVjdEFsbCgpXHJcbiAgICAgIG9uUGxhY2VkKGNhbnZhcywgcG9zKVxyXG4gICAgfSlcclxuICB9KVxyXG5cclxuICByZXR1cm4gbWVudU9wdGlvbkVsZW1lbnRcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGFkZENhcmRNZW51T3B0aW9uKGNhbnZhczogQ2FudmFzLCBlbGVtZW50OiBIVE1MRWxlbWVudCkge1xyXG4gIGlmIChlbGVtZW50LmlkKSBjYW52YXM/LmNhcmRNZW51RWwucXVlcnlTZWxlY3RvcihgIyR7ZWxlbWVudC5pZH1gKT8ucmVtb3ZlKClcclxuICBjYW52YXM/LmNhcmRNZW51RWwuYXBwZW5kQ2hpbGQoZWxlbWVudClcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVBvcHVwTWVudU9wdGlvbihtZW51T3B0aW9uOiBNZW51T3B0aW9uKTogSFRNTEVsZW1lbnQge1xyXG4gIGNvbnN0IG1lbnVPcHRpb25FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJylcclxuICBpZiAobWVudU9wdGlvbi5pZCkgbWVudU9wdGlvbkVsZW1lbnQuaWQgPSBtZW51T3B0aW9uLmlkXHJcbiAgbWVudU9wdGlvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnY2xpY2thYmxlLWljb24nKVxyXG4gIHNldEljb24obWVudU9wdGlvbkVsZW1lbnQsIG1lbnVPcHRpb24uaWNvbilcclxuICBzZXRUb29sdGlwKG1lbnVPcHRpb25FbGVtZW50LCBtZW51T3B0aW9uLmxhYmVsLCB7IHBsYWNlbWVudDogJ3RvcCcgfSlcclxuICBtZW51T3B0aW9uRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IG1lbnVPcHRpb24uY2FsbGJhY2s/LigpKVxyXG5cclxuICByZXR1cm4gbWVudU9wdGlvbkVsZW1lbnRcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUV4cGFuZGFibGVQb3B1cE1lbnVPcHRpb24obWVudU9wdGlvbjogTWVudU9wdGlvbiwgc3ViTWVudU9wdGlvbnM6IE1lbnVPcHRpb25bXSk6IEhUTUxFbGVtZW50IHtcclxuICBjb25zdCBtZW51T3B0aW9uRWxlbWVudCA9IGNyZWF0ZVBvcHVwTWVudU9wdGlvbih7XHJcbiAgICAuLi5tZW51T3B0aW9uLFxyXG4gICAgY2FsbGJhY2s6ICgpID0+IHtcclxuICAgICAgY29uc3Qgc3VibWVudUlkID0gYCR7bWVudU9wdGlvbi5pZH0tc3VibWVudWBcclxuXHJcbiAgICAgIGlmIChtZW51T3B0aW9uRWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ2lzLWFjdGl2ZScpKSB7XHJcbiAgICAgICAgbWVudU9wdGlvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnaXMtYWN0aXZlJylcclxuICAgICAgICBtZW51T3B0aW9uRWxlbWVudC5wYXJlbnRFbGVtZW50Py5xdWVyeVNlbGVjdG9yKGAjJHtzdWJtZW51SWR9YCk/LnJlbW92ZSgpXHJcbiAgICAgICAgcmV0dXJuXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIG1lbnVPcHRpb25FbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2lzLWFjdGl2ZScpXHJcblxyXG4gICAgICAvLyBBZGQgcG9wdXAgbWVudVxyXG4gICAgICBjb25zdCBzdWJtZW51ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcclxuICAgICAgc3VibWVudS5pZCA9IHN1Ym1lbnVJZFxyXG4gICAgICBzdWJtZW51LmNsYXNzTGlzdC5hZGQoJ2NhbnZhcy1zdWJtZW51JylcclxuICAgIFxyXG4gICAgICAvLyBBZGQgbmVzdGVkIG9wdGlvbnNcclxuICAgICAgZm9yIChjb25zdCBzdWJNZW51T3B0aW9uIG9mIHN1Yk1lbnVPcHRpb25zKSB7XHJcbiAgICAgICAgY29uc3Qgc3ViTWVudU9wdGlvbkVsZW1lbnQgPSBjcmVhdGVQb3B1cE1lbnVPcHRpb24oc3ViTWVudU9wdGlvbilcclxuICAgICAgICBzdWJtZW51LmFwcGVuZENoaWxkKHN1Yk1lbnVPcHRpb25FbGVtZW50KVxyXG4gICAgICB9XHJcblxyXG4gICAgICBtZW51T3B0aW9uRWxlbWVudC5wYXJlbnRFbGVtZW50Py5hcHBlbmRDaGlsZChzdWJtZW51KVxyXG4gICAgfVxyXG4gIH0pXHJcblxyXG4gIHJldHVybiBtZW51T3B0aW9uRWxlbWVudFxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gYWRkUG9wdXBNZW51T3B0aW9uKGNhbnZhczogQ2FudmFzLCBlbGVtZW50OiBIVE1MRWxlbWVudCwgaW5kZXg6IG51bWJlciA9IC0xKSB7XHJcbiAgY29uc3QgcG9wdXBNZW51RWwgPSBjYW52YXM/Lm1lbnU/Lm1lbnVFbFxyXG4gIGlmICghcG9wdXBNZW51RWwpIHJldHVyblxyXG5cclxuICBpZiAoZWxlbWVudC5pZCkgcG9wdXBNZW51RWwucXVlcnlTZWxlY3RvcihgIyR7ZWxlbWVudC5pZH1gKT8ucmVtb3ZlKClcclxuXHJcbiAgY29uc3Qgc2lzdGVyRWxlbWVudCA9IGluZGV4ID49IDAgPyBwb3B1cE1lbnVFbC5jaGlsZHJlbltpbmRleF0gOiBwb3B1cE1lbnVFbC5jaGlsZHJlbltwb3B1cE1lbnVFbC5jaGlsZHJlbi5sZW5ndGggKyBpbmRleF1cclxuICBwb3B1cE1lbnVFbC5pbnNlcnRBZnRlcihlbGVtZW50LCBzaXN0ZXJFbGVtZW50KVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2VudGVyQ29vcmRpbmF0ZXMoY2FudmFzOiBDYW52YXMsIG5vZGVTaXplOiBTaXplKTogUG9zaXRpb24ge1xyXG4gIGNvbnN0IHZpZXdCb3VuZHMgPSBjYW52YXMuZ2V0Vmlld3BvcnRCQm94KClcclxuXHJcbiAgcmV0dXJuIHsgXHJcbiAgICB4OiAodmlld0JvdW5kcy5taW5YICsgdmlld0JvdW5kcy5tYXhYKSAvIDIgLSBub2RlU2l6ZS53aWR0aCAvIDIsXHJcbiAgICB5OiAodmlld0JvdW5kcy5taW5ZICsgdmlld0JvdW5kcy5tYXhZKSAvIDIgLSBub2RlU2l6ZS5oZWlnaHQgLyAyLFxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEJCb3goY2FudmFzTm9kZXM6IChDYW52YXNOb2RlfENhbnZhc05vZGVEYXRhKVtdKSB7XHJcbiAgbGV0IG1pblggPSBJbmZpbml0eVxyXG4gIGxldCBtaW5ZID0gSW5maW5pdHlcclxuICBsZXQgbWF4WCA9IC1JbmZpbml0eVxyXG4gIGxldCBtYXhZID0gLUluZmluaXR5XHJcblxyXG4gIGZvciAoY29uc3Qgbm9kZSBvZiBjYW52YXNOb2Rlcykge1xyXG4gICAgY29uc3Qgbm9kZURhdGEgPSBub2RlLmdldERhdGEgPyBub2RlLmdldERhdGEoKSA6IG5vZGVcclxuXHJcbiAgICBtaW5YID0gTWF0aC5taW4obWluWCwgbm9kZURhdGEueClcclxuICAgIG1pblkgPSBNYXRoLm1pbihtaW5ZLCBub2RlRGF0YS55KVxyXG4gICAgbWF4WCA9IE1hdGgubWF4KG1heFgsIG5vZGVEYXRhLnggKyBub2RlRGF0YS53aWR0aClcclxuICAgIG1heFkgPSBNYXRoLm1heChtYXhZLCBub2RlRGF0YS55ICsgbm9kZURhdGEuaGVpZ2h0KVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHsgbWluWCwgbWluWSwgbWF4WCwgbWF4WSB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB6b29tVG9CQm94KGNhbnZhczogQ2FudmFzLCBiYm94OiBCQm94KSB7XHJcbiAgY29uc3QgUEFERElOR19DT1JSRUNUSU9OX0ZBQ1RPUiA9IDEgLyAxLjFcclxuICBjb25zdCB6b29tZWRCQm94ID0gQkJveEhlbHBlci5zY2FsZUJCb3goYmJveCwgUEFERElOR19DT1JSRUNUSU9OX0ZBQ1RPUilcclxuXHJcbiAgY2FudmFzLnpvb21Ub0Jib3goem9vbWVkQkJveClcclxuICBcclxuICAvLyBDYWxjdWxhdGUgem9vbSBmYWN0b3Igd2l0aG91dCBjbGFtcFxyXG4gIGNvbnN0IHNjYWxlRmFjdG9yID0gTWF0aC5taW4oXHJcbiAgICBjYW52YXMuY2FudmFzUmVjdC53aWR0aCAvIChiYm94Lm1heFggLSBiYm94Lm1pblgpLFxyXG4gICAgY2FudmFzLmNhbnZhc1JlY3QuaGVpZ2h0IC8gKGJib3gubWF4WSAtIGJib3gubWluWSlcclxuICApXHJcblxyXG4gIGNhbnZhcy50Wm9vbSA9IE1hdGgubG9nMihzY2FsZUZhY3RvcilcclxufSIsICJpbXBvcnQgeyBCQm94LCBDYW52YXNOb2RlRGF0YSwgUG9zaXRpb24sIFNpZGUgfSBmcm9tIFwic3JjL0B0eXBlcy9DYW52YXNcIlxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNvbWJpbmVCQm94ZXMoYmJveGVzOiBCQm94W10pOiBCQm94IHtcclxuICBsZXQgbWluWCA9IEluZmluaXR5XHJcbiAgbGV0IG1pblkgPSBJbmZpbml0eVxyXG4gIGxldCBtYXhYID0gLUluZmluaXR5XHJcbiAgbGV0IG1heFkgPSAtSW5maW5pdHlcclxuXHJcbiAgZm9yIChsZXQgYmJveCBvZiBiYm94ZXMpIHtcclxuICAgIG1pblggPSBNYXRoLm1pbihtaW5YLCBiYm94Lm1pblgpXHJcbiAgICBtaW5ZID0gTWF0aC5taW4obWluWSwgYmJveC5taW5ZKVxyXG4gICAgbWF4WCA9IE1hdGgubWF4KG1heFgsIGJib3gubWF4WClcclxuICAgIG1heFkgPSBNYXRoLm1heChtYXhZLCBiYm94Lm1heFkpXHJcbiAgfVxyXG5cclxuICByZXR1cm4geyBtaW5YLCBtaW5ZLCBtYXhYLCBtYXhZIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNjYWxlQkJveChiYm94OiBCQm94LCBzY2FsZTogbnVtYmVyKTogQkJveCB7XHJcbiAgbGV0IGRpZmZYID0gKHNjYWxlIC0gMSkgKiAoYmJveC5tYXhYIC0gYmJveC5taW5YKVxyXG4gIGxldCBkaWZmWSA9IChzY2FsZSAtIDEpICogKGJib3gubWF4WSAtIGJib3gubWluWSlcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIG1pblg6IGJib3gubWluWCAtIGRpZmZYIC8gMixcclxuICAgIG1heFg6IGJib3gubWF4WCArIGRpZmZYIC8gMixcclxuICAgIG1pblk6IGJib3gubWluWSAtIGRpZmZZIC8gMixcclxuICAgIG1heFk6IGJib3gubWF4WSArIGRpZmZZIC8gMlxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGluc2lkZUJCb3gocG9zaXRpb246IFBvc2l0aW9ufEJCb3gsIGJib3g6IEJCb3gsIGNhblRvdWNoRWRnZTogQm9vbGVhbik6IGJvb2xlYW4ge1xyXG4gIGNvbnN0IHByb3ZpZGVkQkJveCA9IHtcclxuICAgIG1pblg6IChwb3NpdGlvbiBhcyBCQm94KS5taW5YID8/IChwb3NpdGlvbiBhcyBQb3NpdGlvbikueCxcclxuICAgIG1pblk6IChwb3NpdGlvbiBhcyBCQm94KS5taW5ZID8/IChwb3NpdGlvbiBhcyBQb3NpdGlvbikueSxcclxuICAgIG1heFg6IChwb3NpdGlvbiBhcyBCQm94KS5tYXhYID8/IChwb3NpdGlvbiBhcyBQb3NpdGlvbikueCxcclxuICAgIG1heFk6IChwb3NpdGlvbiBhcyBCQm94KS5tYXhZID8/IChwb3NpdGlvbiBhcyBQb3NpdGlvbikueVxyXG4gIH1cclxuICBcclxuICByZXR1cm4gY2FuVG91Y2hFZGdlID8gcHJvdmlkZWRCQm94Lm1pblggPj0gYmJveC5taW5YICYmIHByb3ZpZGVkQkJveC5tYXhYIDw9IGJib3gubWF4WCAmJiBwcm92aWRlZEJCb3gubWluWSA+PSBiYm94Lm1pblkgJiYgcHJvdmlkZWRCQm94Lm1heFkgPD0gYmJveC5tYXhZIDpcclxuICAgIHByb3ZpZGVkQkJveC5taW5YID4gYmJveC5taW5YICYmIHByb3ZpZGVkQkJveC5tYXhYIDwgYmJveC5tYXhYICYmIHByb3ZpZGVkQkJveC5taW5ZID4gYmJveC5taW5ZICYmIHByb3ZpZGVkQkJveC5tYXhZIDwgYmJveC5tYXhZXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBlbmxhcmdlQkJveChiYm94OiBCQm94LCBwYWRkaW5nOiBudW1iZXIpOiBCQm94IHtcclxuICByZXR1cm4ge1xyXG4gICAgbWluWDogYmJveC5taW5YIC0gcGFkZGluZyxcclxuICAgIG1pblk6IGJib3gubWluWSAtIHBhZGRpbmcsXHJcbiAgICBtYXhYOiBiYm94Lm1heFggKyBwYWRkaW5nLFxyXG4gICAgbWF4WTogYmJveC5tYXhZICsgcGFkZGluZ1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldENlbnRlck9mQkJveFNpZGUoYmJveDogQkJveCwgc2lkZTogU2lkZSk6IFBvc2l0aW9uIHtcclxuICBzd2l0Y2ggKHNpZGUpIHtcclxuICAgIGNhc2UgJ3RvcCc6XHJcbiAgICAgIHJldHVybiB7IHg6IChiYm94Lm1pblggKyBiYm94Lm1heFgpIC8gMiwgeTogYmJveC5taW5ZIH1cclxuICAgIGNhc2UgJ3JpZ2h0JzpcclxuICAgICAgcmV0dXJuIHsgeDogYmJveC5tYXhYLCB5OiAoYmJveC5taW5ZICsgYmJveC5tYXhZKSAvIDIgfVxyXG4gICAgY2FzZSAnYm90dG9tJzpcclxuICAgICAgcmV0dXJuIHsgeDogKGJib3gubWluWCArIGJib3gubWF4WCkgLyAyLCB5OiBiYm94Lm1heFkgfVxyXG4gICAgY2FzZSAnbGVmdCc6XHJcbiAgICAgIHJldHVybiB7IHg6IGJib3gubWluWCwgeTogKGJib3gubWluWSArIGJib3gubWF4WSkgLyAyIH1cclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBiYm94RnJvbU5vZGVEYXRhKG5vZGVEYXRhOiBDYW52YXNOb2RlRGF0YSk6IEJCb3gge1xyXG4gIHJldHVybiB7XHJcbiAgICBtaW5YOiBub2RlRGF0YS54LFxyXG4gICAgbWluWTogbm9kZURhdGEueSxcclxuICAgIG1heFg6IG5vZGVEYXRhLnggKyBub2RlRGF0YS53aWR0aCxcclxuICAgIG1heFk6IG5vZGVEYXRhLnkgKyBub2RlRGF0YS5oZWlnaHRcclxuICB9XHJcbn0iLCAiY29uc3QgUExVR0lOX0VWRU5UX1BSRUZJWCA9ICdhZHZhbmNlZC1jYW52YXMnXHJcblxyXG5leHBvcnQgY29uc3QgQ2FudmFzRXZlbnQgPSB7XHJcbiAgQ2FudmFzQ2hhbmdlZDogYCR7UExVR0lOX0VWRU5UX1BSRUZJWH06Y2FudmFzLWNoYW5nZWRgLFxyXG4gIFZpZXdwb3J0Q2hhbmdlZDoge1xyXG4gICAgQmVmb3JlOiBgJHtQTFVHSU5fRVZFTlRfUFJFRklYfTp2aWV3cG9ydC1jaGFuZ2VkOmJlZm9yZWAsXHJcbiAgICBBZnRlcjogYCR7UExVR0lOX0VWRU5UX1BSRUZJWH06dmlld3BvcnQtY2hhbmdlZDphZnRlcmBcclxuICB9LFxyXG4gIE5vZGVNb3ZlZDogYCR7UExVR0lOX0VWRU5UX1BSRUZJWH06bm9kZS1tb3ZlZGAsXHJcbiAgRG91YmxlQ2xpY2s6IGAke1BMVUdJTl9FVkVOVF9QUkVGSVh9OmRvdWJsZS1jbGlja2AsXHJcbiAgRHJhZ2dpbmdTdGF0ZUNoYW5nZWQ6IGAke1BMVUdJTl9FVkVOVF9QUkVGSVh9OmRyYWdnaW5nLXN0YXRlLWNoYW5nZWRgLFxyXG4gIE5vZGVBZGRlZDogYCR7UExVR0lOX0VWRU5UX1BSRUZJWH06bm9kZS1hZGRlZGAsXHJcbiAgRWRnZUFkZGVkOiBgJHtQTFVHSU5fRVZFTlRfUFJFRklYfTplZGdlLWFkZGVkYCxcclxuICBOb2RlUmVtb3ZlZDogYCR7UExVR0lOX0VWRU5UX1BSRUZJWH06bm9kZS1yZW1vdmVkYCxcclxuICBFZGdlUmVtb3ZlZDogYCR7UExVR0lOX0VWRU5UX1BSRUZJWH06ZWRnZS1yZW1vdmVkYCxcclxuICBOb2RlQ2hhbmdlZDogYCR7UExVR0lOX0VWRU5UX1BSRUZJWH06bm9kZS1jaGFuZ2VkYCxcclxuICBFZGdlQ2hhbmdlZDogYCR7UExVR0lOX0VWRU5UX1BSRUZJWH06ZWRnZS1jaGFuZ2VkYCxcclxuICBOb2RlQkJveFJlcXVlc3RlZDogYCR7UExVR0lOX0VWRU5UX1BSRUZJWH06bm9kZS1iYm94LXJlcXVlc3RlZGAsXHJcbiAgRWRnZUNlbnRlclJlcXVlc3RlZDogYCR7UExVR0lOX0VWRU5UX1BSRUZJWH06ZWRnZS1jZW50ZXItcmVxdWVzdGVkYCxcclxuICBDb250YWluaW5nTm9kZXNSZXF1ZXN0ZWQ6IGAke1BMVUdJTl9FVkVOVF9QUkVGSVh9OmNvbnRhaW5pbmctbm9kZXMtcmVxdWVzdGVkYCxcclxuICBTZWxlY3Rpb25DaGFuZ2VkOiBgJHtQTFVHSU5fRVZFTlRfUFJFRklYfTpzZWxlY3Rpb24tY2hhbmdlZGAsXHJcbiAgWm9vbVRvQmJveDoge1xyXG4gICAgQmVmb3JlOiBgJHtQTFVHSU5fRVZFTlRfUFJFRklYfTp6b29tLXRvLWJib3g6YmVmb3JlYCxcclxuICAgIEFmdGVyOiBgJHtQTFVHSU5fRVZFTlRfUFJFRklYfTp6b29tLXRvLWJib3g6YWZ0ZXJgXHJcbiAgfSxcclxuICBQb3B1cE1lbnVDcmVhdGVkOiBgJHtQTFVHSU5fRVZFTlRfUFJFRklYfTpwb3B1cC1tZW51LWNyZWF0ZWRgLFxyXG4gIE5vZGVJbnRlcmFjdGlvbjogYCR7UExVR0lOX0VWRU5UX1BSRUZJWH06bm9kZS1pbnRlcmFjdGlvbmAsXHJcbiAgVW5kbzogYCR7UExVR0lOX0VWRU5UX1BSRUZJWH06dW5kb2AsXHJcbiAgUmVkbzogYCR7UExVR0lOX0VWRU5UX1BSRUZJWH06cmVkb2AsXHJcbiAgUmVhZG9ubHlDaGFuZ2VkOiBgJHtQTFVHSU5fRVZFTlRfUFJFRklYfTpyZWFkb25seS1jaGFuZ2VkYCxcclxuICBEYXRhUmVxdWVzdGVkOiBgJHtQTFVHSU5fRVZFTlRfUFJFRklYfTpkYXRhLXJlcXVlc3RlZGAsXHJcbiAgTG9hZERhdGE6IGAke1BMVUdJTl9FVkVOVF9QUkVGSVh9OmxvYWQtZGF0YWAsXHJcbiAgQ2FudmFzU2F2ZWQ6IHtcclxuICAgIEJlZm9yZTogYCR7UExVR0lOX0VWRU5UX1BSRUZJWH06Y2FudmFzLXNhdmVkOmJlZm9yZWAsXHJcbiAgICBBZnRlcjogYCR7UExVR0lOX0VWRU5UX1BSRUZJWH06Y2FudmFzLXNhdmVkOmFmdGVyYFxyXG4gIH1cclxufSIsICJpbXBvcnQgeyBDYW52YXMgfSBmcm9tIFwic3JjL0B0eXBlcy9DYW52YXNcIlxyXG5pbXBvcnQgQWR2YW5jZWRDYW52YXNQbHVnaW4gZnJvbSBcInNyYy9tYWluXCJcclxuaW1wb3J0ICogYXMgQ2FudmFzSGVscGVyIGZyb20gXCJzcmMvdXRpbHMvY2FudmFzLWhlbHBlclwiXHJcbmltcG9ydCB7IENhbnZhc0V2ZW50IH0gZnJvbSBcInNyYy9jb3JlL2V2ZW50c1wiXHJcblxyXG5pbnRlcmZhY2UgU2hhcGUge1xyXG4gIGlkPzogc3RyaW5nXHJcbiAgbWVudU5hbWU6IHN0cmluZ1xyXG4gIGljb246IHN0cmluZ1xyXG59XHJcblxyXG5jb25zdCBTSEFQRVM6IFNoYXBlW10gPSBbXHJcbiAge1xyXG4gICAgbWVudU5hbWU6ICdEZWZhdWx0JyxcclxuICAgIGljb246ICdjaXJjbGUtb2ZmJ1xyXG4gIH0sXHJcbiAge1xyXG4gICAgaWQ6ICdvdmFsJyxcclxuICAgIG1lbnVOYW1lOiAnT3ZhbCcsXHJcbiAgICBpY29uOiAnb3ZhbCdcclxuICB9LFxyXG4gIHtcclxuICAgIGlkOiAnY2VudGVyZWQtcmVjdGFuZ2xlJyxcclxuICAgIG1lbnVOYW1lOiAnUmVjdGFuZ2xlJyxcclxuICAgIGljb246ICdyZWN0YW5nbGUtaG9yaXpvbnRhbCdcclxuICB9LFxyXG4gIHtcclxuICAgIGlkOiAnZGlhbW9uZCcsXHJcbiAgICBtZW51TmFtZTogJ0RpYW1vbmQnLFxyXG4gICAgaWNvbjogJ2RpYW1vbmQnXHJcbiAgfSxcclxuICB7XHJcbiAgICBpZDogJ3BhcmFsbGVsb2dyYW0nLFxyXG4gICAgbWVudU5hbWU6ICdQYXJhbGxlbG9ncmFtJyxcclxuICAgIGljb246ICdwYXJhbGxlbG9ncmFtJ1xyXG4gIH0sXHJcbiAge1xyXG4gICAgaWQ6ICdjaXJjbGUnLFxyXG4gICAgbWVudU5hbWU6ICdDaXJjbGUnLFxyXG4gICAgaWNvbjogJ2NpcmNsZSdcclxuICB9LFxyXG4gIHtcclxuICAgIGlkOiAncHJlZGVmaW5lZC1wcm9jZXNzJyxcclxuICAgIG1lbnVOYW1lOiAnUHJlZGVmaW5lZCBwcm9jZXNzJyxcclxuICAgIGljb246ICdwcmVkZWZpbmVkLXByb2Nlc3MnXHJcbiAgfSxcclxuICB7XHJcbiAgICBpZDogJ2RvY3VtZW50JyxcclxuICAgIG1lbnVOYW1lOiAnRG9jdW1lbnQnLFxyXG4gICAgaWNvbjogJ2RvY3VtZW50J1xyXG4gIH0sXHJcbiAge1xyXG4gICAgaWQ6ICdkYXRhYmFzZScsXHJcbiAgICBtZW51TmFtZTogJ0RhdGFiYXNlJyxcclxuICAgIGljb246ICdkYXRhYmFzZS1zaGFwZSdcclxuICB9XHJcbl1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNoYXBlc0NhbnZhc0V4dGVuc2lvbiB7XHJcbiAgcGx1Z2luOiBBZHZhbmNlZENhbnZhc1BsdWdpblxyXG5cclxuICBjb25zdHJ1Y3RvcihwbHVnaW46IEFkdmFuY2VkQ2FudmFzUGx1Z2luKSB7XHJcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpblxyXG5cclxuICAgIGlmICghdGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2V0U2V0dGluZygnc2hhcGVzRmVhdHVyZUVuYWJsZWQnKSkgcmV0dXJuXHJcblxyXG4gICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudCh0aGlzLnBsdWdpbi5hcHAud29ya3NwYWNlLm9uKFxyXG4gICAgICBDYW52YXNFdmVudC5Qb3B1cE1lbnVDcmVhdGVkLFxyXG4gICAgICAoY2FudmFzOiBDYW52YXMpID0+IHRoaXMub25Qb3B1cE1lbnVDcmVhdGVkKGNhbnZhcylcclxuICAgICkpXHJcbiAgfVxyXG5cclxuICBvblBvcHVwTWVudUNyZWF0ZWQoY2FudmFzOiBDYW52YXMpOiB2b2lkIHtcclxuICAgIC8vIElmIHRoZSBjYW52YXMgaXMgcmVhZG9ubHkgb3IgdGhlcmUgaXMgbm8gdmFsaWQgc2hhcGUgaW4gdGhlIHNlbGVjdGlvbiwgcmV0dXJuXHJcbiAgICBpZiAoY2FudmFzLnJlYWRvbmx5IHx8ICF0aGlzLmhhc1ZhbGlkTm9kZUluU2VsZWN0aW9uKGNhbnZhcykpXHJcbiAgICAgIHJldHVyblxyXG5cclxuICAgIGNvbnN0IG5lc3RlZE1lbnVPcHRpb25zID0gU0hBUEVTLm1hcCgoc2hhcGUpID0+ICh7XHJcbiAgICAgIGxhYmVsOiBzaGFwZS5tZW51TmFtZSxcclxuICAgICAgaWNvbjogc2hhcGUuaWNvbixcclxuICAgICAgY2FsbGJhY2s6ICgpID0+IHRoaXMuc2V0U2hhcGVGb3JTZWxlY3Rpb24oY2FudmFzLCBzaGFwZSlcclxuICAgIH0pKVxyXG5cclxuICAgIGNvbnN0IG1lbnVPcHRpb24gPSBDYW52YXNIZWxwZXIuY3JlYXRlRXhwYW5kYWJsZVBvcHVwTWVudU9wdGlvbih7XHJcbiAgICAgIGlkOiAnbm9kZS1zaGFwZS1vcHRpb24nLFxyXG4gICAgICBsYWJlbDogJ05vZGUgc2hhcGUnLFxyXG4gICAgICBpY29uOiAnc2hhcGVzJ1xyXG4gICAgfSwgbmVzdGVkTWVudU9wdGlvbnMpXHJcblxyXG4gICAgLy8gQWRkIG1lbnUgb3B0aW9uIHRvIG1lbnUgYmFyXHJcbiAgICBDYW52YXNIZWxwZXIuYWRkUG9wdXBNZW51T3B0aW9uKGNhbnZhcywgbWVudU9wdGlvbilcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFzVmFsaWROb2RlSW5TZWxlY3Rpb24oY2FudmFzOiBDYW52YXMpOiBib29sZWFuIHtcclxuICAgIGNvbnN0IHNlbGVjdGVkTm9kZXNEYXRhID0gY2FudmFzLmdldFNlbGVjdGlvbkRhdGEoKS5ub2Rlc1xyXG5cclxuICAgIGZvciAoY29uc3Qgbm9kZURhdGEgb2Ygc2VsZWN0ZWROb2Rlc0RhdGEpIHtcclxuICAgICAgaWYgKG5vZGVEYXRhLnR5cGUgPT09ICd0ZXh0JykgcmV0dXJuIHRydWVcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIGZhbHNlXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNldFNoYXBlRm9yU2VsZWN0aW9uKGNhbnZhczogQ2FudmFzLCBzaGFwZTogU2hhcGUpIHsgIFxyXG4gICAgY29uc3Qgc2VsZWN0ZWROb2Rlc0RhdGEgPSBjYW52YXMuZ2V0U2VsZWN0aW9uRGF0YSgpLm5vZGVzXHJcblxyXG4gICAgZm9yIChjb25zdCBub2RlRGF0YSBvZiBzZWxlY3RlZE5vZGVzRGF0YSkge1xyXG4gICAgICBpZiAobm9kZURhdGEudHlwZSAhPT0gJ3RleHQnKSBjb250aW51ZVxyXG5cclxuICAgICAgY29uc3Qgbm9kZSA9IGNhbnZhcy5ub2Rlcy5nZXQobm9kZURhdGEuaWQpXHJcbiAgICAgIGlmICghbm9kZSkgY29udGludWVcclxuICAgICAgXHJcbiAgICAgIG5vZGUuc2V0RGF0YSh7IC4uLm5vZGVEYXRhLCBzaGFwZTogc2hhcGUuaWQgfSlcclxuICAgIH1cclxuICB9XHJcbn0iLCAiZXhwb3J0IGZ1bmN0aW9uIGFyb3VuZChvYmosIGZhY3Rvcmllcykge1xuICAgIGNvbnN0IHJlbW92ZXJzID0gT2JqZWN0LmtleXMoZmFjdG9yaWVzKS5tYXAoa2V5ID0+IGFyb3VuZDEob2JqLCBrZXksIGZhY3Rvcmllc1trZXldKSk7XG4gICAgcmV0dXJuIHJlbW92ZXJzLmxlbmd0aCA9PT0gMSA/IHJlbW92ZXJzWzBdIDogZnVuY3Rpb24gKCkgeyByZW1vdmVycy5mb3JFYWNoKHIgPT4gcigpKTsgfTtcbn1cbmZ1bmN0aW9uIGFyb3VuZDEob2JqLCBtZXRob2QsIGNyZWF0ZVdyYXBwZXIpIHtcbiAgICBjb25zdCBvcmlnaW5hbCA9IG9ialttZXRob2RdLCBoYWRPd24gPSBvYmouaGFzT3duUHJvcGVydHkobWV0aG9kKTtcbiAgICBsZXQgY3VycmVudCA9IGNyZWF0ZVdyYXBwZXIob3JpZ2luYWwpO1xuICAgIC8vIExldCBvdXIgd3JhcHBlciBpbmhlcml0IHN0YXRpYyBwcm9wcyBmcm9tIHRoZSB3cmFwcGluZyBtZXRob2QsXG4gICAgLy8gYW5kIHRoZSB3cmFwcGluZyBtZXRob2QsIHByb3BzIGZyb20gdGhlIG9yaWdpbmFsIG1ldGhvZFxuICAgIGlmIChvcmlnaW5hbClcbiAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKGN1cnJlbnQsIG9yaWdpbmFsKTtcbiAgICBPYmplY3Quc2V0UHJvdG90eXBlT2Yod3JhcHBlciwgY3VycmVudCk7XG4gICAgb2JqW21ldGhvZF0gPSB3cmFwcGVyO1xuICAgIC8vIFJldHVybiBhIGNhbGxiYWNrIHRvIGFsbG93IHNhZmUgcmVtb3ZhbFxuICAgIHJldHVybiByZW1vdmU7XG4gICAgZnVuY3Rpb24gd3JhcHBlciguLi5hcmdzKSB7XG4gICAgICAgIC8vIElmIHdlIGhhdmUgYmVlbiBkZWFjdGl2YXRlZCBhbmQgYXJlIG5vIGxvbmdlciB3cmFwcGVkLCByZW1vdmUgb3Vyc2VsdmVzXG4gICAgICAgIGlmIChjdXJyZW50ID09PSBvcmlnaW5hbCAmJiBvYmpbbWV0aG9kXSA9PT0gd3JhcHBlcilcbiAgICAgICAgICAgIHJlbW92ZSgpO1xuICAgICAgICByZXR1cm4gY3VycmVudC5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gcmVtb3ZlKCkge1xuICAgICAgICAvLyBJZiBubyBvdGhlciBwYXRjaGVzLCBqdXN0IGRvIGEgZGlyZWN0IHJlbW92YWxcbiAgICAgICAgaWYgKG9ialttZXRob2RdID09PSB3cmFwcGVyKSB7XG4gICAgICAgICAgICBpZiAoaGFkT3duKVxuICAgICAgICAgICAgICAgIG9ialttZXRob2RdID0gb3JpZ2luYWw7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgZGVsZXRlIG9ialttZXRob2RdO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjdXJyZW50ID09PSBvcmlnaW5hbClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgLy8gRWxzZSBwYXNzIGZ1dHVyZSBjYWxscyB0aHJvdWdoLCBhbmQgcmVtb3ZlIHdyYXBwZXIgZnJvbSB0aGUgcHJvdG90eXBlIGNoYWluXG4gICAgICAgIGN1cnJlbnQgPSBvcmlnaW5hbDtcbiAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKHdyYXBwZXIsIG9yaWdpbmFsIHx8IEZ1bmN0aW9uKTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gZGVkdXBlKGtleSwgb2xkRm4sIG5ld0ZuKSB7XG4gICAgY2hlY2tba2V5XSA9IGtleTtcbiAgICByZXR1cm4gY2hlY2s7XG4gICAgZnVuY3Rpb24gY2hlY2soLi4uYXJncykge1xuICAgICAgICByZXR1cm4gKG9sZEZuW2tleV0gPT09IGtleSA/IG9sZEZuIDogbmV3Rm4pLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBhZnRlcihwcm9taXNlLCBjYikge1xuICAgIHJldHVybiBwcm9taXNlLnRoZW4oY2IsIGNiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBzZXJpYWxpemUoYXN5bmNGdW5jdGlvbikge1xuICAgIGxldCBsYXN0UnVuID0gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgZnVuY3Rpb24gd3JhcHBlciguLi5hcmdzKSB7XG4gICAgICAgIHJldHVybiBsYXN0UnVuID0gbmV3IFByb21pc2UoKHJlcywgcmVqKSA9PiB7XG4gICAgICAgICAgICBhZnRlcihsYXN0UnVuLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgYXN5bmNGdW5jdGlvbi5hcHBseSh0aGlzLCBhcmdzKS50aGVuKHJlcywgcmVqKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgd3JhcHBlci5hZnRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGxhc3RSdW4gPSBuZXcgUHJvbWlzZSgocmVzLCByZWopID0+IHsgYWZ0ZXIobGFzdFJ1biwgcmVzKTsgfSk7XG4gICAgfTtcbiAgICByZXR1cm4gd3JhcHBlcjtcbn1cbiIsICJpbXBvcnQgeyBhcm91bmQgfSBmcm9tIFwibW9ua2V5LWFyb3VuZFwiXHJcbmltcG9ydCB7IFBsdWdpbiB9IGZyb20gXCJvYnNpZGlhblwiXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdHJ5UGF0Y2hXb3Jrc3BhY2VQcm90b3R5cGU8VD4ocGx1Z2luOiBQbHVnaW4sIGdldFRhcmdldDogKCkgPT4gVHx1bmRlZmluZWQsIGZ1bmN0aW9uczogeyBba2V5OiBzdHJpbmddOiAobmV4dDogYW55KSA9PiAoLi4uYXJnczogYW55KSA9PiBhbnkgfSk6IFByb21pc2U8VD4ge1xyXG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xyXG4gICAgY29uc3QgdHJ5UGF0Y2ggPSAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHRhcmdldCA9IGdldFRhcmdldCgpXHJcbiAgICAgIGlmICghdGFyZ2V0KSByZXR1cm4gbnVsbFxyXG5cclxuICAgICAgY29uc3QgdW5pbnN0YWxsZXIgPSBhcm91bmQodGFyZ2V0LmNvbnN0cnVjdG9yLnByb3RvdHlwZSwgZnVuY3Rpb25zKVxyXG4gICAgICBwbHVnaW4ucmVnaXN0ZXIodW5pbnN0YWxsZXIpXHJcblxyXG4gICAgICByZXR1cm4gdGFyZ2V0XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcmVzdWx0ID0gdHJ5UGF0Y2goKVxyXG4gICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICByZXNvbHZlKHJlc3VsdClcclxuICAgICAgcmV0dXJuXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbGlzdGVuZXIgPSBwbHVnaW4uYXBwLndvcmtzcGFjZS5vbignbGF5b3V0LWNoYW5nZScsICgpID0+IHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gdHJ5UGF0Y2goKVxyXG5cclxuICAgICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICAgIHBsdWdpbi5hcHAud29ya3NwYWNlLm9mZnJlZihsaXN0ZW5lcilcclxuICAgICAgICByZXNvbHZlKHJlc3VsdClcclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICBwbHVnaW4ucmVnaXN0ZXJFdmVudChsaXN0ZW5lcilcclxuICB9KVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcGF0Y2hPYmplY3RQcm90b3R5cGU8VD4ocGx1Z2luOiBQbHVnaW4sIHRhcmdldDogVCwgZnVuY3Rpb25zOiB7IFtrZXk6IHN0cmluZ106IChuZXh0OiBhbnkpID0+ICguLi5hcmdzOiBhbnkpID0+IGFueSB9KTogdm9pZCB7XHJcbiAgY29uc3QgdW5pbnN0YWxsZXIgPSBhcm91bmQoKHRhcmdldCBhcyBhbnkpLmNvbnN0cnVjdG9yLnByb3RvdHlwZSwgZnVuY3Rpb25zKVxyXG4gIHBsdWdpbi5yZWdpc3Rlcih1bmluc3RhbGxlcilcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHBhdGNoT2JqZWN0SW5zdGFuY2U8VD4ocGx1Z2luOiBQbHVnaW4sIHRhcmdldDogVCwgZnVuY3Rpb25zOiB7IFtrZXk6IHN0cmluZ106IChuZXh0OiBhbnkpID0+ICguLi5hcmdzOiBhbnkpID0+IGFueSB9KTogdm9pZCB7XHJcbiAgY29uc3QgdW5pbnN0YWxsZXIgPSBhcm91bmQodGFyZ2V0IGFzIGFueSwgZnVuY3Rpb25zKVxyXG4gIHBsdWdpbi5yZWdpc3Rlcih1bmluc3RhbGxlcilcclxufSIsICJpbXBvcnQgQWR2YW5jZWRDYW52YXNQbHVnaW4gZnJvbSBcInNyYy9tYWluXCJcclxuaW1wb3J0IHsgQkJveCwgQ2FudmFzLCBDYW52YXNEYXRhLCBDYW52YXNFZGdlLCBDYW52YXNFbGVtZW50LCBDYW52YXNOb2RlLCBDYW52YXNWaWV3IH0gZnJvbSBcInNyYy9AdHlwZXMvQ2FudmFzXCJcclxuaW1wb3J0IHsgcGF0Y2hPYmplY3RJbnN0YW5jZSwgcGF0Y2hPYmplY3RQcm90b3R5cGUgfSBmcm9tIFwic3JjL3V0aWxzL3BhdGNoLWhlbHBlclwiXHJcbmltcG9ydCB7IENhbnZhc0V2ZW50IH0gZnJvbSBcIi4vZXZlbnRzXCJcclxuaW1wb3J0IHsgV29ya3NwYWNlTGVhZiB9IGZyb20gXCJvYnNpZGlhblwiXHJcbmltcG9ydCB7IGFyb3VuZCB9IGZyb20gXCJtb25rZXktYXJvdW5kXCJcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENhbnZhc1BhdGNoZXIge1xyXG4gIHBsdWdpbjogQWR2YW5jZWRDYW52YXNQbHVnaW5cclxuXHJcbiAgY29uc3RydWN0b3IocGx1Z2luOiBBZHZhbmNlZENhbnZhc1BsdWdpbikge1xyXG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW5cclxuICAgIHRoaXMuYXBwbHlQYXRjaGVzKClcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgYXBwbHlQYXRjaGVzKCkge1xyXG4gICAgY29uc3QgdGhhdCA9IHRoaXNcclxuXHJcbiAgICAvLyBHZXQgdGhlIGN1cnJlbnQgY2FudmFzIHZpZXcgb3Igd2FpdCBmb3IgaXQgdG8gYmUgY3JlYXRlZFxyXG4gICAgY29uc3QgY2FudmFzVmlldyA9IChcclxuICAgICAgdGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5nZXRMZWF2ZXNPZlR5cGUoJ2NhbnZhcycpPy5maXJzdCgpPy52aWV3ID8/XHJcbiAgICAgIGF3YWl0IG5ldyBQcm9taXNlPENhbnZhc1ZpZXc+KChyZXNvbHZlKSA9PiB7XHJcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgIGNvbnN0IHVuaW5zdGFsbCA9IGFyb3VuZCh0aGlzLnBsdWdpbi5hcHAuaW50ZXJuYWxQbHVnaW5zLnBsdWdpbnMuY2FudmFzLnZpZXdzLCB7XHJcbiAgICAgICAgICBjYW52YXM6IChuZXh0OiBhbnkpID0+IGZ1bmN0aW9uICguLi5hcmdzOiBhbnkpIHtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gbmV4dC5jYWxsKHRoaXMsIC4uLmFyZ3MpXHJcblxyXG4gICAgICAgICAgICByZXNvbHZlKHJlc3VsdClcclxuICAgICAgICAgICAgdW5pbnN0YWxsKCkgLy8gVW5pbnN0YWxsIHRoZSBwYXRjaFxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdFxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXIodW5pbnN0YWxsKVxyXG4gICAgICB9KVxyXG4gICAgKSBhcyBDYW52YXNWaWV3XHJcbiAgICBcclxuICAgIC8vIFBhdGNoIGNhbnZhcyB2aWV3XHJcbiAgICBwYXRjaE9iamVjdFByb3RvdHlwZSh0aGlzLnBsdWdpbiwgY2FudmFzVmlldywge1xyXG4gICAgICBnZXRWaWV3RGF0YTogKF9uZXh0OiBhbnkpID0+IGZ1bmN0aW9uICguLi5fYXJnczogYW55KSB7XHJcbiAgICAgICAgY29uc3QgY2FudmFzRGF0YSA9IHRoaXMuY2FudmFzLmdldERhdGEoKVxyXG4gICAgICAgIGNhbnZhc0RhdGEubWV0YWRhdGEgPSB0aGlzLmNhbnZhcy5tZXRhZGF0YSA/PyB7fVxyXG5cclxuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoY2FudmFzRGF0YSwgbnVsbCwgMilcclxuICAgICAgfSxcclxuICAgICAgc2V0Vmlld0RhdGE6IChuZXh0OiBhbnkpID0+IGZ1bmN0aW9uIChqc29uOiBzdHJpbmcsIC4uLmFyZ3M6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IG5leHQuY2FsbCh0aGlzLCBqc29uLCAuLi5hcmdzKVxyXG5cclxuICAgICAgICB0cnkgeyB0aGlzLmNhbnZhcy5tZXRhZGF0YSA9IEpTT04ucGFyc2UoanNvbikubWV0YWRhdGEgfVxyXG4gICAgICAgIGNhdGNoIChfZSkgeyB0aGlzLmNhbnZhcy5tZXRhZGF0YSA9IHt9IH1cclxuXHJcbiAgICAgICAgdGhhdC50cmlnZ2VyV29ya3NwYWNlRXZlbnQoQ2FudmFzRXZlbnQuQ2FudmFzQ2hhbmdlZCwgdGhpcy5jYW52YXMpXHJcblxyXG4gICAgICAgIHJldHVybiByZXN1bHRcclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICAvLyBQYXRjaCBjYW52YXNcclxuICAgIHBhdGNoT2JqZWN0UHJvdG90eXBlKHRoaXMucGx1Z2luLCBjYW52YXNWaWV3LmNhbnZhcywge1xyXG4gICAgICBtYXJrVmlld3BvcnRDaGFuZ2VkOiAobmV4dDogYW55KSA9PiBmdW5jdGlvbiAoLi4uYXJnczogYW55KSB7XHJcbiAgICAgICAgdGhhdC50cmlnZ2VyV29ya3NwYWNlRXZlbnQoQ2FudmFzRXZlbnQuVmlld3BvcnRDaGFuZ2VkLkJlZm9yZSwgdGhpcylcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBuZXh0LmNhbGwodGhpcywgLi4uYXJncylcclxuICAgICAgICB0aGF0LnRyaWdnZXJXb3Jrc3BhY2VFdmVudChDYW52YXNFdmVudC5WaWV3cG9ydENoYW5nZWQuQWZ0ZXIsIHRoaXMpXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdFxyXG4gICAgICB9LFxyXG4gICAgICBtYXJrTW92ZWQ6IChuZXh0OiBhbnkpID0+IGZ1bmN0aW9uIChub2RlOiBDYW52YXNOb2RlKSB7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gbmV4dC5jYWxsKHRoaXMsIG5vZGUpXHJcbiAgICAgICAgdGhhdC50cmlnZ2VyV29ya3NwYWNlRXZlbnQoQ2FudmFzRXZlbnQuTm9kZU1vdmVkLCB0aGlzLCBub2RlKVxyXG4gICAgICAgIHJldHVybiByZXN1bHRcclxuICAgICAgfSxcclxuICAgICAgb25Eb3VibGVDbGljazogKG5leHQ6IGFueSkgPT4gZnVuY3Rpb24gKGV2ZW50OiBNb3VzZUV2ZW50KSB7XHJcbiAgICAgICAgY29uc3QgcHJldmVudERlZmF1bHQgPSB7IHZhbHVlOiBmYWxzZSB9XHJcbiAgICAgICAgdGhhdC50cmlnZ2VyV29ya3NwYWNlRXZlbnQoQ2FudmFzRXZlbnQuRG91YmxlQ2xpY2ssIHRoaXMsIGV2ZW50LCBwcmV2ZW50RGVmYXVsdClcclxuICAgICAgICBpZiAoIXByZXZlbnREZWZhdWx0LnZhbHVlKSBuZXh0LmNhbGwodGhpcywgZXZlbnQpXHJcbiAgICAgIH0sXHJcbiAgICAgIHNldERyYWdnaW5nOiAobmV4dDogYW55KSA9PiBmdW5jdGlvbiAoZHJhZ2dpbmc6IGJvb2xlYW4pIHtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBuZXh0LmNhbGwodGhpcywgZHJhZ2dpbmcpXHJcbiAgICAgICAgdGhhdC50cmlnZ2VyV29ya3NwYWNlRXZlbnQoQ2FudmFzRXZlbnQuRHJhZ2dpbmdTdGF0ZUNoYW5nZWQsIHRoaXMsIGRyYWdnaW5nKVxyXG4gICAgICAgIHJldHVybiByZXN1bHRcclxuICAgICAgfSxcclxuICAgICAgZ2V0Q29udGFpbmluZ05vZGVzOiAobmV4dDogYW55KSA9PiBmdW5jdGlvbiAoYmJveDogQkJveCkge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IG5leHQuY2FsbCh0aGlzLCBiYm94KVxyXG4gICAgICAgIHRoYXQudHJpZ2dlcldvcmtzcGFjZUV2ZW50KENhbnZhc0V2ZW50LkNvbnRhaW5pbmdOb2Rlc1JlcXVlc3RlZCwgdGhpcywgYmJveCwgcmVzdWx0KVxyXG4gICAgICAgIHJldHVybiByZXN1bHRcclxuICAgICAgfSxcclxuICAgICAgdXBkYXRlU2VsZWN0aW9uOiAobmV4dDogYW55KSA9PiBmdW5jdGlvbiAodXBkYXRlOiAoKSA9PiB2b2lkKSB7XHJcbiAgICAgICAgY29uc3Qgb2xkU2VsZWN0aW9uID0gbmV3IFNldCh0aGlzLnNlbGVjdGlvbilcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBuZXh0LmNhbGwodGhpcywgdXBkYXRlKVxyXG4gICAgICAgIHRoYXQudHJpZ2dlcldvcmtzcGFjZUV2ZW50KENhbnZhc0V2ZW50LlNlbGVjdGlvbkNoYW5nZWQsIHRoaXMsIG9sZFNlbGVjdGlvbiwgKCh1cGRhdGU6ICgpID0+IHZvaWQpID0+IG5leHQuY2FsbCh0aGlzLCB1cGRhdGUpKSlcclxuICAgICAgICByZXR1cm4gcmVzdWx0XHJcbiAgICAgIH0sXHJcbiAgICAgIGFkZE5vZGU6IChuZXh0OiBhbnkpID0+IGZ1bmN0aW9uIChub2RlOiBDYW52YXNOb2RlKSB7XHJcbiAgICAgICAgdGhhdC5wYXRjaE5vZGUobm9kZSlcclxuICAgICAgICByZXR1cm4gbmV4dC5jYWxsKHRoaXMsIG5vZGUpXHJcbiAgICAgIH0sXHJcbiAgICAgIGFkZEVkZ2U6IChuZXh0OiBhbnkpID0+IGZ1bmN0aW9uIChlZGdlOiBDYW52YXNFZGdlKSB7XHJcbiAgICAgICAgdGhhdC5wYXRjaEVkZ2UoZWRnZSlcclxuICAgICAgICByZXR1cm4gbmV4dC5jYWxsKHRoaXMsIGVkZ2UpXHJcbiAgICAgIH0sXHJcbiAgICAgIHJlbW92ZU5vZGU6IChuZXh0OiBhbnkpID0+IGZ1bmN0aW9uIChub2RlOiBDYW52YXNOb2RlKSB7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gbmV4dC5jYWxsKHRoaXMsIG5vZGUpXHJcbiAgICAgICAgdGhhdC50cmlnZ2VyV29ya3NwYWNlRXZlbnQoQ2FudmFzRXZlbnQuTm9kZVJlbW92ZWQsIHRoaXMsIG5vZGUpXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdFxyXG4gICAgICB9LFxyXG4gICAgICByZW1vdmVFZGdlOiAobmV4dDogYW55KSA9PiBmdW5jdGlvbiAoZWRnZTogQ2FudmFzRWRnZSkge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IG5leHQuY2FsbCh0aGlzLCBlZGdlKVxyXG4gICAgICAgIHRoYXQudHJpZ2dlcldvcmtzcGFjZUV2ZW50KENhbnZhc0V2ZW50LkVkZ2VSZW1vdmVkLCB0aGlzLCBlZGdlKVxyXG4gICAgICAgIHJldHVybiByZXN1bHRcclxuICAgICAgfSxcclxuICAgICAgem9vbVRvQmJveDogKG5leHQ6IGFueSkgPT4gZnVuY3Rpb24gKGJib3g6IEJCb3gpIHtcclxuICAgICAgICB0aGF0LnRyaWdnZXJXb3Jrc3BhY2VFdmVudChDYW52YXNFdmVudC5ab29tVG9CYm94LkJlZm9yZSwgdGhpcywgYmJveClcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBuZXh0LmNhbGwodGhpcywgYmJveClcclxuICAgICAgICB0aGF0LnRyaWdnZXJXb3Jrc3BhY2VFdmVudChDYW52YXNFdmVudC5ab29tVG9CYm94LkFmdGVyLCB0aGlzLCBiYm94KVxyXG4gICAgICAgIHJldHVybiByZXN1bHRcclxuICAgICAgfSxcclxuICAgICAgc2V0UmVhZG9ubHk6IChuZXh0OiBhbnkpID0+IGZ1bmN0aW9uIChyZWFkb25seTogYm9vbGVhbikge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IG5leHQuY2FsbCh0aGlzLCByZWFkb25seSlcclxuICAgICAgICB0aGF0LnRyaWdnZXJXb3Jrc3BhY2VFdmVudChDYW52YXNFdmVudC5SZWFkb25seUNoYW5nZWQsIHRoaXMsIHJlYWRvbmx5KVxyXG4gICAgICAgIHJldHVybiByZXN1bHRcclxuICAgICAgfSxcclxuICAgICAgdW5kbzogKG5leHQ6IGFueSkgPT4gZnVuY3Rpb24gKC4uLmFyZ3M6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IG5leHQuY2FsbCh0aGlzLCAuLi5hcmdzKVxyXG4gICAgICAgIHRoaXMuaW1wb3J0RGF0YSh0aGlzLmdldERhdGEoKSwgdHJ1ZSkgLy8gRm9yY2UgdXBkYXRlIHRoZSBjYW52YXMgZGF0YVxyXG4gICAgICAgIHRoYXQudHJpZ2dlcldvcmtzcGFjZUV2ZW50KENhbnZhc0V2ZW50LlVuZG8sIHRoaXMpXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdFxyXG4gICAgICB9LFxyXG4gICAgICByZWRvOiAobmV4dDogYW55KSA9PiBmdW5jdGlvbiAoLi4uYXJnczogYW55KSB7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gbmV4dC5jYWxsKHRoaXMsIC4uLmFyZ3MpXHJcbiAgICAgICAgdGhpcy5pbXBvcnREYXRhKHRoaXMuZ2V0RGF0YSgpLCB0cnVlKSAvLyBGb3JjZSB1cGRhdGUgdGhlIGNhbnZhcyBkYXRhXHJcbiAgICAgICAgdGhhdC50cmlnZ2VyV29ya3NwYWNlRXZlbnQoQ2FudmFzRXZlbnQuUmVkbywgdGhpcylcclxuICAgICAgICByZXR1cm4gcmVzdWx0XHJcbiAgICAgIH0sXHJcbiAgICAgIGdldERhdGE6IChuZXh0OiBhbnkpID0+IGZ1bmN0aW9uICguLi5hcmdzOiBhbnkpIHtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBuZXh0LmNhbGwodGhpcywgLi4uYXJncylcclxuICAgICAgICB0aGF0LnRyaWdnZXJXb3Jrc3BhY2VFdmVudChDYW52YXNFdmVudC5EYXRhUmVxdWVzdGVkLCB0aGlzLCByZXN1bHQpXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdFxyXG4gICAgICB9LFxyXG4gICAgICBpbXBvcnREYXRhOiAobmV4dDogYW55KSA9PiBmdW5jdGlvbiAoZGF0YTogQ2FudmFzRGF0YSwgY2xlYXJDYW52YXM/OiBib29sZWFuLCBzaWxlbnQ/OiBib29sZWFuKSB7XHJcbiAgICAgICAgY29uc3QgdGFyZ2V0RmlsZVBhdGggPSB0aGlzLnZpZXcuZmlsZS5wYXRoXHJcbiAgICAgICAgY29uc3Qgc2V0RGF0YSA9IChkYXRhOiBDYW52YXNEYXRhKSA9PiB7XHJcbiAgICAgICAgICAvLyBTa2lwIGlmIHRoZSBjYW52YXMgZ290IHVubG9hZGVkIG9yIHRoZSBmaWxlIGNoYW5nZWRcclxuICAgICAgICAgIGlmICghdGhpcy52aWV3LmZpbGUgfHwgdGhpcy52aWV3LmZpbGUucGF0aCAhPT0gdGFyZ2V0RmlsZVBhdGgpIHJldHVyblxyXG5cclxuICAgICAgICAgIHRoaXMuaW1wb3J0RGF0YShkYXRhLCB0cnVlLCB0cnVlKVxyXG4gICAgICAgICAgdGhhdC5lbWl0RXZlbnRzRm9yVW5rbm93bkRhdGFDaGFuZ2VzKHRoaXMpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIXNpbGVudCkgdGhhdC50cmlnZ2VyV29ya3NwYWNlRXZlbnQoQ2FudmFzRXZlbnQuTG9hZERhdGEsIHRoaXMsIGRhdGEsIHNldERhdGEpXHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gbmV4dC5jYWxsKHRoaXMsIGRhdGEsIGNsZWFyQ2FudmFzKVxyXG4gICAgICAgIHRoYXQuZW1pdEV2ZW50c0ZvclVua25vd25EYXRhQ2hhbmdlcyh0aGlzKVxyXG4gICAgICAgIHJldHVybiByZXN1bHRcclxuICAgICAgfSxcclxuICAgICAgcmVxdWVzdFNhdmU6IChuZXh0OiBhbnkpID0+IGZ1bmN0aW9uICguLi5hcmdzOiBhbnkpIHtcclxuICAgICAgICB0aGF0LnRyaWdnZXJXb3Jrc3BhY2VFdmVudChDYW52YXNFdmVudC5DYW52YXNTYXZlZC5CZWZvcmUsIHRoaXMpXHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gbmV4dC5jYWxsKHRoaXMsIC4uLmFyZ3MpXHJcbiAgICAgICAgdGhhdC50cmlnZ2VyV29ya3NwYWNlRXZlbnQoQ2FudmFzRXZlbnQuQ2FudmFzU2F2ZWQuQWZ0ZXIsIHRoaXMpXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdFxyXG4gICAgICB9XHJcbiAgICB9KVxyXG5cclxuICAgIC8vIFBhdGNoIGNhbnZhcyBwb3B1cCBtZW51XHJcbiAgICBwYXRjaE9iamVjdFByb3RvdHlwZSh0aGlzLnBsdWdpbiwgY2FudmFzVmlldy5jYW52YXMubWVudSwge1xyXG4gICAgICByZW5kZXI6IChuZXh0OiBhbnkpID0+IGZ1bmN0aW9uICguLi5hcmdzOiBhbnkpIHtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBuZXh0LmNhbGwodGhpcywgLi4uYXJncylcclxuICAgICAgICB0aGF0LnRyaWdnZXJXb3Jrc3BhY2VFdmVudChDYW52YXNFdmVudC5Qb3B1cE1lbnVDcmVhdGVkLCB0aGlzLmNhbnZhcylcclxuICAgICAgICBuZXh0LmNhbGwodGhpcykgLy8gUmUtQ2VudGVyIHRoZSBwb3B1cCBtZW51XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdFxyXG4gICAgICB9XHJcbiAgICB9KVxyXG5cclxuICAgIC8vIFBhdGNoIGludGVyYWN0aW9uIGxheWVyXHJcbiAgICBwYXRjaE9iamVjdFByb3RvdHlwZSh0aGlzLnBsdWdpbiwgY2FudmFzVmlldy5jYW52YXMubm9kZUludGVyYWN0aW9uTGF5ZXIsIHtcclxuICAgICAgc2V0VGFyZ2V0OiAobmV4dDogYW55KSA9PiBmdW5jdGlvbiAobm9kZTogQ2FudmFzTm9kZSkge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IG5leHQuY2FsbCh0aGlzLCBub2RlKVxyXG4gICAgICAgIHRoYXQudHJpZ2dlcldvcmtzcGFjZUV2ZW50KENhbnZhc0V2ZW50Lk5vZGVJbnRlcmFjdGlvbiwgdGhpcy5jYW52YXMsIG5vZGUpXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdFxyXG4gICAgICB9XHJcbiAgICB9KVxyXG5cclxuICAgIC8vIENhbnZhcyBpcyBub3cgcGF0Y2hlZCAtIHVwZGF0ZSBhbGwgb3BlbiBjYW52YXMgdmlld3NcclxuICAgIHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2UuaXRlcmF0ZUFsbExlYXZlcygobGVhZjogV29ya3NwYWNlTGVhZikgPT4ge1xyXG4gICAgICBpZiAobGVhZi52aWV3LmdldFZpZXdUeXBlKCkgIT09ICdjYW52YXMnKSByZXR1cm5cclxuXHJcbiAgICAgIGNvbnN0IGNhbnZhc1ZpZXcgPSBsZWFmLnZpZXcgYXMgQ2FudmFzVmlld1xyXG4gICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgIGNhbnZhc1ZpZXcubGVhZi5yZWJ1aWxkVmlldygpXHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwYXRjaE5vZGUobm9kZTogQ2FudmFzTm9kZSkge1xyXG4gICAgY29uc3QgdGhhdCA9IHRoaXNcclxuXHJcbiAgICBwYXRjaE9iamVjdEluc3RhbmNlKHRoaXMucGx1Z2luLCBub2RlLCB7XHJcbiAgICAgIHNldERhdGE6IChuZXh0OiBhbnkpID0+IGZ1bmN0aW9uICguLi5hcmdzOiBhbnkpIHtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBuZXh0LmNhbGwodGhpcywgLi4uYXJncylcclxuXHJcbiAgICAgICAgaWYgKG5vZGUuaW5pdGlhbGl6ZWQgJiYgIW5vZGUuaXNEaXJ0eSkge1xyXG4gICAgICAgICAgbm9kZS5pc0RpcnR5ID0gdHJ1ZVxyXG4gICAgICAgICAgdGhhdC50cmlnZ2VyV29ya3NwYWNlRXZlbnQoQ2FudmFzRXZlbnQuTm9kZUNoYW5nZWQsIHRoaXMuY2FudmFzLCBub2RlKVxyXG4gICAgICAgICAgZGVsZXRlIG5vZGUuaXNEaXJ0eVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gU2F2ZSB0aGUgZGF0YSB0byB0aGUgZmlsZVxyXG4gICAgICAgIHRoaXMuY2FudmFzLmRhdGEgPSB0aGlzLmNhbnZhcy5nZXREYXRhKClcclxuICAgICAgICB0aGlzLmNhbnZhcy52aWV3LnJlcXVlc3RTYXZlKClcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdFxyXG4gICAgICB9LFxyXG4gICAgICBnZXRCQm94OiAobmV4dDogYW55KSA9PiBmdW5jdGlvbiAoLi4uYXJnczogYW55KSB7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gbmV4dC5jYWxsKHRoaXMsIC4uLmFyZ3MpXHJcbiAgICAgICAgdGhhdC50cmlnZ2VyV29ya3NwYWNlRXZlbnQoQ2FudmFzRXZlbnQuTm9kZUJCb3hSZXF1ZXN0ZWQsIHRoaXMuY2FudmFzLCBub2RlLCByZXN1bHQpXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdFxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gICAgXHJcbiAgICB0aGlzLnJ1bkFmdGVySW5pdGlhbGl6ZWQobm9kZSwgKCkgPT4ge1xyXG4gICAgICB0aGlzLnRyaWdnZXJXb3Jrc3BhY2VFdmVudChDYW52YXNFdmVudC5Ob2RlQWRkZWQsIG5vZGUuY2FudmFzLCBub2RlKVxyXG4gICAgICB0aGlzLnRyaWdnZXJXb3Jrc3BhY2VFdmVudChDYW52YXNFdmVudC5Ob2RlQ2hhbmdlZCwgbm9kZS5jYW52YXMsIG5vZGUpXHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwYXRjaEVkZ2UoZWRnZTogQ2FudmFzRWRnZSkge1xyXG4gICAgY29uc3QgdGhhdCA9IHRoaXNcclxuXHJcbiAgICBwYXRjaE9iamVjdEluc3RhbmNlKHRoaXMucGx1Z2luLCBlZGdlLCB7XHJcbiAgICAgIHNldERhdGE6IChuZXh0OiBhbnkpID0+IGZ1bmN0aW9uICguLi5hcmdzOiBhbnkpIHtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBuZXh0LmNhbGwodGhpcywgLi4uYXJncylcclxuXHJcbiAgICAgICAgaWYgKGVkZ2UuaW5pdGlhbGl6ZWQgJiYgIWVkZ2UuaXNEaXJ0eSkge1xyXG4gICAgICAgICAgZWRnZS5pc0RpcnR5ID0gdHJ1ZVxyXG4gICAgICAgICAgdGhhdC50cmlnZ2VyV29ya3NwYWNlRXZlbnQoQ2FudmFzRXZlbnQuRWRnZUNoYW5nZWQsIHRoaXMuY2FudmFzLCBlZGdlKVxyXG4gICAgICAgICAgZGVsZXRlIGVkZ2UuaXNEaXJ0eVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gU2F2ZSB0aGUgZGF0YSB0byB0aGUgZmlsZVxyXG4gICAgICAgIHRoaXMuY2FudmFzLmRhdGEgPSB0aGlzLmNhbnZhcy5nZXREYXRhKClcclxuICAgICAgICB0aGlzLmNhbnZhcy52aWV3LnJlcXVlc3RTYXZlKClcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdFxyXG4gICAgICB9LFxyXG4gICAgICByZW5kZXI6IChuZXh0OiBhbnkpID0+IGZ1bmN0aW9uICguLi5hcmdzOiBhbnkpIHtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBuZXh0LmNhbGwodGhpcywgLi4uYXJncylcclxuICAgICAgICB0aGF0LnRyaWdnZXJXb3Jrc3BhY2VFdmVudChDYW52YXNFdmVudC5FZGdlQ2hhbmdlZCwgdGhpcy5jYW52YXMsIGVkZ2UpXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdFxyXG4gICAgICB9LFxyXG4gICAgICBnZXRDZW50ZXI6IChuZXh0OiBhbnkpID0+IGZ1bmN0aW9uICguLi5hcmdzOiBhbnkpIHtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBuZXh0LmNhbGwodGhpcywgLi4uYXJncylcclxuICAgICAgICB0aGF0LnRyaWdnZXJXb3Jrc3BhY2VFdmVudChDYW52YXNFdmVudC5FZGdlQ2VudGVyUmVxdWVzdGVkLCB0aGlzLmNhbnZhcywgZWRnZSwgcmVzdWx0KVxyXG4gICAgICAgIHJldHVybiByZXN1bHRcclxuICAgICAgfVxyXG4gICAgfSlcclxuICAgIFxyXG4gICAgdGhpcy5ydW5BZnRlckluaXRpYWxpemVkKGVkZ2UsICgpID0+IHtcclxuICAgICAgdGhpcy50cmlnZ2VyV29ya3NwYWNlRXZlbnQoQ2FudmFzRXZlbnQuRWRnZUFkZGVkLCBlZGdlLmNhbnZhcywgZWRnZSlcclxuICAgIH0pXHJcbiAgfVxyXG4gIFxyXG4gIHByaXZhdGUgcnVuQWZ0ZXJJbml0aWFsaXplZChjYW52YXNFbGVtZW50OiBDYW52YXNFbGVtZW50LCBvblJlYWR5OiAoKSA9PiB2b2lkKSB7XHJcbiAgICBpZiAoY2FudmFzRWxlbWVudC5pbml0aWFsaXplZCkge1xyXG4gICAgICBvblJlYWR5KClcclxuICAgICAgcmV0dXJuXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdGhhdCA9IHRoaXNcclxuXHJcbiAgICAvLyBQYXRjaCBDYW52YXNFbGVtZW50IG9iamVjdFxyXG4gICAgY29uc3QgdW5pbnN0YWxsID0gYXJvdW5kKGNhbnZhc0VsZW1lbnQsIHtcclxuICAgICAgaW5pdGlhbGl6ZTogKG5leHQ6IGFueSkgPT4gZnVuY3Rpb24gKC4uLmFyZ3M6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IG5leHQuY2FsbCh0aGlzLCAuLi5hcmdzKVxyXG5cclxuICAgICAgICBvblJlYWR5KClcclxuICAgICAgICB1bmluc3RhbGwoKSAvLyBVbmluc3RhbGwgdGhlIHBhdGNoXHJcblxyXG4gICAgICAgIHJldHVybiByZXN1bHRcclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICB0aGF0LnBsdWdpbi5yZWdpc3Rlcih1bmluc3RhbGwpXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGVtaXRFdmVudHNGb3JVbmtub3duRGF0YUNoYW5nZXMoY2FudmFzOiBDYW52YXMpIHtcclxuICAgIC8vIElmIG5vZGUgZGF0YSBjaGFuZ2VkXHJcbiAgICBjYW52YXMubm9kZXMuZm9yRWFjaCgobm9kZTogQ2FudmFzTm9kZSkgPT4gdGhpcy5ydW5BZnRlckluaXRpYWxpemVkKG5vZGUsICgpID0+IHtcclxuICAgICAgdGhpcy50cmlnZ2VyV29ya3NwYWNlRXZlbnQoQ2FudmFzRXZlbnQuTm9kZUNoYW5nZWQsIG5vZGUuY2FudmFzLCBub2RlKVxyXG4gICAgfSkpXHJcblxyXG4gICAgLy8gSWYgZWRnZSBkYXRhIGNoYW5nZWRcclxuICAgIGNhbnZhcy5lZGdlcy5mb3JFYWNoKChlZGdlOiBDYW52YXNFZGdlKSA9PiB0aGlzLnJ1bkFmdGVySW5pdGlhbGl6ZWQoZWRnZSwgKCkgPT4ge1xyXG4gICAgICB0aGlzLnRyaWdnZXJXb3Jrc3BhY2VFdmVudChDYW52YXNFdmVudC5FZGdlQ2hhbmdlZCwgZWRnZS5jYW52YXMsIGVkZ2UpXHJcbiAgICB9KSlcclxuICB9XHJcblxyXG4gIHByaXZhdGUgdHJpZ2dlcldvcmtzcGFjZUV2ZW50KGV2ZW50OiBzdHJpbmcsIC4uLmFyZ3M6IGFueSkge1xyXG4gICAgdGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS50cmlnZ2VyKGV2ZW50LCAuLi5hcmdzKVxyXG4gIH1cclxufSIsICJpbXBvcnQgeyBDYW52YXMsIFBvc2l0aW9uIH0gZnJvbSBcInNyYy9AdHlwZXMvQ2FudmFzXCJcclxuaW1wb3J0ICogYXMgQ2FudmFzSGVscGVyIGZyb20gXCJzcmMvdXRpbHMvY2FudmFzLWhlbHBlclwiXHJcbmltcG9ydCBBZHZhbmNlZENhbnZhc1BsdWdpbiBmcm9tIFwic3JjL21haW5cIlxyXG5pbXBvcnQgeyBDYW52YXNFdmVudCB9IGZyb20gXCJzcmMvY29yZS9ldmVudHNcIlxyXG5cclxuY29uc3QgR1JPVVBfTk9ERV9TSVpFID0geyB3aWR0aDogMzAwLCBoZWlnaHQ6IDMwMCB9XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBHcm91cENhbnZhc0V4dGVuc2lvbiB7XHJcbiAgcGx1Z2luOiBBZHZhbmNlZENhbnZhc1BsdWdpblxyXG5cclxuICBjb25zdHJ1Y3RvcihwbHVnaW46IGFueSkge1xyXG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW5cclxuXHJcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2Uub24oXHJcbiAgICAgIENhbnZhc0V2ZW50LkNhbnZhc0NoYW5nZWQsXHJcbiAgICAgIChjYW52YXM6IENhbnZhcykgPT4ge1xyXG4gICAgICAgIENhbnZhc0hlbHBlci5hZGRDYXJkTWVudU9wdGlvbihcclxuICAgICAgICAgIGNhbnZhcyxcclxuICAgICAgICAgIENhbnZhc0hlbHBlci5jcmVhdGVDYXJkTWVudU9wdGlvbihcclxuICAgICAgICAgICAgY2FudmFzLFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgaWQ6ICdjcmVhdGUtZ3JvdXAnLFxyXG4gICAgICAgICAgICAgIGxhYmVsOiAnRHJhZyB0byBhZGQgZ3JvdXAnLFxyXG4gICAgICAgICAgICAgIGljb246ICdncm91cCdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgKCkgPT4gR1JPVVBfTk9ERV9TSVpFLFxyXG4gICAgICAgICAgICAoY2FudmFzOiBDYW52YXMsIHBvczogUG9zaXRpb24pID0+IHtcclxuICAgICAgICAgICAgICBjYW52YXMuY3JlYXRlR3JvdXBOb2RlKHtcclxuICAgICAgICAgICAgICAgIHBvczogcG9zLFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogR1JPVVBfTk9ERV9TSVpFXHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgKVxyXG4gICAgICAgIClcclxuICAgICAgfVxyXG4gICAgKSlcclxuICB9XHJcbn0iLCAiaW1wb3J0IHsgTWVudSwgTm90aWNlIH0gZnJvbSAnb2JzaWRpYW4nXHJcbmltcG9ydCB7IEJCb3gsIENhbnZhcywgQ2FudmFzRWRnZSwgQ2FudmFzRWxlbWVudCwgQ2FudmFzTm9kZSwgUG9zaXRpb24sIFNpemUgfSBmcm9tICdzcmMvQHR5cGVzL0NhbnZhcydcclxuaW1wb3J0IEFkdmFuY2VkQ2FudmFzUGx1Z2luIGZyb20gJ3NyYy9tYWluJ1xyXG5pbXBvcnQgeyBDYW52YXNFdmVudCB9IGZyb20gJ3NyYy9jb3JlL2V2ZW50cydcclxuaW1wb3J0ICogYXMgQ2FudmFzSGVscGVyIGZyb20gXCJzcmMvdXRpbHMvY2FudmFzLWhlbHBlclwiXHJcbmltcG9ydCAqIGFzIEJCb3hIZWxwZXIgZnJvbSBcInNyYy91dGlscy9iYm94LWhlbHBlclwiXHJcblxyXG5jb25zdCBTVEFSVF9TTElERV9OQU1FID0gJ1N0YXJ0IFNsaWRlJ1xyXG5jb25zdCBERUZBVUxUX1NMSURFX05BTUUgPSAnTmV3IFNsaWRlJ1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUHJlc2VudGF0aW9uQ2FudmFzRXh0ZW5zaW9uIHtcclxuICBwbHVnaW46IEFkdmFuY2VkQ2FudmFzUGx1Z2luXHJcbiAgc2F2ZWRWaWV3cG9ydDogYW55ID0gbnVsbFxyXG4gIGlzUHJlc2VudGF0aW9uTW9kZTogYm9vbGVhbiA9IGZhbHNlXHJcbiAgdmlzaXRlZE5vZGVzOiBhbnlbXSA9IFtdXHJcblxyXG4gIGNvbnN0cnVjdG9yKHBsdWdpbjogYW55KSB7XHJcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpblxyXG5cclxuICAgIGlmICghdGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2V0U2V0dGluZygncHJlc2VudGF0aW9uRmVhdHVyZUVuYWJsZWQnKSkgcmV0dXJuXHJcblxyXG4gICAgLyogQWRkIHdyYXAgaW4gc2xpZGUgb3B0aW9uIHRvIGNvbnRleHQgbWVudSAqL1xyXG4gICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudCh0aGlzLnBsdWdpbi5hcHAud29ya3NwYWNlLm9uKFxyXG4gICAgICAnY2FudmFzOnNlbGVjdGlvbi1tZW51JyxcclxuICAgICAgKG1lbnU6IE1lbnUsIGNhbnZhczogQ2FudmFzKSA9PiB7XHJcbiAgICAgICAgbWVudS5hZGRJdGVtKChpdGVtKSA9PlxyXG4gICAgICAgICAgaXRlbVxyXG4gICAgICAgICAgICAuc2V0VGl0bGUoJ1dyYXAgaW4gc2xpZGUnKVxyXG4gICAgICAgICAgICAuc2V0SWNvbignZ2FsbGVyeS12ZXJ0aWNhbCcpXHJcbiAgICAgICAgICAgIC5vbkNsaWNrKCgpID0+IHRoaXMuYWRkU2xpZGUoY2FudmFzLCB1bmRlZmluZWQsIFxyXG4gICAgICAgICAgICAgIEJCb3hIZWxwZXIuZW5sYXJnZUJCb3goQkJveEhlbHBlci5jb21iaW5lQkJveGVzKFxyXG4gICAgICAgICAgICAgICAgWy4uLmNhbnZhcy5zZWxlY3Rpb24udmFsdWVzKCldLm1hcCgoZWxlbWVudDogQ2FudmFzRWxlbWVudCkgPT4gZWxlbWVudC5nZXRCQm94KCkpXHJcbiAgICAgICAgICAgICAgKSwgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2V0U2V0dGluZygnd3JhcEluU2xpZGVQYWRkaW5nJykpXHJcbiAgICAgICAgICAgICkpXHJcbiAgICAgICAgKVxyXG4gICAgICB9XHJcbiAgICApKVxyXG5cclxuICAgIHRoaXMucGx1Z2luLmFkZENvbW1hbmQoe1xyXG5cdFx0XHRpZDogJ2NyZWF0ZS1uZXctc2xpZGUnLFxyXG5cdFx0XHRuYW1lOiAnQ3JlYXRlIG5ldyBzbGlkZScsXHJcblx0XHRcdGNoZWNrQ2FsbGJhY2s6IENhbnZhc0hlbHBlci5jYW52YXNDb21tYW5kKFxyXG4gICAgICAgIHRoaXMucGx1Z2luLFxyXG4gICAgICAgIChjYW52YXM6IENhbnZhcykgPT4gIWNhbnZhcy5yZWFkb25seSAmJiAhdGhpcy5pc1ByZXNlbnRhdGlvbk1vZGUsXHJcbiAgICAgICAgKGNhbnZhczogQ2FudmFzKSA9PiB0aGlzLmFkZFNsaWRlKGNhbnZhcylcclxuICAgICAgKVxyXG4gICAgfSlcclxuXHJcbiAgICB0aGlzLnBsdWdpbi5hZGRDb21tYW5kKHtcclxuXHRcdFx0aWQ6ICdzdGFydC1wcmVzZW50YXRpb24nLFxyXG4gICAgICBuYW1lOiAnU3RhcnQgcHJlc2VudGF0aW9uJyxcclxuICAgICAgY2hlY2tDYWxsYmFjazogQ2FudmFzSGVscGVyLmNhbnZhc0NvbW1hbmQoXHJcbiAgICAgICAgdGhpcy5wbHVnaW4sXHJcbiAgICAgICAgKF9jYW52YXM6IENhbnZhcykgPT4gIXRoaXMuaXNQcmVzZW50YXRpb25Nb2RlLFxyXG4gICAgICAgIChjYW52YXM6IENhbnZhcykgPT4gdGhpcy5zdGFydFByZXNlbnRhdGlvbihjYW52YXMpXHJcbiAgICAgIClcclxuICAgIH0pXHJcblxyXG4gICAgdGhpcy5wbHVnaW4uYWRkQ29tbWFuZCh7XHJcbiAgICAgIGlkOiAncHJldmlvdXMtbm9kZScsXHJcbiAgICAgIG5hbWU6ICdQcmV2aW91cyBub2RlJyxcclxuICAgICAgY2hlY2tDYWxsYmFjazogQ2FudmFzSGVscGVyLmNhbnZhc0NvbW1hbmQoXHJcbiAgICAgICAgdGhpcy5wbHVnaW4sXHJcbiAgICAgICAgKF9jYW52YXM6IENhbnZhcykgPT4gdGhpcy5pc1ByZXNlbnRhdGlvbk1vZGUsXHJcbiAgICAgICAgKGNhbnZhczogQ2FudmFzKSA9PiB0aGlzLnByZXZpb3VzTm9kZShjYW52YXMpXHJcbiAgICAgIClcclxuICAgIH0pXHJcblxyXG4gICAgdGhpcy5wbHVnaW4uYWRkQ29tbWFuZCh7XHJcblx0XHRcdGlkOiAnbmV4dC1ub2RlJyxcclxuICAgICAgbmFtZTogJ05leHQgbm9kZScsXHJcbiAgICAgIGNoZWNrQ2FsbGJhY2s6IENhbnZhc0hlbHBlci5jYW52YXNDb21tYW5kKFxyXG4gICAgICAgIHRoaXMucGx1Z2luLFxyXG4gICAgICAgIChfY2FudmFzOiBDYW52YXMpID0+IHRoaXMuaXNQcmVzZW50YXRpb25Nb2RlLFxyXG4gICAgICAgIChjYW52YXM6IENhbnZhcykgPT4gdGhpcy5uZXh0Tm9kZShjYW52YXMpXHJcbiAgICAgIClcclxuICAgIH0pXHJcblxyXG4gICAgLy8gUmVnaXN0ZXIgZXZlbnRzXHJcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2Uub24oXHJcbiAgICAgIENhbnZhc0V2ZW50LkNhbnZhc0NoYW5nZWQsXHJcbiAgICAgIChjYW52YXM6IENhbnZhcykgPT4gdGhpcy5vbkNhbnZhc0NoYW5nZWQoY2FudmFzKVxyXG4gICAgKSlcclxuXHJcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2Uub24oXHJcbiAgICAgIENhbnZhc0V2ZW50LlBvcHVwTWVudUNyZWF0ZWQsXHJcbiAgICAgIChjYW52YXM6IENhbnZhcykgPT4gdGhpcy5vblBvcHVwTWVudUNyZWF0ZWQoY2FudmFzKVxyXG4gICAgKSlcclxuXHJcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2Uub24oXHJcbiAgICAgIENhbnZhc0V2ZW50Lk5vZGVNb3ZlZCxcclxuICAgICAgKGNhbnZhczogQ2FudmFzLCBub2RlOiBDYW52YXNOb2RlKSA9PiB0aGlzLm9uTm9kZU1vdmVkKGNhbnZhcywgbm9kZSlcclxuICAgICkpXHJcbiAgfVxyXG5cclxuICBvbkNhbnZhc0NoYW5nZWQoY2FudmFzOiBDYW52YXMpOiB2b2lkIHtcclxuICAgIENhbnZhc0hlbHBlci5hZGRDYXJkTWVudU9wdGlvbihcclxuICAgICAgY2FudmFzLFxyXG4gICAgICBDYW52YXNIZWxwZXIuY3JlYXRlQ2FyZE1lbnVPcHRpb24oXHJcbiAgICAgICAgY2FudmFzLFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGlkOiAnbmV3LXNsaWRlJyxcclxuICAgICAgICAgIGxhYmVsOiAnRHJhZyB0byBhZGQgc2xpZGUnLFxyXG4gICAgICAgICAgaWNvbjogJ2dhbGxlcnktdmVydGljYWwnXHJcbiAgICAgICAgfSxcclxuICAgICAgICAoKSA9PiB0aGlzLmdldERlZmF1bHRTbGlkZVNpemUoKSxcclxuICAgICAgICAoY2FudmFzOiBDYW52YXMsIHBvczogUG9zaXRpb24pID0+IHRoaXMuYWRkU2xpZGUoY2FudmFzLCBwb3MpXHJcbiAgICAgIClcclxuICAgIClcclxuICB9XHJcblxyXG4gIG9uUG9wdXBNZW51Q3JlYXRlZChjYW52YXM6IENhbnZhcyk6IHZvaWQge1xyXG4gICAgLy8gSWYgdGhlIGNhbnZhcyBpcyByZWFkb25seSBvciB0aGVyZSBhcmUgbXVsdGlwbGUvbm8gbm9kZXMgc2VsZWN0ZWQsIHJldHVyblxyXG4gICAgY29uc3Qgc2VsZWN0ZWROb2Rlc0RhdGEgPSBjYW52YXMuZ2V0U2VsZWN0aW9uRGF0YSgpLm5vZGVzXHJcbiAgICBpZiAoY2FudmFzLnJlYWRvbmx5IHx8IHNlbGVjdGVkTm9kZXNEYXRhLmxlbmd0aCAhPT0gMSB8fCBjYW52YXMuc2VsZWN0aW9uLnNpemUgPiAxKSByZXR1cm5cclxuICAgIFxyXG4gICAgY29uc3Qgc2VsZWN0ZWROb2RlID0gY2FudmFzLm5vZGVzLmdldChzZWxlY3RlZE5vZGVzRGF0YVswXS5pZClcclxuICAgIGlmICghc2VsZWN0ZWROb2RlKSByZXR1cm5cclxuICAgIFxyXG4gICAgQ2FudmFzSGVscGVyLmFkZFBvcHVwTWVudU9wdGlvbihcclxuICAgICAgY2FudmFzLFxyXG4gICAgICBDYW52YXNIZWxwZXIuY3JlYXRlUG9wdXBNZW51T3B0aW9uKHtcclxuICAgICAgICBpZDogJ3N0YXJ0LW5vZGUnLCBcclxuICAgICAgICBsYWJlbDogJ1NldCBhcyBzdGFydCBzbGlkZScsIFxyXG4gICAgICAgIGljb246ICdwbGF5JywgXHJcbiAgICAgICAgY2FsbGJhY2s6ICgpID0+IHRoaXMuc2V0U3RhcnROb2RlKGNhbnZhcywgc2VsZWN0ZWROb2RlKVxyXG4gICAgICB9KVxyXG4gICAgKVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBvbk5vZGVNb3ZlZChfY2FudmFzOiBDYW52YXMsIG5vZGU6IENhbnZhc05vZGUpIHtcclxuICAgIGNvbnN0IG5vZGVEYXRhID0gbm9kZS5nZXREYXRhKClcclxuICAgIGlmICghbm9kZURhdGEuc2lkZVJhdGlvKSByZXR1cm5cclxuXHJcbiAgICBjb25zdCBub2RlQkJveCA9IG5vZGUuZ2V0QkJveCgpXHJcbiAgICBjb25zdCBub2RlU2l6ZSA9IHtcclxuICAgICAgd2lkdGg6IG5vZGVCQm94Lm1heFggLSBub2RlQkJveC5taW5YLFxyXG4gICAgICBoZWlnaHQ6IG5vZGVCQm94Lm1heFkgLSBub2RlQkJveC5taW5ZXHJcbiAgICB9XHJcbiAgICBjb25zdCBub2RlQXNwZWN0UmF0aW8gPSBub2RlU2l6ZS53aWR0aCAvIG5vZGVTaXplLmhlaWdodFxyXG5cclxuICAgIGlmIChub2RlQXNwZWN0UmF0aW8gPCBub2RlRGF0YS5zaWRlUmF0aW8pXHJcbiAgICAgIG5vZGVTaXplLndpZHRoID0gbm9kZVNpemUuaGVpZ2h0ICogbm9kZURhdGEuc2lkZVJhdGlvXHJcbiAgICBlbHNlIG5vZGVTaXplLmhlaWdodCA9IG5vZGVTaXplLndpZHRoIC8gbm9kZURhdGEuc2lkZVJhdGlvXHJcblxyXG4gICAgbm9kZS5zZXREYXRhKHtcclxuICAgICAgLi4ubm9kZURhdGEsXHJcbiAgICAgIHdpZHRoOiBub2RlU2l6ZS53aWR0aCxcclxuICAgICAgaGVpZ2h0OiBub2RlU2l6ZS5oZWlnaHRcclxuICAgIH0pXHJcbiAgfVxyXG4gIFxyXG4gIHByaXZhdGUgZ2V0U3RhcnROb2RlKGNhbnZhczogQ2FudmFzKTogQ2FudmFzTm9kZXx1bmRlZmluZWQge1xyXG4gICAgZm9yIChjb25zdCBbXywgbm9kZV0gb2YgY2FudmFzLm5vZGVzKSB7XHJcbiAgICAgIGlmIChub2RlLmdldERhdGEoKS5pc1N0YXJ0Tm9kZSkgcmV0dXJuIG5vZGVcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdW5kZWZpbmVkXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNldFN0YXJ0Tm9kZShjYW52YXM6IENhbnZhcywgbm9kZTogQ2FudmFzTm9kZXx1bmRlZmluZWQpIHtcclxuICAgIGlmICghbm9kZSkgcmV0dXJuXHJcblxyXG4gICAgY29uc3Qgc3RhcnROb2RlID0gdGhpcy5nZXRTdGFydE5vZGUoY2FudmFzKVxyXG4gICAgaWYgKHN0YXJ0Tm9kZSkgc3RhcnROb2RlLnNldERhdGEoeyAuLi5zdGFydE5vZGUuZ2V0RGF0YSgpLCBpc1N0YXJ0Tm9kZTogZmFsc2UgfSlcclxuXHJcbiAgICBpZiAobm9kZSAhPT0gc3RhcnROb2RlKSBub2RlLnNldERhdGEoeyAuLi5ub2RlLmdldERhdGEoKSwgaXNTdGFydE5vZGU6IHRydWUgfSlcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0RGVmYXVsdFNsaWRlU2l6ZSgpOiBTaXplIHtcclxuICAgIGNvbnN0IHNsaWRlU2l6ZVN0cmluZyA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmdldFNldHRpbmcoJ2RlZmF1bHRTbGlkZVNpemUnKVxyXG4gICAgY29uc3Qgc2xpZGVTaXplQXJyYXkgPSBzbGlkZVNpemVTdHJpbmcuc3BsaXQoJ3gnKS5tYXAoKHZhbHVlOiBzdHJpbmcpID0+IHBhcnNlSW50KHZhbHVlKSlcclxuICAgIHJldHVybiB7IHdpZHRoOiBzbGlkZVNpemVBcnJheVswXSwgaGVpZ2h0OiBzbGlkZVNpemVBcnJheVsxXSB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldFNsaWRlQXNwZWN0UmF0aW8oKTogbnVtYmVyIHtcclxuICAgIGNvbnN0IHNsaWRlU2l6ZSA9IHRoaXMuZ2V0RGVmYXVsdFNsaWRlU2l6ZSgpXHJcbiAgICByZXR1cm4gc2xpZGVTaXplLndpZHRoIC8gc2xpZGVTaXplLmhlaWdodFxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhZGRTbGlkZShjYW52YXM6IENhbnZhcywgcG9zPzogUG9zaXRpb24sIGJib3g/OiBCQm94KSB7XHJcbiAgICBjb25zdCBpc1N0YXJ0Tm9kZSA9IHRoaXMuZ2V0U3RhcnROb2RlKGNhbnZhcykgPT0gbnVsbFxyXG4gICAgY29uc3Qgc2xpZGVTaXplID0gdGhpcy5nZXREZWZhdWx0U2xpZGVTaXplKClcclxuICAgIGNvbnN0IHNsaWRlQXNwZWN0UmF0aW8gPSB0aGlzLmdldFNsaWRlQXNwZWN0UmF0aW8oKVxyXG5cclxuICAgIGlmIChiYm94KSB7XHJcbiAgICAgIGNvbnN0IGJib3hXaWR0aCA9IGJib3gubWF4WCAtIGJib3gubWluWFxyXG4gICAgICBjb25zdCBiYm94SGVpZ2h0ID0gYmJveC5tYXhZIC0gYmJveC5taW5ZXHJcblxyXG4gICAgICAvLyBNYWtlIHN1cmUgdGhlIG5vZGVzIGZpdCBpbnNpZGUgdGhlIGJvdW5kaW5nIGJveCB3aGlsZSBrZWVwaW5nIHRoZSBhc3BlY3QgcmF0aW9cclxuICAgICAgaWYgKGJib3hXaWR0aCAvIGJib3hIZWlnaHQgPiBzbGlkZUFzcGVjdFJhdGlvKSB7XHJcbiAgICAgICAgc2xpZGVTaXplLndpZHRoID0gYmJveFdpZHRoXHJcbiAgICAgICAgc2xpZGVTaXplLmhlaWdodCA9IGJib3hXaWR0aCAvIHNsaWRlQXNwZWN0UmF0aW9cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBzbGlkZVNpemUuaGVpZ2h0ID0gYmJveEhlaWdodFxyXG4gICAgICAgIHNsaWRlU2l6ZS53aWR0aCA9IGJib3hIZWlnaHQgKiBzbGlkZUFzcGVjdFJhdGlvXHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIHBvcyA9IHsgXHJcbiAgICAgICAgeDogYmJveC5taW5YLFxyXG4gICAgICAgIHk6IGJib3gubWluWVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSWYgbm8gcG9zaXRpb24gaXMgcHJvdmlkZWQsIHVzZSB0aGUgY2VudGVyIG9mIHRoZSBjYW52YXNcclxuICAgIGlmICghcG9zKSBwb3MgPSBDYW52YXNIZWxwZXIuZ2V0Q2VudGVyQ29vcmRpbmF0ZXMoY2FudmFzLCB0aGlzLmdldERlZmF1bHRTbGlkZVNpemUoKSlcclxuXHJcbiAgICBjb25zdCBncm91cE5vZGUgPSBjYW52YXMuY3JlYXRlR3JvdXBOb2RlKHtcclxuICAgICAgcG9zOiBwb3MsXHJcbiAgICAgIHNpemU6IHNsaWRlU2l6ZSxcclxuICAgICAgbGFiZWw6IGlzU3RhcnROb2RlID8gU1RBUlRfU0xJREVfTkFNRSA6IERFRkFVTFRfU0xJREVfTkFNRSxcclxuICAgICAgZm9jdXM6IGZhbHNlLFxyXG4gICAgfSlcclxuXHJcbiAgICBncm91cE5vZGUuc2V0RGF0YSh7IFxyXG4gICAgICAuLi5ncm91cE5vZGUuZ2V0RGF0YSgpLCBcclxuICAgICAgc2lkZVJhdGlvOiBzbGlkZUFzcGVjdFJhdGlvLFxyXG4gICAgICBpc1N0YXJ0Tm9kZTogaXNTdGFydE5vZGUgPyB0cnVlIDogdW5kZWZpbmVkLFxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgYW5pbWF0ZU5vZGVUcmFuc2l0aW9uKGNhbnZhczogQ2FudmFzLCBmcm9tTm9kZTogQ2FudmFzTm9kZXx1bmRlZmluZWQsIHRvTm9kZTogQ2FudmFzTm9kZSkge1xyXG4gICAgY29uc3QgdXNlQ3VzdG9tWm9vbUZ1bmN0aW9uID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2V0U2V0dGluZygnem9vbVRvU2xpZGVXaXRob3V0UGFkZGluZycpXHJcbiAgICBjb25zdCBhbmltYXRpb25EdXJhdGlvbk1zID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2V0U2V0dGluZygnc2xpZGVUcmFuc2l0aW9uQW5pbWF0aW9uRHVyYXRpb24nKSAqIDEwMDBcclxuICAgIFxyXG4gICAgaWYgKGFuaW1hdGlvbkR1cmF0aW9uTXMgPiAwICYmIGZyb21Ob2RlKSB7XHJcbiAgICAgIGNvbnN0IGFuaW1hdGlvbkludGVuc2l0eSA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmdldFNldHRpbmcoJ3NsaWRlVHJhbnNpdGlvbkFuaW1hdGlvbkludGVuc2l0eScpXHJcblxyXG4gICAgICBjb25zdCBjdXJyZW50Tm9kZUJCb3hFbmxhcmdlZCA9IEJCb3hIZWxwZXIuc2NhbGVCQm94KGZyb21Ob2RlLmdldEJCb3goKSwgYW5pbWF0aW9uSW50ZW5zaXR5KVxyXG4gICAgICBpZiAodXNlQ3VzdG9tWm9vbUZ1bmN0aW9uKSBDYW52YXNIZWxwZXIuem9vbVRvQkJveChjYW52YXMsIGN1cnJlbnROb2RlQkJveEVubGFyZ2VkKVxyXG4gICAgICBlbHNlIGNhbnZhcy56b29tVG9CYm94KGN1cnJlbnROb2RlQkJveEVubGFyZ2VkKVxyXG5cclxuICAgICAgYXdhaXQgc2xlZXAoYW5pbWF0aW9uRHVyYXRpb25NcyAvIDIpXHJcblxyXG4gICAgICBjb25zdCBuZXh0Tm9kZUJCb3hFbmxhcmdlZCA9IEJCb3hIZWxwZXIuc2NhbGVCQm94KHRvTm9kZS5nZXRCQm94KCksIGFuaW1hdGlvbkludGVuc2l0eSlcclxuICAgICAgaWYgKHVzZUN1c3RvbVpvb21GdW5jdGlvbikgQ2FudmFzSGVscGVyLnpvb21Ub0JCb3goY2FudmFzLCBuZXh0Tm9kZUJCb3hFbmxhcmdlZClcclxuICAgICAgZWxzZSBjYW52YXMuem9vbVRvQmJveChuZXh0Tm9kZUJCb3hFbmxhcmdlZClcclxuXHJcbiAgICAgIGF3YWl0IHNsZWVwKGFuaW1hdGlvbkR1cmF0aW9uTXMgLyAyKVxyXG4gICAgfVxyXG5cclxuICAgIGxldCBub2RlQkJveCA9IHRvTm9kZS5nZXRCQm94KClcclxuICAgIGlmICh1c2VDdXN0b21ab29tRnVuY3Rpb24pIENhbnZhc0hlbHBlci56b29tVG9CQm94KGNhbnZhcywgbm9kZUJCb3gpXHJcbiAgICBlbHNlIGNhbnZhcy56b29tVG9CYm94KG5vZGVCQm94KVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBzdGFydFByZXNlbnRhdGlvbihjYW52YXM6IENhbnZhcykge1xyXG4gICAgY29uc3Qgc3RhcnROb2RlID0gdGhpcy5nZXRTdGFydE5vZGUoY2FudmFzKVxyXG4gICAgaWYgKCFzdGFydE5vZGUpIHtcclxuICAgICAgbmV3IE5vdGljZSgnTm8gc3RhcnQgbm9kZSBmb3VuZC4gUGxlYXNlIG1hcmsgYSBub2RlIGFzIGEgc3RhcnQgbm9kZSB0cm91Z2ggdGhlIHBvcHVwIG1lbnUuJylcclxuICAgICAgcmV0dXJuXHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy52aXNpdGVkTm9kZXMgPSBbXVxyXG4gICAgdGhpcy5zYXZlZFZpZXdwb3J0ID0ge1xyXG4gICAgICB4OiBjYW52YXMudHgsXHJcbiAgICAgIHk6IGNhbnZhcy50eSxcclxuICAgICAgem9vbTogY2FudmFzLnRab29tLFxyXG4gICAgfVxyXG5cclxuICAgIC8vIEVudGVyIGZ1bGxzY3JlZW4gbW9kZVxyXG4gICAgY2FudmFzLndyYXBwZXJFbC5mb2N1cygpXHJcbiAgICBjYW52YXMud3JhcHBlckVsLnJlcXVlc3RGdWxsc2NyZWVuKClcclxuICAgIGNhbnZhcy53cmFwcGVyRWwuY2xhc3NMaXN0LmFkZCgncHJlc2VudGF0aW9uLW1vZGUnKVxyXG5cclxuICAgIC8vIExvY2sgY2FudmFzXHJcbiAgICBjYW52YXMuc2V0UmVhZG9ubHkodHJ1ZSlcclxuXHJcbiAgICAvLyBSZWdpc3RlciBldmVudCBoYW5kbGVyIGZvciBrZXlib2FyZCBuYXZpZ2F0aW9uXHJcbiAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2V0U2V0dGluZygndXNlQXJyb3dLZXlzVG9DaGFuZ2VTbGlkZXMnKSkge1xyXG4gICAgICBjYW52YXMud3JhcHBlckVsLm9ua2V5ZG93biA9IChlOiBhbnkpID0+IHtcclxuICAgICAgICBpZiAoZS5rZXkgPT09ICdBcnJvd1JpZ2h0JykgdGhpcy5uZXh0Tm9kZShjYW52YXMpXHJcbiAgICAgICAgZWxzZSBpZiAoZS5rZXkgPT09ICdBcnJvd0xlZnQnKSB0aGlzLnByZXZpb3VzTm9kZShjYW52YXMpXHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBLZWVwIG1vZGFscyB3aGlsZSBpbiBmdWxsc2NyZWVuIG1vZGVcclxuICAgIGNvbnN0IGZ1bGxzY3JlZW5Nb2RhbE9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKG11dGF0aW9uUmVjb3JkcykgPT4ge1xyXG4gICAgICBtdXRhdGlvblJlY29yZHMuZm9yRWFjaCgobXV0YXRpb25SZWNvcmQpID0+IHtcclxuICAgICAgICBtdXRhdGlvblJlY29yZC5hZGRlZE5vZGVzLmZvckVhY2goKG5vZGUpID0+IHtcclxuICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQobm9kZSlcclxuICAgICAgICAgIGRvY3VtZW50LmZ1bGxzY3JlZW5FbGVtZW50Py5hcHBlbmRDaGlsZChub2RlKVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pXHJcblxyXG4gICAgICBjb25zdCBpbnB1dEZpZWxkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9tcHQtaW5wdXRcIikgYXMgSFRNTElucHV0RWxlbWVudHxudWxsXHJcbiAgICAgIGlmIChpbnB1dEZpZWxkKSBpbnB1dEZpZWxkLmZvY3VzKClcclxuICAgIH0pXHJcbiAgICBmdWxsc2NyZWVuTW9kYWxPYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LmJvZHksIHsgY2hpbGRMaXN0OiB0cnVlIH0pXHJcblxyXG4gICAgLy8gUmVnaXN0ZXIgZXZlbnQgaGFuZGxlciBmb3IgZXhpdGluZyBwcmVzZW50YXRpb24gbW9kZVxyXG4gICAgY2FudmFzLndyYXBwZXJFbC5vbmZ1bGxzY3JlZW5jaGFuZ2UgPSAoX2U6IGFueSkgPT4ge1xyXG4gICAgICBpZiAoZG9jdW1lbnQuZnVsbHNjcmVlbkVsZW1lbnQpIHJldHVyblxyXG5cclxuICAgICAgZnVsbHNjcmVlbk1vZGFsT2JzZXJ2ZXIuZGlzY29ubmVjdCgpXHJcbiAgICAgIHRoaXMuZW5kUHJlc2VudGF0aW9uKGNhbnZhcylcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmlzUHJlc2VudGF0aW9uTW9kZSA9IHRydWVcclxuXHJcbiAgICAvLyBXYWl0IGZvciBmdWxsc2NyZWVuIHRvIGJlIGVuYWJsZWRcclxuICAgIGF3YWl0IHNsZWVwKDUwMClcclxuXHJcbiAgICAvLyBab29tIHRvIGZpcnN0IG5vZGVcclxuICAgIHRoaXMudmlzaXRlZE5vZGVzLnB1c2goc3RhcnROb2RlKVxyXG4gICAgdGhpcy5hbmltYXRlTm9kZVRyYW5zaXRpb24oY2FudmFzLCB1bmRlZmluZWQsIHN0YXJ0Tm9kZSlcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZW5kUHJlc2VudGF0aW9uKGNhbnZhczogQ2FudmFzKSB7XHJcbiAgICAvLyBVbnJlZ2lzdGVyIGV2ZW50IGhhbmRsZXJzXHJcbiAgICBjYW52YXMud3JhcHBlckVsLm9ua2V5ZG93biA9IG51bGxcclxuICAgIGNhbnZhcy53cmFwcGVyRWwub25mdWxsc2NyZWVuY2hhbmdlID0gbnVsbFxyXG5cclxuICAgIC8vIFVubG9jayBjYW52YXNcclxuICAgIGNhbnZhcy5zZXRSZWFkb25seShmYWxzZSlcclxuXHJcbiAgICAvLyBFeGl0IGZ1bGxzY3JlZW4gbW9kZVxyXG4gICAgY2FudmFzLndyYXBwZXJFbC5jbGFzc0xpc3QucmVtb3ZlKCdwcmVzZW50YXRpb24tbW9kZScpXHJcbiAgICBpZiAoZG9jdW1lbnQuZnVsbHNjcmVlbkVsZW1lbnQpIGRvY3VtZW50LmV4aXRGdWxsc2NyZWVuKClcclxuXHJcbiAgICAvLyBSZXNldCB2aWV3cG9ydFxyXG4gICAgY2FudmFzLnNldFZpZXdwb3J0KHRoaXMuc2F2ZWRWaWV3cG9ydC54LCB0aGlzLnNhdmVkVmlld3BvcnQueSwgdGhpcy5zYXZlZFZpZXdwb3J0Lnpvb20pXHJcbiAgICB0aGlzLmlzUHJlc2VudGF0aW9uTW9kZSA9IGZhbHNlXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG5leHROb2RlKGNhbnZhczogQ2FudmFzKSB7XHJcbiAgICBjb25zdCBmcm9tTm9kZSA9IHRoaXMudmlzaXRlZE5vZGVzLmxhc3QoKVxyXG4gICAgaWYgKCFmcm9tTm9kZSkgcmV0dXJuXHJcblxyXG4gICAgY29uc3Qgb3V0Z29pbmdFZGdlcyA9IGNhbnZhcy5nZXRFZGdlc0Zvck5vZGUoZnJvbU5vZGUpLmZpbHRlcigoZWRnZTogQ2FudmFzRWRnZSkgPT4gZWRnZS5mcm9tLm5vZGUgPT09IGZyb21Ob2RlKVxyXG4gICAgbGV0IHRvTm9kZSA9IG91dGdvaW5nRWRnZXMuZmlyc3QoKT8udG8ubm9kZVxyXG5cclxuICAgIC8vIElmIHRoZXJlIGFyZSBtdWx0aXBsZSBvdXRnb2luZyBlZGdlcywgd2UgbmVlZCB0byBsb29rIGF0IHRoZSBlZGdlIGxhYmVsXHJcbiAgICBpZiAob3V0Z29pbmdFZGdlcy5sZW5ndGggPiAxKSB7XHJcbiAgICAgIC8vIENyZWF0ZSBtYXAgb2YgZWRnZSBsYWJlbHMgdG8gbm9kZXNcclxuICAgICAgY29uc3Qgc29ydGVkRWRnZXMgPSBvdXRnb2luZ0VkZ2VzXHJcbiAgICAgICAgLnNvcnQoKGE6IENhbnZhc0VkZ2UsIGI6IENhbnZhc0VkZ2UpID0+IHtcclxuICAgICAgICAgIGlmICghYS5sYWJlbCkgcmV0dXJuIDFcclxuICAgICAgICAgIGlmICghYi5sYWJlbCkgcmV0dXJuIC0xXHJcblxyXG4gICAgICAgICAgcmV0dXJuIGEubGFiZWwubG9jYWxlQ29tcGFyZShiLmxhYmVsKVxyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAvLyBGaW5kIHdoaWNoIGVkZ2VzIGFscmVhZHkgaGF2ZSBiZWVuIHRyYXZlcnNlZFxyXG4gICAgICBjb25zdCB0cmF2ZXJzZWRFZGdlc0NvdW50ID0gdGhpcy52aXNpdGVkTm9kZXNcclxuICAgICAgICAuZmlsdGVyKCh2aXNpdGVkTm9kZTogQ2FudmFzTm9kZSkgPT4gdmlzaXRlZE5vZGUgPT0gZnJvbU5vZGUpLmxlbmd0aCAtIDFcclxuXHJcbiAgICAgIC8vIFNlbGVjdCBuZXh0IGVkZ2VcclxuICAgICAgY29uc3QgbmV4dEVkZ2UgPSBzb3J0ZWRFZGdlc1t0cmF2ZXJzZWRFZGdlc0NvdW50XVxyXG4gICAgICB0b05vZGUgPSBuZXh0RWRnZS50by5ub2RlXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRvTm9kZSkge1xyXG4gICAgICB0aGlzLnZpc2l0ZWROb2Rlcy5wdXNoKHRvTm9kZSlcclxuICAgICAgdGhpcy5hbmltYXRlTm9kZVRyYW5zaXRpb24oY2FudmFzLCBmcm9tTm9kZSwgdG9Ob2RlKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gTm8gbW9yZSBub2RlcyBsZWZ0LCBhbmltYXRlIHRvIHNhbWUgbm9kZVxyXG4gICAgICB0aGlzLmFuaW1hdGVOb2RlVHJhbnNpdGlvbihjYW52YXMsIGZyb21Ob2RlLCBmcm9tTm9kZSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgcHJldmlvdXNOb2RlKGNhbnZhczogQ2FudmFzKSB7XHJcbiAgICBjb25zdCBmcm9tTm9kZSA9IHRoaXMudmlzaXRlZE5vZGVzLnBvcCgpXHJcbiAgICBpZiAoIWZyb21Ob2RlKSByZXR1cm5cclxuXHJcbiAgICBsZXQgdG9Ob2RlID0gdGhpcy52aXNpdGVkTm9kZXMubGFzdCgpXHJcblxyXG4gICAgLy8gRmFsbCBiYWNrIHRvIHNhbWUgbm9kZSBpZiB0aGVyZSBhcmUgbm8gbW9yZSBub2RlcyBiZWZvcmVcclxuICAgIGlmICghdG9Ob2RlKSB7XHJcbiAgICAgIHRvTm9kZSA9IGZyb21Ob2RlXHJcbiAgICAgIHRoaXMudmlzaXRlZE5vZGVzLnB1c2goZnJvbU5vZGUpXHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5hbmltYXRlTm9kZVRyYW5zaXRpb24oY2FudmFzLCBmcm9tTm9kZSwgdG9Ob2RlKVxyXG4gIH1cclxufSIsICJpbXBvcnQgeyBDYW52YXMsIENhbnZhc05vZGUsIENhbnZhc05vZGVEYXRhIH0gZnJvbSBcInNyYy9AdHlwZXMvQ2FudmFzXCJcclxuaW1wb3J0IHsgQ2FudmFzRXZlbnQgfSBmcm9tIFwic3JjL2NvcmUvZXZlbnRzXCJcclxuaW1wb3J0IEFkdmFuY2VkQ2FudmFzUGx1Z2luIGZyb20gXCJzcmMvbWFpblwiXHJcbmltcG9ydCBTZXR0aW5nc01hbmFnZXIgZnJvbSBcInNyYy9zZXR0aW5nc1wiXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RXhwb3NlZE5vZGVEYXRhKHNldHRpbmdzOiBTZXR0aW5nc01hbmFnZXIpOiAoa2V5b2YgQ2FudmFzTm9kZURhdGEpW10ge1xyXG4gIGNvbnN0IGV4cG9zZWREYXRhOiAoa2V5b2YgQ2FudmFzTm9kZURhdGEpW10gPSBbXVxyXG4gIFxyXG4gIGlmIChzZXR0aW5ncy5nZXRTZXR0aW5nKCdzdGlja2Vyc0ZlYXR1cmVFbmFibGVkJykpIGV4cG9zZWREYXRhLnB1c2goJ2lzU3RpY2tlcicpXHJcbiAgaWYgKHNldHRpbmdzLmdldFNldHRpbmcoJ3NoYXBlc0ZlYXR1cmVFbmFibGVkJykpIGV4cG9zZWREYXRhLnB1c2goJ3NoYXBlJylcclxuICBpZiAoc2V0dGluZ3MuZ2V0U2V0dGluZygnY29sbGFwc2libGVHcm91cHNGZWF0dXJlRW5hYmxlZCcpKSBleHBvc2VkRGF0YS5wdXNoKCdpc0NvbGxhcHNlZCcpXHJcbiAgaWYgKHNldHRpbmdzLmdldFNldHRpbmcoJ3ByZXNlbnRhdGlvbkZlYXR1cmVFbmFibGVkJykpIGV4cG9zZWREYXRhLnB1c2goJ2lzU3RhcnROb2RlJylcclxuICBpZiAoc2V0dGluZ3MuZ2V0U2V0dGluZygncG9ydGFsc0ZlYXR1cmVFbmFibGVkJykpIGV4cG9zZWREYXRhLnB1c2goJ3BvcnRhbFRvRmlsZScsICdwb3J0YWxJZCcpXHJcblxyXG4gIHJldHVybiBleHBvc2VkRGF0YVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBOb2RlRGF0YVRhZ2dlckNhbnZhc0V4dGVuc2lvbiB7XHJcbiAgcGx1Z2luOiBBZHZhbmNlZENhbnZhc1BsdWdpblxyXG5cclxuICBjb25zdHJ1Y3RvcihwbHVnaW46IEFkdmFuY2VkQ2FudmFzUGx1Z2luKSB7XHJcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpblxyXG5cclxuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQodGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5vbihcclxuICAgICAgQ2FudmFzRXZlbnQuTm9kZUNoYW5nZWQsXHJcbiAgICAgIChfY2FudmFzOiBDYW52YXMsIG5vZGU6IENhbnZhc05vZGUpID0+IHtcclxuICAgICAgICBjb25zdCBub2RlRGF0YSA9IG5vZGU/LmdldERhdGEoKVxyXG4gICAgICAgIGlmICghbm9kZURhdGEpIHJldHVyblxyXG5cclxuICAgICAgICBmb3IgKGNvbnN0IGRhdGFLZXkgb2YgZ2V0RXhwb3NlZE5vZGVEYXRhKHRoaXMucGx1Z2luLnNldHRpbmdzKSkge1xyXG4gICAgICAgICAgY29uc3QgZGF0YVZhbHVlID0gbm9kZURhdGFbZGF0YUtleV1cclxuICAgICAgICAgIFxyXG4gICAgICAgICAgaWYgKCFkYXRhVmFsdWUpIGRlbGV0ZSBub2RlLm5vZGVFbC5kYXRhc2V0W2RhdGFLZXldXHJcbiAgICAgICAgICBlbHNlIG5vZGUubm9kZUVsLmRhdGFzZXRbZGF0YUtleV0gPSBkYXRhVmFsdWVcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICkpXHJcbiAgfVxyXG59IiwgImltcG9ydCB7IENhbnZhcywgQ2FudmFzTm9kZSB9IGZyb20gXCJzcmMvQHR5cGVzL0NhbnZhc1wiXHJcbmltcG9ydCB7IGdldEV4cG9zZWROb2RlRGF0YSB9IGZyb20gXCIuL25vZGUtZGF0YS10YWdnZXItY2FudmFzLWV4dGVuc2lvblwiXHJcbmltcG9ydCBBZHZhbmNlZENhbnZhc1BsdWdpbiBmcm9tIFwic3JjL21haW5cIlxyXG5pbXBvcnQgeyBDYW52YXNFdmVudCB9IGZyb20gXCJzcmMvY29yZS9ldmVudHNcIlxyXG5cclxuZXhwb3J0IGNvbnN0IFRBUkdFVF9OT0RFX0RBVEFTRVRfUFJFRklYID0gXCJ0YXJnZXRcIlxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSW50ZXJhY3Rpb25UYWdnZXJDYW52YXNFeHRlbnNpb24ge1xyXG4gIHBsdWdpbjogQWR2YW5jZWRDYW52YXNQbHVnaW5cclxuXHJcbiAgY29uc3RydWN0b3IocGx1Z2luOiBBZHZhbmNlZENhbnZhc1BsdWdpbikge1xyXG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW5cclxuXHJcbiAgICAvLyBSZWdpc3RlciBldmVudHNcclxuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQodGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5vbihcclxuICAgICAgQ2FudmFzRXZlbnQuTm9kZUludGVyYWN0aW9uLFxyXG4gICAgICAoY2FudmFzOiBDYW52YXMsIG5vZGU6IENhbnZhc05vZGUpID0+IHtcclxuICAgICAgICBjb25zdCBpbnRlcmFjdGlvbkVsID0gY2FudmFzLm5vZGVJbnRlcmFjdGlvbkxheWVyLmludGVyYWN0aW9uRWxcclxuICAgICAgICBpZiAoIWludGVyYWN0aW9uRWwpIHJldHVyblxyXG4gICAgXHJcbiAgICAgICAgZm9yIChjb25zdCBkYXRhS2V5IG9mIGdldEV4cG9zZWROb2RlRGF0YSh0aGlzLnBsdWdpbi5zZXR0aW5ncykpIHtcclxuICAgICAgICAgIGNvbnN0IGRhdGFzZXRLZXkgPSBUQVJHRVRfTk9ERV9EQVRBU0VUX1BSRUZJWCArIGRhdGFLZXkudG9TdHJpbmcoKS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGRhdGFLZXkudG9TdHJpbmcoKS5zbGljZSgxKVxyXG4gICAgXHJcbiAgICAgICAgICBjb25zdCBkYXRhVmFsdWUgPSBub2RlPy5nZXREYXRhKClbZGF0YUtleV1cclxuXHJcbiAgICAgICAgICBpZiAoIWRhdGFWYWx1ZSkgZGVsZXRlIGludGVyYWN0aW9uRWwuZGF0YXNldFtkYXRhc2V0S2V5XVxyXG4gICAgICAgICAgZWxzZSBpbnRlcmFjdGlvbkVsLmRhdGFzZXRbZGF0YXNldEtleV0gPSBkYXRhVmFsdWVcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICkpXHJcbiAgfVxyXG59IiwgImltcG9ydCB7IENhbnZhcyB9IGZyb20gXCJzcmMvQHR5cGVzL0NhbnZhc1wiXHJcbmltcG9ydCAqIGFzIENhbnZhc0hlbHBlciBmcm9tIFwic3JjL3V0aWxzL2NhbnZhcy1oZWxwZXJcIlxyXG5pbXBvcnQgQWR2YW5jZWRDYW52YXNQbHVnaW4gZnJvbSBcInNyYy9tYWluXCJcclxuaW1wb3J0IHsgQ2FudmFzRXZlbnQgfSBmcm9tIFwic3JjL2NvcmUvZXZlbnRzXCJcclxuaW1wb3J0IHsgQWR2YW5jZWRDYW52YXNQbHVnaW5TZXR0aW5ncyB9IGZyb20gXCJzcmMvc2V0dGluZ3NcIlxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUmVhZG9ubHlDYW52YXNFeHRlbnNpb24ge1xyXG4gIHBsdWdpbjogQWR2YW5jZWRDYW52YXNQbHVnaW5cclxuXHJcbiAgY29uc3RydWN0b3IocGx1Z2luOiBhbnkpIHtcclxuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luXHJcbiAgICBjb25zdCB0aGF0ID0gdGhpc1xyXG5cclxuICAgIGlmICghdGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2V0U2V0dGluZygnYmV0dGVyUmVhZG9ubHlFbmFibGVkJykpIHJldHVyblxyXG5cclxuICAgIC8qIFBvcHVwIGxpc3RlbmVyICovXHJcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2Uub24oXHJcbiAgICAgIENhbnZhc0V2ZW50LlBvcHVwTWVudUNyZWF0ZWQsXHJcbiAgICAgIChjYW52YXM6IENhbnZhcywgX25vZGU6IGFueSkgPT4gdGhpcy51cGRhdGVQb3B1cE1lbnUoY2FudmFzKVxyXG4gICAgKSlcclxuXHJcbiAgICAvKiBab29tIGFuZCBQYW4gbGlzdGVuZXIgKi9cclxuICAgIGxldCBtb3ZpbmdUb0JCb3ggPSBmYWxzZVxyXG5cclxuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQodGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5vbihcclxuICAgICAgQ2FudmFzRXZlbnQuVmlld3BvcnRDaGFuZ2VkLkJlZm9yZSxcclxuICAgICAgKGNhbnZhczogQ2FudmFzKSA9PiB7XHJcbiAgICAgICAgLy8gT25seSBhbGxvdyB2aWV3cG9ydCBjaGFuZ2Ugb25jZSB3aGVuIHVzaW5nIHpvb20gdG8gYmJveFxyXG4gICAgICAgIGlmIChtb3ZpbmdUb0JCb3gpIHtcclxuICAgICAgICAgIG1vdmluZ1RvQkJveCA9IGZhbHNlXHJcblxyXG4gICAgICAgICAgdGhhdC51cGRhdGVMb2NrZWRab29tKGNhbnZhcylcclxuICAgICAgICAgIHRoYXQudXBkYXRlTG9ja2VkUGFuKGNhbnZhcylcclxuXHJcbiAgICAgICAgICByZXR1cm5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghY2FudmFzLnJlYWRvbmx5KSByZXR1cm5cclxuXHJcbiAgICAgICAgaWYgKHRoYXQucGx1Z2luLnNldHRpbmdzLmdldFNldHRpbmcoJ2Rpc2FibGVab29tJykpIHtcclxuICAgICAgICAgIGNhbnZhcy56b29tID0gY2FudmFzLmxvY2tlZFpvb20gPz8gY2FudmFzLnpvb21cclxuICAgICAgICAgIGNhbnZhcy50Wm9vbSA9IGNhbnZhcy5sb2NrZWRab29tID8/IGNhbnZhcy50Wm9vbVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoYXQucGx1Z2luLnNldHRpbmdzLmdldFNldHRpbmcoJ2Rpc2FibGVQYW4nKSkge1xyXG4gICAgICAgICAgY2FudmFzLnggPSBjYW52YXMubG9ja2VkWCA/PyBjYW52YXMueFxyXG4gICAgICAgICAgY2FudmFzLnR4ID0gY2FudmFzLmxvY2tlZFggPz8gY2FudmFzLnR4XHJcbiAgICAgICAgICBjYW52YXMueSA9IGNhbnZhcy5sb2NrZWRZID8/IGNhbnZhcy55XHJcbiAgICAgICAgICBjYW52YXMudHkgPSBjYW52YXMubG9ja2VkWSA/PyBjYW52YXMudHlcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICkpXHJcblxyXG4gICAgLy8gQWxsb3cgdmlld3BvcnQgY2hhbmdlIHdoZW4gdXNpbmcgem9vbSB0byBiYm94XHJcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2Uub24oXHJcbiAgICAgIENhbnZhc0V2ZW50Llpvb21Ub0Jib3guQmVmb3JlLFxyXG4gICAgICAoKSA9PiBtb3ZpbmdUb0JCb3ggPSB0cnVlXHJcbiAgICApKVxyXG5cclxuICAgIC8qIFJlYWRvbmx5IGxpc3RlbmVyICovXHJcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2Uub24oXHJcbiAgICAgIENhbnZhc0V2ZW50LlJlYWRvbmx5Q2hhbmdlZCxcclxuICAgICAgKGNhbnZhczogQ2FudmFzLCBfcmVhZG9ubHk6IGJvb2xlYW4pID0+IHtcclxuICAgICAgICB0aGlzLnVwZGF0ZVBvcHVwTWVudShjYW52YXMpXHJcbiAgICAgICAgdGhpcy51cGRhdGVMb2NrZWRab29tKGNhbnZhcylcclxuICAgICAgICB0aGlzLnVwZGF0ZUxvY2tlZFBhbihjYW52YXMpXHJcbiAgICAgIH1cclxuICAgICkpXHJcblxyXG4gICAgLyogQWRkIHNldHRpbmdzICovXHJcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2Uub24oXHJcbiAgICAgIENhbnZhc0V2ZW50LkNhbnZhc0NoYW5nZWQsXHJcbiAgICAgIChjYW52YXM6IENhbnZhcykgPT4gdGhpcy5hZGRRdWlja1NldHRpbmdzKGNhbnZhcylcclxuICAgICkpXHJcbiAgfVxyXG5cclxuICBhZGRRdWlja1NldHRpbmdzKGNhbnZhczogQ2FudmFzKSB7XHJcbiAgICBjb25zdCBzZXR0aW5nc0NvbnRhaW5lciA9IGNhbnZhcy5xdWlja1NldHRpbmdzQnV0dG9uPy5wYXJlbnRFbGVtZW50XHJcbiAgICBpZiAoIXNldHRpbmdzQ29udGFpbmVyKSByZXR1cm5cclxuXHJcbiAgICBDYW52YXNIZWxwZXIuYWRkUXVpY2tTZXR0aW5nc0J1dHRvbihcclxuICAgICAgc2V0dGluZ3NDb250YWluZXIsXHJcbiAgICAgIHRoaXMuY3JlYXRlVG9nZ2xlKHtcclxuICAgICAgICBpZDogJ2Rpc2FibGUtbm9kZS1wb3B1cCcsXHJcbiAgICAgICAgbGFiZWw6ICdEaXNhYmxlIG5vZGUgcG9wdXAnLFxyXG4gICAgICAgIGljb246ICdhcnJvdy11cC1yaWdodC1mcm9tLWNpcmNsZScsXHJcbiAgICAgICAgY2FsbGJhY2s6ICgpID0+IHRoaXMudXBkYXRlUG9wdXBNZW51KGNhbnZhcylcclxuICAgICAgfSwgJ2Rpc2FibGVOb2RlUG9wdXAnKVxyXG4gICAgKVxyXG5cclxuICAgIENhbnZhc0hlbHBlci5hZGRRdWlja1NldHRpbmdzQnV0dG9uKFxyXG4gICAgICBzZXR0aW5nc0NvbnRhaW5lcixcclxuICAgICAgdGhpcy5jcmVhdGVUb2dnbGUoe1xyXG4gICAgICAgIGlkOiAnZGlzYWJsZS16b29tJyxcclxuICAgICAgICBsYWJlbDogJ0Rpc2FibGUgem9vbScsXHJcbiAgICAgICAgaWNvbjogJ3pvb20taW4nLFxyXG4gICAgICAgIGNhbGxiYWNrOiAoKSA9PiB0aGlzLnVwZGF0ZUxvY2tlZFpvb20oY2FudmFzKVxyXG4gICAgICB9LCAnZGlzYWJsZVpvb20nKVxyXG4gICAgKVxyXG5cclxuICAgIENhbnZhc0hlbHBlci5hZGRRdWlja1NldHRpbmdzQnV0dG9uKFxyXG4gICAgICBzZXR0aW5nc0NvbnRhaW5lcixcclxuICAgICAgdGhpcy5jcmVhdGVUb2dnbGUoe1xyXG4gICAgICAgIGlkOiAnZGlzYWJsZS1wYW4nLFxyXG4gICAgICAgIGxhYmVsOiAnRGlzYWJsZSBwYW4nLFxyXG4gICAgICAgIGljb246ICdtb3ZlJyxcclxuICAgICAgICBjYWxsYmFjazogKCkgPT4gdGhpcy51cGRhdGVMb2NrZWRQYW4oY2FudmFzKVxyXG4gICAgICB9LCAnZGlzYWJsZVBhbicpXHJcbiAgICApXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNyZWF0ZVRvZ2dsZShtZW51T3B0aW9uOiBDYW52YXNIZWxwZXIuTWVudU9wdGlvbiwgc2V0dGluZ0tleToga2V5b2YgQWR2YW5jZWRDYW52YXNQbHVnaW5TZXR0aW5ncyk6IEhUTUxFbGVtZW50IHtcclxuICAgIGNvbnN0IHRvZ2dsZSA9IENhbnZhc0hlbHBlci5jcmVhdGVRdWlja1NldHRpbmdzQnV0dG9uKHtcclxuICAgICAgLi4ubWVudU9wdGlvbixcclxuICAgICAgY2FsbGJhY2s6ICgpID0+IChhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgbmV3VmFsdWUgPSAhdGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2V0U2V0dGluZyhzZXR0aW5nS2V5KVxyXG4gICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNldHRpbmdzLnNldFNldHRpbmcoeyBbc2V0dGluZ0tleV06IG5ld1ZhbHVlIH0pXHJcblxyXG4gICAgICAgIHRvZ2dsZS5kYXRhc2V0LnRvZ2dsZWQgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5nZXRTZXR0aW5nKHNldHRpbmdLZXkpLnRvU3RyaW5nKClcclxuICAgICAgICBtZW51T3B0aW9uLmNhbGxiYWNrPy5jYWxsKHRoaXMpXHJcbiAgICAgIH0pKClcclxuICAgIH0pXHJcbiAgICB0b2dnbGUuY2xhc3NMaXN0LmFkZCgnc2hvdy13aGlsZS1yZWFkb25seScpXHJcblxyXG4gICAgdG9nZ2xlLmRhdGFzZXQudG9nZ2xlZCA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmdldFNldHRpbmcoc2V0dGluZ0tleSkudG9TdHJpbmcoKVxyXG5cclxuICAgIHJldHVybiB0b2dnbGVcclxuICB9XHJcblxyXG4gIHByaXZhdGUgdXBkYXRlUG9wdXBNZW51KGNhbnZhczogQ2FudmFzKSB7XHJcbiAgICBjb25zdCBoaWRkZW4gPSBjYW52YXMucmVhZG9ubHkgJiYgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2V0U2V0dGluZygnZGlzYWJsZU5vZGVQb3B1cCcpXHJcbiAgICBjYW52YXMubWVudS5tZW51RWwuc3R5bGUudmlzaWJpbGl0eSA9IGhpZGRlbiA/ICdoaWRkZW4nIDogJ3Zpc2libGUnXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHVwZGF0ZUxvY2tlZFpvb20oY2FudmFzOiBDYW52YXMpIHtcclxuICAgIGNhbnZhcy5sb2NrZWRab29tID0gY2FudmFzLnRab29tXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHVwZGF0ZUxvY2tlZFBhbihjYW52YXM6IENhbnZhcykge1xyXG4gICAgY2FudmFzLmxvY2tlZFggPSBjYW52YXMudHhcclxuICAgIGNhbnZhcy5sb2NrZWRZID0gY2FudmFzLnR5XHJcbiAgfVxyXG59IiwgImltcG9ydCBBcHAsIHsgU3VnZ2VzdE1vZGFsLCBURmlsZSB9IGZyb20gJ29ic2lkaWFuJ1xyXG5pbXBvcnQgKiBhcyBQYXRoSGVscGVyIGZyb20gJ3NyYy91dGlscy9wYXRoLWhlbHBlcidcclxuXHJcbmV4cG9ydCBjbGFzcyBGaWxlTmFtZU1vZGFsIGV4dGVuZHMgU3VnZ2VzdE1vZGFsPHN0cmluZz4ge1xyXG4gIHBhcmVudFBhdGg6IHN0cmluZ1xyXG4gIGZpbGVFeHRlbnNpb246IHN0cmluZ1xyXG5cclxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGFyZW50UGF0aDogc3RyaW5nLCBmaWxlRXh0ZW5zaW9uOiBzdHJpbmcpIHtcclxuICAgIHN1cGVyKGFwcClcclxuXHJcbiAgICB0aGlzLnBhcmVudFBhdGggPSBwYXJlbnRQYXRoXHJcbiAgICB0aGlzLmZpbGVFeHRlbnNpb24gPSBmaWxlRXh0ZW5zaW9uXHJcbiAgfVxyXG5cclxuICBnZXRTdWdnZXN0aW9ucyhxdWVyeTogc3RyaW5nKTogc3RyaW5nW10ge1xyXG4gICAgY29uc3QgcXVlcnlXaXRob3V0RXh0ZW5zaW9uID0gcXVlcnkucmVwbGFjZShuZXcgUmVnRXhwKGBcXFxcLiR7dGhpcy5maWxlRXh0ZW5zaW9ufSRgKSwgJycpXHJcbiAgICBpZiAocXVlcnlXaXRob3V0RXh0ZW5zaW9uID09PSAnJykgcmV0dXJuIFtdXHJcblxyXG4gICAgY29uc3QgcXVlcnlXaXRoRXh0ZW5zaW9uID0gcXVlcnlXaXRob3V0RXh0ZW5zaW9uICsgJy4nICsgdGhpcy5maWxlRXh0ZW5zaW9uXHJcbiAgICBjb25zdCBzdWdnZXN0aW9ucyA9IFtgJHt0aGlzLnBhcmVudFBhdGh9LyR7cXVlcnlXaXRoRXh0ZW5zaW9ufWAsIHF1ZXJ5V2l0aEV4dGVuc2lvbl1cclxuICAgICAgLy8gRmlsdGVyIG91dCBzdWdnZXN0aW9ucyBmb3IgZmlsZXMgdGhhdCBhbHJlYWR5IGV4aXN0XHJcbiAgICAgIC5maWx0ZXIocyA9PiB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgocykgPT09IG51bGwpXHJcblxyXG4gICAgcmV0dXJuIHN1Z2dlc3Rpb25zXHJcbiAgfVxyXG5cclxuICByZW5kZXJTdWdnZXN0aW9uKHRleHQ6IHN0cmluZywgZWw6IEhUTUxFbGVtZW50KSB7XHJcbiAgICBlbC5zZXRUZXh0KHRleHQpXHJcbiAgfVxyXG5cclxuICBvbkNob29zZVN1Z2dlc3Rpb24oX3RleHQ6IHN0cmluZywgX2V2dDogTW91c2VFdmVudCB8IEtleWJvYXJkRXZlbnQpIHt9XHJcblxyXG4gIGF3YWl0SW5wdXQoKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgX3JlamVjdCkgPT4ge1xyXG4gICAgICB0aGlzLm9uQ2hvb3NlU3VnZ2VzdGlvbiA9ICh0ZXh0OiBzdHJpbmcpID0+IHsgcmVzb2x2ZSh0ZXh0KSB9XHJcbiAgICAgIHRoaXMub3BlbigpXHJcbiAgICB9KVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEZpbGVTZWxlY3RNb2RhbCBleHRlbmRzIFN1Z2dlc3RNb2RhbDxzdHJpbmc+IHtcclxuICBmaWxlczogc3RyaW5nW11cclxuICBzdWdnZXN0TmV3RmlsZTogYm9vbGVhblxyXG5cclxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgZXh0ZW5zaW9uc1JlZ2V4PzogUmVnRXhwLCBzdWdnZXN0TmV3RmlsZTogYm9vbGVhbiA9IGZhbHNlKSB7XHJcbiAgICBzdXBlcihhcHApXHJcblxyXG4gICAgdGhpcy5maWxlcyA9IHRoaXMuYXBwLnZhdWx0LmdldEZpbGVzKClcclxuICAgICAgLm1hcChmaWxlID0+IGZpbGUucGF0aClcclxuICAgICAgLmZpbHRlcihwYXRoID0+IFBhdGhIZWxwZXIuZXh0ZW5zaW9uKHBhdGgpPy5tYXRjaChleHRlbnNpb25zUmVnZXggPz8gLy4qLykpXHJcbiAgICB0aGlzLnN1Z2dlc3ROZXdGaWxlID0gc3VnZ2VzdE5ld0ZpbGVcclxuXHJcbiAgICB0aGlzLnNldFBsYWNlaG9sZGVyKCdUeXBlIHRvIHNlYXJjaC4uLicpXHJcbiAgICB0aGlzLnNldEluc3RydWN0aW9ucyhbe1xyXG4gICAgICAgIGNvbW1hbmQ6ICdcdTIxOTFcdTIxOTMnLFxyXG4gICAgICAgIHB1cnBvc2U6ICd0byBuYXZpZ2F0ZSdcclxuICAgIH0sIHtcclxuICAgICAgICBjb21tYW5kOiAnXHUyMUI1JyxcclxuICAgICAgICBwdXJwb3NlOiAndG8gb3BlbidcclxuICAgIH0sIHtcclxuICAgICAgICBjb21tYW5kOiAnc2hpZnQgXHUyMUI1JyxcclxuICAgICAgICBwdXJwb3NlOiAndG8gY3JlYXRlJ1xyXG4gICAgfSwge1xyXG4gICAgICAgIGNvbW1hbmQ6ICdlc2MnLFxyXG4gICAgICAgIHB1cnBvc2U6ICd0byBkaXNtaXNzJ1xyXG4gICAgfV0pXHJcblxyXG4gICAgdGhpcy5zY29wZS5yZWdpc3RlcihbJ1NoaWZ0J10sICdFbnRlcicsICgoZSkgPT4ge1xyXG4gICAgICB0aGlzLm9uQ2hvb3NlU3VnZ2VzdGlvbih0aGlzLmlucHV0RWwudmFsdWUsIGUpXHJcbiAgICAgIHRoaXMuY2xvc2UoKVxyXG4gICAgfSkpXHJcbiAgfVxyXG5cclxuICBnZXRTdWdnZXN0aW9ucyhxdWVyeTogc3RyaW5nKTogc3RyaW5nW10ge1xyXG4gICAgY29uc3Qgc3VnZ2VzdGlvbnMgPSB0aGlzLmZpbGVzLmZpbHRlcihwYXRoID0+IHBhdGgudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhxdWVyeS50b0xvd2VyQ2FzZSgpKSlcclxuICAgIGlmIChzdWdnZXN0aW9ucy5sZW5ndGggPT09IDAgJiYgdGhpcy5zdWdnZXN0TmV3RmlsZSkgc3VnZ2VzdGlvbnMucHVzaChxdWVyeSlcclxuXHJcbiAgICByZXR1cm4gc3VnZ2VzdGlvbnNcclxuICB9XHJcblxyXG4gIHJlbmRlclN1Z2dlc3Rpb24ocGF0aDogc3RyaW5nLCBlbDogSFRNTEVsZW1lbnQpIHtcclxuICAgIGNvbnN0IHNpbXBsaWZpZWRQYXRoID0gcGF0aC5yZXBsYWNlKC9cXC5tZCQvLCAnJylcclxuICAgIGVsLnNldFRleHQoc2ltcGxpZmllZFBhdGgpXHJcbiAgfVxyXG5cclxuICBvbkNob29zZVN1Z2dlc3Rpb24oX3BhdGg6IHN0cmluZywgX2V2dDogTW91c2VFdmVudCB8IEtleWJvYXJkRXZlbnQpIHt9XHJcblxyXG4gIGF3YWl0SW5wdXQoKTogUHJvbWlzZTxURmlsZT4ge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCBfcmVqZWN0KSA9PiB7XHJcbiAgICAgIHRoaXMub25DaG9vc2VTdWdnZXN0aW9uID0gKHBhdGg6IHN0cmluZywgX2V2dDogTW91c2VFdmVudCB8IEtleWJvYXJkRXZlbnQpID0+IHtcclxuICAgICAgICBjb25zdCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKHBhdGgpXHJcblxyXG4gICAgICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcclxuICAgICAgICAgIHJlc29sdmUoZmlsZSlcclxuICAgICAgICAgIHJldHVyblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLnN1Z2dlc3ROZXdGaWxlKSByZXR1cm5cclxuXHJcbiAgICAgICAgaWYgKFBhdGhIZWxwZXIuZXh0ZW5zaW9uKHBhdGgpID09PSB1bmRlZmluZWQpIHBhdGggKz0gJy5tZCdcclxuICAgICAgICBjb25zdCBuZXdGaWxlID0gdGhpcy5hcHAudmF1bHQuY3JlYXRlKHBhdGgsICcnKVxyXG4gICAgICAgIHJlc29sdmUobmV3RmlsZSlcclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy5vcGVuKClcclxuICAgIH0pXHJcbiAgfVxyXG59IiwgImV4cG9ydCBmdW5jdGlvbiBleHRlbnNpb24ocGF0aDogc3RyaW5nKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcclxuICByZXR1cm4gcGF0aC5pbmNsdWRlcygnLicpID8gcGF0aC5zcGxpdCgnLicpLnBvcCgpIDogdW5kZWZpbmVkXHJcbn0iLCAiaW1wb3J0IHsgTWVudSB9IGZyb20gXCJvYnNpZGlhblwiXHJcbmltcG9ydCB7IENhbnZhcyB9IGZyb20gXCJzcmMvQHR5cGVzL0NhbnZhc1wiXHJcbmltcG9ydCBBZHZhbmNlZENhbnZhc1BsdWdpbiBmcm9tIFwic3JjL21haW5cIlxyXG5pbXBvcnQgeyBGaWxlTmFtZU1vZGFsIH0gZnJvbSBcInNyYy91dGlscy9tb2RhbC1oZWxwZXJcIlxyXG5pbXBvcnQgKiBhcyBDYW52YXNIZWxwZXIgZnJvbSBcInNyYy91dGlscy9jYW52YXMtaGVscGVyXCJcclxuXHJcbmNvbnN0IEVOQ0FQU1VMQVRFRF9GSUxFX05PREVfU0laRSA9IHsgd2lkdGg6IDMwMCwgaGVpZ2h0OiAzMDAgfVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRW5jYXBzdWxhdGVDYW52YXNFeHRlbnNpb24ge1xyXG4gIHBsdWdpbjogQWR2YW5jZWRDYW52YXNQbHVnaW5cclxuXHJcbiAgY29uc3RydWN0b3IocGx1Z2luOiBBZHZhbmNlZENhbnZhc1BsdWdpbikge1xyXG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW5cclxuXHJcbiAgICBpZiAoIXRoaXMucGx1Z2luLnNldHRpbmdzLmdldFNldHRpbmcoJ2NhbnZhc0VuY2Fwc3VsYXRpb25FbmFibGVkJykpIHJldHVyblxyXG5cclxuICAgIC8qIEFkZCBjb21tYW5kIHRvIGVuY2Fwc3VsYXRlIHNlbGVjdGlvbiAqL1xyXG4gICAgdGhpcy5wbHVnaW4uYWRkQ29tbWFuZCh7XHJcbiAgICAgIGlkOiAnZW5jYXBzdWxhdGUtc2VsZWN0aW9uJyxcclxuICAgICAgbmFtZTogJ0VuY2Fwc3VsYXRlIHNlbGVjdGlvbicsXHJcbiAgICAgIGNoZWNrQ2FsbGJhY2s6IENhbnZhc0hlbHBlci5jYW52YXNDb21tYW5kKFxyXG4gICAgICAgIHRoaXMucGx1Z2luLFxyXG4gICAgICAgIChjYW52YXM6IENhbnZhcykgPT4gIWNhbnZhcy5yZWFkb25seSAmJiBjYW52YXMuc2VsZWN0aW9uLnNpemUgPiAwLFxyXG4gICAgICAgIChjYW52YXM6IENhbnZhcykgPT4gdGhpcy5lbmNhcHN1bGF0ZVNlbGVjdGlvbihjYW52YXMpXHJcbiAgICAgIClcclxuICAgIH0pXHJcblxyXG4gICAgLyogQWRkIGVuY2Fwc3VsYXRlIG9wdGlvbiB0byBjb250ZXh0IG1lbnUgKi9cclxuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQodGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5vbihcclxuICAgICAgJ2NhbnZhczpzZWxlY3Rpb24tbWVudScsXHJcbiAgICAgIChtZW51OiBNZW51LCBjYW52YXM6IENhbnZhcykgPT4ge1xyXG4gICAgICAgIG1lbnUuYWRkSXRlbSgoaXRlbSkgPT5cclxuICAgICAgICAgIGl0ZW1cclxuICAgICAgICAgICAgLnNldFRpdGxlKCdFbmNhcHN1bGF0ZScpXHJcbiAgICAgICAgICAgIC5zZXRJY29uKCdmaWxlLXBsdXMnKVxyXG4gICAgICAgICAgICAub25DbGljaygoKSA9PiB0aGlzLmVuY2Fwc3VsYXRlU2VsZWN0aW9uKGNhbnZhcykpXHJcbiAgICAgICAgKVxyXG4gICAgICB9XHJcbiAgICApKVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZW5jYXBzdWxhdGVTZWxlY3Rpb24oY2FudmFzOiBDYW52YXMpIHtcclxuICAgIGNvbnN0IHNlbGVjdGlvbiA9IGNhbnZhcy5nZXRTZWxlY3Rpb25EYXRhKClcclxuXHJcbiAgICAvLyBDcmVhdGUgbmV3IGZpbGVcclxuICAgIGNvbnN0IHNvdXJjZUZpbGVGb2xkZXIgPSBjYW52YXMudmlldy5maWxlLnBhcmVudD8ucGF0aFxyXG4gICAgaWYgKCFzb3VyY2VGaWxlRm9sZGVyKSByZXR1cm4gLy8gU2hvdWxkIG5ldmVyIGhhcHBlblxyXG5cclxuICAgIGNvbnN0IHRhcmdldEZpbGVQYXRoID0gYXdhaXQgbmV3IEZpbGVOYW1lTW9kYWwoXHJcbiAgICAgIHRoaXMucGx1Z2luLmFwcCxcclxuICAgICAgc291cmNlRmlsZUZvbGRlcixcclxuICAgICAgJ2NhbnZhcydcclxuICAgICkuYXdhaXRJbnB1dCgpXHJcblxyXG4gICAgY29uc3QgbmV3RmlsZURhdGEgPSB7IG5vZGVzOiBzZWxlY3Rpb24ubm9kZXMsIGVkZ2VzOiBzZWxlY3Rpb24uZWRnZXMgfVxyXG4gICAgY29uc3QgZmlsZSA9IGF3YWl0IHRoaXMucGx1Z2luLmFwcC52YXVsdC5jcmVhdGUodGFyZ2V0RmlsZVBhdGgsIEpTT04uc3RyaW5naWZ5KG5ld0ZpbGVEYXRhLCBudWxsLCAyKSlcclxuXHJcbiAgICAvLyBSZW1vdmUgZnJvbSBjdXJyZW50IGNhbnZhc1xyXG4gICAgZm9yIChjb25zdCBub2RlRGF0YSBvZiBzZWxlY3Rpb24ubm9kZXMpIHtcclxuICAgICAgY29uc3Qgbm9kZSA9IGNhbnZhcy5ub2Rlcy5nZXQobm9kZURhdGEuaWQpXHJcbiAgICAgIGlmIChub2RlKSBjYW52YXMucmVtb3ZlTm9kZShub2RlKVxyXG4gICAgfVxyXG5cclxuICAgIC8vIEFkZCBsaW5rIHRvIG5ldyBmaWxlIGluIGN1cnJlbnQgY2FudmFzXHJcbiAgICBjYW52YXMuY3JlYXRlRmlsZU5vZGUoe1xyXG4gICAgICBwb3M6IHtcclxuICAgICAgICB4OiBzZWxlY3Rpb24uY2VudGVyLnggLSBFTkNBUFNVTEFURURfRklMRV9OT0RFX1NJWkUud2lkdGggLyAyLFxyXG4gICAgICAgIHk6IHNlbGVjdGlvbi5jZW50ZXIueSAtIEVOQ0FQU1VMQVRFRF9GSUxFX05PREVfU0laRS5oZWlnaHQgLyAyXHJcbiAgICAgIH0sXHJcbiAgICAgIHNpemU6IEVOQ0FQU1VMQVRFRF9GSUxFX05PREVfU0laRSxcclxuICAgICAgZmlsZTogZmlsZVxyXG4gICAgfSlcclxuICB9XHJcbn0iLCAiaW1wb3J0IHsgQ2FudmFzIH0gZnJvbSBcInNyYy9AdHlwZXMvQ2FudmFzXCJcclxuaW1wb3J0IEFkdmFuY2VkQ2FudmFzUGx1Z2luIGZyb20gXCJzcmMvbWFpblwiXHJcbmltcG9ydCAqIGFzIENhbnZhc0hlbHBlciBmcm9tIFwic3JjL3V0aWxzL2NhbnZhcy1oZWxwZXJcIlxyXG5pbXBvcnQgeyBGaWxlU2VsZWN0TW9kYWwgfSBmcm9tIFwic3JjL3V0aWxzL21vZGFsLWhlbHBlclwiXHJcblxyXG50eXBlIERpcmVjdGlvbiA9ICd1cCcgfCAnZG93bicgfCAnbGVmdCcgfCAncmlnaHQnXHJcbmNvbnN0IERJUkVDVElPTlMgPSBbJ3VwJywgJ2Rvd24nLCAnbGVmdCcsICdyaWdodCddIGFzIERpcmVjdGlvbltdXHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDb21tYW5kc0NhbnZhc0V4dGVuc2lvbiB7XHJcbiAgcGx1Z2luOiBBZHZhbmNlZENhbnZhc1BsdWdpblxyXG5cclxuICBjb25zdHJ1Y3RvcihwbHVnaW46IEFkdmFuY2VkQ2FudmFzUGx1Z2luKSB7XHJcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpblxyXG5cclxuICAgIGlmICghdGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2V0U2V0dGluZygnY29tbWFuZHNGZWF0dXJlRW5hYmxlZCcpKSByZXR1cm5cclxuXHJcbiAgICB0aGlzLnBsdWdpbi5hZGRDb21tYW5kKHtcclxuICAgICAgaWQ6ICdjcmVhdGUtdGV4dC1ub2RlJyxcclxuICAgICAgbmFtZTogJ0NyZWF0ZSB0ZXh0IG5vZGUnLFxyXG4gICAgICBjaGVja0NhbGxiYWNrOiBDYW52YXNIZWxwZXIuY2FudmFzQ29tbWFuZChcclxuICAgICAgICB0aGlzLnBsdWdpbixcclxuICAgICAgICAoY2FudmFzOiBDYW52YXMpID0+ICFjYW52YXMucmVhZG9ubHksXHJcbiAgICAgICAgKGNhbnZhczogQ2FudmFzKSA9PiB0aGlzLmNyZWF0ZVRleHROb2RlKGNhbnZhcylcclxuICAgICAgKVxyXG4gICAgfSlcclxuXHJcbiAgICB0aGlzLnBsdWdpbi5hZGRDb21tYW5kKHtcclxuICAgICAgaWQ6ICdjcmVhdGUtZmlsZS1ub2RlJyxcclxuICAgICAgbmFtZTogJ0NyZWF0ZSBmaWxlIG5vZGUnLFxyXG4gICAgICBjaGVja0NhbGxiYWNrOiBDYW52YXNIZWxwZXIuY2FudmFzQ29tbWFuZChcclxuICAgICAgICB0aGlzLnBsdWdpbixcclxuICAgICAgICAoY2FudmFzOiBDYW52YXMpID0+ICFjYW52YXMucmVhZG9ubHksXHJcbiAgICAgICAgKGNhbnZhczogQ2FudmFzKSA9PiB0aGlzLmNyZWF0ZUZpbGVOb2RlKGNhbnZhcylcclxuICAgICAgKVxyXG4gICAgfSlcclxuXHJcbiAgICB0aGlzLnBsdWdpbi5hZGRDb21tYW5kKHtcclxuICAgICAgaWQ6ICdzZWxlY3QtYWxsLWVkZ2VzJyxcclxuICAgICAgbmFtZTogJ1NlbGVjdCBhbGwgZWRnZXMnLFxyXG4gICAgICBjaGVja0NhbGxiYWNrOiBDYW52YXNIZWxwZXIuY2FudmFzQ29tbWFuZChcclxuICAgICAgICB0aGlzLnBsdWdpbixcclxuICAgICAgICAoX2NhbnZhczogQ2FudmFzKSA9PiB0cnVlLFxyXG4gICAgICAgIChjYW52YXM6IENhbnZhcykgPT4gY2FudmFzLnVwZGF0ZVNlbGVjdGlvbigoKSA9PiBcclxuICAgICAgICAgIGNhbnZhcy5zZWxlY3Rpb24gPSBuZXcgU2V0KGNhbnZhcy5lZGdlcy52YWx1ZXMoKSlcclxuICAgICAgICApXHJcbiAgICAgIClcclxuICAgIH0pXHJcblxyXG4gICAgdGhpcy5wbHVnaW4uYWRkQ29tbWFuZCh7XHJcbiAgICAgIGlkOiAnem9vbS10by1zZWxlY3Rpb24nLFxyXG4gICAgICBuYW1lOiAnWm9vbSB0byBzZWxlY3Rpb24nLFxyXG4gICAgICBjaGVja0NhbGxiYWNrOiBDYW52YXNIZWxwZXIuY2FudmFzQ29tbWFuZChcclxuICAgICAgICB0aGlzLnBsdWdpbixcclxuICAgICAgICAoY2FudmFzOiBDYW52YXMpID0+IGNhbnZhcy5zZWxlY3Rpb24uc2l6ZSA+IDAsXHJcbiAgICAgICAgKGNhbnZhczogQ2FudmFzKSA9PiBjYW52YXMuem9vbVRvU2VsZWN0aW9uKClcclxuICAgICAgKVxyXG4gICAgfSlcclxuXHJcbiAgICBmb3IgKGNvbnN0IGRpcmVjdGlvbiBvZiBESVJFQ1RJT05TKSB7XHJcbiAgICAgIHRoaXMucGx1Z2luLmFkZENvbW1hbmQoe1xyXG4gICAgICAgIGlkOiBgY2xvbmUtbm9kZS0ke2RpcmVjdGlvbn1gLFxyXG4gICAgICAgIG5hbWU6IGBDbG9uZSBub2RlICR7ZGlyZWN0aW9ufWAsXHJcbiAgICAgICAgY2hlY2tDYWxsYmFjazogQ2FudmFzSGVscGVyLmNhbnZhc0NvbW1hbmQoXHJcbiAgICAgICAgICB0aGlzLnBsdWdpbixcclxuICAgICAgICAgIChjYW52YXM6IENhbnZhcykgPT4gIWNhbnZhcy5yZWFkb25seSAmJiBjYW52YXMuc2VsZWN0aW9uLnNpemUgPT09IDEgJiYgY2FudmFzLnNlbGVjdGlvbi52YWx1ZXMoKS5uZXh0KCkudmFsdWU/LmdldERhdGEoKS50eXBlID09PSAndGV4dCcsXHJcbiAgICAgICAgICAoY2FudmFzOiBDYW52YXMpID0+IHRoaXMuY2xvbmVOb2RlKGNhbnZhcywgZGlyZWN0aW9uKVxyXG4gICAgICAgIClcclxuICAgICAgfSlcclxuXHJcbiAgICAgIHRoaXMucGx1Z2luLmFkZENvbW1hbmQoe1xyXG4gICAgICAgIGlkOiBgZXhwYW5kLW5vZGUtJHtkaXJlY3Rpb259YCxcclxuICAgICAgICBuYW1lOiBgRXhwYW5kIG5vZGUgJHtkaXJlY3Rpb259YCxcclxuICAgICAgICBjaGVja0NhbGxiYWNrOiBDYW52YXNIZWxwZXIuY2FudmFzQ29tbWFuZChcclxuICAgICAgICAgIHRoaXMucGx1Z2luLFxyXG4gICAgICAgICAgKGNhbnZhczogQ2FudmFzKSA9PiAhY2FudmFzLnJlYWRvbmx5ICYmIGNhbnZhcy5zZWxlY3Rpb24uc2l6ZSA9PT0gMSxcclxuICAgICAgICAgIChjYW52YXM6IENhbnZhcykgPT4gdGhpcy5leHBhbmROb2RlKGNhbnZhcywgZGlyZWN0aW9uKVxyXG4gICAgICAgIClcclxuICAgICAgfSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgY3JlYXRlVGV4dE5vZGUoY2FudmFzOiBDYW52YXMpIHtcclxuICAgIGNvbnN0IHNpemUgPSBjYW52YXMuY29uZmlnLmRlZmF1bHRUZXh0Tm9kZURpbWVuc2lvbnNcclxuICAgIGNvbnN0IHBvcyA9IENhbnZhc0hlbHBlci5nZXRDZW50ZXJDb29yZGluYXRlcyhjYW52YXMsIHNpemUpXHJcblxyXG4gICAgY2FudmFzLmNyZWF0ZVRleHROb2RlKHsgcG9zOiBwb3MsIHNpemU6IHNpemUgfSlcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgY3JlYXRlRmlsZU5vZGUoY2FudmFzOiBDYW52YXMpIHtcclxuICAgIGNvbnN0IHNpemUgPSBjYW52YXMuY29uZmlnLmRlZmF1bHRGaWxlTm9kZURpbWVuc2lvbnNcclxuICAgIGNvbnN0IHBvcyA9IENhbnZhc0hlbHBlci5nZXRDZW50ZXJDb29yZGluYXRlcyhjYW52YXMsIHNpemUpXHJcbiAgICBjb25zdCBmaWxlID0gYXdhaXQgbmV3IEZpbGVTZWxlY3RNb2RhbCh0aGlzLnBsdWdpbi5hcHAsIHVuZGVmaW5lZCwgdHJ1ZSkuYXdhaXRJbnB1dCgpXHJcblxyXG4gICAgY2FudmFzLmNyZWF0ZUZpbGVOb2RlKHsgcG9zOiBwb3MsIHNpemU6IHNpemUsIGZpbGU6IGZpbGUgfSlcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2xvbmVOb2RlKGNhbnZhczogQ2FudmFzLCBjbG9uZURpcmVjdGlvbjogRGlyZWN0aW9uKSB7XHJcbiAgICBjb25zdCBzb3VyY2VOb2RlID0gY2FudmFzLnNlbGVjdGlvbi52YWx1ZXMoKS5uZXh0KCkudmFsdWVcclxuICAgIGlmICghc291cmNlTm9kZSkgcmV0dXJuXHJcbiAgICBjb25zdCBzb3VyY2VOb2RlRGF0YSA9IHNvdXJjZU5vZGUuZ2V0RGF0YSgpXHJcblxyXG4gICAgY29uc3Qgbm9kZU1hcmdpbiA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmdldFNldHRpbmcoJ2Nsb25lTm9kZU1hcmdpbicpXHJcbiAgICBjb25zdCBvZmZzZXQgPSB7IFxyXG4gICAgICB4OiAoc291cmNlTm9kZS53aWR0aCArIG5vZGVNYXJnaW4pICogKGNsb25lRGlyZWN0aW9uID09PSAnbGVmdCcgPyAtMSA6IChjbG9uZURpcmVjdGlvbiA9PT0gJ3JpZ2h0JyA/IDEgOiAwKSksXHJcbiAgICAgIHk6IChzb3VyY2VOb2RlLmhlaWdodCArIG5vZGVNYXJnaW4pICogKGNsb25lRGlyZWN0aW9uID09PSAndXAnID8gLTEgOiAoY2xvbmVEaXJlY3Rpb24gPT09ICdkb3duJyA/IDEgOiAwKSlcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjbG9uZWROb2RlID0gY2FudmFzLmNyZWF0ZVRleHROb2RlKHtcclxuICAgICAgcG9zOiB7XHJcbiAgICAgICAgeDogc291cmNlTm9kZS54ICsgb2Zmc2V0LngsXHJcbiAgICAgICAgeTogc291cmNlTm9kZS55ICsgb2Zmc2V0LnlcclxuICAgICAgfSxcclxuICAgICAgc2l6ZToge1xyXG4gICAgICAgIHdpZHRoOiBzb3VyY2VOb2RlLndpZHRoLFxyXG4gICAgICAgIGhlaWdodDogc291cmNlTm9kZS5oZWlnaHRcclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICBjbG9uZWROb2RlLnNldERhdGEoeyBcclxuICAgICAgLi4uY2xvbmVkTm9kZS5nZXREYXRhKCksIFxyXG4gICAgICBjb2xvcjogc291cmNlTm9kZURhdGEuY29sb3IsXHJcbiAgICAgIHNoYXBlOiBzb3VyY2VOb2RlRGF0YS5zaGFwZSBcclxuICAgIH0pXHJcblxyXG4gICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLmdldFNldHRpbmcoJ3pvb21Ub0Nsb25lZE5vZGUnKSlcclxuICAgICAgY2FudmFzLnpvb21Ub0Jib3goY2xvbmVkTm9kZS5nZXRCQm94KCkpXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGV4cGFuZE5vZGUoY2FudmFzOiBDYW52YXMsIGV4cGFuZERpcmVjdGlvbjogRGlyZWN0aW9uKSB7XHJcbiAgICBjb25zdCBub2RlID0gY2FudmFzLnNlbGVjdGlvbi52YWx1ZXMoKS5uZXh0KCkudmFsdWVcclxuICAgIGlmICghbm9kZSkgcmV0dXJuXHJcblxyXG4gICAgY29uc3QgZXhwYW5kTm9kZVN0ZXBTaXplID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2V0U2V0dGluZygnZXhwYW5kTm9kZVN0ZXBTaXplJylcclxuICAgIGNvbnN0IGV4cGFuZCA9IHtcclxuICAgICAgeDogZXhwYW5kRGlyZWN0aW9uID09PSAnbGVmdCcgPyAtMSA6IChleHBhbmREaXJlY3Rpb24gPT09ICdyaWdodCcgPyAxIDogMCksXHJcbiAgICAgIHk6IGV4cGFuZERpcmVjdGlvbiA9PT0gJ3VwJyA/IC0xIDogKGV4cGFuZERpcmVjdGlvbiA9PT0gJ2Rvd24nID8gMSA6IDApXHJcbiAgICB9XHJcblxyXG4gICAgbm9kZS5zZXREYXRhKHtcclxuICAgICAgLi4ubm9kZS5nZXREYXRhKCksXHJcbiAgICAgIHdpZHRoOiBub2RlLndpZHRoICsgZXhwYW5kLnggKiBleHBhbmROb2RlU3RlcFNpemUsXHJcbiAgICAgIGhlaWdodDogbm9kZS5oZWlnaHQgKyBleHBhbmQueSAqIGV4cGFuZE5vZGVTdGVwU2l6ZVxyXG4gICAgfSlcclxuICB9XHJcbn0iLCAiaW1wb3J0IHsgVEZpbGUgfSBmcm9tIFwib2JzaWRpYW5cIlxyXG5pbXBvcnQgeyBCQm94LCBDYW52YXMsIENhbnZhc0RhdGEsIENhbnZhc0VkZ2UsIENhbnZhc0VsZW1lbnQsIENhbnZhc05vZGUsIENhbnZhc05vZGVEYXRhIH0gZnJvbSBcInNyYy9AdHlwZXMvQ2FudmFzXCJcclxuaW1wb3J0IHsgQ2FudmFzRXZlbnQgfSBmcm9tIFwic3JjL2NvcmUvZXZlbnRzXCJcclxuaW1wb3J0IEFkdmFuY2VkQ2FudmFzUGx1Z2luIGZyb20gXCJzcmMvbWFpblwiXHJcbmltcG9ydCAqIGFzIENhbnZhc0hlbHBlciBmcm9tIFwic3JjL3V0aWxzL2NhbnZhcy1oZWxwZXJcIlxyXG5cclxuY29uc3QgUE9SVEFMX1BBRERJTkcgPSA1MFxyXG5jb25zdCBNSU5fT1BFTl9QT1JUQUxfU0laRSA9IHsgd2lkdGg6IDIwMCwgaGVpZ2h0OiAyMDAgfVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9ydGFsc0NhbnZhc0V4dGVuc2lvbiB7XHJcbiAgcGx1Z2luOiBBZHZhbmNlZENhbnZhc1BsdWdpblxyXG5cclxuICBjb25zdHJ1Y3RvcihwbHVnaW46IEFkdmFuY2VkQ2FudmFzUGx1Z2luKSB7XHJcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpblxyXG5cclxuICAgIGlmICghdGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2V0U2V0dGluZygncG9ydGFsc0ZlYXR1cmVFbmFibGVkJykpIHJldHVyblxyXG5cclxuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQodGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5vbihcclxuICAgICAgQ2FudmFzRXZlbnQuUG9wdXBNZW51Q3JlYXRlZCxcclxuICAgICAgKGNhbnZhczogQ2FudmFzKSA9PiB0aGlzLnVwZGF0ZVBvcHVwTWVudShjYW52YXMpXHJcbiAgICApKVxyXG5cclxuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQodGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5vbihcclxuICAgICAgQ2FudmFzRXZlbnQuTm9kZVJlbW92ZWQsXHJcbiAgICAgIChjYW52YXM6IENhbnZhcywgbm9kZTogQ2FudmFzTm9kZSkgPT4gdGhpcy5vbk5vZGVSZW1vdmVkKGNhbnZhcywgbm9kZSlcclxuICAgICkpXHJcblxyXG4gICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudCh0aGlzLnBsdWdpbi5hcHAud29ya3NwYWNlLm9uKFxyXG4gICAgICBDYW52YXNFdmVudC5Ob2RlTW92ZWQsXHJcbiAgICAgIChjYW52YXM6IENhbnZhcywgbm9kZTogQ2FudmFzTm9kZSkgPT4gdGhpcy5vbk5vZGVNb3ZlZChjYW52YXMsIG5vZGUpXHJcbiAgICApKVxyXG5cclxuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQodGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5vbihcclxuICAgICAgQ2FudmFzRXZlbnQuRHJhZ2dpbmdTdGF0ZUNoYW5nZWQsXHJcbiAgICAgIChjYW52YXM6IENhbnZhcywgc3RhcnRlZERyYWdnaW5nOiBib29sZWFuKSA9PiB0aGlzLm9uRHJhZ2dpbmdTdGF0ZUNoYW5nZWQoY2FudmFzLCBzdGFydGVkRHJhZ2dpbmcpXHJcbiAgICApKVxyXG5cclxuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQodGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5vbihcclxuICAgICAgQ2FudmFzRXZlbnQuQ29udGFpbmluZ05vZGVzUmVxdWVzdGVkLFxyXG4gICAgICAoY2FudmFzOiBDYW52YXMsIGJib3g6IEJCb3gsIG5vZGVzOiBDYW52YXNOb2RlW10pID0+IHRoaXMub25Db250YWluaW5nTm9kZXNSZXF1ZXN0ZWQoY2FudmFzLCBiYm94LCBub2RlcylcclxuICAgICkpXHJcblxyXG4gICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudCh0aGlzLnBsdWdpbi5hcHAud29ya3NwYWNlLm9uKFxyXG4gICAgICBDYW52YXNFdmVudC5TZWxlY3Rpb25DaGFuZ2VkLFxyXG4gICAgICAoY2FudmFzOiBDYW52YXMsIG9sZFNlbGVjdGlvbjogU2V0PENhbnZhc0VsZW1lbnQ+LCB1cGRhdGVTZWxlY3Rpb246ICh1cGRhdGU6ICgpID0+IHZvaWQpID0+IHZvaWQpID0+IHRoaXMub25TZWxlY3Rpb25DaGFuZ2VkKGNhbnZhcywgb2xkU2VsZWN0aW9uLCB1cGRhdGVTZWxlY3Rpb24pXHJcbiAgICApKVxyXG5cclxuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQodGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5vbihcclxuICAgICAgQ2FudmFzRXZlbnQuRWRnZUNoYW5nZWQsXHJcbiAgICAgIChjYW52YXM6IENhbnZhcywgZWRnZTogQ2FudmFzRWRnZSkgPT4gdGhpcy5vbkVkZ2VDaGFuZ2VkKGNhbnZhcywgZWRnZSlcclxuICAgICkpXHJcblxyXG4gICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudCh0aGlzLnBsdWdpbi5hcHAud29ya3NwYWNlLm9uKFxyXG4gICAgICBDYW52YXNFdmVudC5EYXRhUmVxdWVzdGVkLFxyXG4gICAgICAoY2FudmFzOiBDYW52YXMsIGRhdGE6IENhbnZhc0RhdGEpID0+IHRoaXMucmVtb3ZlUG9ydGFsQ2FudmFzRGF0YShjYW52YXMsIGRhdGEpXHJcbiAgICApKVxyXG5cclxuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQodGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5vbihcclxuICAgICAgQ2FudmFzRXZlbnQuTG9hZERhdGEsXHJcbiAgICAgIChjYW52YXM6IENhbnZhcywgZGF0YTogQ2FudmFzRGF0YSwgc2V0RGF0YTogKGRhdGE6IENhbnZhc0RhdGEpID0+IHZvaWQpID0+IHtcclxuICAgICAgICB0aGlzLmdldENhbnZhc0RhdGFXaXRoUG9ydGFscyhjYW52YXMsIGRhdGEpXHJcbiAgICAgICAgICAudGhlbigobmV3RGF0YTogQ2FudmFzRGF0YSkgPT4ge1xyXG4gICAgICAgICAgICAvLyBTa2lwIGlmIHRoZSBkYXRhIGRpZG4ndCBjaGFuZ2VcclxuICAgICAgICAgICAgaWYgKG5ld0RhdGEubm9kZXMubGVuZ3RoID09PSBkYXRhLm5vZGVzLmxlbmd0aCAmJiBuZXdEYXRhLmVkZ2VzLmxlbmd0aCA9PT0gZGF0YS5lZGdlcy5sZW5ndGgpIHJldHVyblxyXG4gICAgICAgICAgICBzZXREYXRhKG5ld0RhdGEpXHJcbiAgICAgICAgICB9KVxyXG4gICAgICB9XHJcbiAgICApKVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB1cGRhdGVQb3B1cE1lbnUoY2FudmFzOiBDYW52YXMpIHtcclxuICAgIGlmIChjYW52YXMucmVhZG9ubHkpIHJldHVyblxyXG5cclxuICAgIC8vIE9ubHkgc2VhcmNoIGZvciB2YWxpZCBub2Rlc1xyXG4gICAgY29uc3Qgc2VsZWN0ZWRGaWxlTm9kZXMgPSBjYW52YXMuZ2V0U2VsZWN0aW9uRGF0YSgpLm5vZGVzLm1hcChub2RlRGF0YSA9PiB7XHJcbiAgICAgIGNvbnN0IG5vZGUgPSBjYW52YXMubm9kZXMuZ2V0KG5vZGVEYXRhLmlkKVxyXG4gICAgICBpZiAoIW5vZGUpIHJldHVybiBudWxsXHJcblxyXG4gICAgICBpZiAobm9kZURhdGEudHlwZSAhPT0gJ2ZpbGUnKSByZXR1cm4gbnVsbFxyXG4gICAgICBpZiAobm9kZS5maWxlPy5leHRlbnNpb24gPT09ICdjYW52YXMnKSByZXR1cm4gbm9kZVxyXG4gICAgICBcclxuICAgICAgLy8gQ2xvc2UgcG9ydGFsIG9mIG5vbi1jYW52YXMgZmlsZVxyXG4gICAgICBpZiAobm9kZURhdGEucG9ydGFsVG9GaWxlKSB0aGlzLnNldFBvcnRhbE9wZW4oY2FudmFzLCBub2RlLCBmYWxzZSlcclxuXHJcbiAgICAgIHJldHVybiBudWxsXHJcbiAgICB9KS5maWx0ZXIobm9kZSA9PiBub2RlICE9PSBudWxsKSBhcyBDYW52YXNOb2RlW11cclxuICAgIFxyXG4gICAgaWYgKHNlbGVjdGVkRmlsZU5vZGVzLmxlbmd0aCAhPT0gMSkgcmV0dXJuXHJcblxyXG4gICAgY29uc3QgcG9ydGFsTm9kZSA9IHNlbGVjdGVkRmlsZU5vZGVzWzBdXHJcbiAgICBjb25zdCBwb3J0YWxOb2RlRGF0YSA9IHBvcnRhbE5vZGUuZ2V0RGF0YSgpXHJcblxyXG4gICAgLy8gSWYgZmlsZSBjaGFuZ2VkXHJcbiAgICBpZiAocG9ydGFsTm9kZURhdGEucG9ydGFsVG9GaWxlICYmIHBvcnRhbE5vZGVEYXRhLmZpbGUgIT09IHBvcnRhbE5vZGVEYXRhLnBvcnRhbFRvRmlsZSkge1xyXG4gICAgICB0aGlzLnNldFBvcnRhbE9wZW4oY2FudmFzLCBwb3J0YWxOb2RlLCB0cnVlKVxyXG4gICAgfVxyXG5cclxuICAgIENhbnZhc0hlbHBlci5hZGRQb3B1cE1lbnVPcHRpb24oXHJcbiAgICAgIGNhbnZhcyxcclxuICAgICAgQ2FudmFzSGVscGVyLmNyZWF0ZVBvcHVwTWVudU9wdGlvbih7XHJcbiAgICAgICAgaWQ6ICd0b2dnbGUtcG9ydGFsJyxcclxuICAgICAgICBsYWJlbDogcG9ydGFsTm9kZURhdGEucG9ydGFsVG9GaWxlID8gJ0Nsb3NlIHBvcnRhbCcgOiAnT3BlbiBwb3J0YWwnLFxyXG4gICAgICAgIGljb246IHBvcnRhbE5vZGVEYXRhLnBvcnRhbFRvRmlsZSA/ICdkb29yLW9wZW4nIDogJ2Rvb3ItY2xvc2VkJyxcclxuICAgICAgICBjYWxsYmFjazogKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5zZXRQb3J0YWxPcGVuKGNhbnZhcywgcG9ydGFsTm9kZSwgcG9ydGFsTm9kZURhdGEucG9ydGFsVG9GaWxlID09PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICB0aGlzLnVwZGF0ZVBvcHVwTWVudShjYW52YXMpXHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzZXRQb3J0YWxPcGVuKGNhbnZhczogQ2FudmFzLCBwb3J0YWxOb2RlOiBDYW52YXNOb2RlLCBvcGVuOiBib29sZWFuKSB7XHJcbiAgICBjb25zdCBwb3J0YWxOb2RlRGF0YSA9IHBvcnRhbE5vZGUuZ2V0RGF0YSgpXHJcbiAgICBwb3J0YWxOb2RlLnNldERhdGEoe1xyXG4gICAgICAuLi5wb3J0YWxOb2RlRGF0YSxcclxuICAgICAgcG9ydGFsVG9GaWxlOiBvcGVuID8gcG9ydGFsTm9kZURhdGEuZmlsZSA6IHVuZGVmaW5lZFxyXG4gICAgfSlcclxuXHJcbiAgICAvLyBVcGRhdGUgd2hvbGUgY2FudmFzIGRhdGFcclxuICAgIGNhbnZhcy5zZXREYXRhKGNhbnZhcy5nZXREYXRhKCkpXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG9uTm9kZVJlbW92ZWQoY2FudmFzOiBDYW52YXMsIG5vZGU6IENhbnZhc05vZGUpIHtcclxuICAgIGNvbnN0IG5vZGVEYXRhID0gbm9kZS5nZXREYXRhKClcclxuICAgIGlmIChub2RlRGF0YS50eXBlICE9PSAnZmlsZScgfHwgIW5vZGVEYXRhLnBvcnRhbFRvRmlsZSkgcmV0dXJuXHJcblxyXG4gICAgLy8gUmVtb3ZlIG5lc3RlZCBub2RlcyBhbmQgZWRnZXNcclxuICAgIE9iamVjdC5rZXlzKG5vZGVEYXRhLnBvcnRhbElkTWFwcz8ubm9kZUlkTWFwID8/IHt9KS5tYXAocmVmTm9kZUlkID0+IGNhbnZhcy5ub2Rlcy5nZXQocmVmTm9kZUlkKSlcclxuICAgICAgLmZpbHRlcihub2RlID0+IG5vZGUgIT09IHVuZGVmaW5lZClcclxuICAgICAgLmZvckVhY2gobm9kZSA9PiBjYW52YXMucmVtb3ZlTm9kZShub2RlISkpXHJcblxyXG4gICAgT2JqZWN0LmtleXMobm9kZURhdGEucG9ydGFsSWRNYXBzPy5lZGdlSWRNYXAgPz8ge30pLm1hcChyZWZFZGdlSWQgPT4gY2FudmFzLmVkZ2VzLmdldChyZWZFZGdlSWQpKVxyXG4gICAgICAuZmlsdGVyKGVkZ2UgPT4gZWRnZSAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAuZm9yRWFjaChlZGdlID0+IGNhbnZhcy5yZW1vdmVFZGdlKGVkZ2UhKSlcclxuICB9XHJcblxyXG4gIHByaXZhdGUgb25FZGdlQ2hhbmdlZChfY2FudmFzOiBDYW52YXMsIGVkZ2U6IENhbnZhc0VkZ2UpIHtcclxuICAgIGNvbnN0IGlzVW5zYXZlZCA9IChlZGdlLmZyb20ubm9kZSAhPT0gdW5kZWZpbmVkICYmIGVkZ2UudG8ubm9kZSAhPT0gdW5kZWZpbmVkKSAmJiAvLyBFZGdlIG5vdCBmdWxseSBjb25uZWN0ZWRcclxuICAgICAgKGVkZ2UuZnJvbS5ub2RlLmdldERhdGEoKS5wb3J0YWxJZCAhPT0gdW5kZWZpbmVkICYmIGVkZ2UudG8ubm9kZS5nZXREYXRhKCkucG9ydGFsSWQgIT09IHVuZGVmaW5lZCkgJiYgLy8gQm90aCBub2RlcyBhcmUgZnJvbSBwb3J0YWxcclxuICAgICAgZWRnZS5nZXREYXRhKCkucG9ydGFsSWQgPT09IHVuZGVmaW5lZCAvLyBFZGdlIGlzIG5vdCBmcm9tIHBvcnRhbFxyXG5cclxuICAgIGVkZ2Uuc2V0RGF0YSh7XHJcbiAgICAgIC4uLmVkZ2UuZ2V0RGF0YSgpLCBcclxuICAgICAgaXNVbnNhdmVkOiBpc1Vuc2F2ZWQgPyB0cnVlIDogdW5kZWZpbmVkXHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBvbkNvbnRhaW5pbmdOb2Rlc1JlcXVlc3RlZChfY2FudmFzOiBDYW52YXMsIF9iYm94OiBCQm94LCBub2RlczogQ2FudmFzTm9kZVtdKSB7XHJcbiAgICAvLyBSZW1vdmUgbm9kZXMgZnJvbSBwb3J0YWxzIGZyb20gdGhlIGxpc3RcclxuICAgIG5vZGVzLnNwbGljZSgwLCBub2Rlcy5sZW5ndGgsIC4uLm5vZGVzLmZpbHRlcihub2RlID0+IG5vZGUuZ2V0RGF0YSgpLnBvcnRhbElkID09PSB1bmRlZmluZWQpKVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBvblNlbGVjdGlvbkNoYW5nZWQoY2FudmFzOiBDYW52YXMsIG9sZFNlbGVjdGlvbjogU2V0PENhbnZhc0VsZW1lbnQ+LCB1cGRhdGVTZWxlY3Rpb246ICh1cGRhdGU6ICgpID0+IHZvaWQpID0+IHZvaWQpIHtcclxuICAgIC8vIFVuc2VsZWN0IG5vZGVzIGZyb20gcG9ydGFsc1xyXG4gICAgdXBkYXRlU2VsZWN0aW9uKCgpID0+IHtcclxuICAgICAgY29uc3QgdXBkYXRlZFNlbGVjdGlvbiA9IEFycmF5LmZyb20oY2FudmFzLnNlbGVjdGlvbilcclxuICAgICAgICAuZmlsdGVyKG5vZGUgPT4gbm9kZS5nZXREYXRhKCkucG9ydGFsSWQgPT09IHVuZGVmaW5lZClcclxuICAgICAgY2FudmFzLnNlbGVjdGlvbiA9IG5ldyBTZXQodXBkYXRlZFNlbGVjdGlvbilcclxuICAgIH0pXHJcblxyXG4gICAgLy8gTW92ZSBwcmV2aW91c2x5IHNlbGVjdGVkIHBvcnRhbHMgdG8gdGhlIGJhY2tcclxuICAgIGNvbnN0IHByZXZpb3VzbHlTZWxlY3RlZFBvcnRhbE5vZGVzSWRzID0gQXJyYXkuZnJvbShvbGRTZWxlY3Rpb24pXHJcbiAgICAgIC5maWx0ZXIobm9kZSA9PiAobm9kZS5nZXREYXRhKCkgYXMgYW55KS5wb3J0YWxUb0ZpbGUgIT09IHVuZGVmaW5lZClcclxuICAgICAgLmZsYXRNYXAobm9kZSA9PiB7XHJcbiAgICAgICAgY29uc3QgcG9ydGFsTm9kZURhdGEgPSBub2RlLmdldERhdGEoKVxyXG4gICAgICAgIGNvbnN0IG5lc3RlZFBvcnRhbHNJZHMgPSB0aGlzLmdldE5lc3RlZFBvcnRhbHNJZHMoY2FudmFzLCBwb3J0YWxOb2RlRGF0YS5pZClcclxuXHJcbiAgICAgICAgcmV0dXJuIFtwb3J0YWxOb2RlRGF0YS5pZCwgLi4ubmVzdGVkUG9ydGFsc0lkc11cclxuICAgICAgfSlcclxuXHJcbiAgICBmb3IgKGNvbnN0IG5vZGUgb2YgY2FudmFzLm5vZGVzLnZhbHVlcygpKSB7XHJcbiAgICAgIGNvbnN0IG5vZGVEYXRhID0gbm9kZS5nZXREYXRhKClcclxuXHJcbiAgICAgIC8vIE5vdCBmcm9tIHVuc2VsZWN0ZWQgcG9ydGFsXHJcbiAgICAgIGlmIChub2RlRGF0YS5wb3J0YWxJZCA9PT0gdW5kZWZpbmVkIHx8ICFwcmV2aW91c2x5U2VsZWN0ZWRQb3J0YWxOb2Rlc0lkcy5pbmNsdWRlcyhub2RlRGF0YS5wb3J0YWxJZCkpIGNvbnRpbnVlXHJcblxyXG4gICAgICAvLyBNb3ZlIHRvIGZyb250XHJcbiAgICAgIG5vZGUudXBkYXRlWkluZGV4KClcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0TmVzdGVkUG9ydGFsc0lkcyhjYW52YXM6IENhbnZhcywgcG9ydGFsSWQ6IHN0cmluZyk6IHN0cmluZ1tdIHtcclxuICAgIGNvbnN0IG5lc3RlZFBvcnRhbHNJZHM6IHN0cmluZ1tdID0gW11cclxuXHJcbiAgICBmb3IgKGNvbnN0IG5vZGUgb2YgY2FudmFzLm5vZGVzLnZhbHVlcygpKSB7XHJcbiAgICAgIGNvbnN0IG5vZGVEYXRhID0gbm9kZS5nZXREYXRhKClcclxuXHJcbiAgICAgIGlmIChub2RlRGF0YS5wb3J0YWxJZCA9PT0gcG9ydGFsSWQpIHtcclxuICAgICAgICBuZXN0ZWRQb3J0YWxzSWRzLnB1c2gobm9kZURhdGEuaWQpXHJcbiAgICAgICAgbmVzdGVkUG9ydGFsc0lkcy5wdXNoKC4uLnRoaXMuZ2V0TmVzdGVkUG9ydGFsc0lkcyhjYW52YXMsIG5vZGVEYXRhLmlkKSlcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBuZXN0ZWRQb3J0YWxzSWRzXHJcbiAgfVxyXG5cclxuICByZXN0b3JlT2JqZWN0U25hcHBpbmdTdGF0ZTogKCkgPT4gdm9pZFxyXG4gIHByaXZhdGUgb25EcmFnZ2luZ1N0YXRlQ2hhbmdlZChjYW52YXM6IENhbnZhcywgc3RhcnRlZERyYWdnaW5nOiBib29sZWFuKSB7XHJcbiAgICAvLyBJZiBubyBvcGVuIHBvcnRhbCBnZXRzIGRyYWdnZWQsIHJldHVyblxyXG4gICAgaWYgKCFjYW52YXMuZ2V0U2VsZWN0aW9uRGF0YSgpLm5vZGVzLnNvbWUobm9kZSA9PiBub2RlLnR5cGUgPT09ICdmaWxlJyAmJiBub2RlLnBvcnRhbFRvRmlsZSkpIHJldHVyblxyXG5cclxuICAgIC8vIERpc2FibGUgb2JqZWN0IHNuYXBwaW5nIHRvIGZpeCBzZWxmLWFsaWduaW5nXHJcbiAgICBpZiAoc3RhcnRlZERyYWdnaW5nKSB7XHJcbiAgICAgIGNvbnN0IG9iamVjdFNuYXBwaW5nRW5hYmxlZCA9IGNhbnZhcy5vcHRpb25zLnNuYXBUb09iamVjdHNcclxuICAgICAgdGhpcy5yZXN0b3JlT2JqZWN0U25hcHBpbmdTdGF0ZSA9ICgpID0+IGNhbnZhcy50b2dnbGVPYmplY3RTbmFwcGluZyhvYmplY3RTbmFwcGluZ0VuYWJsZWQpXHJcblxyXG4gICAgICBpZiAob2JqZWN0U25hcHBpbmdFbmFibGVkKSBjYW52YXMudG9nZ2xlT2JqZWN0U25hcHBpbmcoZmFsc2UpXHJcbiAgICB9IGVsc2UgdGhpcy5yZXN0b3JlT2JqZWN0U25hcHBpbmdTdGF0ZT8uKClcclxuICB9XHJcblxyXG4gIHByaXZhdGUgb25Ob2RlTW92ZWQoY2FudmFzOiBDYW52YXMsIG5vZGU6IENhbnZhc05vZGUpIHtcclxuICAgIGNvbnN0IG5vZGVEYXRhID0gbm9kZS5nZXREYXRhKClcclxuICAgIGlmIChub2RlRGF0YS50eXBlICE9PSAnZmlsZScgfHwgIW5vZGVEYXRhLnBvcnRhbFRvRmlsZSkgcmV0dXJuXHJcblxyXG4gICAgdGhpcy5vbk9wZW5Qb3J0YWxNb3ZlZChjYW52YXMsIG5vZGUpXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG9uT3BlblBvcnRhbE1vdmVkKGNhbnZhczogQ2FudmFzLCBwb3J0YWxOb2RlOiBDYW52YXNOb2RlKSB7XHJcbiAgICBsZXQgcG9ydGFsTm9kZURhdGEgPSBwb3J0YWxOb2RlLmdldERhdGEoKVxyXG5cclxuICAgIC8vIFVwZGF0ZSBuZXN0ZWQgbm9kZXMgcG9zaXRpb25zXHJcbiAgICBjb25zdCBuZXN0ZWROb2Rlc0lkTWFwID0gcG9ydGFsTm9kZS5nZXREYXRhKCkucG9ydGFsSWRNYXBzPy5ub2RlSWRNYXBcclxuICAgIGlmICghbmVzdGVkTm9kZXNJZE1hcCkgcmV0dXJuXHJcblxyXG4gICAgY29uc3QgbmVzdGVkTm9kZXMgPSBPYmplY3Qua2V5cyhuZXN0ZWROb2Rlc0lkTWFwKS5tYXAocmVmTm9kZUlkID0+IGNhbnZhcy5ub2Rlcy5nZXQocmVmTm9kZUlkKSlcclxuICAgICAgLmZpbHRlcihub2RlID0+IG5vZGUgIT09IHVuZGVmaW5lZCkgYXMgQ2FudmFzTm9kZVtdXHJcbiAgICBjb25zdCBzb3VyY2VCQm94ID0gQ2FudmFzSGVscGVyLmdldEJCb3gobmVzdGVkTm9kZXMpXHJcblxyXG4gICAgLy8gUmVzaXplIHBvcnRhbFxyXG4gICAgY29uc3QgdGFyZ2V0U2l6ZSA9IHRoaXMuZ2V0UG9ydGFsU2l6ZShzb3VyY2VCQm94KVxyXG4gICAgaWYgKHBvcnRhbE5vZGVEYXRhLndpZHRoICE9PSB0YXJnZXRTaXplLndpZHRoIHx8IHBvcnRhbE5vZGVEYXRhLmhlaWdodCAhPT0gdGFyZ2V0U2l6ZS5oZWlnaHQpIHtcclxuICAgICAgcG9ydGFsTm9kZS5zZXREYXRhKHtcclxuICAgICAgICAuLi5wb3J0YWxOb2RlRGF0YSxcclxuICAgICAgICB3aWR0aDogdGFyZ2V0U2l6ZS53aWR0aCxcclxuICAgICAgICBoZWlnaHQ6IHRhcmdldFNpemUuaGVpZ2h0XHJcbiAgICAgIH0pXHJcblxyXG4gICAgICByZXR1cm5cclxuICAgIH1cclxuXHJcbiAgICAvLyBNb3ZlIG5lc3RlZCBub2Rlc1xyXG4gICAgY29uc3QgcG9ydGFsT2Zmc2V0ID0ge1xyXG4gICAgICB4OiBwb3J0YWxOb2RlRGF0YS54IC0gc291cmNlQkJveC5taW5YICsgUE9SVEFMX1BBRERJTkcsXHJcbiAgICAgIHk6IHBvcnRhbE5vZGVEYXRhLnkgLSBzb3VyY2VCQm94Lm1pblkgKyBQT1JUQUxfUEFERElOR1xyXG4gICAgfVxyXG5cclxuICAgIGZvciAoY29uc3QgbmVzdGVkTm9kZSBvZiBuZXN0ZWROb2Rlcykge1xyXG4gICAgICBjb25zdCBuZXN0ZWROb2RlRGF0YSA9IG5lc3RlZE5vZGUuZ2V0RGF0YSgpXHJcblxyXG4gICAgICBuZXN0ZWROb2RlLnNldERhdGEoe1xyXG4gICAgICAgIC4uLm5lc3RlZE5vZGVEYXRhLFxyXG4gICAgICAgIHg6IG5lc3RlZE5vZGVEYXRhLnggKyBwb3J0YWxPZmZzZXQueCxcclxuICAgICAgICB5OiBuZXN0ZWROb2RlRGF0YS55ICsgcG9ydGFsT2Zmc2V0LnlcclxuICAgICAgfSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgcmVtb3ZlUG9ydGFsQ2FudmFzRGF0YShfY2FudmFzOiBDYW52YXMsIGRhdGE6IENhbnZhc0RhdGEpIHtcclxuICAgIGRhdGEuZWRnZXMgPSBkYXRhLmVkZ2VzLmZpbHRlcihlZGdlRGF0YSA9PiB7XHJcbiAgICAgIGlmIChlZGdlRGF0YS5wb3J0YWxJZCAhPT0gdW5kZWZpbmVkKSByZXR1cm4gZmFsc2VcclxuXHJcbiAgICAgIGNvbnN0IGZyb21Ob2RlRGF0YSA9IGRhdGEubm9kZXMuZmluZChub2RlRGF0YSA9PiBub2RlRGF0YS5pZCA9PT0gZWRnZURhdGEuZnJvbU5vZGUpXHJcbiAgICAgIGNvbnN0IHRvTm9kZURhdGEgPSBkYXRhLm5vZGVzLmZpbmQobm9kZURhdGEgPT4gbm9kZURhdGEuaWQgPT09IGVkZ2VEYXRhLnRvTm9kZSlcclxuICAgICAgaWYgKCFmcm9tTm9kZURhdGEgfHwgIXRvTm9kZURhdGEpIHJldHVybiB0cnVlXHJcblxyXG4gICAgICBpZiAoZnJvbU5vZGVEYXRhLnBvcnRhbElkID09PSB1bmRlZmluZWQgJiYgdG9Ob2RlRGF0YS5wb3J0YWxJZCA9PT0gdW5kZWZpbmVkKSB7IC8vIE5vcm1hbCBlZGdlXHJcbiAgICAgICAgcmV0dXJuIHRydWUgXHJcbiAgICAgIH0gZWxzZSBpZiAoZnJvbU5vZGVEYXRhLnBvcnRhbElkICE9PSB1bmRlZmluZWQgJiYgdG9Ob2RlRGF0YS5wb3J0YWxJZCAhPT0gdW5kZWZpbmVkKSB7IC8vIENvbXBsZXRlbHkgZnJvbSBwb3J0YWxcclxuICAgICAgICAvLyBTYXZlIHRvIHBvcnRhbCBmaWxlPyBPUiBkZWxldGUhXHJcbiAgICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICAgIH0gZWxzZSB7IC8vIFBhcnRpYWxseSBmcm9tIHBvcnRhbFxyXG4gICAgICAgIGNvbnN0IGZyb21Qb3J0YWxOb2RlRGF0YSA9IGZyb21Ob2RlRGF0YS5wb3J0YWxJZCAhPT0gdW5kZWZpbmVkID8gZnJvbU5vZGVEYXRhIDogdG9Ob2RlRGF0YVxyXG4gICAgICAgIGNvbnN0IG5vdEZyb21Qb3J0YWxOb2RlRGF0YSA9IGZyb21Ob2RlRGF0YS5wb3J0YWxJZCAhPT0gdW5kZWZpbmVkID8gdG9Ob2RlRGF0YSA6IGZyb21Ob2RlRGF0YVxyXG5cclxuICAgICAgICBub3RGcm9tUG9ydGFsTm9kZURhdGEuZWRnZXNUb05vZGVGcm9tUG9ydGFsID0gbm90RnJvbVBvcnRhbE5vZGVEYXRhLmVkZ2VzVG9Ob2RlRnJvbVBvcnRhbCA/PyB7fVxyXG4gICAgICAgIG5vdEZyb21Qb3J0YWxOb2RlRGF0YS5lZGdlc1RvTm9kZUZyb21Qb3J0YWxbZnJvbVBvcnRhbE5vZGVEYXRhLnBvcnRhbElkIV0gPSBub3RGcm9tUG9ydGFsTm9kZURhdGEuZWRnZXNUb05vZGVGcm9tUG9ydGFsW2Zyb21Qb3J0YWxOb2RlRGF0YS5wb3J0YWxJZCFdID8/IFtdXHJcbiAgICAgICAgbm90RnJvbVBvcnRhbE5vZGVEYXRhLmVkZ2VzVG9Ob2RlRnJvbVBvcnRhbFtmcm9tUG9ydGFsTm9kZURhdGEucG9ydGFsSWQhXS5wdXNoKGVkZ2VEYXRhKVxyXG5cclxuICAgICAgICByZXR1cm4gZmFsc2VcclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICBkYXRhLm5vZGVzID0gZGF0YS5ub2Rlcy5maWx0ZXIobm9kZURhdGEgPT4gbm9kZURhdGEucG9ydGFsSWQgPT09IHVuZGVmaW5lZClcclxuXHJcbiAgICBmb3IgKGNvbnN0IHBvcnRhbE5vZGVEYXRhIG9mIGRhdGEubm9kZXMpIHtcclxuICAgICAgaWYgKHBvcnRhbE5vZGVEYXRhLnR5cGUgIT09ICdmaWxlJykgY29udGludWVcclxuXHJcbiAgICAgIC8vIFJlc2V0IHBvcnRhbCBzaXplXHJcbiAgICAgIGlmICh0aGlzLnBsdWdpbi5zZXR0aW5ncy5nZXRTZXR0aW5nKCdtYWludGFpbkNsb3NlZFBvcnRhbFNpemUnKSkge1xyXG4gICAgICAgIHBvcnRhbE5vZGVEYXRhLndpZHRoID0gcG9ydGFsTm9kZURhdGEuY2xvc2VkUG9ydGFsV2lkdGggPz8gcG9ydGFsTm9kZURhdGEud2lkdGhcclxuICAgICAgICBwb3J0YWxOb2RlRGF0YS5oZWlnaHQgPSBwb3J0YWxOb2RlRGF0YS5jbG9zZWRQb3J0YWxIZWlnaHQgPz8gcG9ydGFsTm9kZURhdGEuaGVpZ2h0XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFJlbW92ZSByZWZlcmVuY2VzIHRvIHBvcnRhbCBub2RlcyBhbmQgZWRnZXNcclxuICAgICAgZGVsZXRlIHBvcnRhbE5vZGVEYXRhLmNsb3NlZFBvcnRhbFdpZHRoXHJcbiAgICAgIGRlbGV0ZSBwb3J0YWxOb2RlRGF0YS5jbG9zZWRQb3J0YWxIZWlnaHRcclxuICAgICAgZGVsZXRlIHBvcnRhbE5vZGVEYXRhLnBvcnRhbElkTWFwc1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBnZXRDYW52YXNEYXRhV2l0aFBvcnRhbHMoY2FudmFzOiBDYW52YXMsIGRhdGFSZWY6IENhbnZhc0RhdGEpOiBQcm9taXNlPENhbnZhc0RhdGE+IHtcclxuICAgIC8vIERlZXAgY29weSBkYXRhIC0gSWYgYW5vdGhlciBmaWxlIGdldHMgb3BlbmVkIGluIHRoZSBzYW1lIHZpZXcsIHRoZSBkYXRhIHdvdWxkIGdldCBvdmVyd3JpdHRlblxyXG4gICAgY29uc3QgZGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YVJlZikpIGFzIENhbnZhc0RhdGFcclxuXHJcbiAgICAvLyBPcGVuIHBvcnRhbHNcclxuICAgIGNvbnN0IGFkZGVkRGF0YSA9IGF3YWl0IFByb21pc2UuYWxsKGRhdGEubm9kZXMubWFwKG5vZGVEYXRhID0+IHRoaXMudHJ5T3BlblBvcnRhbChjYW52YXMsIG5vZGVEYXRhKSkpXHJcbiAgICBmb3IgKGNvbnN0IG5ld0RhdGEgb2YgYWRkZWREYXRhKSB7XHJcbiAgICAgIGRhdGEubm9kZXMucHVzaCguLi5uZXdEYXRhLm5vZGVzKVxyXG4gICAgICBkYXRhLmVkZ2VzLnB1c2goLi4ubmV3RGF0YS5lZGdlcylcclxuICAgIH1cclxuXHJcbiAgICAvLyBBZGQgY3Jvc3MtcG9ydGFsIGVkZ2VzXHJcbiAgICBmb3IgKGNvbnN0IG9yaWdpbk5vZGVEYXRhIG9mIGRhdGEubm9kZXMpIHtcclxuICAgICAgaWYgKG9yaWdpbk5vZGVEYXRhLmVkZ2VzVG9Ob2RlRnJvbVBvcnRhbCA9PT0gdW5kZWZpbmVkKSBjb250aW51ZVxyXG5cclxuICAgICAgZm9yIChjb25zdCBbcmVsYXRpdmVQb3J0YWxJZCwgZWRnZXNdIG9mIE9iamVjdC5lbnRyaWVzKG9yaWdpbk5vZGVEYXRhLmVkZ2VzVG9Ob2RlRnJvbVBvcnRhbCkpIHtcclxuICAgICAgICBjb25zdCBpZFByZWZpeCA9IG9yaWdpbk5vZGVEYXRhLnBvcnRhbElkID8gYCR7b3JpZ2luTm9kZURhdGEucG9ydGFsSWR9LWAgOiAnJ1xyXG5cclxuICAgICAgICBjb25zdCBwb3J0YWxJZCA9IGAke2lkUHJlZml4fSR7cmVsYXRpdmVQb3J0YWxJZH1gXHJcbiAgICAgICAgY29uc3QgdGFyZ2V0UG9ydGFsRGF0YSA9IGRhdGEubm9kZXMuZmluZChub2RlRGF0YSA9PiBub2RlRGF0YS5pZCA9PT0gcG9ydGFsSWQpXHJcblxyXG4gICAgICAgIC8vIElmIHRhcmdldCBwb3J0YWwgaXMgZGVsZXRlZCwgcmVtb3ZlIGVkZ2VzXHJcbiAgICAgICAgaWYgKCF0YXJnZXRQb3J0YWxEYXRhKSB7XHJcbiAgICAgICAgICBkZWxldGUgb3JpZ2luTm9kZURhdGEuZWRnZXNUb05vZGVGcm9tUG9ydGFsIVtwb3J0YWxJZF1cclxuICAgICAgICAgIGNvbnRpbnVlXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBJZiBwb3J0YWwgaXMgb3BlbiwgYWRkIGVkZ2VzXHJcbiAgICAgICAgaWYgKHRhcmdldFBvcnRhbERhdGEucG9ydGFsVG9GaWxlKSB7XHJcbiAgICAgICAgICAvLyBQdXNoIGVkZ2VzIHdpdGggdXBkYXRlZCBmcm9tIGFuZCB0byBpZHNcclxuICAgICAgICAgIGRhdGEuZWRnZXMucHVzaCguLi5lZGdlcy5tYXAoZWRnZSA9PiAoe1xyXG4gICAgICAgICAgICAuLi5lZGdlLFxyXG4gICAgICAgICAgICBwb3J0YWxJZDogb3JpZ2luTm9kZURhdGEucG9ydGFsSWQsXHJcbiAgICAgICAgICAgIGZyb21Ob2RlOiBgJHtpZFByZWZpeH0ke2VkZ2UuZnJvbU5vZGV9YCxcclxuICAgICAgICAgICAgdG9Ob2RlOiBgJHtpZFByZWZpeH0ke2VkZ2UudG9Ob2RlfWBcclxuICAgICAgICAgIH0pKSlcclxuXHJcbiAgICAgICAgICBkZWxldGUgb3JpZ2luTm9kZURhdGEuZWRnZXNUb05vZGVGcm9tUG9ydGFsIVtwb3J0YWxJZF1cclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLmdldFNldHRpbmcoJ3Nob3dFZGdlc0ludG9EaXNhYmxlZFBvcnRhbHMnKSkge1xyXG4gICAgICAgICAgLy8gSWYgcG9ydGFsIGlzIGNsb3NlZCwgYWRkIGFsdGVybmF0aXZlIGVkZ2VzIGRpcmVjdGx5IHRvIHBvcnRhbFxyXG4gICAgICAgICAgLy8gQnV0IGRvbid0IGRlbGV0ZSB0aGUgZWRnZXNcclxuXHJcbiAgICAgICAgICBkYXRhLmVkZ2VzLnB1c2goLi4uZWRnZXMubWFwKGVkZ2UgPT4ge1xyXG4gICAgICAgICAgICAvLyBXaGljaCBlbmQgaXMgZnJvbSBwb3J0YWw/XHJcbiAgICAgICAgICAgIGNvbnN0IGZyb21Ob2RlSWQgPSBgJHtpZFByZWZpeH0ke2VkZ2UuZnJvbU5vZGV9YFxyXG4gICAgICAgICAgICBjb25zdCBmcm9tTm9kZSA9IGRhdGEubm9kZXMuZmluZChub2RlRGF0YSA9PiBub2RlRGF0YS5pZCA9PT0gZnJvbU5vZGVJZClcclxuICAgICAgICAgICAgY29uc3QgdG9Ob2RlSWQgPSBgJHtpZFByZWZpeH0ke2VkZ2UudG9Ob2RlfWBcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgLi4uZWRnZSxcclxuICAgICAgICAgICAgICBmcm9tTm9kZTogZnJvbU5vZGUgPyBmcm9tTm9kZUlkIDogcG9ydGFsSWQsXHJcbiAgICAgICAgICAgICAgdG9Ob2RlOiBmcm9tTm9kZSA/IHBvcnRhbElkIDogdG9Ob2RlSWQsXHJcbiAgICAgICAgICAgICAgcG9ydGFsSWQ6IHBvcnRhbElkIC8vIE1hcmsgaXQgYXMgdGVtcG9yYXJ5XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pKVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gSWYgbm8gbW9yZSBlZGdlcywgZGVsZXRlIHRoZSBwcm9wZXJ0eVxyXG4gICAgICBpZiAoT2JqZWN0LmtleXMob3JpZ2luTm9kZURhdGEuZWRnZXNUb05vZGVGcm9tUG9ydGFsISkubGVuZ3RoID09PSAwKVxyXG4gICAgICAgIGRlbGV0ZSBvcmlnaW5Ob2RlRGF0YS5lZGdlc1RvTm9kZUZyb21Qb3J0YWxcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZGF0YVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyB0cnlPcGVuUG9ydGFsKGNhbnZhczogQ2FudmFzLCBwb3J0YWxOb2RlRGF0YTogQ2FudmFzTm9kZURhdGEpOiBQcm9taXNlPENhbnZhc0RhdGE+IHtcclxuICAgIGNvbnN0IGFkZGVkRGF0YTogQ2FudmFzRGF0YSA9IHsgbm9kZXM6IFtdLCBlZGdlczogW10gfVxyXG4gICAgaWYgKHBvcnRhbE5vZGVEYXRhLnR5cGUgIT09ICdmaWxlJyB8fCAhcG9ydGFsTm9kZURhdGEucG9ydGFsVG9GaWxlKSByZXR1cm4gYWRkZWREYXRhXHJcblxyXG4gICAgLy8gVXBkYXRlIHBvcnRhbCBmaWxlXHJcbiAgICBwb3J0YWxOb2RlRGF0YS5wb3J0YWxUb0ZpbGUgPSBwb3J0YWxOb2RlRGF0YS5maWxlXHJcblxyXG4gICAgLy8gRml4IHJlY3Vyc2l2ZSBwb3J0YWxzXHJcbiAgICBpZiAocG9ydGFsTm9kZURhdGEucG9ydGFsVG9GaWxlID09PSBjYW52YXMudmlldy5maWxlLnBhdGgpIHtcclxuICAgICAgcG9ydGFsTm9kZURhdGEucG9ydGFsVG9GaWxlID0gdW5kZWZpbmVkXHJcbiAgICAgIHJldHVybiBhZGRlZERhdGFcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwb3J0YWxGaWxlID0gdGhpcy5wbHVnaW4uYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChwb3J0YWxOb2RlRGF0YS5maWxlISlcclxuICAgIGlmICghKHBvcnRhbEZpbGUgaW5zdGFuY2VvZiBURmlsZSkgfHwgcG9ydGFsRmlsZS5leHRlbnNpb24gIT09ICdjYW52YXMnKSB7XHJcbiAgICAgIHBvcnRhbE5vZGVEYXRhLnBvcnRhbFRvRmlsZSA9IHVuZGVmaW5lZFxyXG4gICAgICByZXR1cm4gYWRkZWREYXRhXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcG9ydGFsRmlsZURhdGEgPSBKU09OLnBhcnNlKGF3YWl0IHRoaXMucGx1Z2luLmFwcC52YXVsdC5jYWNoZWRSZWFkKHBvcnRhbEZpbGUpKVxyXG4gICAgaWYgKCFwb3J0YWxGaWxlRGF0YSkge1xyXG4gICAgICBwb3J0YWxOb2RlRGF0YS5wb3J0YWxUb0ZpbGUgPSB1bmRlZmluZWRcclxuICAgICAgcmV0dXJuIGFkZGVkRGF0YVxyXG4gICAgfVxyXG5cclxuICAgIC8vIEFkZCBwb3J0YWwgbm9kZXMgYW5kIGVkZ2VzIGlkIG1hcFxyXG4gICAgcG9ydGFsTm9kZURhdGEucG9ydGFsSWRNYXBzID0ge1xyXG4gICAgICBub2RlSWRNYXA6IHt9LFxyXG4gICAgICBlZGdlSWRNYXA6IHt9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2FsY3VsYXRlIG5lc3RlZCBub2RlIG9mZnNldFxyXG4gICAgY29uc3Qgc291cmNlTWluQ29vcmRpbmF0ZXMgPSBDYW52YXNIZWxwZXIuZ2V0QkJveChwb3J0YWxGaWxlRGF0YS5ub2RlcylcclxuICAgIGNvbnN0IHBvcnRhbE9mZnNldCA9IHtcclxuICAgICAgeDogcG9ydGFsTm9kZURhdGEueCAtIHNvdXJjZU1pbkNvb3JkaW5hdGVzLm1pblggKyBQT1JUQUxfUEFERElORyxcclxuICAgICAgeTogcG9ydGFsTm9kZURhdGEueSAtIHNvdXJjZU1pbkNvb3JkaW5hdGVzLm1pblkgKyBQT1JUQUxfUEFERElOR1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEFkZCBub2RlcyBmcm9tIHBvcnRhbFxyXG4gICAgZm9yIChjb25zdCBub2RlRGF0YUZyb21Qb3J0YWwgb2YgcG9ydGFsRmlsZURhdGEubm9kZXMpIHtcclxuICAgICAgY29uc3QgcmVmTm9kZUlkID0gYCR7cG9ydGFsTm9kZURhdGEuaWR9LSR7bm9kZURhdGFGcm9tUG9ydGFsLmlkfWBcclxuICAgICAgcG9ydGFsTm9kZURhdGEucG9ydGFsSWRNYXBzLm5vZGVJZE1hcFtyZWZOb2RlSWRdID0gbm9kZURhdGFGcm9tUG9ydGFsLmlkXHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBhZGRlZE5vZGUgPSB7XHJcbiAgICAgICAgLi4ubm9kZURhdGFGcm9tUG9ydGFsLFxyXG4gICAgICAgIGlkOiByZWZOb2RlSWQsXHJcbiAgICAgICAgeDogbm9kZURhdGFGcm9tUG9ydGFsLnggKyBwb3J0YWxPZmZzZXQueCxcclxuICAgICAgICB5OiBub2RlRGF0YUZyb21Qb3J0YWwueSArIHBvcnRhbE9mZnNldC55LFxyXG4gICAgICAgIHBvcnRhbElkOiBwb3J0YWxOb2RlRGF0YS5pZFxyXG4gICAgICB9XHJcblxyXG4gICAgICBhZGRlZERhdGEubm9kZXMucHVzaChhZGRlZE5vZGUpXHJcblxyXG4gICAgICBjb25zdCBuZXN0ZWROb2RlcyA9IGF3YWl0IHRoaXMudHJ5T3BlblBvcnRhbChjYW52YXMsIGFkZGVkTm9kZSlcclxuICAgICAgYWRkZWREYXRhLm5vZGVzLnB1c2goLi4ubmVzdGVkTm9kZXMubm9kZXMpXHJcbiAgICAgIGFkZGVkRGF0YS5lZGdlcy5wdXNoKC4uLm5lc3RlZE5vZGVzLmVkZ2VzKVxyXG4gICAgfVxyXG5cclxuICAgIC8vIEFkZCBlZGdlcyBmcm9tIHBvcnRhbFxyXG4gICAgZm9yIChjb25zdCBlZGdlRGF0YUZyb21Qb3J0YWwgb2YgcG9ydGFsRmlsZURhdGEuZWRnZXMpIHtcclxuICAgICAgY29uc3QgcmVmRWRnZUlkID0gYCR7cG9ydGFsTm9kZURhdGEuaWR9LSR7ZWRnZURhdGFGcm9tUG9ydGFsLmlkfWBcclxuICAgICAgcG9ydGFsTm9kZURhdGEucG9ydGFsSWRNYXBzLmVkZ2VJZE1hcFtyZWZFZGdlSWRdID0gZWRnZURhdGFGcm9tUG9ydGFsLmlkXHJcblxyXG4gICAgICBjb25zdCBmcm9tUmVmTm9kZSA9IE9iamVjdC5lbnRyaWVzKHBvcnRhbE5vZGVEYXRhLnBvcnRhbElkTWFwcy5ub2RlSWRNYXApXHJcbiAgICAgICAgLmZpbmQoKFtfcmVmTm9kZUlkLCBub2RlSWRdKSA9PiBub2RlSWQgPT09IGVkZ2VEYXRhRnJvbVBvcnRhbC5mcm9tTm9kZSk/LlswXVxyXG4gICAgICBjb25zdCB0b1JlZk5vZGUgPSBPYmplY3QuZW50cmllcyhwb3J0YWxOb2RlRGF0YS5wb3J0YWxJZE1hcHMubm9kZUlkTWFwKVxyXG4gICAgICAgIC5maW5kKChbX3JlZk5vZGVJZCwgbm9kZUlkXSkgPT4gbm9kZUlkID09PSBlZGdlRGF0YUZyb21Qb3J0YWwudG9Ob2RlKT8uWzBdXHJcblxyXG4gICAgICBhZGRlZERhdGEuZWRnZXMucHVzaCh7XHJcbiAgICAgICAgLi4uZWRnZURhdGFGcm9tUG9ydGFsLFxyXG4gICAgICAgIGlkOiByZWZFZGdlSWQsXHJcbiAgICAgICAgZnJvbU5vZGU6IGZyb21SZWZOb2RlLFxyXG4gICAgICAgIHRvTm9kZTogdG9SZWZOb2RlLFxyXG4gICAgICAgIHBvcnRhbElkOiBwb3J0YWxOb2RlRGF0YS5pZFxyXG4gICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFJlc2l6ZSBwb3J0YWxcclxuICAgIGNvbnN0IG5lc3RlZE5vZGVzQkJveCA9IENhbnZhc0hlbHBlci5nZXRCQm94KGFkZGVkRGF0YS5ub2RlcylcclxuICAgIGNvbnN0IHRhcmdldFNpemUgPSB0aGlzLmdldFBvcnRhbFNpemUobmVzdGVkTm9kZXNCQm94KVxyXG5cclxuICAgIC8vIFNhdmUgY2xvc2VkIHBvcnRhbCBzaXplXHJcbiAgICBwb3J0YWxOb2RlRGF0YS5jbG9zZWRQb3J0YWxXaWR0aCA9IHBvcnRhbE5vZGVEYXRhLndpZHRoXHJcbiAgICBwb3J0YWxOb2RlRGF0YS5jbG9zZWRQb3J0YWxIZWlnaHQgPSBwb3J0YWxOb2RlRGF0YS5oZWlnaHRcclxuXHJcbiAgICAvLyBTZXQgb3BlbiBwb3J0YWwgc2l6ZVxyXG4gICAgcG9ydGFsTm9kZURhdGEud2lkdGggPSB0YXJnZXRTaXplLndpZHRoXHJcbiAgICBwb3J0YWxOb2RlRGF0YS5oZWlnaHQgPSB0YXJnZXRTaXplLmhlaWdodFxyXG5cclxuICAgIHJldHVybiBhZGRlZERhdGFcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0UG9ydGFsU2l6ZShzb3VyY2VCQm94OiBCQm94KSB7XHJcbiAgICBjb25zdCBzb3VyY2VTaXplID0ge1xyXG4gICAgICB3aWR0aDogc291cmNlQkJveC5tYXhYIC0gc291cmNlQkJveC5taW5YLFxyXG4gICAgICBoZWlnaHQ6IHNvdXJjZUJCb3gubWF4WSAtIHNvdXJjZUJCb3gubWluWVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHRhcmdldFNpemUgPSB7XHJcbiAgICAgIHdpZHRoOiBNYXRoLm1heChzb3VyY2VTaXplLndpZHRoICsgUE9SVEFMX1BBRERJTkcgKiAyLCBNSU5fT1BFTl9QT1JUQUxfU0laRS53aWR0aCksXHJcbiAgICAgIGhlaWdodDogTWF0aC5tYXgoc291cmNlU2l6ZS5oZWlnaHQgKyBQT1JUQUxfUEFERElORyAqIDIsIE1JTl9PUEVOX1BPUlRBTF9TSVpFLmhlaWdodClcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIU51bWJlci5pc0Zpbml0ZSh0YXJnZXRTaXplLndpZHRoKSkgdGFyZ2V0U2l6ZS53aWR0aCA9IE1JTl9PUEVOX1BPUlRBTF9TSVpFLndpZHRoXHJcbiAgICBpZiAoIU51bWJlci5pc0Zpbml0ZSh0YXJnZXRTaXplLmhlaWdodCkpIHRhcmdldFNpemUuaGVpZ2h0ID0gTUlOX09QRU5fUE9SVEFMX1NJWkUuaGVpZ2h0XHJcblxyXG4gICAgcmV0dXJuIHRhcmdldFNpemVcclxuICB9XHJcbn0iLCAiaW1wb3J0IHsgYWRkSWNvbiB9IGZyb20gXCJvYnNpZGlhblwiXHJcblxyXG5jb25zdCBDVVNUT01fSUNPTlMgPSB7XHJcbiAgJ292YWwnOiBgPHJlY3Qgcng9XCIzMS4yNVwiIGhlaWdodD1cIjYyLjVcIiB3aWR0aD1cIjkzLjc1XCIgeT1cIjE4Ljc1XCIgeD1cIjMuMTI1XCIgc3Ryb2tlLXdpZHRoPVwiOC4zMzNcIiBzdHJva2U9XCJjdXJyZW50Q29sb3JcIiBmaWxsPVwidHJhbnNwYXJlbnRcIi8+YCxcclxuICAncGFyYWxsZWxvZ3JhbSc6IGA8cmVjdCB0cmFuc2Zvcm09XCJza2V3WCgtMjApXCIgcng9XCI1XCIgaGVpZ2h0PVwiNTBcIiB3aWR0aD1cIjcwXCIgeT1cIjI1XCIgeD1cIjM1XCIgc3Ryb2tlLXdpZHRoPVwiOC4zMzNcIiBzdHJva2U9XCJjdXJyZW50Q29sb3JcIiBmaWxsPVwidHJhbnNwYXJlbnRcIi8+YCxcclxuICAncHJlZGVmaW5lZC1wcm9jZXNzJzogYFxyXG4gICAgPGcgc3Ryb2tlLXdpZHRoPVwiMlwiIHN0cm9rZT1cImN1cnJlbnRDb2xvclwiIGZpbGw9XCJub25lXCIgdHJhbnNmb3JtPVwibWF0cml4KDQuMTY2NjY3LDAsMCw0LjE2NjY2NywwLDApXCI+XHJcbiAgICAgIDxwYXRoIGQ9XCJNIDQuOTk5Njg3IDMgTCAxOS4wMDAzMTIgMyBDIDIwLjEwNDY4OCAzIDIxIDMuODk1MzEyIDIxIDQuOTk5Njg3IEwgMjEgMTkuMDAwMzEyIEMgMjEgMjAuMTA0Njg4IDIwLjEwNDY4OCAyMSAxOS4wMDAzMTIgMjEgTCA0Ljk5OTY4NyAyMSBDIDMuODk1MzEyIDIxIDMgMjAuMTA0Njg4IDMgMTkuMDAwMzEyIEwgMyA0Ljk5OTY4NyBDIDMgMy44OTUzMTIgMy44OTUzMTIgMyA0Ljk5OTY4NyAzIFogTSA0Ljk5OTY4NyAzIFwiLz5cclxuICAgICAgPHBhdGggZD1cIk0gNyAzIEwgNyAyMSBcIi8+XHJcbiAgICAgIDxwYXRoIGQ9XCJNIDE3IDMgTCAxNyAyMSBcIi8+XHJcbiAgICA8L2c+XHJcbiAgYCxcclxuICAnZG9jdW1lbnQnOiBgPHBhdGggdHJhbnNmb3JtPVwidHJhbnNsYXRlKDAsIDUpXCIgc3Ryb2tlPVwiY3VycmVudENvbG9yXCIgZmlsbD1cIm5vbmVcIiBzdHJva2Utd2lkdGg9XCI4LjMzM1wiIGQ9XCJNODMuNzUgMjVDODUuODIgMjUgODcuNSAyNi42OCA4Ny41IDI4Ljc1TDg3LjUgNjQuMzc1UTY4Ljc1IDU0LjI1IDUwIDY0LjM3NSAzMS4yNSA3NC41IDEyLjUgNjQuMzc1TDEyLjUgMzAuNjI1IDEyLjUgMjguNzVDMTIuNSAyNi42OCAxNC4xOCAyNSAxNi4yNSAyNVpcIi8+YCxcclxuICAnZGF0YWJhc2Utc2hhcGUnOiBgXHJcbiAgICA8ZyB0cmFuc2Zvcm09XCJ0cmFuc2xhdGUoMjAsIDIwKVwiIHN0cm9rZS13aWR0aD1cIjguMzMzXCIgc3Ryb2tlPVwiY3VycmVudENvbG9yXCIgZmlsbD1cIm5vbmVcIj5cclxuICAgICAgPHBhdGggZD1cIk0gMSA1MSBMIDEgMTEgQyAxIDUuNDggMTQuNDMgMSAzMSAxIEMgNDcuNTcgMSA2MSA1LjQ4IDYxIDExIEwgNjEgNTEgQyA2MSA1Ni41MiA0Ny41NyA2MSAzMSA2MSBDIDE0LjQzIDYxIDEgNTYuNTIgMSA1MSBaXCIvPlxyXG4gICAgICA8cGF0aCBkPVwiTSAxIDExIEMgMSAxNi41MiAxNC40MyAyMSAzMSAyMSBDIDQ3LjU3IDIxIDYxIDE2LjUyIDYxIDExXCIvPlxyXG4gICAgPC9nPlxyXG4gIGAsXHJcbiAgJ2RvdHRlZC1saW5lJzogYDxwYXRoIHN0cm9rZT1cImN1cnJlbnRDb2xvclwiIGZpbGw9XCJub25lXCIgc3Ryb2tlLXdpZHRoPVwiOC41XCIgc3Ryb2tlLWRhc2hhcnJheT1cIjguNVwiIGQ9XCJNMjAuODUgNTBoNTguNVwiLz5gLFxyXG4gICdzaG9ydC1kYXNoZWQtbGluZSc6IGA8cGF0aCBzdHJva2U9XCJjdXJyZW50Q29sb3JcIiBmaWxsPVwibm9uZVwiIHN0cm9rZS13aWR0aD1cIjguNVwiIHN0cm9rZS1kYXNoYXJyYXk9XCIxMFwiIGQ9XCJNMjAuODUgNTBoNTguNVwiLz5gLFxyXG4gICdsb25nLWRhc2hlZC1saW5lJzogYDxwYXRoIHN0cm9rZT1cImN1cnJlbnRDb2xvclwiIGZpbGw9XCJub25lXCIgc3Ryb2tlLXdpZHRoPVwiOC41XCIgc3Ryb2tlLWRhc2hhcnJheT1cIjIwXCIgZD1cIk0yMC44NSA1MGg1OC41XCIvPmBcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSWNvbnNIZWxwZXIge1xyXG4gIHN0YXRpYyBhZGRJY29ucygpIHtcclxuICAgIGZvciAoY29uc3QgW2lkLCBzdmddIG9mIE9iamVjdC5lbnRyaWVzKENVU1RPTV9JQ09OUykpIHtcclxuICAgICAgYWRkSWNvbihpZCwgc3ZnKVxyXG4gICAgfVxyXG4gIH1cclxufSIsICJpbXBvcnQgeyBDYW52YXMsIENhbnZhc0VkZ2UsIENhbnZhc05vZGUgfSBmcm9tIFwic3JjL0B0eXBlcy9DYW52YXNcIlxyXG5pbXBvcnQgQWR2YW5jZWRDYW52YXNQbHVnaW4gZnJvbSBcInNyYy9tYWluXCJcclxuaW1wb3J0ICogYXMgQ2FudmFzSGVscGVyIGZyb20gXCJzcmMvdXRpbHMvY2FudmFzLWhlbHBlclwiXHJcbmltcG9ydCB7IENhbnZhc0V2ZW50IH0gZnJvbSBcInNyYy9jb3JlL2V2ZW50c1wiXHJcblxyXG5jb25zdCBJTUFHRV9GSUxFX0VYVEVOU0lPTlMgPSBbXCJibXBcIiwgXCJwbmdcIiwgXCJqcGdcIiwgXCJqcGVnXCIsIFwiZ2lmXCIsIFwic3ZnXCIsIFwid2VicFwiLCBcImF2aWZcIl1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFN0aWNrZXJzQ2FudmFzRXh0ZW5zaW9uIHtcclxuICBwbHVnaW46IEFkdmFuY2VkQ2FudmFzUGx1Z2luXHJcblxyXG4gIGNvbnN0cnVjdG9yKHBsdWdpbjogQWR2YW5jZWRDYW52YXNQbHVnaW4pIHtcclxuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luXHJcblxyXG4gICAgaWYgKCF0aGlzLnBsdWdpbi5zZXR0aW5ncy5nZXRTZXR0aW5nKCdzdGlja2Vyc0ZlYXR1cmVFbmFibGVkJykpIHJldHVyblxyXG5cclxuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQodGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5vbihcclxuICAgICAgQ2FudmFzRXZlbnQuUG9wdXBNZW51Q3JlYXRlZCxcclxuICAgICAgKGNhbnZhczogQ2FudmFzKSA9PiB0aGlzLm9uUG9wdXBNZW51Q3JlYXRlZChjYW52YXMpXHJcbiAgICApKVxyXG4gIH1cclxuXHJcbiAgb25Qb3B1cE1lbnVDcmVhdGVkKGNhbnZhczogQ2FudmFzKTogdm9pZCB7XHJcbiAgICAvLyBJZiB0aGUgY2FudmFzIGlzIHJlYWRvbmx5IG9yIHRoZXJlIGlzIG5vIHZhbGlkIHNoYXBlIGluIHRoZSBzZWxlY3Rpb24sIHJldHVyblxyXG4gICAgaWYgKGNhbnZhcy5yZWFkb25seSB8fCAhdGhpcy5oYXNWYWxpZE5vZGVJblNlbGVjdGlvbihjYW52YXMpKVxyXG4gICAgICByZXR1cm5cclxuXHJcbiAgICBDYW52YXNIZWxwZXIuYWRkUG9wdXBNZW51T3B0aW9uKFxyXG4gICAgICBjYW52YXMsXHJcbiAgICAgIENhbnZhc0hlbHBlci5jcmVhdGVQb3B1cE1lbnVPcHRpb24oe1xyXG4gICAgICAgIGlkOiAnc3RpY2tlci1vcHRpb24nLFxyXG4gICAgICAgIGxhYmVsOiAnVG9nZ2xlIHN0aWNrZXInLFxyXG4gICAgICAgIGljb246ICdiYWRnZScsIFxyXG4gICAgICAgIGNhbGxiYWNrOiAoKSA9PiB0aGlzLnRvZ2dsZVN0aWNrZXJGb3JTZWxlY3Rpb24oY2FudmFzKVxyXG4gICAgICB9KVxyXG4gICAgKVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBoYXNWYWxpZE5vZGVJblNlbGVjdGlvbihjYW52YXM6IENhbnZhcyk6IGJvb2xlYW4ge1xyXG4gICAgY29uc3Qgc2VsZWN0ZWROb2Rlc0RhdGEgPSBjYW52YXMuZ2V0U2VsZWN0aW9uRGF0YSgpLm5vZGVzXHJcblxyXG4gICAgZm9yIChjb25zdCBub2RlRGF0YSBvZiBzZWxlY3RlZE5vZGVzRGF0YSkge1xyXG4gICAgICBpZiAobm9kZURhdGEudHlwZSAhPT0gJ2ZpbGUnKSBjb250aW51ZVxyXG4gICAgICBcclxuICAgICAgY29uc3Qgbm9kZUZpbGVFeHRlbnNpb24gPSBub2RlRGF0YS5maWxlPy5zcGxpdCgnLicpLnBvcCgpPy50b0xvd2VyQ2FzZSgpXHJcbiAgICAgIGlmICghbm9kZUZpbGVFeHRlbnNpb24pIGNvbnRpbnVlXHJcbiAgICAgIGlmICghSU1BR0VfRklMRV9FWFRFTlNJT05TLmluY2x1ZGVzKG5vZGVGaWxlRXh0ZW5zaW9uKSkgY29udGludWVcclxuXHJcbiAgICAgIHJldHVybiB0cnVlXHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiBmYWxzZVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB0b2dnbGVTdGlja2VyRm9yU2VsZWN0aW9uKGNhbnZhczogQ2FudmFzKTogdm9pZCB7XHJcbiAgICBjb25zdCBzZWxlY3RlZE5vZGVzRGF0YSA9IGNhbnZhcy5nZXRTZWxlY3Rpb25EYXRhKCkubm9kZXNcclxuXHJcbiAgICBmb3IgKGNvbnN0IG5vZGVEYXRhIG9mIHNlbGVjdGVkTm9kZXNEYXRhKSB7XHJcbiAgICAgIGlmIChub2RlRGF0YS50eXBlICE9PSAnZmlsZScpIGNvbnRpbnVlXHJcblxyXG4gICAgICBjb25zdCBub2RlID0gY2FudmFzLm5vZGVzLmdldChub2RlRGF0YS5pZClcclxuICAgICAgaWYgKCFub2RlKSBjb250aW51ZVxyXG4gICAgICBcclxuICAgICAgY29uc3Qgd2FzU3RpY2tlciA9IG5vZGUuZ2V0RGF0YSgpLmlzU3RpY2tlclxyXG4gICAgICBub2RlLnNldERhdGEoeyAuLi5ub2RlRGF0YSwgaXNTdGlja2VyOiB3YXNTdGlja2VyID8gdW5kZWZpbmVkIDogdHJ1ZSB9KVxyXG4gICAgfVxyXG4gIH1cclxufSIsICJpbXBvcnQgeyBCQm94LCBQb3NpdGlvbiwgU2lkZSB9IGZyb20gXCJzcmMvQHR5cGVzL0NhbnZhc1wiXHJcbmltcG9ydCAqIGFzIEJCb3hIZWxwZXIgZnJvbSBcInNyYy91dGlscy9iYm94LWhlbHBlclwiXHJcblxyXG5jb25zdCBESVJFQ1RJT05TID0gW1xyXG4gIHsgZHg6IDEsIGR5OiAwIH0sIHsgZHg6IC0xLCBkeTogMCB9LCB7IGR4OiAwLCBkeTogMSB9LCB7IGR4OiAwLCBkeTogLTEgfSxcclxuICB7IGR4OiAxLCBkeTogMSB9LCB7IGR4OiAtMSwgZHk6IDEgfSwgeyBkeDogMSwgZHk6IC0xIH0sIHsgZHg6IC0xLCBkeTogLTEgfSxcclxuXSBhcyBjb25zdFxyXG5jb25zdCBESUFHT05BTF9DT1NUID0gTWF0aC5zcXJ0KDIpXHJcblxyXG5jbGFzcyBOb2RlIHtcclxuICB4OiBudW1iZXJcclxuICB5OiBudW1iZXJcclxuICBnQ29zdDogbnVtYmVyXHJcbiAgaENvc3Q6IG51bWJlclxyXG4gIGZDb3N0OiBudW1iZXJcclxuICBwYXJlbnQ6IE5vZGV8bnVsbFxyXG5cclxuICBjb25zdHJ1Y3Rvcih4OiBudW1iZXIsIHk6IG51bWJlcikge1xyXG4gICAgdGhpcy54ID0geFxyXG4gICAgdGhpcy55ID0geVxyXG5cclxuICAgIHRoaXMuZ0Nvc3QgPSAwXHJcbiAgICB0aGlzLmhDb3N0ID0gMFxyXG4gICAgdGhpcy5mQ29zdCA9IDBcclxuICAgIHRoaXMucGFyZW50ID0gbnVsbFxyXG4gIH1cclxuXHJcbiAgLy8gT25seSBjaGVjayBmb3IgeCBhbmQgeSwgbm90IGdDb3N0LCBoQ29zdCwgZkNvc3QsIG9yIHBhcmVudFxyXG4gIGluTGlzdChub2RlczogTm9kZVtdKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gbm9kZXMuc29tZShuID0+IG4ueCA9PT0gdGhpcy54ICYmIG4ueSA9PT0gdGhpcy55KVxyXG4gIH1cclxufVxyXG5cclxuLy8gTWFuaGF0dGFuIGRpc3RhbmNlXHJcbmZ1bmN0aW9uIGhldXJpc3RpYyhub2RlOiBOb2RlLCBlbmQ6IE5vZGUpOiBudW1iZXIge1xyXG4gIHJldHVybiBNYXRoLmFicyhub2RlLnggLSBlbmQueCkgKyBNYXRoLmFicyhub2RlLnkgLSBlbmQueSlcclxufVxyXG5cclxuLy8gRGVmaW5lIGEgZnVuY3Rpb24gdG8gY2hlY2sgaWYgYSBwb3NpdGlvbiBpc24ndCBpbnNpZGUgYW55IG9ic3RhY2xlXHJcbmZ1bmN0aW9uIGlzVG91Y2hpbmdPYnN0YWNsZShub2RlOiBQb3NpdGlvbiwgb2JzdGFjbGVzOiBCQm94W10pOiBib29sZWFuIHtcclxuICByZXR1cm4gb2JzdGFjbGVzLnNvbWUob2JzdGFjbGUgPT4gQkJveEhlbHBlci5pbnNpZGVCQm94KG5vZGUsIG9ic3RhY2xlLCB0cnVlKSlcclxufVxyXG5cclxuZnVuY3Rpb24gaXNJbnNpZGVPYnN0YWNsZShub2RlOiBQb3NpdGlvbiwgb2JzdGFjbGVzOiBCQm94W10pOiBib29sZWFuIHtcclxuICByZXR1cm4gb2JzdGFjbGVzLnNvbWUob2JzdGFjbGUgPT4gQkJveEhlbHBlci5pbnNpZGVCQm94KG5vZGUsIG9ic3RhY2xlLCBmYWxzZSkpXHJcbn1cclxuXHJcbi8vIERlZmluZSBhIGZ1bmN0aW9uIHRvIGNhbGN1bGF0ZSBtb3ZlbWVudCBjb3N0IGJhc2VkIG9uIGRpcmVjdGlvblxyXG5mdW5jdGlvbiBnZXRNb3ZlbWVudENvc3QoZGlyZWN0aW9uOiB7IGR4OiBudW1iZXI7IGR5OiBudW1iZXIgfSk6IG51bWJlciB7XHJcbiAgcmV0dXJuIGRpcmVjdGlvbi5keCAhPT0gMCAmJiBkaXJlY3Rpb24uZHkgIT09IDAgPyBESUFHT05BTF9DT1NUIDogMVxyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRQb3NzaWJsZU5laWdoYm9ycyhub2RlOiBOb2RlLCBvYnN0YWNsZXM6IEJCb3hbXSwgZ3JpZFJlc29sdXRpb246IG51bWJlcik6IE5vZGVbXSB7XHJcbiAgY29uc3QgbmVpZ2hib3JzOiBOb2RlW10gPSBbXVxyXG4gIFxyXG4gIGZvciAoY29uc3QgZGlyZWN0aW9uIG9mIERJUkVDVElPTlMpIHtcclxuICAgIGNvbnN0IG5laWdoYm9yID0gbmV3IE5vZGUoXHJcbiAgICAgIG5vZGUueCArIGRpcmVjdGlvbi5keCAqIGdyaWRSZXNvbHV0aW9uLCBcclxuICAgICAgbm9kZS55ICsgZGlyZWN0aW9uLmR5ICogZ3JpZFJlc29sdXRpb25cclxuICAgIClcclxuICAgIG5laWdoYm9yLmdDb3N0ID0gbm9kZS5nQ29zdCArIGdldE1vdmVtZW50Q29zdChkaXJlY3Rpb24pXHJcblxyXG4gICAgaWYgKGlzSW5zaWRlT2JzdGFjbGUobmVpZ2hib3IsIG9ic3RhY2xlcykpIGNvbnRpbnVlXHJcblxyXG4gICAgbmVpZ2hib3JzLnB1c2gobmVpZ2hib3IpXHJcbiAgfVxyXG5cclxuICByZXR1cm4gbmVpZ2hib3JzXHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJlY29uc3RydWN0UGF0aChub2RlOiBOb2RlKTogTm9kZVtdIHtcclxuICBjb25zdCBwYXRoOiBOb2RlW10gPSBbXVxyXG4gIHdoaWxlIChub2RlKSB7XHJcbiAgICBwYXRoLnB1c2gobm9kZSlcclxuICAgIG5vZGUgPSBub2RlLnBhcmVudCFcclxuICB9XHJcbiAgcmV0dXJuIHBhdGgucmV2ZXJzZSgpXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBhU3Rhcihmcm9tUG9zOiBQb3NpdGlvbiwgZnJvbVNpZGU6IFNpZGUsIHRvUG9zOiBQb3NpdGlvbiwgdG9TaWRlOiBTaWRlLCBvYnN0YWNsZXM6IEJCb3hbXSwgZ3JpZFJlc29sdXRpb246IG51bWJlcik6IFBvc2l0aW9uW10gfCBudWxsIHtcclxuICBjb25zdCBzdGFydDogTm9kZSA9IG5ldyBOb2RlKFxyXG4gICAgTWF0aC5mbG9vcihmcm9tUG9zLnggLyBncmlkUmVzb2x1dGlvbikgKiBncmlkUmVzb2x1dGlvbixcclxuICAgIE1hdGguZmxvb3IoZnJvbVBvcy55IC8gZ3JpZFJlc29sdXRpb24pICogZ3JpZFJlc29sdXRpb25cclxuICApXHJcbiAgLy8gUm91bmQgc3RhcnQgYW5kIGVuZCBwb3NpdGlvbnMgdG8gdGhlIG5lYXJlc3QgZ3JpZCBjZWxsIG91dHNpZGUgb2YgdGhlIG5vZGVzIHRvIGNvbm5lY3RcclxuICBpZiAoZnJvbVNpZGUgPT09ICdyaWdodCcgJiYgZnJvbVBvcy54ICE9PSBzdGFydC54KSBzdGFydC54ICs9IGdyaWRSZXNvbHV0aW9uXHJcbiAgaWYgKGZyb21TaWRlID09PSAnYm90dG9tJyAmJiBmcm9tUG9zLnkgIT09IHN0YXJ0LnkpIHN0YXJ0LnkgKz0gZ3JpZFJlc29sdXRpb25cclxuXHJcbiAgY29uc3QgZW5kOiBOb2RlID0gbmV3IE5vZGUoXHJcbiAgICBNYXRoLmZsb29yKHRvUG9zLnggLyBncmlkUmVzb2x1dGlvbikgKiBncmlkUmVzb2x1dGlvbixcclxuICAgIE1hdGguZmxvb3IodG9Qb3MueSAvIGdyaWRSZXNvbHV0aW9uKSAqIGdyaWRSZXNvbHV0aW9uXHJcbiAgKVxyXG4gIC8vIFJvdW5kIHN0YXJ0IGFuZCBlbmQgcG9zaXRpb25zIHRvIHRoZSBuZWFyZXN0IGdyaWQgY2VsbCBvdXRzaWRlIG9mIHRoZSBub2RlcyB0byBjb25uZWN0XHJcbiAgaWYgKHRvU2lkZSA9PT0gJ3JpZ2h0JyAmJiB0b1Bvcy54ICE9PSBlbmQueCkgZW5kLnggKz0gZ3JpZFJlc29sdXRpb25cclxuICBpZiAodG9TaWRlID09PSAnYm90dG9tJyAmJiB0b1Bvcy55ICE9PSBlbmQueSkgZW5kLnkgKz0gZ3JpZFJlc29sdXRpb25cclxuICBcclxuICAvLyBDaGVjayBpZiBzdGFydCBhbmQgZW5kIHBvc2l0aW9ucyBhcmUgdmFsaWRcclxuICBpZiAoaXNJbnNpZGVPYnN0YWNsZShzdGFydCwgb2JzdGFjbGVzKSB8fCBpc0luc2lkZU9ic3RhY2xlKGVuZCwgb2JzdGFjbGVzKSkgcmV0dXJuIG51bGxcclxuXHJcbiAgY29uc3Qgb3BlblNldDogTm9kZVtdID0gW3N0YXJ0XVxyXG4gIGNvbnN0IGNsb3NlZFNldDogTm9kZVtdID0gW11cclxuXHJcbiAgd2hpbGUgKG9wZW5TZXQubGVuZ3RoID4gMCkge1xyXG4gICAgLy8gRmluZCB0aGUgbm9kZSB3aXRoIHRoZSBsb3dlc3QgZkNvc3QgaW4gdGhlIG9wZW4gc2V0XHJcbiAgICBsZXQgY3VycmVudDogTm9kZXxudWxsID0gbnVsbFxyXG4gICAgbGV0IGxvd2VzdEZDb3N0ID0gSW5maW5pdHlcclxuXHJcbiAgICBmb3IgKGNvbnN0IG5vZGUgb2Ygb3BlblNldCkge1xyXG4gICAgICBpZiAobm9kZS5mQ29zdCA8IGxvd2VzdEZDb3N0KSB7XHJcbiAgICAgICAgY3VycmVudCA9IG5vZGVcclxuICAgICAgICBsb3dlc3RGQ29zdCA9IG5vZGUuZkNvc3RcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIE5vIHBhdGggZm91bmRcclxuICAgIGlmICghY3VycmVudCkgcmV0dXJuIG51bGxcclxuXHJcbiAgICAvLyBSZW1vdmUgdGhlIGN1cnJlbnQgbm9kZSBmcm9tIHRoZSBvcGVuIHNldCBhbmQgYWRkIGl0IHRvIHRoZSBjbG9zZWQgc2V0XHJcbiAgICBvcGVuU2V0LnNwbGljZShvcGVuU2V0LmluZGV4T2YoY3VycmVudCksIDEpXHJcbiAgICBjbG9zZWRTZXQucHVzaChjdXJyZW50KVxyXG5cclxuICAgIC8vIENoZWNrIGlmIHdlIGhhdmUgcmVhY2hlZCB0aGUgZW5kXHJcbiAgICBpZiAoY3VycmVudC54ID09PSBlbmQueCAmJiBjdXJyZW50LnkgPT09IGVuZC55KSB7XHJcbiAgICAgIHJldHVybiBbZnJvbVBvcywgLi4ucmVjb25zdHJ1Y3RQYXRoKGN1cnJlbnQpLCB0b1Bvc10ubWFwKG5vZGUgPT4gKHsgeDogbm9kZS54LCB5OiBub2RlLnkgfSkpXHJcbiAgICB9XHJcblxyXG4gICAgLy8gTG9jYXRpb24gaXMgbm90IHN0YXJ0IG9yIGVuZCwgYWxsIHRvdWNoaW5nIHBvc2l0aW9ucyBhcmUgaW52YWxpZFxyXG4gICAgaWYgKCEoY3VycmVudC54ID09PSBzdGFydC54ICYmIGN1cnJlbnQueSA9PT0gc3RhcnQueSkgJiYgaXNUb3VjaGluZ09ic3RhY2xlKGN1cnJlbnQsIG9ic3RhY2xlcykpIGNvbnRpbnVlXHJcblxyXG4gICAgLy8gRXhwYW5kIG5laWdoYm9yc1xyXG4gICAgZm9yIChjb25zdCBuZWlnaGJvciBvZiBnZXRQb3NzaWJsZU5laWdoYm9ycyhjdXJyZW50LCBvYnN0YWNsZXMsIGdyaWRSZXNvbHV0aW9uKSkge1xyXG4gICAgICBpZiAobmVpZ2hib3IuaW5MaXN0KGNsb3NlZFNldCkpIGNvbnRpbnVlXHJcblxyXG4gICAgICAvLyBDYWxjdWxhdGUgdGVudGF0aXZlIGdDb3N0XHJcbiAgICAgIGNvbnN0IHRlbnRhdGl2ZUdDb3N0ID0gY3VycmVudC5nQ29zdCArIGdldE1vdmVtZW50Q29zdCh7XHJcbiAgICAgICAgZHg6IG5laWdoYm9yLnggLSBjdXJyZW50LngsXHJcbiAgICAgICAgZHk6IG5laWdoYm9yLnkgLSBjdXJyZW50LnksXHJcbiAgICAgIH0pXHJcblxyXG4gICAgICAvLyBDaGVjayBpZiBuZWlnaGJvciBpcyBub3QgYWxyZWFkeSBpbiB0aGUgb3BlbiBzZXQgb3IgaWYgdGhlIG5ldyBnQ29zdCBpcyBsb3dlclxyXG4gICAgICBpZiAoIW5laWdoYm9yLmluTGlzdChvcGVuU2V0KSB8fCB0ZW50YXRpdmVHQ29zdCA8IG5laWdoYm9yLmdDb3N0KSB7XHJcbiAgICAgICAgbmVpZ2hib3IucGFyZW50ID0gY3VycmVudFxyXG4gICAgICAgIG5laWdoYm9yLmdDb3N0ID0gdGVudGF0aXZlR0Nvc3RcclxuICAgICAgICBuZWlnaGJvci5oQ29zdCA9IGhldXJpc3RpYyhuZWlnaGJvciwgZW5kKVxyXG4gICAgICAgIG5laWdoYm9yLmZDb3N0ID0gbmVpZ2hib3IuZ0Nvc3QgKyBuZWlnaGJvci5oQ29zdFxyXG5cclxuICAgICAgICAvLyBBZGQgbmVpZ2hib3IgdG8gdGhlIG9wZW4gc2V0XHJcbiAgICAgICAgb3BlblNldC5wdXNoKG5laWdoYm9yKVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBObyBwYXRoIGZvdW5kXHJcbiAgcmV0dXJuIG51bGxcclxufSIsICJpbXBvcnQgeyBQb3NpdGlvbiB9IGZyb20gXCJzcmMvQHR5cGVzL0NhbnZhc1wiXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcGF0aEFycmF5VG9TdmdQYXRoKHBvc2l0aW9uczogUG9zaXRpb25bXSwgcm91bmRlZCA9IGZhbHNlKTogc3RyaW5nIHtcclxuICBjb25zdCB0ZW5zaW9uID0gMC4yXHJcbiAgbGV0IG5ld1Bvc2l0aW9ucyA9IFsuLi5wb3NpdGlvbnNdXHJcblxyXG4gIGlmIChyb3VuZGVkICYmIHBvc2l0aW9ucy5sZW5ndGggPiAyKSB7XHJcbiAgICBuZXdQb3NpdGlvbnMgPSBbcG9zaXRpb25zWzBdXVxyXG5cclxuICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcG9zaXRpb25zLmxlbmd0aCAtIDI7IGkrKykge1xyXG4gICAgICBjb25zdCBwMSA9IHBvc2l0aW9uc1tpXVxyXG4gICAgICBjb25zdCBwMiA9IHBvc2l0aW9uc1tpICsgMV1cclxuICAgICAgY29uc3QgcDMgPSBwb3NpdGlvbnNbaSArIDJdXHJcblxyXG4gICAgICBjb25zdCB0MSA9ICgxIC0gdGVuc2lvbikgLyAyXHJcbiAgICAgIGNvbnN0IHQyID0gMSAtIHQxXHJcblxyXG4gICAgICBjb25zdCB4ID1cclxuICAgICAgICB0MiAqIHQyICogdDIgKiBwMS54ICtcclxuICAgICAgICAzICogdDIgKiB0MiAqIHQxICogcDIueCArXHJcbiAgICAgICAgMyAqIHQyICogdDEgKiB0MSAqIHAzLnggK1xyXG4gICAgICAgIHQxICogdDEgKiB0MSAqIHAyLnhcclxuXHJcbiAgICAgIGNvbnN0IHkgPVxyXG4gICAgICAgIHQyICogdDIgKiB0MiAqIHAxLnkgK1xyXG4gICAgICAgIDMgKiB0MiAqIHQyICogdDEgKiBwMi55ICtcclxuICAgICAgICAzICogdDIgKiB0MSAqIHQxICogcDMueSArXHJcbiAgICAgICAgdDEgKiB0MSAqIHQxICogcDIueVxyXG5cclxuICAgICAgbmV3UG9zaXRpb25zLnB1c2goeyB4OiB4LCB5OiB5IH0pXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbGFzdFBvaW50ID0gcG9zaXRpb25zW3Bvc2l0aW9ucy5sZW5ndGggLSAxXVxyXG4gICAgbmV3UG9zaXRpb25zLnB1c2gobGFzdFBvaW50KVxyXG4gIH1cclxuICAgIFxyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbmV3UG9zaXRpb25zLmxlbmd0aCAtIDI7IGkrKykge1xyXG4gICAgY29uc3QgcDEgPSBuZXdQb3NpdGlvbnNbaV1cclxuICAgIGNvbnN0IHAyID0gbmV3UG9zaXRpb25zW2kgKyAxXVxyXG4gICAgY29uc3QgcDMgPSBuZXdQb3NpdGlvbnNbaSArIDJdXHJcblxyXG4gICAgY29uc3QgY3VycmVudERpcmVjdGlvbiA9IHtcclxuICAgICAgeDogcDIueCAtIHAxLngsXHJcbiAgICAgIHk6IHAyLnkgLSBwMS55XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbmV4dERpcmVjdGlvbiA9IHtcclxuICAgICAgeDogcDMueCAtIHAyLngsXHJcbiAgICAgIHk6IHAzLnkgLSBwMi55XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGN1cnJlbnREaXJlY3Rpb24ueCAhPT0gbmV4dERpcmVjdGlvbi54ICYmIGN1cnJlbnREaXJlY3Rpb24ueSAhPT0gbmV4dERpcmVjdGlvbi55KSBjb250aW51ZVxyXG5cclxuICAgIG5ld1Bvc2l0aW9ucy5zcGxpY2UoaSArIDEsIDEpXHJcbiAgICBpLS1cclxuICB9XHJcblxyXG4gIHJldHVybiBuZXdQb3NpdGlvbnMubWFwKChwb3NpdGlvbiwgaW5kZXgpID0+IFxyXG4gICAgYCR7aW5kZXggPT09IDAgPyAnTScgOiAnTCd9ICR7cG9zaXRpb24ueH0gJHtwb3NpdGlvbi55fWBcclxuICApLmpvaW4oJyAnKVxyXG59IiwgImltcG9ydCB7IENhbnZhcywgQ2FudmFzRWRnZSwgQ2FudmFzTm9kZSwgUG9zaXRpb24gfSBmcm9tIFwic3JjL0B0eXBlcy9DYW52YXNcIlxyXG5pbXBvcnQgQWR2YW5jZWRDYW52YXNQbHVnaW4gZnJvbSBcInNyYy9tYWluXCJcclxuaW1wb3J0ICogYXMgQ2FudmFzSGVscGVyIGZyb20gXCJzcmMvdXRpbHMvY2FudmFzLWhlbHBlclwiXHJcbmltcG9ydCAqIGFzIEFTdGFySGVscGVyIGZyb20gXCJzcmMvdXRpbHMvYS1zdGFyLWhlbHBlclwiXHJcbmltcG9ydCAqIGFzIFN2Z1BhdGhIZWxwZXIgZnJvbSBcInNyYy91dGlscy9zdmctcGF0aC1oZWxwZXJcIlxyXG5pbXBvcnQgeyBDYW52YXNFdmVudCB9IGZyb20gXCJzcmMvY29yZS9ldmVudHNcIlxyXG5pbXBvcnQgKiBhcyBCQm94SGVscGVyIGZyb20gXCJzcmMvdXRpbHMvYmJveC1oZWxwZXJcIlxyXG5cclxuY29uc3QgU1RZTEVTX01FTlVfT1BUSU9OUzogQ2FudmFzSGVscGVyLk1lbnVPcHRpb25bXSA9IFtcclxuICB7XHJcbiAgICBpZDogdW5kZWZpbmVkLFxyXG4gICAgbGFiZWw6ICdEZWZhdWx0JyxcclxuICAgIGljb246ICdtaW51cydcclxuICB9LFxyXG4gIHtcclxuICAgIGlkOiAnbG9uZy1kYXNoZWQnLFxyXG4gICAgbGFiZWw6ICdEYXNoZWQgKGxvbmcpJyxcclxuICAgIGljb246ICdsb25nLWRhc2hlZC1saW5lJ1xyXG4gIH0sXHJcbiAge1xyXG4gICAgaWQ6ICdzaG9ydC1kYXNoZWQnLFxyXG4gICAgbGFiZWw6ICdEYXNoZWQnLFxyXG4gICAgaWNvbjogJ3Nob3J0LWRhc2hlZC1saW5lJ1xyXG4gIH0sXHJcbiAge1xyXG4gICAgaWQ6ICdkb3R0ZWQnLFxyXG4gICAgbGFiZWw6ICdEb3R0ZWQnLFxyXG4gICAgaWNvbjogJ2RvdHRlZC1saW5lJ1xyXG4gIH1cclxuXVxyXG5cclxuY29uc3QgUk9VVEVTX01FTlVfT1BUSU9OUzogQ2FudmFzSGVscGVyLk1lbnVPcHRpb25bXSA9IFtcclxuICB7XHJcbiAgICBpZDogdW5kZWZpbmVkLFxyXG4gICAgbGFiZWw6ICdEZWZhdWx0JyxcclxuICAgIGljb246ICdyb3V0ZSdcclxuICB9LFxyXG4gIHtcclxuICAgIGlkOiAnZGlyZWN0JyxcclxuICAgIGxhYmVsOiAnRGlyZWN0JyxcclxuICAgIGljb246ICdtaW51cydcclxuICB9LFxyXG4gIHtcclxuICAgIGlkOiAnc3F1YXJlJyxcclxuICAgIGxhYmVsOiAnU3F1YXJlJyxcclxuICAgIGljb246ICdjb3JuZXItZG93bi1yaWdodCdcclxuICB9LFxyXG4gIHtcclxuICAgIGlkOiAnYS1zdGFyJyxcclxuICAgIGxhYmVsOiAnQSonLFxyXG4gICAgaWNvbjogJ25hdmlnYXRpb24nXHJcbiAgfVxyXG5dXHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBFZGdlc1N0eWxlQ2FudmFzRXh0ZW5zaW9uIHtcclxuICBwbHVnaW46IEFkdmFuY2VkQ2FudmFzUGx1Z2luXHJcblxyXG4gIGNvbnN0cnVjdG9yKHBsdWdpbjogQWR2YW5jZWRDYW52YXNQbHVnaW4pIHtcclxuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luXHJcblxyXG4gICAgaWYgKCF0aGlzLnBsdWdpbi5zZXR0aW5ncy5nZXRTZXR0aW5nKCdlZGdlc1N0eWxpbmdGZWF0dXJlRW5hYmxlZCcpKSByZXR1cm5cclxuXHJcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2Uub24oXHJcbiAgICAgIENhbnZhc0V2ZW50LlBvcHVwTWVudUNyZWF0ZWQsXHJcbiAgICAgIChjYW52YXM6IENhbnZhcykgPT4gdGhpcy5vblBvcHVwTWVudUNyZWF0ZWQoY2FudmFzKVxyXG4gICAgKSlcclxuXHJcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2Uub24oXHJcbiAgICAgIENhbnZhc0V2ZW50LkVkZ2VDaGFuZ2VkLFxyXG4gICAgICAoY2FudmFzOiBDYW52YXMsIGVkZ2U6IENhbnZhc0VkZ2UpID0+IHRoaXMub25FZGdlQ2hhbmdlZChjYW52YXMsIGVkZ2UpXHJcbiAgICApKVxyXG5cclxuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQodGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5vbihcclxuICAgICAgQ2FudmFzRXZlbnQuRWRnZUNlbnRlclJlcXVlc3RlZCxcclxuICAgICAgKGNhbnZhczogQ2FudmFzLCBlZGdlOiBDYW52YXNFZGdlLCBjZW50ZXI6IFBvc2l0aW9uKSA9PiB0aGlzLm9uRWRnZUNlbnRlclJlcXVlc3RlZChjYW52YXMsIGVkZ2UsIGNlbnRlcilcclxuICAgICkpXHJcblxyXG4gICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudCh0aGlzLnBsdWdpbi5hcHAud29ya3NwYWNlLm9uKFxyXG4gICAgICBDYW52YXNFdmVudC5Ob2RlQWRkZWQsXHJcbiAgICAgIChjYW52YXM6IENhbnZhcywgX25vZGU6IENhbnZhc05vZGUpID0+IHRoaXMudXBkYXRlQWxsRWRnZXMoY2FudmFzKVxyXG4gICAgKSlcclxuXHJcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2Uub24oXHJcbiAgICAgIENhbnZhc0V2ZW50Lk5vZGVSZW1vdmVkLFxyXG4gICAgICAoY2FudmFzOiBDYW52YXMsIF9ub2RlOiBDYW52YXNOb2RlKSA9PiB0aGlzLnVwZGF0ZUFsbEVkZ2VzKGNhbnZhcylcclxuICAgICkpXHJcblxyXG4gICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudCh0aGlzLnBsdWdpbi5hcHAud29ya3NwYWNlLm9uKFxyXG4gICAgICBDYW52YXNFdmVudC5EcmFnZ2luZ1N0YXRlQ2hhbmdlZCxcclxuICAgICAgKGNhbnZhczogQ2FudmFzLCBpc0RyYWdnaW5nOiBib29sZWFuKSA9PiB7XHJcbiAgICAgICAgaWYgKCFpc0RyYWdnaW5nKSB0aGlzLnVwZGF0ZUFsbEVkZ2VzKGNhbnZhcylcclxuICAgICAgfVxyXG4gICAgKSlcclxuICB9XHJcblxyXG4gIG9uUG9wdXBNZW51Q3JlYXRlZChjYW52YXM6IENhbnZhcyk6IHZvaWQge1xyXG4gICAgLy8gSWYgdGhlIGNhbnZhcyBpcyByZWFkb25seSBvciB0aGVyZSBpcyBubyBlZGdlIGluIHRoZSBzZWxlY3Rpb24sIHJldHVyblxyXG4gICAgY29uc3Qgc2VsZWN0ZWRFZGdlcyA9IFsuLi5jYW52YXMuc2VsZWN0aW9uXS5maWx0ZXIoKGl0ZW06IGFueSkgPT4gaXRlbS5wYXRoICE9PSB1bmRlZmluZWQpIGFzIENhbnZhc0VkZ2VbXVxyXG4gICAgaWYgKGNhbnZhcy5yZWFkb25seSB8fCBzZWxlY3RlZEVkZ2VzLmxlbmd0aCA9PT0gMClcclxuICAgICAgcmV0dXJuXHJcblxyXG4gICAgLy8gUGF0aCBzdHlsZXNcclxuICAgIGNvbnN0IHBhdGhTdHlsZU5lc3RlZE9wdGlvbnMgPSBTVFlMRVNfTUVOVV9PUFRJT05TLm1hcCgoc3R5bGUpID0+ICh7XHJcbiAgICAgIC4uLnN0eWxlLFxyXG4gICAgICBpZDogdW5kZWZpbmVkLFxyXG4gICAgICBjYWxsYmFjazogKCkgPT4gdGhpcy5zZXRTdHlsZUZvclNlbGVjdGlvbihjYW52YXMsIHNlbGVjdGVkRWRnZXMsIHN0eWxlLmlkKVxyXG4gICAgfSkpXHJcblxyXG4gICAgY29uc3QgcGF0aFN0eWxlTWVudU9wdGlvbiA9IENhbnZhc0hlbHBlci5jcmVhdGVFeHBhbmRhYmxlUG9wdXBNZW51T3B0aW9uKHtcclxuICAgICAgaWQ6ICdlZGdlLXN0eWxlLW9wdGlvbicsXHJcbiAgICAgIGxhYmVsOiAnRWRnZSBzdHlsZScsXHJcbiAgICAgIGljb246ICdtaW51cycsXHJcbiAgICB9LCBwYXRoU3R5bGVOZXN0ZWRPcHRpb25zKVxyXG5cclxuICAgIC8vIEFkZCBtZW51IG9wdGlvbiB0byBtZW51IGJhclxyXG4gICAgQ2FudmFzSGVscGVyLmFkZFBvcHVwTWVudU9wdGlvbihjYW52YXMsIHBhdGhTdHlsZU1lbnVPcHRpb24sIC0yKVxyXG5cclxuICAgIGNvbnN0IHBhdGhSb3V0ZU5lc3RlZE9wdGlvbnMgPSBST1VURVNfTUVOVV9PUFRJT05TLm1hcCgocm91dGUpID0+ICh7XHJcbiAgICAgIC4uLnJvdXRlLFxyXG4gICAgICBpZDogdW5kZWZpbmVkLFxyXG4gICAgICBjYWxsYmFjazogKCkgPT4gdGhpcy5zZXRQYXRoUm91dGVGb3JTZWxlY3Rpb24oY2FudmFzLCBzZWxlY3RlZEVkZ2VzLCByb3V0ZS5pZClcclxuICAgIH0pKVxyXG5cclxuICAgIGNvbnN0IHBhdGhSb3V0ZU1lbnVPcHRpb24gPSBDYW52YXNIZWxwZXIuY3JlYXRlRXhwYW5kYWJsZVBvcHVwTWVudU9wdGlvbih7XHJcbiAgICAgIGlkOiAnZWRnZS1wYXRoLXJvdXRlLW9wdGlvbicsXHJcbiAgICAgIGxhYmVsOiAnRWRnZSBwYXRoIHJvdXRlJyxcclxuICAgICAgaWNvbjogJ3JvdXRlJyxcclxuICAgIH0sIHBhdGhSb3V0ZU5lc3RlZE9wdGlvbnMpXHJcblxyXG4gICAgLy8gQWRkIG1lbnUgb3B0aW9uIHRvIG1lbnUgYmFyXHJcbiAgICBDYW52YXNIZWxwZXIuYWRkUG9wdXBNZW51T3B0aW9uKGNhbnZhcywgcGF0aFJvdXRlTWVudU9wdGlvbiwgLTIpXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNldFN0eWxlRm9yU2VsZWN0aW9uKF9jYW52YXM6IENhbnZhcywgc2VsZWN0ZWRFZGdlczogQ2FudmFzRWRnZVtdLCBzdHlsZUlkOiBzdHJpbmd8dW5kZWZpbmVkKSB7XHJcbiAgICBmb3IgKGNvbnN0IGVkZ2Ugb2Ygc2VsZWN0ZWRFZGdlcykge1xyXG4gICAgICBlZGdlLnNldERhdGEoeyAuLi5lZGdlLmdldERhdGEoKSwgZWRnZVN0eWxlOiBzdHlsZUlkIGFzIGFueSB9KVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzZXRQYXRoUm91dGVGb3JTZWxlY3Rpb24oX2NhbnZhczogQ2FudmFzLCBzZWxlY3RlZEVkZ2VzOiBDYW52YXNFZGdlW10sIHBhdGhSb3V0ZVR5cGVJZDogc3RyaW5nfHVuZGVmaW5lZCkge1xyXG4gICAgZm9yIChjb25zdCBlZGdlIG9mIHNlbGVjdGVkRWRnZXMpIHtcclxuICAgICAgZWRnZS5zZXREYXRhKHsgLi4uZWRnZS5nZXREYXRhKCksIGVkZ2VQYXRoUm91dGU6IHBhdGhSb3V0ZVR5cGVJZCBhcyBhbnkgfSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgdXBkYXRlQWxsRWRnZXMoY2FudmFzOiBDYW52YXMpIHtcclxuICAgIGZvciAoY29uc3QgZWRnZSBvZiBjYW52YXMuZWRnZXMudmFsdWVzKCkpIHtcclxuICAgICAgdGhpcy5vbkVkZ2VDaGFuZ2VkKGNhbnZhcywgZWRnZSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgb25FZGdlQ2hhbmdlZChjYW52YXM6IENhbnZhcywgZWRnZTogQ2FudmFzRWRnZSkge1xyXG4gICAgaWYgKCFlZGdlLmJlemllcikgcmV0dXJuXHJcbiAgICBcclxuICAgIC8vIFJlc2V0IHBhdGggdG8gZGVmYXVsdFxyXG4gICAgZWRnZS51cGRhdGVQYXRoKClcclxuICAgIGVkZ2UuY2VudGVyID0gdW5kZWZpbmVkXHJcblxyXG4gICAgY29uc3QgcGF0aFJvdXRlVHlwZSA9IGVkZ2UuZ2V0RGF0YSgpLmVkZ2VQYXRoUm91dGUgPz8gJ2RlZmF1bHQnXHJcbiAgICBpZiAocGF0aFJvdXRlVHlwZSA9PT0gJ2RlZmF1bHQnKSB7XHJcbiAgICAgIC8vIFVwZGF0ZSBsYWJlbCBwb3NpdGlvblxyXG4gICAgICBlZGdlLmxhYmVsRWxlbWVudD8ucmVuZGVyKCkgXHJcblxyXG4gICAgICByZXR1cm5cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBmcm9tUG9zID0gZWRnZS5mcm9tLmVuZCA9PT0gJ25vbmUnID8gXHJcbiAgICAgIEJCb3hIZWxwZXIuZ2V0Q2VudGVyT2ZCQm94U2lkZShlZGdlLmZyb20ubm9kZS5nZXRCQm94KCksIGVkZ2UuZnJvbS5zaWRlKSA6XHJcbiAgICAgIGVkZ2UuYmV6aWVyLmZyb21cclxuXHJcbiAgICBjb25zdCB0b1BvcyA9IGVkZ2UudG8uZW5kID09PSAnbm9uZScgPyBcclxuICAgICAgQkJveEhlbHBlci5nZXRDZW50ZXJPZkJCb3hTaWRlKGVkZ2UudG8ubm9kZS5nZXRCQm94KCksIGVkZ2UudG8uc2lkZSkgOlxyXG4gICAgICBlZGdlLmJlemllci50b1xyXG5cclxuICAgIGxldCBuZXdQYXRoID0gZWRnZS5wYXRoLmRpc3BsYXkuZ2V0QXR0cmlidXRlKFwiZFwiKVxyXG4gIFxyXG4gICAgaWYgKHBhdGhSb3V0ZVR5cGUgPT09ICdkaXJlY3QnKSB7XHJcbiAgICAgIG5ld1BhdGggPSBTdmdQYXRoSGVscGVyLnBhdGhBcnJheVRvU3ZnUGF0aChbZnJvbVBvcywgdG9Qb3NdLCBmYWxzZSlcclxuICAgICAgZWRnZS5jZW50ZXIgPSB7IFxyXG4gICAgICAgIHg6IChmcm9tUG9zLnggKyB0b1Bvcy54KSAvIDIsIFxyXG4gICAgICAgIHk6IChmcm9tUG9zLnkgKyB0b1Bvcy55KSAvIDIgXHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSBpZiAocGF0aFJvdXRlVHlwZSA9PT0gJ3NxdWFyZScpIHtcclxuICAgICAgbGV0IHBhdGhBcnJheTogUG9zaXRpb25bXSA9IFtdXHJcbiAgICAgIGlmIChlZGdlLmZyb20uc2lkZSA9PT0gJ2JvdHRvbScgfHwgZWRnZS5mcm9tLnNpZGUgPT09ICd0b3AnKSB7XHJcbiAgICAgICAgcGF0aEFycmF5ID0gW1xyXG4gICAgICAgICAgZnJvbVBvcywgXHJcbiAgICAgICAgICB7IHg6IGZyb21Qb3MueCwgeTogZnJvbVBvcy55ICsgKHRvUG9zLnkgLSBmcm9tUG9zLnkpIC8gMiB9LFxyXG4gICAgICAgICAgeyB4OiB0b1Bvcy54LCB5OiBmcm9tUG9zLnkgKyAodG9Qb3MueSAtIGZyb21Qb3MueSkgLyAyIH0sXHJcbiAgICAgICAgICB0b1Bvc1xyXG4gICAgICAgIF1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBwYXRoQXJyYXkgPSBbXHJcbiAgICAgICAgICBmcm9tUG9zLCBcclxuICAgICAgICAgIHsgeDogZnJvbVBvcy54ICsgKHRvUG9zLnggLSBmcm9tUG9zLngpIC8gMiwgeTogZnJvbVBvcy55IH0sXHJcbiAgICAgICAgICB7IHg6IGZyb21Qb3MueCArICh0b1Bvcy54IC0gZnJvbVBvcy54KSAvIDIsIHk6IHRvUG9zLnkgfSxcclxuICAgICAgICAgIHRvUG9zXHJcbiAgICAgICAgXVxyXG4gICAgICB9XHJcblxyXG4gICAgICBuZXdQYXRoID0gU3ZnUGF0aEhlbHBlci5wYXRoQXJyYXlUb1N2Z1BhdGgocGF0aEFycmF5LCBmYWxzZSlcclxuICAgICAgZWRnZS5jZW50ZXIgPSB7IFxyXG4gICAgICAgIHg6IChmcm9tUG9zLnggKyB0b1Bvcy54KSAvIDIsIFxyXG4gICAgICAgIHk6IChmcm9tUG9zLnkgKyB0b1Bvcy55KSAvIDIgXHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSBpZiAocGF0aFJvdXRlVHlwZSA9PT0gJ2Etc3RhcicpIHtcclxuICAgICAgaWYgKGNhbnZhcy5pc0RyYWdnaW5nICYmICF0aGlzLnBsdWdpbi5zZXR0aW5ncy5nZXRTZXR0aW5nKCdlZGdlU3R5bGVQYXRoZmluZGVyUGF0aExpdmVVcGRhdGUnKSkgcmV0dXJuXHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBub2RlQkJveGVzID0gWy4uLmNhbnZhcy5ub2Rlcy52YWx1ZXMoKV1cclxuICAgICAgICAuZmlsdGVyKG5vZGUgPT4ge1xyXG4gICAgICAgICAgY29uc3Qgbm9kZURhdGEgPSBub2RlLmdldERhdGEoKVxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBjb25zdCBpc0dyb3VwID0gbm9kZURhdGEudHlwZSA9PT0gJ2dyb3VwJyAvLyBFeGNsdWRlIGdyb3VwIG5vZGVzXHJcbiAgICAgICAgICBjb25zdCBpc09wZW5Qb3J0YWwgPSBub2RlRGF0YS5wb3J0YWxUb0ZpbGUgIT09IHVuZGVmaW5lZCAvLyBFeGNsdWRlIG9wZW4gcG9ydGFsc1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICByZXR1cm4gIWlzR3JvdXAgJiYgIWlzT3BlblBvcnRhbFxyXG4gICAgICAgIH0pLm1hcChub2RlID0+IG5vZGUuZ2V0QkJveCgpKVxyXG5cclxuICAgICAgY29uc3QgZ3JpZFJlc29sdXRpb24gPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5nZXRTZXR0aW5nKCdlZGdlU3R5bGVQYXRoZmluZGVyR3JpZFJlc29sdXRpb24nKVxyXG4gICAgICBjb25zdCBwYXRoQXJyYXkgPSBBU3RhckhlbHBlci5hU3Rhcihmcm9tUG9zLCBlZGdlLmZyb20uc2lkZSwgdG9Qb3MsIGVkZ2UudG8uc2lkZSwgbm9kZUJCb3hlcywgZ3JpZFJlc29sdXRpb24pXHJcbiAgICAgIGlmICghcGF0aEFycmF5KSByZXR1cm4gLy8gTm8gcGF0aCBmb3VuZCAtIHVzZSBkZWZhdWx0IHBhdGhcclxuXHJcbiAgICAgIGNvbnN0IHJvdW5kZWRQYXRoID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2V0U2V0dGluZygnZWRnZVN0eWxlUGF0aGZpbmRlclBhdGhSb3VuZGVkJylcclxuICAgICAgY29uc3Qgc3ZnUGF0aCA9IFN2Z1BhdGhIZWxwZXIucGF0aEFycmF5VG9TdmdQYXRoKHBhdGhBcnJheSwgcm91bmRlZFBhdGgpXHJcblxyXG4gICAgICBuZXdQYXRoID0gc3ZnUGF0aFxyXG4gICAgICBlZGdlLmNlbnRlciA9IHBhdGhBcnJheVtNYXRoLmZsb29yKHBhdGhBcnJheS5sZW5ndGggLyAyKV1cclxuICAgIH1cclxuICAgIFxyXG4gICAgZWRnZS5wYXRoLmludGVyYWN0aW9uLnNldEF0dHIoXCJkXCIsIG5ld1BhdGgpXHJcbiAgICBlZGdlLnBhdGguZGlzcGxheS5zZXRBdHRyKFwiZFwiLCBuZXdQYXRoKVxyXG4gICAgZWRnZS5sYWJlbEVsZW1lbnQ/LnJlbmRlcigpXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG9uRWRnZUNlbnRlclJlcXVlc3RlZChfY2FudmFzOiBDYW52YXMsIGVkZ2U6IENhbnZhc0VkZ2UsIGNlbnRlcjogUG9zaXRpb24pIHtcclxuICAgIGNlbnRlci54ID0gZWRnZS5jZW50ZXI/LnggPz8gY2VudGVyLnhcclxuICAgIGNlbnRlci55ID0gZWRnZS5jZW50ZXI/LnkgPz8gY2VudGVyLnlcclxuICB9XHJcbn0iLCAiaW1wb3J0IHsgQ2FudmFzLCBDYW52YXNFZGdlLCBDYW52YXNFZGdlRGF0YSB9IGZyb20gXCJzcmMvQHR5cGVzL0NhbnZhc1wiXHJcbmltcG9ydCB7IENhbnZhc0V2ZW50IH0gZnJvbSBcInNyYy9jb3JlL2V2ZW50c1wiXHJcbmltcG9ydCBBZHZhbmNlZENhbnZhc1BsdWdpbiBmcm9tIFwic3JjL21haW5cIlxyXG5pbXBvcnQgU2V0dGluZ3NNYW5hZ2VyIGZyb20gXCJzcmMvc2V0dGluZ3NcIlxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEV4cG9zZWRFZGdlRGF0YShzZXR0aW5nczogU2V0dGluZ3NNYW5hZ2VyKTogKGtleW9mIENhbnZhc0VkZ2VEYXRhKVtdIHtcclxuICBjb25zdCBleHBvc2VkRGF0YTogKGtleW9mIENhbnZhc0VkZ2VEYXRhKVtdID0gW11cclxuXHJcbiAgaWYgKHNldHRpbmdzLmdldFNldHRpbmcoJ2VkZ2VzU3R5bGluZ0ZlYXR1cmVFbmFibGVkJykpIGV4cG9zZWREYXRhLnB1c2goJ2VkZ2VTdHlsZScpXHJcbiAgaWYgKHNldHRpbmdzLmdldFNldHRpbmcoJ3BvcnRhbHNGZWF0dXJlRW5hYmxlZCcpKSBleHBvc2VkRGF0YS5wdXNoKCdpc1Vuc2F2ZWQnKVxyXG5cclxuICByZXR1cm4gZXhwb3NlZERhdGFcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRWRnZURhdGFUYWdnZXJDYW52YXNFeHRlbnNpb24ge1xyXG4gIHBsdWdpbjogQWR2YW5jZWRDYW52YXNQbHVnaW5cclxuXHJcbiAgY29uc3RydWN0b3IocGx1Z2luOiBBZHZhbmNlZENhbnZhc1BsdWdpbikge1xyXG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW5cclxuXHJcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2Uub24oXHJcbiAgICAgIENhbnZhc0V2ZW50LkVkZ2VDaGFuZ2VkLFxyXG4gICAgICAoX2NhbnZhczogQ2FudmFzLCBlZGdlOiBDYW52YXNFZGdlKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZWRnZURhdGEgPSBlZGdlPy5nZXREYXRhKClcclxuICAgICAgICBpZiAoIWVkZ2VEYXRhKSByZXR1cm5cclxuXHJcbiAgICAgICAgZm9yIChjb25zdCBkYXRhS2V5IG9mIGdldEV4cG9zZWRFZGdlRGF0YSh0aGlzLnBsdWdpbi5zZXR0aW5ncykpIHtcclxuICAgICAgICAgIGNvbnN0IGRhdGFWYWx1ZSA9IGVkZ2VEYXRhW2RhdGFLZXldXHJcbiAgICAgICAgICBcclxuICAgICAgICAgIGlmICghZGF0YVZhbHVlKSBkZWxldGUgZWRnZS5wYXRoLmRpc3BsYXkuZGF0YXNldFtkYXRhS2V5XVxyXG4gICAgICAgICAgZWxzZSBlZGdlLnBhdGguZGlzcGxheS5kYXRhc2V0W2RhdGFLZXldID0gZGF0YVZhbHVlIGFzIHN0cmluZ1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgKSlcclxuICB9XHJcbn0iLCAiaW1wb3J0IEFkdmFuY2VkQ2FudmFzUGx1Z2luIGZyb20gXCJzcmMvbWFpblwiXHJcbmltcG9ydCB7IENhbnZhc0V2ZW50IH0gZnJvbSBcIi4uL2NvcmUvZXZlbnRzXCJcclxuaW1wb3J0IHsgQ2FudmFzLCBDYW52YXNOb2RlIH0gZnJvbSBcInNyYy9AdHlwZXMvQ2FudmFzXCJcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIERlYnVnSGVscGVyIHtcclxuICBwbHVnaW46IEFkdmFuY2VkQ2FudmFzUGx1Z2luXHJcblxyXG4gIGNvbnN0cnVjdG9yKHBsdWdpbjogQWR2YW5jZWRDYW52YXNQbHVnaW4pIHtcclxuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luXHJcblxyXG4gICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudCh0aGlzLnBsdWdpbi5hcHAud29ya3NwYWNlLm9uKFxyXG4gICAgICBDYW52YXNFdmVudC5Ob2RlQWRkZWQsXHJcbiAgICAgIChfY2FudmFzOiBDYW52YXMsIF9ub2RlOiBDYW52YXNOb2RlKSA9PiBjb25zb2xlLmNvdW50KCdcdUQ4M0RcdURGRTIgTm9kZUFkZGVkJylcclxuICAgICkpXHJcblxyXG4gICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudCh0aGlzLnBsdWdpbi5hcHAud29ya3NwYWNlLm9uKFxyXG4gICAgICBDYW52YXNFdmVudC5Ob2RlQ2hhbmdlZCxcclxuICAgICAgKF9jYW52YXM6IENhbnZhcywgX25vZGU6IENhbnZhc05vZGUpID0+IGNvbnNvbGUuY291bnQoJ1x1RDgzRFx1REZFMSBOb2RlQ2hhbmdlZCcpXHJcbiAgICApKVxyXG5cclxuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQodGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5vbihcclxuICAgICAgQ2FudmFzRXZlbnQuRWRnZUFkZGVkLFxyXG4gICAgICAoX2NhbnZhczogQ2FudmFzLCBfZWRnZTogQ2FudmFzTm9kZSkgPT4gY29uc29sZS5jb3VudCgnXHVEODNEXHVERkUyIEVkZ2VBZGRlZCcpXHJcbiAgICApKVxyXG5cclxuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQodGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5vbihcclxuICAgICAgQ2FudmFzRXZlbnQuRWRnZUNoYW5nZWQsXHJcbiAgICAgIChfY2FudmFzOiBDYW52YXMsIF9lZGdlOiBDYW52YXNOb2RlKSA9PiBjb25zb2xlLmNvdW50KCdcdUQ4M0RcdURGRTEgRWRnZUNoYW5nZWQnKVxyXG4gICAgKSlcclxuICB9XHJcbn0iLCAiaW1wb3J0IHsgQ2FudmFzIH0gZnJvbSBcInNyYy9AdHlwZXMvQ2FudmFzXCJcclxuaW1wb3J0IHsgQ2FudmFzRXZlbnQgfSBmcm9tIFwic3JjL2NvcmUvZXZlbnRzXCJcclxuaW1wb3J0IEFkdmFuY2VkQ2FudmFzUGx1Z2luIGZyb20gXCJzcmMvbWFpblwiXHJcbmltcG9ydCBTZXR0aW5nc01hbmFnZXIgZnJvbSBcInNyYy9zZXR0aW5nc1wiXHJcbmltcG9ydCB7IEZpbGVTZWxlY3RNb2RhbCB9IGZyb20gXCJzcmMvdXRpbHMvbW9kYWwtaGVscGVyXCJcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEJldHRlckRlZmF1bHRTZXR0aW5nc0NhbnZhc0V4dGVuc2lvbiB7XHJcbiAgcGx1Z2luOiBBZHZhbmNlZENhbnZhc1BsdWdpblxyXG5cclxuICBjb25zdHJ1Y3RvcihwbHVnaW46IEFkdmFuY2VkQ2FudmFzUGx1Z2luKSB7XHJcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpblxyXG5cclxuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQodGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5vbihcclxuICAgICAgU2V0dGluZ3NNYW5hZ2VyLlNFVFRJTkdTX0NIQU5HRURfRVZFTlQsXHJcbiAgICAgICgpID0+IHRoaXMuYXBwbHlTZXR0aW5ncyh0aGlzLnBsdWdpbi5nZXRDdXJyZW50Q2FudmFzKCkpXHJcbiAgICApKVxyXG5cclxuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQodGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5vbihcclxuICAgICAgQ2FudmFzRXZlbnQuQ2FudmFzQ2hhbmdlZCxcclxuICAgICAgKGNhbnZhczogQ2FudmFzKSA9PiB0aGlzLmFwcGx5U2V0dGluZ3MoY2FudmFzKVxyXG4gICAgKSlcclxuXHJcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2Uub24oXHJcbiAgICAgIENhbnZhc0V2ZW50LkRvdWJsZUNsaWNrLFxyXG4gICAgICAoY2FudmFzOiBDYW52YXMsIGV2ZW50OiBNb3VzZUV2ZW50LCBwcmV2ZW50RGVmYXVsdDogeyB2YWx1ZTogYm9vbGVhbiB9KSA9PiB0aGlzLm9uRG91YmxlQ2xpY2soY2FudmFzLCBldmVudCwgcHJldmVudERlZmF1bHQpXHJcbiAgICApKVxyXG5cclxuICAgIHRoaXMuYXBwbHlTZXR0aW5ncyh0aGlzLnBsdWdpbi5nZXRDdXJyZW50Q2FudmFzKCkpXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFwcGx5U2V0dGluZ3MoY2FudmFzOiBDYW52YXMgfCBudWxsKSB7XHJcbiAgICBpZiAoIWNhbnZhcykgcmV0dXJuXHJcblxyXG4gICAgY2FudmFzLmNvbmZpZy5kZWZhdWx0VGV4dE5vZGVEaW1lbnNpb25zID0ge1xyXG4gICAgICB3aWR0aDogdGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2V0U2V0dGluZygnZGVmYXVsdFRleHROb2RlV2lkdGgnKSxcclxuICAgICAgaGVpZ2h0OiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5nZXRTZXR0aW5nKCdkZWZhdWx0VGV4dE5vZGVIZWlnaHQnKVxyXG4gICAgfVxyXG5cclxuICAgIGNhbnZhcy5jb25maWcuZGVmYXVsdEZpbGVOb2RlRGltZW5zaW9ucyA9IHtcclxuICAgICAgd2lkdGg6IHRoaXMucGx1Z2luLnNldHRpbmdzLmdldFNldHRpbmcoJ2RlZmF1bHRGaWxlTm9kZVdpZHRoJyksXHJcbiAgICAgIGhlaWdodDogdGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2V0U2V0dGluZygnZGVmYXVsdEZpbGVOb2RlSGVpZ2h0JylcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgb25Eb3VibGVDbGljayhjYW52YXM6IENhbnZhcywgZXZlbnQ6IE1vdXNlRXZlbnQsIHByZXZlbnREZWZhdWx0OiB7IHZhbHVlOiBib29sZWFuIH0pIHtcclxuICAgIGlmIChldmVudC5kZWZhdWx0UHJldmVudGVkIHx8IGV2ZW50LnRhcmdldCAhPT0gY2FudmFzLndyYXBwZXJFbCB8fCBjYW52YXMuaXNEcmFnZ2luZyB8fCBjYW52YXMucmVhZG9ubHkpIHJldHVyblxyXG4gICAgcHJldmVudERlZmF1bHQudmFsdWUgPSB0cnVlXHJcblxyXG4gICAgdmFyIHBvcyA9IGNhbnZhcy5wb3NGcm9tRXZ0KGV2ZW50KVxyXG5cclxuICAgIHN3aXRjaCAodGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2V0U2V0dGluZygnbm9kZVR5cGVPbkRvdWJsZUNsaWNrJykpIHtcclxuICAgICAgY2FzZSAnZmlsZSc6XHJcbiAgICAgICAgY29uc3QgZmlsZSA9IGF3YWl0IG5ldyBGaWxlU2VsZWN0TW9kYWwodGhpcy5wbHVnaW4uYXBwLCB1bmRlZmluZWQsIHRydWUpLmF3YWl0SW5wdXQoKVxyXG5cclxuICAgICAgICBjYW52YXMuY3JlYXRlRmlsZU5vZGUoe1xyXG4gICAgICAgICAgcG9zOiBwb3MsXHJcbiAgICAgICAgICBwb3NpdGlvbjogJ2NlbnRlcicsXHJcbiAgICAgICAgICBmaWxlOiBmaWxlXHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgYnJlYWtcclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICBjYW52YXMuY3JlYXRlVGV4dE5vZGUoe1xyXG4gICAgICAgICAgcG9zOiBwb3MsXHJcbiAgICAgICAgICBwb3NpdGlvbjogJ2NlbnRlcidcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICBicmVha1xyXG4gICAgfVxyXG4gIH1cclxufSIsICJpbXBvcnQgeyBXb3Jrc3BhY2VXaW5kb3cgfSBmcm9tIFwib2JzaWRpYW5cIlxyXG5pbXBvcnQgeyBDYW52YXMgfSBmcm9tIFwic3JjL0B0eXBlcy9DYW52YXNcIlxyXG5pbXBvcnQgeyBDYW52YXNFdmVudCB9IGZyb20gXCJzcmMvY29yZS9ldmVudHNcIlxyXG5pbXBvcnQgQWR2YW5jZWRDYW52YXNQbHVnaW4gZnJvbSBcInNyYy9tYWluXCJcclxuXHJcbmNvbnN0IERFRkFVTFRfQ09MT1JTX0NPVU5UID0gNlxyXG5jb25zdCBDVVNUT01fQ09MT1JTX01PRF9TVFlMRVNfSUQgPSAnbW9kLWN1c3RvbS1jb2xvcnMnXHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDb2xvclBhbGV0dGVDYW52YXNFeHRlbnNpb24ge1xyXG4gIHBsdWdpbjogQWR2YW5jZWRDYW52YXNQbHVnaW5cclxuICBvYnNlcnZlcjogTXV0YXRpb25PYnNlcnZlcnxudWxsID0gbnVsbFxyXG5cclxuICBjb25zdHJ1Y3RvcihwbHVnaW46IEFkdmFuY2VkQ2FudmFzUGx1Z2luKSB7XHJcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpblxyXG5cclxuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQodGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5vbihcclxuICAgICAgJ3dpbmRvdy1vcGVuJyxcclxuICAgICAgKF93aW46IFdvcmtzcGFjZVdpbmRvdywgX3dpbmRvdzogV2luZG93KSA9PiB0aGlzLnVwZGF0ZUN1c3RvbUNvbG9yTW9kU3R5bGVDbGFzc2VzKClcclxuICAgICkpXHJcblxyXG4gICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudCh0aGlzLnBsdWdpbi5hcHAud29ya3NwYWNlLm9uKFxyXG4gICAgICAnY3NzLWNoYW5nZScsXHJcbiAgICAgICgpID0+IHRoaXMudXBkYXRlQ3VzdG9tQ29sb3JNb2RTdHlsZUNsYXNzZXMoKVxyXG4gICAgKSlcclxuXHJcbiAgICB0aGlzLnVwZGF0ZUN1c3RvbUNvbG9yTW9kU3R5bGVDbGFzc2VzKClcclxuXHJcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2Uub24oXHJcbiAgICAgIENhbnZhc0V2ZW50LlBvcHVwTWVudUNyZWF0ZWQsXHJcbiAgICAgIChjYW52YXM6IENhbnZhcykgPT4gdGhpcy5wYXRjaENvbG9yU2VsZWN0aW9uKGNhbnZhcylcclxuICAgICkpXHJcblxyXG4gICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXIoKCkgPT4gdGhpcy5vYnNlcnZlcj8uZGlzY29ubmVjdCgpKVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB1cGRhdGVDdXN0b21Db2xvck1vZFN0eWxlQ2xhc3NlcygpIHtcclxuICAgIGNvbnN0IGN1c3RvbUNzcyA9IHRoaXMuZ2V0Q3VzdG9tQ29sb3JzKCkubWFwKChjb2xvcklkKSA9PiBgXHJcbiAgICAgIC5tb2QtY2FudmFzLWNvbG9yLSR7Y29sb3JJZH0ge1xyXG4gICAgICAgIC0tY2FudmFzLWNvbG9yOiB2YXIoLS1jYW52YXMtY29sb3ItJHtjb2xvcklkfSk7XHJcbiAgICAgIH1cclxuICAgIGApLmpvaW4oJycpXHJcblxyXG4gICAgZm9yIChjb25zdCB3aW4gb2YgdGhpcy5wbHVnaW4ud2luZG93c01hbmFnZXIud2luZG93cykge1xyXG4gICAgICBjb25zdCBkb2MgPSB3aW4uZG9jdW1lbnRcclxuICAgICAgXHJcbiAgICAgIGRvYy5nZXRFbGVtZW50QnlJZChDVVNUT01fQ09MT1JTX01PRF9TVFlMRVNfSUQpPy5yZW1vdmUoKVxyXG5cclxuICAgICAgY29uc3QgY3VzdG9tQ29sb3JNb2RTdHlsZSA9IGRvYy5jcmVhdGVFbGVtZW50KCdzdHlsZScpXHJcbiAgICAgIGN1c3RvbUNvbG9yTW9kU3R5bGUuaWQgPSBDVVNUT01fQ09MT1JTX01PRF9TVFlMRVNfSURcclxuICAgICAgZG9jLmhlYWQuYXBwZW5kQ2hpbGQoY3VzdG9tQ29sb3JNb2RTdHlsZSlcclxuXHJcbiAgICAgIGN1c3RvbUNvbG9yTW9kU3R5bGUudGV4dENvbnRlbnQgPSBjdXN0b21Dc3NcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgcGF0Y2hDb2xvclNlbGVjdGlvbihjYW52YXM6IENhbnZhcykge1xyXG4gICAgaWYgKHRoaXMub2JzZXJ2ZXIpIHRoaXMub2JzZXJ2ZXIuZGlzY29ubmVjdCgpXHJcblxyXG4gICAgdGhpcy5vYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKG11dGF0aW9ucyA9PiB7XHJcbiAgICAgIGNvbnN0IGNvbG9yTWVudU9wZW5lZCA9IG11dGF0aW9ucy5zb21lKG11dGF0aW9uID0+IFxyXG4gICAgICAgIE9iamVjdC52YWx1ZXMobXV0YXRpb24uYWRkZWROb2Rlcykuc29tZSgobm9kZTogTm9kZSkgPT4gXHJcbiAgICAgICAgICBub2RlIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgJiYgbm9kZS5jbGFzc0xpc3QuY29udGFpbnMoJ2NhbnZhcy1zdWJtZW51JykgJiYgT2JqZWN0LnZhbHVlcyhub2RlLmNoaWxkTm9kZXMpLnNvbWUoKG5vZGU6IE5vZGUpID0+XHJcbiAgICAgICAgICAgIG5vZGUgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCAmJiBub2RlLmNsYXNzTGlzdC5jb250YWlucygnY2FudmFzLWNvbG9yLXBpY2tlci1pdGVtJylcclxuICAgICAgICAgIClcclxuICAgICAgICApXHJcbiAgICAgIClcclxuICAgICAgaWYgKCFjb2xvck1lbnVPcGVuZWQpIHJldHVyblxyXG5cclxuICAgICAgY29uc3Qgc3VibWVudSA9IGNhbnZhcy5tZW51Lm1lbnVFbC5xdWVyeVNlbGVjdG9yKCcuY2FudmFzLXN1Ym1lbnUnKVxyXG4gICAgICBpZiAoIXN1Ym1lbnUpIHJldHVyblxyXG5cclxuICAgICAgY29uc3QgY3VycmVudE5vZGVDb2xvciA9IGNhbnZhcy5nZXRTZWxlY3Rpb25EYXRhKCkubm9kZXMubWFwKG5vZGUgPT4gbm9kZS5jb2xvcikubGFzdCgpXHJcbiAgICAgIGZvciAoY29uc3QgY29sb3JJZCBvZiB0aGlzLmdldEN1c3RvbUNvbG9ycygpKSB7XHJcbiAgICAgICAgY29uc3QgY3VzdG9tQ29sb3JNZW51SXRlbSA9IHRoaXMuY3JlYXRlQ29sb3JNZW51SXRlbShjYW52YXMsIGNvbG9ySWQpXHJcbiAgICAgICAgaWYgKGN1cnJlbnROb2RlQ29sb3IgPT09IGNvbG9ySWQpIGN1c3RvbUNvbG9yTWVudUl0ZW0uY2xhc3NMaXN0LmFkZCgnaXMtYWN0aXZlJylcclxuICAgICAgICBcclxuICAgICAgICBzdWJtZW51Lmluc2VydEJlZm9yZShjdXN0b21Db2xvck1lbnVJdGVtLCBzdWJtZW51Lmxhc3RDaGlsZClcclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICB0aGlzLm9ic2VydmVyLm9ic2VydmUoY2FudmFzLm1lbnUubWVudUVsLCB7IGNoaWxkTGlzdDogdHJ1ZSB9KVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjcmVhdGVDb2xvck1lbnVJdGVtKGNhbnZhczogQ2FudmFzLCBjb2xvcklkOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IG1lbnVJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcclxuICAgIG1lbnVJdGVtLmNsYXNzTGlzdC5hZGQoJ2NhbnZhcy1jb2xvci1waWNrZXItaXRlbScpXHJcbiAgICBtZW51SXRlbS5jbGFzc0xpc3QuYWRkKGBtb2QtY2FudmFzLWNvbG9yLSR7Y29sb3JJZH1gKVxyXG5cclxuICAgIG1lbnVJdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICBtZW51SXRlbS5jbGFzc0xpc3QuYWRkKCdpcy1hY3RpdmUnKVxyXG5cclxuICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGNhbnZhcy5zZWxlY3Rpb24pIHtcclxuICAgICAgICBpdGVtLnNldENvbG9yKGNvbG9ySWQpXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNhbnZhcy5yZXF1ZXN0U2F2ZSgpXHJcbiAgICB9KVxyXG5cclxuICAgIHJldHVybiBtZW51SXRlbVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRDdXN0b21Db2xvcnMoKTogc3RyaW5nW10ge1xyXG4gICAgY29uc3QgY29sb3JzOiBzdHJpbmdbXSA9IFtdXHJcblxyXG4gICAgd2hpbGUgKHRydWUpIHtcclxuICAgICAgY29uc3QgY29sb3JJZCA9IChERUZBVUxUX0NPTE9SU19DT1VOVCArIGNvbG9ycy5sZW5ndGggKyAxKS50b1N0cmluZygpXHJcbiAgICAgIGlmICghZ2V0Q29tcHV0ZWRTdHlsZShkb2N1bWVudC5ib2R5KS5nZXRQcm9wZXJ0eVZhbHVlKGAtLWNhbnZhcy1jb2xvci0ke2NvbG9ySWR9YCkpIGJyZWFrXHJcblxyXG4gICAgICBjb2xvcnMucHVzaChjb2xvcklkKVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBjb2xvcnNcclxuICB9XHJcbn0iLCAiaW1wb3J0IHsgc2V0SWNvbiB9IGZyb20gXCJvYnNpZGlhblwiXHJcbmltcG9ydCB7IEJCb3gsIENhbnZhcywgQ2FudmFzRGF0YSwgQ2FudmFzTm9kZSB9IGZyb20gXCJzcmMvQHR5cGVzL0NhbnZhc1wiXHJcbmltcG9ydCB7IENhbnZhc0V2ZW50IH0gZnJvbSBcInNyYy9jb3JlL2V2ZW50c1wiXHJcbmltcG9ydCBBZHZhbmNlZENhbnZhc1BsdWdpbiBmcm9tIFwic3JjL21haW5cIlxyXG5pbXBvcnQgKiBhcyBCQm94SGVscGVyIGZyb20gXCJzcmMvdXRpbHMvYmJveC1oZWxwZXJcIlxyXG5cclxuY29uc3QgQ09MTEFQU0VfQlVUVE9OX0lEID0gJ2dyb3VwLWNvbGxhcHNlLWJ1dHRvbidcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENvbGxhcHNpYmxlR3JvdXBzQ2FudmFzRXh0ZW5zaW9uIHtcclxuICBwbHVnaW46IEFkdmFuY2VkQ2FudmFzUGx1Z2luXHJcblxyXG4gIGNvbnN0cnVjdG9yKHBsdWdpbjogQWR2YW5jZWRDYW52YXNQbHVnaW4pIHtcclxuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luXHJcblxyXG4gICAgaWYgKCF0aGlzLnBsdWdpbi5zZXR0aW5ncy5nZXRTZXR0aW5nKCdjb2xsYXBzaWJsZUdyb3Vwc0ZlYXR1cmVFbmFibGVkJykpIHJldHVyblxyXG5cclxuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQodGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5vbihcclxuICAgICAgQ2FudmFzRXZlbnQuTm9kZUNoYW5nZWQsXHJcbiAgICAgIChjYW52YXM6IENhbnZhcywgbm9kZTogQ2FudmFzTm9kZSkgPT4gdGhpcy5vbk5vZGVDaGFuZ2VkKGNhbnZhcywgbm9kZSlcclxuICAgICkpXHJcblxyXG4gICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudCh0aGlzLnBsdWdpbi5hcHAud29ya3NwYWNlLm9uKFxyXG4gICAgICBDYW52YXNFdmVudC5Ob2RlQkJveFJlcXVlc3RlZCxcclxuICAgICAgKGNhbnZhczogQ2FudmFzLCBub2RlOiBDYW52YXNOb2RlLCBiYm94OiBCQm94KSA9PiB0aGlzLm9uTm9kZUJCb3hSZXF1ZXN0ZWQoY2FudmFzLCBub2RlLCBiYm94KVxyXG4gICAgKSlcclxuXHJcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2Uub24oXHJcbiAgICAgIENhbnZhc0V2ZW50LkRhdGFSZXF1ZXN0ZWQsXHJcbiAgICAgIChfY2FudmFzOiBDYW52YXMsIGRhdGE6IENhbnZhc0RhdGEpID0+IHRoaXMuZXhwYW5kQ29sbGFwc2VkTm9kZXMoZGF0YSlcclxuICAgICkpXHJcblxyXG4gICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudCh0aGlzLnBsdWdpbi5hcHAud29ya3NwYWNlLm9uKFxyXG4gICAgICBDYW52YXNFdmVudC5Mb2FkRGF0YSxcclxuICAgICAgKF9jYW52YXM6IENhbnZhcywgZGF0YTogQ2FudmFzRGF0YSwgX3NldERhdGE6IChkYXRhOiBDYW52YXNEYXRhKSA9PiB2b2lkKSA9PiB0aGlzLmNvbGxhcHNlTm9kZXMoZGF0YSlcclxuICAgICkpXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG9uTm9kZUNoYW5nZWQoY2FudmFzOiBDYW52YXMsIGdyb3VwTm9kZTogQ2FudmFzTm9kZSkge1xyXG4gICAgY29uc3QgZ3JvdXBOb2RlRGF0YSA9IGdyb3VwTm9kZS5nZXREYXRhKClcclxuICAgIGlmIChncm91cE5vZGVEYXRhLnR5cGUgIT09ICdncm91cCcpIHJldHVyblxyXG5cclxuICAgIC8vIFJlbW92ZSB0aGUgY29sbGFwc2UvZXhwYW5kIGJ1dHRvblxyXG4gICAgZ3JvdXBOb2RlLm5vZGVFbD8ucXVlcnlTZWxlY3RvckFsbChgIyR7Q09MTEFQU0VfQlVUVE9OX0lEfWApLmZvckVhY2goKGVsKSA9PiBlbC5yZW1vdmUoKSlcclxuXHJcbiAgICAvLyBBZGQgY29sbGFwc2UvZXhwYW5kIGJ1dHRvbiBuZXh0IHRvIHRoZSBsYWJlbFxyXG4gICAgY29uc3QgY29sbGFwc2VCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJylcclxuICAgIGNvbGxhcHNlQnV0dG9uLmlkID0gQ09MTEFQU0VfQlVUVE9OX0lEXHJcbiAgICBzZXRJY29uKGNvbGxhcHNlQnV0dG9uLCBncm91cE5vZGVEYXRhLmlzQ29sbGFwc2VkID8gJ3BsdXMtY2lyY2xlJyA6ICdtaW51cy1jaXJjbGUnKVxyXG5cclxuICAgIGNvbGxhcHNlQnV0dG9uLm9uY2xpY2sgPSAoKSA9PiB7IHRoaXMuc2V0Q29sbGFwc2VkKGNhbnZhcywgZ3JvdXBOb2RlLCBncm91cE5vZGUuZ2V0RGF0YSgpLmlzQ29sbGFwc2VkID8gdW5kZWZpbmVkIDogdHJ1ZSkgfVxyXG5cclxuICAgIGdyb3VwTm9kZS5sYWJlbEVsPy5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyZW5kJywgY29sbGFwc2VCdXR0b24pXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNldENvbGxhcHNlZChjYW52YXM6IENhbnZhcywgZ3JvdXBOb2RlOiBDYW52YXNOb2RlLCBjb2xsYXBzZWQ6IGJvb2xlYW4gfCB1bmRlZmluZWQpIHtcclxuICAgIGdyb3VwTm9kZS5zZXREYXRhKHsgLi4uZ3JvdXBOb2RlLmdldERhdGEoKSwgaXNDb2xsYXBzZWQ6IGNvbGxhcHNlZCB9KVxyXG4gICAgY2FudmFzLnNldERhdGEoY2FudmFzLmdldERhdGEoKSlcclxuICB9XHJcblxyXG4gIG9uTm9kZUJCb3hSZXF1ZXN0ZWQoX2NhbnZhczogQ2FudmFzLCBub2RlOiBDYW52YXNOb2RlLCBiYm94OiBCQm94KSB7XHJcbiAgICBjb25zdCBub2RlRGF0YSA9IG5vZGUuZ2V0RGF0YSgpXHJcbiAgICBpZiAobm9kZURhdGEudHlwZSAhPT0gJ2dyb3VwJyB8fCAhbm9kZURhdGEuaXNDb2xsYXBzZWQpIHJldHVyblxyXG5cclxuICAgIC8vIFNldCB3aWR0aCB0byBsYWJlbCB3aWR0aFxyXG4gICAgYmJveC5tYXhYID0gYmJveC5taW5YICsgKG5vZGUubm9kZUVsPy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCA/PyAwKVxyXG4gICAgXHJcbiAgICAvLyBTZXQgaGVpZ2h0IG9mIHRvIDAgKERvbid0IGRyYWcgYW55IG5vZGVzIHdpdGggaXQpXHJcbiAgICBiYm94Lm1heFkgPSBiYm94Lm1pbllcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZXhwYW5kQ29sbGFwc2VkTm9kZXMoZGF0YTogQ2FudmFzRGF0YSkge1xyXG4gICAgZGF0YS5ub2RlcyA9IGRhdGEubm9kZXMuZmxhdE1hcCgoZ3JvdXBOb2RlRGF0YSkgPT4ge1xyXG4gICAgICBjb25zdCBjb2xsYXBzZWREYXRhID0gZ3JvdXBOb2RlRGF0YS5jb2xsYXBzZWREYXRhXHJcbiAgICAgIGlmIChjb2xsYXBzZWREYXRhID09PSB1bmRlZmluZWQpIHJldHVybiBbZ3JvdXBOb2RlRGF0YV1cclxuXHJcbiAgICAgIGdyb3VwTm9kZURhdGEuY29sbGFwc2VkRGF0YSA9IHVuZGVmaW5lZFxyXG5cclxuICAgICAgZGF0YS5lZGdlcy5wdXNoKC4uLmNvbGxhcHNlZERhdGEuZWRnZXMpXHJcbiAgICAgIHJldHVybiBbZ3JvdXBOb2RlRGF0YSwgLi4uY29sbGFwc2VkRGF0YS5ub2Rlcy5tYXAoKG5vZGVEYXRhKSA9PiAoXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgLi4ubm9kZURhdGEsXHJcbiAgICAgICAgICAvLyBSZXN0b3JlIHRoZSByZWxhdGl2ZSBwb3NpdGlvbiBvZiB0aGUgbm9kZSB0byB0aGUgZ3JvdXBcclxuICAgICAgICAgIHg6IG5vZGVEYXRhLnggKyBncm91cE5vZGVEYXRhLngsXHJcbiAgICAgICAgICB5OiBub2RlRGF0YS55ICsgZ3JvdXBOb2RlRGF0YS55XHJcbiAgICAgICAgfVxyXG4gICAgICApKV1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNvbGxhcHNlTm9kZXMoZGF0YTogQ2FudmFzRGF0YSkge1xyXG4gICAgZGF0YS5ub2Rlcy5mb3JFYWNoKChncm91cE5vZGVEYXRhKSA9PiB7XHJcbiAgICAgIGlmICghZ3JvdXBOb2RlRGF0YS5pc0NvbGxhcHNlZCkgcmV0dXJuXHJcblxyXG4gICAgICBjb25zdCBncm91cE5vZGVCQm94ID0gQkJveEhlbHBlci5iYm94RnJvbU5vZGVEYXRhKGdyb3VwTm9kZURhdGEpXHJcbiAgICAgIGNvbnN0IGNvbnRhaW5lZE5vZGVzRGF0YSA9IGRhdGEubm9kZXMuZmlsdGVyKChub2RlRGF0YSkgPT5cclxuICAgICAgICBub2RlRGF0YS5pZCAhPT0gZ3JvdXBOb2RlRGF0YS5pZCAmJiBCQm94SGVscGVyLmluc2lkZUJCb3goQkJveEhlbHBlci5iYm94RnJvbU5vZGVEYXRhKG5vZGVEYXRhKSwgZ3JvdXBOb2RlQkJveCwgZmFsc2UpXHJcbiAgICAgIClcclxuICAgICAgY29uc3QgY29udGFpbmVkRWRnZXNEYXRhID0gZGF0YS5lZGdlcy5maWx0ZXIoKGVkZ2VEYXRhKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIGNvbnRhaW5lZE5vZGVzRGF0YS5zb21lKChub2RlRGF0YSkgPT4gbm9kZURhdGEuaWQgPT09IGVkZ2VEYXRhLmZyb21Ob2RlKSB8fCBcclxuICAgICAgICAgIGNvbnRhaW5lZE5vZGVzRGF0YS5zb21lKChub2RlRGF0YSkgPT4gbm9kZURhdGEuaWQgPT09IGVkZ2VEYXRhLnRvTm9kZSlcclxuICAgICAgfSlcclxuXHJcbiAgICAgIGRhdGEubm9kZXMgPSBkYXRhLm5vZGVzLmZpbHRlcigobm9kZURhdGEpID0+ICFjb250YWluZWROb2Rlc0RhdGEuaW5jbHVkZXMobm9kZURhdGEpKVxyXG4gICAgICBkYXRhLmVkZ2VzID0gZGF0YS5lZGdlcy5maWx0ZXIoKGVkZ2VEYXRhKSA9PiAhY29udGFpbmVkRWRnZXNEYXRhLmluY2x1ZGVzKGVkZ2VEYXRhKSlcclxuXHJcbiAgICAgIGdyb3VwTm9kZURhdGEuY29sbGFwc2VkRGF0YSA9IHtcclxuICAgICAgICBub2RlczogY29udGFpbmVkTm9kZXNEYXRhLm1hcCgobm9kZURhdGEpID0+IChcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgLi4ubm9kZURhdGEsXHJcbiAgICAgICAgICAgIC8vIFN0b3JlIHRoZSByZWxhdGl2ZSBwb3NpdGlvbiBvZiB0aGUgbm9kZSB0byB0aGUgZ3JvdXBcclxuICAgICAgICAgICAgeDogbm9kZURhdGEueCAtIGdyb3VwTm9kZURhdGEueCxcclxuICAgICAgICAgICAgeTogbm9kZURhdGEueSAtIGdyb3VwTm9kZURhdGEueVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICkpLFxyXG4gICAgICAgIGVkZ2VzOiBjb250YWluZWRFZGdlc0RhdGFcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcbn0iLCAiaW1wb3J0IHsgV29ya3NwYWNlV2luZG93IH0gZnJvbSBcIm9ic2lkaWFuXCJcclxuaW1wb3J0IEFkdmFuY2VkQ2FudmFzUGx1Z2luIGZyb20gXCIuL21haW5cIlxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgV2luZG93c01hbmFnZXIge1xyXG4gIHBsdWdpbjogQWR2YW5jZWRDYW52YXNQbHVnaW5cclxuICB3aW5kb3dzOiBXaW5kb3dbXSA9IFt3aW5kb3ddXHJcblxyXG4gIGNvbnN0cnVjdG9yKHBsdWdpbjogQWR2YW5jZWRDYW52YXNQbHVnaW4pIHtcclxuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luXHJcblxyXG4gICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudCh0aGlzLnBsdWdpbi5hcHAud29ya3NwYWNlLm9uKCd3aW5kb3ctb3BlbicsIFxyXG4gICAgICAoX3dpbjogV29ya3NwYWNlV2luZG93LCB3aW5kb3c6IFdpbmRvdykgPT4gdGhpcy53aW5kb3dzLnB1c2god2luZG93KVxyXG4gICAgKSlcclxuXHJcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2Uub24oJ3dpbmRvdy1jbG9zZScsIFxyXG4gICAgICAoX3dpbjogV29ya3NwYWNlV2luZG93LCB3aW5kb3c6IFdpbmRvdykgPT4gdGhpcy53aW5kb3dzID0gdGhpcy53aW5kb3dzLmZpbHRlcigodykgPT4gdyAhPT0gd2luZG93KVxyXG4gICAgKSlcclxuICB9XHJcbn0iLCAiaW1wb3J0IHsgQ2FudmFzIH0gZnJvbSBcInNyYy9AdHlwZXMvQ2FudmFzXCJcclxuaW1wb3J0IHsgQ2FudmFzRXZlbnQgfSBmcm9tIFwic3JjL2NvcmUvZXZlbnRzXCJcclxuaW1wb3J0IEFkdmFuY2VkQ2FudmFzUGx1Z2luIGZyb20gXCJzcmMvbWFpblwiXHJcbmltcG9ydCBTZXR0aW5nc01hbmFnZXIsIHsgQWR2YW5jZWRDYW52YXNQbHVnaW5TZXR0aW5ncyB9IGZyb20gXCJzcmMvc2V0dGluZ3NcIlxyXG5cclxuY29uc3QgRVhQT1NFRF9TRVRUSU5HUzogKGtleW9mIEFkdmFuY2VkQ2FudmFzUGx1Z2luU2V0dGluZ3MpW10gPSBbXHJcbiAgJ2NvbGxhcHNpYmxlR3JvdXBzRmVhdHVyZUVuYWJsZWQnLFxyXG4gICdjb2xsYXBzZWRHcm91cFByZXZpZXdPbkRyYWcnXHJcbl1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENhbnZhc1dyYXBwZXJEYXRhVGFnZ2VyQ2FudmFzRXh0ZW5zaW9uIHtcclxuICBwbHVnaW46IEFkdmFuY2VkQ2FudmFzUGx1Z2luXHJcblxyXG4gIGNvbnN0cnVjdG9yKHBsdWdpbjogQWR2YW5jZWRDYW52YXNQbHVnaW4pIHtcclxuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luXHJcblxyXG4gICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudCh0aGlzLnBsdWdpbi5hcHAud29ya3NwYWNlLm9uKFxyXG4gICAgICBTZXR0aW5nc01hbmFnZXIuU0VUVElOR1NfQ0hBTkdFRF9FVkVOVCxcclxuICAgICAgKCkgPT4gdGhpcy51cGRhdGVFeHBvc2VkU2V0dGluZ3ModGhpcy5wbHVnaW4uZ2V0Q3VycmVudENhbnZhcygpKVxyXG4gICAgKSlcclxuXHJcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2Uub24oXHJcbiAgICAgIENhbnZhc0V2ZW50LkNhbnZhc0NoYW5nZWQsXHJcbiAgICAgIChjYW52YXM6IENhbnZhcykgPT4gdGhpcy51cGRhdGVFeHBvc2VkU2V0dGluZ3MoY2FudmFzKVxyXG4gICAgKSlcclxuXHJcbiAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2Uub24oXHJcbiAgICAgIENhbnZhc0V2ZW50LkRyYWdnaW5nU3RhdGVDaGFuZ2VkLFxyXG4gICAgICAoY2FudmFzOiBDYW52YXMsIGRyYWdnaW5nOiBib29sZWFuKSA9PiB7XHJcbiAgICAgICAgaWYgKGRyYWdnaW5nKSBjYW52YXMud3JhcHBlckVsLmRhdGFzZXQuaXNEcmFnZ2luZyA9ICd0cnVlJ1xyXG4gICAgICAgIGVsc2UgZGVsZXRlIGNhbnZhcy53cmFwcGVyRWwuZGF0YXNldC5pc0RyYWdnaW5nXHJcbiAgICAgIH1cclxuICAgICkpXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHVwZGF0ZUV4cG9zZWRTZXR0aW5ncyhjYW52YXM6IENhbnZhcyB8IG51bGwpIHtcclxuICAgIGlmICghY2FudmFzKSByZXR1cm5cclxuXHJcbiAgICBmb3IgKGNvbnN0IHNldHRpbmcgb2YgRVhQT1NFRF9TRVRUSU5HUykge1xyXG4gICAgICBjYW52YXMud3JhcHBlckVsLmRhdGFzZXRbc2V0dGluZ10gPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5nZXRTZXR0aW5nKHNldHRpbmcpLnRvU3RyaW5nKClcclxuICAgIH1cclxuICB9XHJcbn0iLCAiaW1wb3J0IEFwcCwgeyBNb2RhbCwgU2V0dGluZyB9IGZyb20gXCJvYnNpZGlhblwiXHJcbmltcG9ydCB7IENhbnZhcyB9IGZyb20gXCJzcmMvQHR5cGVzL0NhbnZhc1wiXHJcbmltcG9ydCB7IENhbnZhc0V2ZW50IH0gZnJvbSBcInNyYy9jb3JlL2V2ZW50c1wiXHJcbmltcG9ydCBBZHZhbmNlZENhbnZhc1BsdWdpbiBmcm9tIFwic3JjL21haW5cIlxyXG5pbXBvcnQgKiBhcyBDYW52YXNIZWxwZXIgZnJvbSBcInNyYy91dGlscy9jYW52YXMtaGVscGVyXCJcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFByb3BlcnRpZXNDYW52YXNFeHRlbnNpb24ge1xyXG4gIHBsdWdpbjogQWR2YW5jZWRDYW52YXNQbHVnaW5cclxuXHJcbiAgY29uc3RydWN0b3IocGx1Z2luOiBBZHZhbmNlZENhbnZhc1BsdWdpbikge1xyXG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW5cclxuXHJcbiAgICBwbHVnaW4ucmVnaXN0ZXJFdmVudChwbHVnaW4uYXBwLndvcmtzcGFjZS5vbihcclxuICAgICAgQ2FudmFzRXZlbnQuQ2FudmFzQ2hhbmdlZCxcclxuICAgICAgKGNhbnZhczogQ2FudmFzKSA9PiB0aGlzLm9uQ2FudmFzQ2hhbmdlZChjYW52YXMpXHJcbiAgICApKVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBvbkNhbnZhc0NoYW5nZWQoY2FudmFzOiBDYW52YXMpIHtcclxuICAgIHRoaXMudXBkYXRlQ3NzQ2xhc3NlcyhjYW52YXMpXHJcblxyXG4gICAgY29uc3Qgc2V0dGluZ3NDb250YWluZXIgPSBjYW52YXMucXVpY2tTZXR0aW5nc0J1dHRvbj8ucGFyZW50RWxlbWVudFxyXG4gICAgaWYgKCFzZXR0aW5nc0NvbnRhaW5lcikgcmV0dXJuXHJcblxyXG4gICAgQ2FudmFzSGVscGVyLmFkZFF1aWNrU2V0dGluZ3NCdXR0b24oXHJcbiAgICAgIHNldHRpbmdzQ29udGFpbmVyLFxyXG4gICAgICBDYW52YXNIZWxwZXIuY3JlYXRlUXVpY2tTZXR0aW5nc0J1dHRvbih7XHJcbiAgICAgICAgaWQ6ICdwcm9wZXJ0aWVzJyxcclxuICAgICAgICBsYWJlbDogJ1Byb3BlcnRpZXMnLFxyXG4gICAgICAgIGljb246ICdzZXR0aW5ncy0yJyxcclxuICAgICAgICBjYWxsYmFjazogKCkgPT4gdGhpcy5vcGVuUHJvcGVydGllc0RpYWxvZyhjYW52YXMpXHJcbiAgICAgIH0pXHJcbiAgICApXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHByZXZpb3VzQ3NzY2xhc3Nlczogc3RyaW5nW10gPSBbXVxyXG4gIHByaXZhdGUgdXBkYXRlQ3NzQ2xhc3NlcyhjYW52YXM6IENhbnZhcykge1xyXG4gICAgdGhpcy5wcmV2aW91c0Nzc2NsYXNzZXMuZm9yRWFjaCgoY3NzY2xhc3MpID0+IHtcclxuICAgICAgY2FudmFzLndyYXBwZXJFbC5jbGFzc0xpc3QucmVtb3ZlKGNzc2NsYXNzKVxyXG4gICAgfSlcclxuXHJcbiAgICB0aGlzLnByZXZpb3VzQ3NzY2xhc3NlcyA9IGNhbnZhcy5tZXRhZGF0YS5wcm9wZXJ0aWVzPy5jc3NjbGFzc2VzIHx8IFtdXHJcbiAgICB0aGlzLnByZXZpb3VzQ3NzY2xhc3Nlcy5mb3JFYWNoKChjc3NjbGFzcykgPT4ge1xyXG4gICAgICBjYW52YXMud3JhcHBlckVsLmNsYXNzTGlzdC5hZGQoY3NzY2xhc3MpXHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBvcGVuUHJvcGVydGllc0RpYWxvZyhjYW52YXM6IENhbnZhcykge1xyXG4gICAgYXdhaXQgbmV3IFByb3BlcnRpZXNNb2RhbCh0aGlzLnBsdWdpbi5hcHAsIGNhbnZhcykuYXdhaXREaWFsb2coKVxyXG4gICAgdGhpcy51cGRhdGVDc3NDbGFzc2VzKGNhbnZhcylcclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIFByb3BlcnRpZXNNb2RhbCBleHRlbmRzIE1vZGFsIHtcclxuICBjYW52YXM6IENhbnZhc1xyXG5cclxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgY2FudmFzOiBDYW52YXMpIHtcclxuICAgIHN1cGVyKGFwcClcclxuICAgIHRoaXMuY2FudmFzID0gY2FudmFzXHJcbiAgfVxyXG5cclxuICBvbk9wZW4oKSB7XHJcbiAgICBuZXcgU2V0dGluZyh0aGlzLmNvbnRlbnRFbClcclxuICAgIC5zZXRIZWFkaW5nKClcclxuICAgIC5zZXROYW1lKFwiUHJvcGVydGllc1wiKVxyXG5cclxuICAgIG5ldyBTZXR0aW5nKHRoaXMuY29udGVudEVsKVxyXG4gICAgICAuc2V0TmFtZShcImNzc2NsYXNzZXNcIilcclxuICAgICAgLnNldFRvb2x0aXAoXCJBZGQgY2xhc3NlcyB0byB0aGUgY2FudmFzIHdyYXBwZXIgZWxlbWVudC4gU2VwYXJhdGUgbXVsdGlwbGUgY2xhc3NlcyB3aXRoIHNwYWNlcy5cIilcclxuICAgICAgLmFkZFRleHQoKHRleHQpID0+XHJcbiAgICAgICAgdGV4dFxyXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMuY2FudmFzLm1ldGFkYXRhLnByb3BlcnRpZXM/LmNzc2NsYXNzZXM/LmpvaW4oJyAnKSlcclxuICAgICAgICAgIC5vbkNoYW5nZSgodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jYW52YXMubWV0YWRhdGEucHJvcGVydGllcyA9IHRoaXMuY2FudmFzLm1ldGFkYXRhLnByb3BlcnRpZXMgfHwge31cclxuICAgICAgICAgICAgdGhpcy5jYW52YXMubWV0YWRhdGEucHJvcGVydGllcy5jc3NjbGFzc2VzID0gdmFsdWUuc3BsaXQoJyAnKVxyXG4gICAgICAgICAgfSlcclxuICAgICAgKS5zZXR0aW5nRWwuY2xhc3NMaXN0LmFkZCgncHJvcGVydGllcy1maWVsZCcpXHJcbiAgfVxyXG5cclxuICBvbkNsb3NlKCkge31cclxuXHJcbiAgYXdhaXREaWFsb2coKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcclxuICAgICAgdGhpcy5vbkNsb3NlID0gKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuY29udGVudEVsLmVtcHR5KClcclxuICAgICAgICByZXNvbHZlKClcclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy5vcGVuKClcclxuICAgIH0pXHJcbiAgfVxyXG59Il0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLElBQUFBLG1CQUFpQzs7O0FDQWpDLHNCQUFrRDtBQUdsRCxJQUFNLDZCQUE2QjtBQUFBLEVBQ2pDLFFBQVE7QUFBQSxFQUNSLFFBQVE7QUFDVjtBQThDTyxJQUFNLG1CQUEwRDtBQUFBLEVBQ3JFLHVCQUF1QixPQUFPLEtBQUssMEJBQTBCLEVBQUUsTUFBTTtBQUFBLEVBQ3JFLHNCQUFzQjtBQUFBLEVBQ3RCLHVCQUF1QjtBQUFBLEVBQ3ZCLHNCQUFzQjtB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QTtBQUNGO0FBRUEsSUFBcUIsdUJBQXJCLGNBQWtELHdCQUFPO0FBQUEsRUFReEQsTUFBTSxTQUFTO0FBQ1osZ0JBQVksU0FBUztBQUVyQixTQUFLLFdBQVcsSUFBSSxnQkFBZ0IsSUFBSTtBQUN4QyxVQUFNLEtBQUssU0FBUyxhQUFhO0FBQ2pDLFNBQUssU0FBUyxlQUFlO0FBRTdCLFNBQUssaUJBQWlCLElBQUksZUFBZSxJQUFJO0FBRTdDLFNBQUsscUJBQXFCLElBQUksY0FBYyxJQUFJO0FBQ2hELFNBQUssbUJBQW1CLGtCQUFrQixJQUFJLENBQUMsY0FBYyxJQUFJLFVBQVUsSUFBSSxDQUFDO0FBQUEsRUFDbkY7QUFBQSxFQUVDLFdBQVc7QUFBQSxFQUFDO0FBQUEsRUFFWix1QkFBd0M7QUFDdEMsVUFBTSxhQUFhLEtBQUssSUFBSSxVQUFVLG9CQUFvQix5QkFBUTtBQUNsRSxTQUFJLHlDQUFZLG1CQUFrQjtBQUFVLGFBQU87QUFDbkQsV0FBTztBQUFBLEVBQ1Q7QUFBQSxFQUVBLG1CQUFnQztBQTFFbEM7QUEyRUksYUFBTyxVQUFLLHFCQUFxQixNQUExQixtQkFBNkIsV0FBVTtBQUFBLEVBQ2hEO0FBQUE7QUFBQSxFQUdBLGtCQUFrQjtBQUNoQixRQUFJLEtBQUs7QUFBYTtBQUN0QixTQUFLLGNBQWMsSUFBSSxZQUFZLElBQUk7QUFBQSxFQUN6QztBQUNGOyIsCiAgIm5hbWVzIjogWyJpbXBvcnRfb2JzaWRpYW4iLCAiaW1wb3J0X29ic2lkaWFuIiwgIl9hIiwgInVwZGF0ZSIsICJkYXRhIiwgImNhbnZhc1ZpZXciLCAiY2FudmFzIiwgImltcG9ydF9vYnNpZGlhbiIsICJjYW52YXMiLCAiaW1wb3J0X29ic2lkaWFuIiwgImltcG9ydF9vYnNpZGlhbiIsICJub2RlIiwgIl9hIiwgIl9iIiwgImltcG9ydF9vYnNpZGlhbiIsICJESVJFQ1RJT05TIiwgIm5vZGUiLCAiaW1wb3J0X29ic2lkaWFuIiwgIndpbmRvdyIsICJpbXBvcnRfb2JzaWRpYW4iXQp9Cg==
