/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => KeyValueListPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian5 = require("obsidian");

// src/key-value-list.ts
var import_state = require("@codemirror/state");
var import_obsidian2 = require("obsidian");
var import_view2 = require("@codemirror/view");
var import_obsidian3 = require("obsidian");

// src/widgets.ts
var import_view = require("@codemirror/view");
var import_obsidian = require("obsidian");
var KeyValueLineWidget = class extends import_view.WidgetType {
  constructor(plugin, listId, listIndex, textLine, maxKeyWidth, listItemWidth, path) {
    super();
    this.plugin = plugin;
    this.listId = listId;
    this.listIndex = listIndex;
    this.textLine = textLine;
    this.maxKeyWidth = maxKeyWidth;
    this.listItemWidth = listItemWidth;
    this.path = path;
  }
  eq(other) {
    return this.listId === other.listId && this.listIndex === other.listIndex && this.textLine === other.textLine && this.maxKeyWidth === other.maxKeyWidth && this.listItemWidth === other.listItemWidth && this.path === other.path;
  }
  toDOM() {
    const settings = this.plugin.settings;
    const isEven = this.listIndex % 2 == 0;
    const pieces = this.plugin.parser.getPiecesFromString(
      this.textLine
    );
    const row = document.createElement("span");
    row.id = `kvl-${this.listId}-${this.listIndex}`;
    row.className = `kvl-row kvl-row-${this.listId} ${isEven ? "kvl-row-even" : "kvl-row-odd"} ${settings.stripedBackgroundType === "default" ? "striped" : ""}`;
    if (isEven && settings.stripedBackgroundType === "custom") {
      row.style.backgroundColor = settings.stripedBackgroundColor;
    }
    row.style.padding = `${settings.verticalPadding}px ${settings.horizontalPadding}px`;
    if (this.listItemWidth.row) {
      row.style.minWidth = `${this.listItemWidth.row}px`;
    }
    const rowInner = document.createElement("span");
    rowInner.className = `kvl-row-inner kvl-row-inner-${this.listId}`;
    const keySpan = document.createElement(
      settings.boldKey ? "strong" : "span"
    );
    keySpan.className = `kvl-key kvl-key-${this.listId}`;
    if (this.listItemWidth.key) {
      keySpan.style.minWidth = `${this.listItemWidth.key}px`;
    }
    const keySpanInner = document.createElement("span");
    if (this.maxKeyWidth > 0) {
      keySpanInner.style.maxWidth = `${this.maxKeyWidth}px`;
    }
    if (settings.isKeyColored) {
      keySpanInner.style.color = settings.keyColor;
    }
    keySpanInner.className = `kvl-key-inner kvl-key-inner-${this.listId}`;
    this.renderMarkdown(pieces.key, keySpanInner);
    const valueSpan = document.createElement("span");
    valueSpan.className = "kvl-value";
    if (settings.isValueColored) {
      valueSpan.style.color = settings.valueColor;
    }
    this.renderMarkdown(pieces.value, valueSpan);
    row.appendChild(rowInner);
    rowInner.appendChild(keySpan);
    keySpan.appendChild(keySpanInner);
    rowInner.appendChild(valueSpan);
    return row;
  }
  renderMarkdown(html, container) {
    import_obsidian.MarkdownRenderer.render(
      this.plugin.app,
      html,
      container,
      this.path,
      this.plugin
    );
  }
  ignoreEvent() {
    return false;
  }
};

// src/key-value-list.ts
var excludeFileFromCssClasses = (plugin) => {
  const noteFile = plugin.app.workspace.getActiveFile();
  if (noteFile) {
    const metadata = plugin.app.metadataCache.getFileCache(noteFile);
    if (metadata == null ? void 0 : metadata.frontmatter) {
      return (metadata.frontmatter.cssclasses || []).includes("nokeyvalue");
    }
  }
  return false;
};
var KeyValueList = class {
  constructor(plugin, parser) {
    this.plugin = plugin;
    this.parser = parser;
  }
  async load() {
    const plugin = this.plugin;
    const parser = this.parser;
    this.plugin.registerMarkdownPostProcessor((element, context) => {
      if (!this.plugin.settings.activeInReadMode || excludeFileFromCssClasses(plugin)) {
        return;
      }
      for (const listElement of element.findAll("ul")) {
        const listItems = listElement.findAll("li");
        const isKeyValueList = listItems.every(
          (listItem) => parser.isKeyValueLiElem(listItem.innerText.trim())
        );
        if (isKeyValueList) {
          const table = document.createElement("table");
          table.classList.add("kvl-table");
          listElement.replaceWith(table);
          let rowIndex = 0;
          for (const listItem of listItems) {
            const tr = document.createElement("tr");
            if (++rowIndex % 2 == 0) {
              if (plugin.settings.stripedBackgroundType === "custom" && plugin.settings.stripedBackgroundColor) {
                tr.style.backgroundColor = plugin.settings.stripedBackgroundColor;
              }
              tr.classList.add("kvl-row-even");
            } else {
              tr.classList.add("kvl-row-odd");
            }
            table.appendChild(tr);
            const tdKey = document.createElement("td");
            tr.appendChild(tdKey);
            const pieces = parser.getPiecesFromLiElem(listItem);
            const keyElemType = plugin.settings.boldKey ? "strong" : "span";
            const keyElem = document.createElement(keyElemType);
            keyElem.innerHTML = pieces.key;
            if (plugin.settings.isKeyColored) {
              keyElem.style.color = plugin.settings.keyColor;
            }
            tdKey.style.padding = `${plugin.settings.verticalPadding + 2}px ${plugin.settings.horizontalPadding}px`;
            tdKey.appendChild(keyElem);
            const tdValue = document.createElement("td");
            tdValue.innerHTML = pieces.value;
            tdValue.style.padding = `${plugin.settings.verticalPadding + 2}px ${plugin.settings.horizontalPadding}px`;
            if (plugin.settings.isValueColored) {
              tdValue.style.color = plugin.settings.valueColor;
            }
            tr.appendChild(tdValue);
          }
        }
      }
    });
    let isPointerDown = false;
    this.plugin.registerDomEvent(window, "pointerdown", () => {
      isPointerDown = true;
    });
    this.plugin.registerDomEvent(window, "pointerup", () => {
      isPointerDown = false;
    });
    this.plugin.registerEditorExtension(
      import_view2.ViewPlugin.fromClass(
        class KVLPlugin {
          constructor(view) {
            this.setupEditor = () => {
              const field = this.view.state.field(import_obsidian3.editorInfoField);
              let editor;
              try {
                editor = field.editor;
              } catch (error) {
                editor = void 0;
              }
              if (!editor) {
                setTimeout(this.setupEditor, 0);
                return;
              }
              this.editor = editor;
              this.updateCounter = 10;
            };
            this.view = view;
            this.listWidths = [];
            this.lastTouchedListIndex = -1;
            this.updateCounter = 0;
            this.decorations = this.buildDecorations(view, []);
            this.setupEditor();
          }
          update(update) {
            if (isPointerDown)
              return;
            if (!this.editor || !plugin.settings.activeInEditMode || excludeFileFromCssClasses(plugin)) {
              this.decorations = import_view2.Decoration.none;
              return;
            }
            const lists = this.view.viewportLineBlocks.length > 0 && this.view.visibleRanges.length > 0 ? parser.collectLists(
              this.editor,
              this.editor.offsetToPos(this.view.viewport.from).line,
              this.editor.offsetToPos(this.view.viewport.to).line
            ).filter((list) => list.isKeyValueList) : [];
            if (lists.length != this.listWidths.length) {
              this.listWidths = lists.map(() => ({
                key: 0,
                row: 0,
                keyNeedsUpdate: true,
                rowNeedsUpdate: true
              }));
            }
            const touchedListIndex = lists.findIndex(
              (list) => list.hasCursorInside
            );
            const isAnyListTouched = touchedListIndex >= 0;
            if (!isAnyListTouched && this.lastTouchedListIndex !== -1) {
              if (this.listWidths[this.lastTouchedListIndex]) {
                this.listWidths[this.lastTouchedListIndex].keyNeedsUpdate = true;
                this.listWidths[this.lastTouchedListIndex].rowNeedsUpdate = false;
              }
              this.lastTouchedListIndex = -1;
              this.updateCounter = 3;
            } else if (isAnyListTouched) {
              this.lastTouchedListIndex = touchedListIndex;
            }
            if (update.docChanged || update.viewportChanged || isAnyListTouched || this.updateCounter || parser.needsUpdate) {
              if (this.updateCounter > 0) {
                this.updateCounter--;
              }
              if (parser.needsUpdate) {
                parser.needsUpdate = false;
              }
              this.decorations = this.buildDecorations(update.view, lists);
            }
          }
          getListWidths(lists) {
            lists.forEach((_list, index) => {
              this.listWidths[index] = {
                key: Math.max(
                  this.listWidths[index].keyNeedsUpdate ? 0 : this.listWidths[index].key,
                  ...Array.from(
                    document.getElementsByClassName(`kvl-key-inner-${index}`)
                  ).map((elem) => elem.clientWidth + 20)
                ),
                row: Math.max(
                  this.listWidths[index].rowNeedsUpdate ? 0 : this.listWidths[index].row,
                  ...Array.from(
                    document.getElementsByClassName(`kvl-row-inner-${index}`)
                  ).map(
                    (elem) => elem.children[0].clientWidth + elem.children[1].clientWidth + plugin.settings.horizontalPadding * 2 + (elem.querySelector("a") ? 16 : 0)
                  )
                ),
                keyNeedsUpdate: false,
                rowNeedsUpdate: this.listWidths[index].keyNeedsUpdate
              };
            });
          }
          buildDecorations(view, lists) {
            const builder = new import_state.RangeSetBuilder();
            if (!this.editor || excludeFileFromCssClasses(plugin)) {
              return builder.finish();
            }
            const cursor = this.editor.getCursor();
            this.getListWidths(lists);
            const maxKeyWidth = plugin.settings.maxKeyWidth / 100 * view.dom.clientWidth;
            const markdownView = plugin.app.workspace.getActiveViewOfType(import_obsidian2.MarkdownView);
            lists.forEach((list, index) => {
              var _a;
              for (let lineNumber = list.start.line; lineNumber < list.end.line; lineNumber++) {
                if (lineNumber === cursor.line) {
                  continue;
                }
                const line = view.state.doc.line(lineNumber + 1);
                builder.add(
                  line.from,
                  line.to,
                  import_view2.Decoration.replace({
                    widget: new KeyValueLineWidget(
                      plugin,
                      index,
                      lineNumber,
                      line.text,
                      maxKeyWidth,
                      this.listWidths[index],
                      ((_a = markdownView == null ? void 0 : markdownView.file) == null ? void 0 : _a.path) || ""
                    )
                  })
                );
              }
            });
            return builder.finish();
          }
        },
        {
          decorations: (value) => plugin.settings.activeInEditMode && !excludeFileFromCssClasses(plugin) ? value.decorations : import_view2.Decoration.none
        }
      )
    );
  }
  async unload() {
  }
};

// src/settings.ts
var import_obsidian4 = require("obsidian");
var DEFAULT_SETTINGS = {
  activeInEditMode: true,
  activeInReadMode: true,
  displayBullet: false,
  displayBulletChar: "-",
  delimiter: ":",
  displayDelimiter: true,
  maxKeyWidth: 50,
  verticalPadding: 3,
  horizontalPadding: 12,
  boldKey: true,
  stripedBackgroundType: "default",
  stripedBackgroundColor: "",
  isKeyColored: false,
  keyColor: "",
  isValueColored: false,
  valueColor: ""
};
var SettingTab = class extends import_obsidian4.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    const foldablePadding = 42;
    new import_obsidian4.Setting(containerEl).setName("Active in edit mode").setDesc("If the plugin should be active in edit mode").addToggle(
      (toggle) => toggle.setValue(this.plugin.settings.activeInEditMode).onChange(async (value) => {
        this.plugin.settings.activeInEditMode = value;
        await this.plugin.saveData(this.plugin.settings);
        this.plugin.refresh();
      })
    );
    new import_obsidian4.Setting(containerEl).setName("Active in read mode").setDesc("If the plugin should be active in read mode").addToggle(
      (toggle) => toggle.setValue(this.plugin.settings.activeInReadMode).onChange(async (value) => {
        this.plugin.settings.activeInReadMode = value;
        await this.plugin.saveData(this.plugin.settings);
        this.plugin.refresh();
      })
    );
    new import_obsidian4.Setting(containerEl).setName("Display bullet").setDesc("If the bullet should be displayed or not").addToggle(
      (toggle) => toggle.setValue(this.plugin.settings.displayBullet).onChange(async (value) => {
        displayBulletChar.settingEl.toggleClass("disabled", !value);
        displayBulletChar.settingEl.style.height = value ? `${displayBulletChar.settingEl.innerHeight + foldablePadding}px` : "0px";
        this.plugin.settings.displayBullet = value;
        await this.plugin.saveData(this.plugin.settings);
        this.plugin.refresh();
      })
    );
    const displayBulletChar = new import_obsidian4.Setting(containerEl).setName("Bullet character").setDesc(
      "The character(s) to be displayed for bullets. The trigger bullet will always be a dash (-) regardless of this setting."
    ).setClass("foldable-setting").setClass(this.plugin.settings.displayBullet ? "enabled" : "disabled").addText(
      (text) => text.setPlaceholder(DEFAULT_SETTINGS.displayBulletChar).setValue(this.plugin.settings.displayBulletChar).onChange(async (value) => {
        this.plugin.settings.displayBulletChar = value;
        await this.plugin.saveSettings();
        this.plugin.refresh();
      })
    ).then((setting) => {
      setting.settingEl.style.height = this.plugin.settings.displayBullet ? `${setting.settingEl.clientHeight}px` : "0px";
    });
    new import_obsidian4.Setting(containerEl).setName("Display delimiter").setDesc("If the delimiter should be displayed in the key or not").addToggle(
      (toggle) => toggle.setValue(this.plugin.settings.displayDelimiter).onChange(async (value) => {
        displayDelimiterChar.settingEl.toggleClass("disabled", !value);
        displayDelimiterChar.settingEl.style.height = value ? `${displayDelimiterChar.settingEl.innerHeight + foldablePadding}px` : "0px";
        this.plugin.settings.displayDelimiter = value;
        await this.plugin.saveData(this.plugin.settings);
        this.plugin.refresh();
      })
    );
    const displayDelimiterChar = new import_obsidian4.Setting(containerEl).setName("Delimiter").setDesc(
      "The character(s) that separate the key from the value. It is possible to use several different delimiters, by separating them with commas"
    ).setClass("foldable-setting").setClass(this.plugin.settings.displayDelimiter ? "enabled" : "disabled").addText(
      (text) => text.setPlaceholder(DEFAULT_SETTINGS.delimiter).setValue(this.plugin.settings.delimiter).onChange(async (value) => {
        this.plugin.settings.delimiter = value;
        await this.plugin.saveSettings();
        this.plugin.refresh();
      })
    ).then((setting) => {
      setting.settingEl.style.height = this.plugin.settings.displayDelimiter ? `${setting.settingEl.clientHeight}px` : "0px";
    });
    new import_obsidian4.Setting(containerEl).setName("Max key width").setDesc(
      "Maximum width of the key in percent of the editor width. 0 = no limit"
    ).addSlider(
      (slider) => slider.setLimits(0, 99, 1).setValue(this.plugin.settings.maxKeyWidth).setDynamicTooltip().onChange(async (value) => {
        this.plugin.settings.maxKeyWidth = value;
        await this.plugin.saveData(this.plugin.settings);
        this.plugin.refresh();
      })
    );
    new import_obsidian4.Setting(containerEl).setName("Vertical padding").setDesc("Vertical padding of the key-value list rows (in pixels)").addText(
      (text) => {
        var _a;
        return text.setPlaceholder(DEFAULT_SETTINGS.verticalPadding.toString()).setValue((_a = this.plugin.settings.verticalPadding) == null ? void 0 : _a.toString()).onChange(async (value) => {
          let numericValue = parseInt(value);
          if (isNaN(numericValue)) {
            numericValue = 0;
          }
          this.plugin.settings.verticalPadding = numericValue;
          text.setValue(numericValue.toString());
          await this.plugin.saveSettings();
          this.plugin.refresh();
        });
      }
    );
    new import_obsidian4.Setting(containerEl).setName("Horizontal padding").setDesc("Horizontal padding of the key-value list rows (in pixels)").addText(
      (text) => {
        var _a;
        return text.setPlaceholder(DEFAULT_SETTINGS.horizontalPadding.toString()).setValue((_a = this.plugin.settings.horizontalPadding) == null ? void 0 : _a.toString()).onChange(async (value) => {
          let numericValue = parseInt(value);
          if (isNaN(numericValue)) {
            numericValue = 0;
          }
          this.plugin.settings.horizontalPadding = numericValue;
          text.setValue(numericValue.toString());
          await this.plugin.saveSettings();
          this.plugin.refresh();
        });
      }
    );
    new import_obsidian4.Setting(containerEl).setName("Bold keys").setDesc("It the keys should be rendered in a bold font").addToggle(
      (toggle) => toggle.setValue(this.plugin.settings.boldKey).onChange(async (value) => {
        this.plugin.settings.boldKey = value;
        await this.plugin.saveData(this.plugin.settings);
        this.plugin.refresh();
      })
    );
    const backgroundColorOptions = [
      { key: "none", label: "No background color" },
      { key: "default", label: "Default background color (based on theme)" },
      { key: "custom", label: "Custom background color" }
    ];
    new import_obsidian4.Setting(containerEl).setName("Striped background").setDesc("Choose if even rows should have another background color").addDropdown((dropdown) => {
      backgroundColorOptions.forEach((option) => {
        dropdown.addOption(option.key, option.label);
      });
      dropdown.setValue(this.plugin.settings.stripedBackgroundType);
      dropdown.onChange(async (value) => {
        this.plugin.settings.stripedBackgroundType = value;
        await this.plugin.saveData(this.plugin.settings);
        this.display();
        this.plugin.refresh();
      });
    });
    if (this.plugin.settings.stripedBackgroundType === "custom") {
      new import_obsidian4.Setting(containerEl).setName("Striped background color").setDesc("Choose the color of the striped background.").addColorPicker(
        (color) => color.setValue(this.plugin.settings.stripedBackgroundColor).onChange(async (value) => {
          this.plugin.settings.stripedBackgroundColor = value;
          await this.plugin.saveData(this.plugin.settings);
          this.plugin.refresh();
        })
      );
    }
    new import_obsidian4.Setting(containerEl).setName("Custom key color").setDesc("If a custom color should be used for the keys").addToggle(
      (toggle) => toggle.setValue(this.plugin.settings.isKeyColored).onChange(async (value) => {
        this.plugin.settings.isKeyColored = value;
        await this.plugin.saveData(this.plugin.settings);
        this.display();
        this.plugin.refresh();
      })
    );
    if (this.plugin.settings.isKeyColored) {
      new import_obsidian4.Setting(containerEl).setName("Key color").setDesc("Choose the color of the keys.").addColorPicker(
        (color) => color.setValue(this.plugin.settings.keyColor).onChange(async (value) => {
          this.plugin.settings.keyColor = value;
          await this.plugin.saveData(this.plugin.settings);
          this.plugin.refresh();
        })
      );
    }
    new import_obsidian4.Setting(containerEl).setName("Custom value color").setDesc("If a custom color should be used for the values").addToggle(
      (toggle) => toggle.setValue(this.plugin.settings.isValueColored).onChange(async (value) => {
        this.plugin.settings.isValueColored = value;
        await this.plugin.saveData(this.plugin.settings);
        this.display();
        this.plugin.refresh();
      })
    );
    if (this.plugin.settings.isValueColored) {
      new import_obsidian4.Setting(containerEl).setName("Value color").setDesc("Choose the color of the values.").addColorPicker(
        (color) => color.setValue(this.plugin.settings.valueColor).onChange(async (value) => {
          this.plugin.settings.valueColor = value;
          await this.plugin.saveData(this.plugin.settings);
          this.plugin.refresh();
        })
      );
    }
    new import_obsidian4.Setting(containerEl).setName("Reset settings").setDesc("Reset all settings to their default values").addButton(
      (button) => button.setButtonText("Reset settings").onClick(async () => {
        if (confirm("Are you sure you want to reset the settings?")) {
          this.plugin.settings = Object.assign({}, DEFAULT_SETTINGS);
          await this.plugin.saveData(this.plugin.settings);
          this.display();
          this.plugin.refresh();
        }
      })
    );
  }
};

// src/list.ts
var List = class {
  constructor(start, end, isKeyValueList, hasCursorInside) {
    this.start = start;
    this.end = end;
    this.isKeyValueList = isKeyValueList;
    this.hasCursorInside = hasCursorInside;
  }
};

// src/utils.ts
function escapeRegExp(string) {
  return string.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
}
function removeInvalidHtmlTags(inputString) {
  const tagRegex = /<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;
  let match;
  const stack = [];
  const invalidTags = [];
  while ((match = tagRegex.exec(inputString)) !== null) {
    const fullTag = match[0];
    const tagName = match[1];
    const isClosingTag = fullTag[1] === "/";
    if (isClosingTag) {
      if (stack.length === 0 || stack[stack.length - 1].tagName !== tagName) {
        invalidTags.push(fullTag);
      } else {
        stack.pop();
      }
    } else {
      stack.push({ tagName, fullTag });
    }
  }
  stack.forEach((tag) => invalidTags.push(tag.fullTag));
  let resultString = inputString;
  invalidTags.forEach((tag) => {
    resultString = resultString.replace(tag, "");
  });
  return resultString;
}

// src/list-parser.ts
var listItemReg = new RegExp(`^[ 	]*-(.*)`);
var ListParser = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.needsUpdate = false;
    this.update();
  }
  update() {
    const bullet = "-";
    const delimiter = escapeRegExp(
      this.plugin.settings.delimiter || DEFAULT_SETTINGS.delimiter
    );
    const delimiters = delimiter.split(",").map((d) => d.trim()).join("|");
    this.keyValueReg = new RegExp(
      `^[ 	]*${bullet}(.*[^:])(${delimiters}) (.*)`
    );
    this.liElemReg = new RegExp(`^(.*[^:])(${delimiters}) (.*)$`);
    this.needsUpdate = true;
  }
  /**
   * Collects all lists within a given range.
   * @param  {Editor} editor    The editor to parse.
   * @param  {Number} startLine The line to start parsing from.
   * @param  {Number} endLine   The line to stop parsing at.
   * @return {List[]}           A list of all lists found.
   * @public
   */
  collectLists(editor, startLine = 0, endLine = editor.lastLine()) {
    const lists = [];
    const cursorLine = editor.getCursor().line;
    for (let currentLine = startLine; currentLine <= endLine; currentLine++) {
      const line = editor.getLine(currentLine);
      if (this.isLineList(line)) {
        let isKeyValueList = true;
        let hasCursorInside = false;
        let listEndLineLookup = currentLine;
        while (listEndLineLookup <= editor.lastLine()) {
          const line2 = editor.getLine(listEndLineLookup);
          if (!this.isLineList(line2)) {
            break;
          }
          if (cursorLine === listEndLineLookup) {
            hasCursorInside = true;
          }
          if (!this.isKeyValueListItem(line2) && cursorLine !== listEndLineLookup) {
            isKeyValueList = false;
          }
          if (listEndLineLookup >= endLine) {
            listEndLineLookup = endLine;
            break;
          }
          listEndLineLookup++;
        }
        lists.push(
          new List(
            { line: currentLine, ch: 0 },
            {
              line: listEndLineLookup,
              ch: editor.getLine(listEndLineLookup).length
            },
            isKeyValueList,
            hasCursorInside
          )
        );
        currentLine = listEndLineLookup;
      }
    }
    return lists;
  }
  isLineList(line) {
    return listItemReg.test(line);
  }
  isKeyValueLiElem(line) {
    return this.liElemReg.test(line.replace("<br>", "\n"));
  }
  getPiecesFromLiElem(listItem) {
    const match = listItem.innerHTML.replace("\n", " ").trim().replace("&gt;", ">").replace("&lt;", "<").match(this.liElemReg);
    let key = (match == null ? void 0 : match[1]) || "";
    if (this.plugin.settings.displayBullet) {
      key = `${this.plugin.settings.displayBulletChar} ${key}`;
    }
    const delimiter = ((match == null ? void 0 : match[2]) || "").replace(">", "&gt;").replace("<", "&lt;");
    if (this.plugin.settings.displayDelimiter) {
      key = `${key}${delimiter}`;
    }
    return {
      key: removeInvalidHtmlTags(key),
      delimiter,
      value: removeInvalidHtmlTags((match == null ? void 0 : match[3]) || "")
    };
  }
  getPiecesFromString(line) {
    const match = line.replace("&gt;", ">").replace("&lt;", "<").match(this.liElemReg);
    let key = ((match == null ? void 0 : match[1]) || "").substring(2);
    if (this.plugin.settings.displayBullet) {
      key = `\\${this.plugin.settings.displayBulletChar} ${key}`;
    }
    if (!this.plugin.settings.displayBullet && key.charAt(0) === "[") {
      key = `- ${key}`;
    } else if (this.plugin.settings.displayBullet && key.startsWith("\\- [")) {
      key = key.substring(1);
    }
    const delimiter = ((match == null ? void 0 : match[2]) || "").replace(">", "&gt;").replace("<", "&lt;");
    if (this.plugin.settings.displayDelimiter) {
      key = `${key}${delimiter}`;
    }
    const value = ((match == null ? void 0 : match[3]) || "").replace(/\[(\^\d+)\]/g, "\\$1");
    return {
      key,
      delimiter,
      value
    };
  }
  isKeyValueListItem(line) {
    return this.keyValueReg.test(line);
  }
};

// src/main.ts
var KeyValueListPlugin = class extends import_obsidian5.Plugin {
  async onload() {
    await this.loadSettings();
    this.parser = new ListParser(this);
    new KeyValueList(this, this.parser).load();
    this.addSettingTab(new SettingTab(this.app, this));
    this.registerEvent(
      this.app.metadataCache.on("changed", () => {
        this.renderPreviewMode();
      })
    );
  }
  renderPreviewMode() {
    const view = this.app.workspace.getActiveViewOfType(import_obsidian5.MarkdownView);
    if (view) {
      view.previewMode.rerender(true);
    }
  }
  refresh() {
    this.app.workspace.updateOptions();
    this.parser.update();
    this.renderPreviewMode();
  }
  onunload() {
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL2tleS12YWx1ZS1saXN0LnRzIiwgInNyYy93aWRnZXRzLnRzIiwgInNyYy9zZXR0aW5ncy50cyIsICJzcmMvbGlzdC50cyIsICJzcmMvdXRpbHMudHMiLCAic3JjL2xpc3QtcGFyc2VyLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgeyBNYXJrZG93blZpZXcsIFBsdWdpbiB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgS2V5VmFsdWVMaXN0IH0gZnJvbSBcInNyYy9rZXktdmFsdWUtbGlzdFwiO1xuXG5pbXBvcnQge1xuICBERUZBVUxUX1NFVFRJTkdTLFxuICBLZXlWYWx1ZUxpc3RQbHVnaW5TZXR0aW5ncyxcbiAgU2V0dGluZ1RhYixcbn0gZnJvbSBcIi4vc2V0dGluZ3NcIjtcbmltcG9ydCB7IExpc3RQYXJzZXIgfSBmcm9tIFwiLi9saXN0LXBhcnNlclwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBLZXlWYWx1ZUxpc3RQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xuICBzZXR0aW5nczogS2V5VmFsdWVMaXN0UGx1Z2luU2V0dGluZ3M7XG4gIHBhcnNlcjogTGlzdFBhcnNlcjtcblxuICBhc3luYyBvbmxvYWQoKSB7XG4gICAgYXdhaXQgdGhpcy5sb2FkU2V0dGluZ3MoKTtcbiAgICB0aGlzLnBhcnNlciA9IG5ldyBMaXN0UGFyc2VyKHRoaXMpO1xuICAgIG5ldyBLZXlWYWx1ZUxpc3QodGhpcywgdGhpcy5wYXJzZXIpLmxvYWQoKTtcblxuICAgIC8vIEFkZCBhIHNldHRpbmdzIHRhYlxuICAgIHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgU2V0dGluZ1RhYih0aGlzLmFwcCwgdGhpcykpO1xuXG4gICAgdGhpcy5yZWdpc3RlckV2ZW50KFxuICAgICAgdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5vbihcImNoYW5nZWRcIiwgKCkgPT4ge1xuICAgICAgICB0aGlzLnJlbmRlclByZXZpZXdNb2RlKCk7XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICByZW5kZXJQcmV2aWV3TW9kZSgpIHtcbiAgICAvLyBUcmlnZ2VyIGEgcmUtcmVuZGVyIG9mIHRoZSBjdXJyZW50IG5vdGUgd2hlbiB0aGUgc2V0dGluZ3MgY2hhbmdlXG4gICAgLy8gdG8gZm9yY2UgdGhlIHJlZ2lzdGVyTWFya2Rvd25Qb3N0UHJvY2Vzc29yIHRvIHJlcHJvY2VzcyB0aGUgTWFya2Rvd24uXG4gICAgY29uc3QgdmlldyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKE1hcmtkb3duVmlldyk7XG4gICAgaWYgKHZpZXcpIHtcbiAgICAgIHZpZXcucHJldmlld01vZGUucmVyZW5kZXIodHJ1ZSk7XG4gICAgfVxuICB9XG5cbiAgcmVmcmVzaCgpIHtcbiAgICB0aGlzLmFwcC53b3Jrc3BhY2UudXBkYXRlT3B0aW9ucygpO1xuICAgIHRoaXMucGFyc2VyLnVwZGF0ZSgpO1xuICAgIHRoaXMucmVuZGVyUHJldmlld01vZGUoKTtcbiAgfVxuXG4gIG9udW5sb2FkKCkge31cblxuICBhc3luYyBsb2FkU2V0dGluZ3MoKSB7XG4gICAgdGhpcy5zZXR0aW5ncyA9IE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfU0VUVElOR1MsIGF3YWl0IHRoaXMubG9hZERhdGEoKSk7XG4gIH1cblxuICBhc3luYyBzYXZlU2V0dGluZ3MoKSB7XG4gICAgYXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcbiAgfVxufVxuIiwgImltcG9ydCB7IExpbmUgfSBmcm9tIFwiQGNvZGVtaXJyb3IvbGFuZ3VhZ2VcIjtcbmltcG9ydCB7IFJhbmdlU2V0QnVpbGRlciB9IGZyb20gXCJAY29kZW1pcnJvci9zdGF0ZVwiO1xuaW1wb3J0IHsgRWRpdG9yUG9zaXRpb24sIE1hcmtkb3duVmlldywgVEZpbGUgfSBmcm9tIFwib2JzaWRpYW5cIjtcblxuaW1wb3J0IHtcbiAgRGVjb3JhdGlvbixcbiAgRGVjb3JhdGlvblNldCxcbiAgRWRpdG9yVmlldyxcbiAgUGx1Z2luVmFsdWUsXG4gIFZpZXdQbHVnaW4sXG4gIFZpZXdVcGRhdGUsXG59IGZyb20gXCJAY29kZW1pcnJvci92aWV3XCI7XG5pbXBvcnQgeyBFZGl0b3IsIGVkaXRvckluZm9GaWVsZCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IEtleVZhbHVlTGlzdFBsdWdpbiBmcm9tIFwiLi9tYWluXCI7XG5pbXBvcnQgeyBMaXN0IH0gZnJvbSBcIi4vbGlzdFwiO1xuaW1wb3J0IHsgS2V5VmFsdWVQaWVjZSwgTGlzdEl0ZW1XaWR0aCB9IGZyb20gXCIuL3R5cGVzXCI7XG5pbXBvcnQgeyBLZXlWYWx1ZUxpbmVXaWRnZXQgfSBmcm9tIFwiLi93aWRnZXRzXCI7XG5pbXBvcnQgeyBMaXN0UGFyc2VyIH0gZnJvbSBcIi4vbGlzdC1wYXJzZXJcIjtcblxuY29uc3QgZXhjbHVkZUZpbGVGcm9tQ3NzQ2xhc3NlcyA9IChwbHVnaW46IEtleVZhbHVlTGlzdFBsdWdpbikgPT4ge1xuICBjb25zdCBub3RlRmlsZTogVEZpbGUgfCBudWxsID0gcGx1Z2luLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlRmlsZSgpO1xuICBpZiAobm90ZUZpbGUpIHtcbiAgICBjb25zdCBtZXRhZGF0YSA9IHBsdWdpbi5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUobm90ZUZpbGUpO1xuICAgIGlmIChtZXRhZGF0YT8uZnJvbnRtYXR0ZXIpIHtcbiAgICAgIHJldHVybiAobWV0YWRhdGEuZnJvbnRtYXR0ZXIuY3NzY2xhc3NlcyB8fCBbXSkuaW5jbHVkZXMoXCJub2tleXZhbHVlXCIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZmFsc2U7XG59O1xuXG5leHBvcnQgY2xhc3MgS2V5VmFsdWVMaXN0IHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBwbHVnaW46IEtleVZhbHVlTGlzdFBsdWdpbiwgcHJpdmF0ZSBwYXJzZXI6IExpc3RQYXJzZXIpIHt9XG5cbiAgYXN5bmMgbG9hZCgpIHtcbiAgICBjb25zdCBwbHVnaW46IEtleVZhbHVlTGlzdFBsdWdpbiA9IHRoaXMucGx1Z2luO1xuICAgIGNvbnN0IHBhcnNlcjogTGlzdFBhcnNlciA9IHRoaXMucGFyc2VyO1xuXG4gICAgLy8gUmVnaXN0ZXIgYSBNYXJrZG93biBwb3N0IHByb2Nlc3NvciB0byBoYW5kbGUgcmVhZCBtb2RlLlxuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyTWFya2Rvd25Qb3N0UHJvY2Vzc29yKChlbGVtZW50LCBjb250ZXh0KSA9PiB7XG4gICAgICBpZiAoXG4gICAgICAgICF0aGlzLnBsdWdpbi5zZXR0aW5ncy5hY3RpdmVJblJlYWRNb2RlIHx8XG4gICAgICAgIGV4Y2x1ZGVGaWxlRnJvbUNzc0NsYXNzZXMocGx1Z2luKVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgZm9yIChjb25zdCBsaXN0RWxlbWVudCBvZiBlbGVtZW50LmZpbmRBbGwoXCJ1bFwiKSkge1xuICAgICAgICBjb25zdCBsaXN0SXRlbXMgPSBsaXN0RWxlbWVudC5maW5kQWxsKFwibGlcIik7XG4gICAgICAgIGNvbnN0IGlzS2V5VmFsdWVMaXN0ID0gbGlzdEl0ZW1zLmV2ZXJ5KChsaXN0SXRlbSkgPT5cbiAgICAgICAgICBwYXJzZXIuaXNLZXlWYWx1ZUxpRWxlbShsaXN0SXRlbS5pbm5lclRleHQudHJpbSgpKVxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChpc0tleVZhbHVlTGlzdCkge1xuICAgICAgICAgIC8vIFJlcGxhY2UgdGhlIGxpc3Qgd2l0aCBhIHRhYmxlIHdoZXJlIGV2ZXJ5IHJvdyBpcyBhIGxpc3QgaXRlbSwgYW5kIHRoZSBmaXJzdCBjb2x1bW4gaXMgdGhlIGtleSBhbmQgdGhlIHNlY29uZCBjb2x1bW4gaXMgdGhlIHZhbHVlLlxuICAgICAgICAgIGNvbnN0IHRhYmxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRhYmxlXCIpO1xuICAgICAgICAgIHRhYmxlLmNsYXNzTGlzdC5hZGQoXCJrdmwtdGFibGVcIik7XG4gICAgICAgICAgbGlzdEVsZW1lbnQucmVwbGFjZVdpdGgodGFibGUpO1xuICAgICAgICAgIGxldCByb3dJbmRleCA9IDA7XG4gICAgICAgICAgZm9yIChjb25zdCBsaXN0SXRlbSBvZiBsaXN0SXRlbXMpIHtcbiAgICAgICAgICAgIGNvbnN0IHRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRyXCIpO1xuXG4gICAgICAgICAgICAvLyBFdmVyeSBvdGhlciByb3cgc2hvdWxkIGhhdmUgYSBkaWZmZXJlbnQgYmFja2dyb3VuZCBjb2xvci5cbiAgICAgICAgICAgIGlmICgrK3Jvd0luZGV4ICUgMiA9PSAwKSB7XG4gICAgICAgICAgICAgIC8vIFNldCB0aGUgYmFja2dyb3VuZCBjb2xvciB0byB0aGUgc3RyaXBlZEJhY2tncm91bmRDb2xvciBzZXR0aW5nXG4gICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICBwbHVnaW4uc2V0dGluZ3Muc3RyaXBlZEJhY2tncm91bmRUeXBlID09PSBcImN1c3RvbVwiICYmXG4gICAgICAgICAgICAgICAgcGx1Z2luLnNldHRpbmdzLnN0cmlwZWRCYWNrZ3JvdW5kQ29sb3JcbiAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgdHIuc3R5bGUuYmFja2dyb3VuZENvbG9yID1cbiAgICAgICAgICAgICAgICAgIHBsdWdpbi5zZXR0aW5ncy5zdHJpcGVkQmFja2dyb3VuZENvbG9yO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHRyLmNsYXNzTGlzdC5hZGQoXCJrdmwtcm93LWV2ZW5cIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0ci5jbGFzc0xpc3QuYWRkKFwia3ZsLXJvdy1vZGRcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRhYmxlLmFwcGVuZENoaWxkKHRyKTtcbiAgICAgICAgICAgIGNvbnN0IHRkS2V5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRkXCIpO1xuICAgICAgICAgICAgdHIuYXBwZW5kQ2hpbGQodGRLZXkpO1xuXG4gICAgICAgICAgICBjb25zdCBwaWVjZXM6IEtleVZhbHVlUGllY2UgPSBwYXJzZXIuZ2V0UGllY2VzRnJvbUxpRWxlbShsaXN0SXRlbSk7XG5cbiAgICAgICAgICAgIC8vIElmIHRoZSBzZXR0aW5ncy5ib2xkS2V5IGlzIHRydWUsIHdyYXAgdGhlIGtleSBpbiBhIHN0cm9uZyB0YWcuXG4gICAgICAgICAgICBjb25zdCBrZXlFbGVtVHlwZTogc3RyaW5nID0gcGx1Z2luLnNldHRpbmdzLmJvbGRLZXlcbiAgICAgICAgICAgICAgPyBcInN0cm9uZ1wiXG4gICAgICAgICAgICAgIDogXCJzcGFuXCI7XG4gICAgICAgICAgICBjb25zdCBrZXlFbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChrZXlFbGVtVHlwZSk7XG4gICAgICAgICAgICBrZXlFbGVtLmlubmVySFRNTCA9IHBpZWNlcy5rZXk7XG4gICAgICAgICAgICBpZiAocGx1Z2luLnNldHRpbmdzLmlzS2V5Q29sb3JlZCkge1xuICAgICAgICAgICAgICBrZXlFbGVtLnN0eWxlLmNvbG9yID0gcGx1Z2luLnNldHRpbmdzLmtleUNvbG9yO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGRLZXkuc3R5bGUucGFkZGluZyA9IGAke3BsdWdpbi5zZXR0aW5ncy52ZXJ0aWNhbFBhZGRpbmcgKyAyfXB4ICR7XG4gICAgICAgICAgICAgIHBsdWdpbi5zZXR0aW5ncy5ob3Jpem9udGFsUGFkZGluZ1xuICAgICAgICAgICAgfXB4YDtcbiAgICAgICAgICAgIHRkS2V5LmFwcGVuZENoaWxkKGtleUVsZW0pO1xuXG4gICAgICAgICAgICBjb25zdCB0ZFZhbHVlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRkXCIpO1xuICAgICAgICAgICAgdGRWYWx1ZS5pbm5lckhUTUwgPSBwaWVjZXMudmFsdWU7XG4gICAgICAgICAgICB0ZFZhbHVlLnN0eWxlLnBhZGRpbmcgPSBgJHtwbHVnaW4uc2V0dGluZ3MudmVydGljYWxQYWRkaW5nICsgMn1weCAke1xuICAgICAgICAgICAgICBwbHVnaW4uc2V0dGluZ3MuaG9yaXpvbnRhbFBhZGRpbmdcbiAgICAgICAgICAgIH1weGA7XG4gICAgICAgICAgICBpZiAocGx1Z2luLnNldHRpbmdzLmlzVmFsdWVDb2xvcmVkKSB7XG4gICAgICAgICAgICAgIHRkVmFsdWUuc3R5bGUuY29sb3IgPSBwbHVnaW4uc2V0dGluZ3MudmFsdWVDb2xvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRyLmFwcGVuZENoaWxkKHRkVmFsdWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gS2VlcCB0cmFjayBvZiB0aGUgcG9pbnRlciBzdGF0ZS4gV2UncmUgYXZvaWRpbmcgdXBkYXRlcyB3aGVuIGl0J3MgZG93bixcbiAgICAvLyBzaW5jZSB0aGF0IHByZXZlbnRzIGxpbmsgY2xpY2tzIHRvIHdvcmsgcHJvcGVybHkgaW4gZWRpdCBtb2RlLlxuICAgIGxldCBpc1BvaW50ZXJEb3duID0gZmFsc2U7XG4gICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJEb21FdmVudCh3aW5kb3csIFwicG9pbnRlcmRvd25cIiwgKCkgPT4ge1xuICAgICAgaXNQb2ludGVyRG93biA9IHRydWU7XG4gICAgfSk7XG4gICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJEb21FdmVudCh3aW5kb3csIFwicG9pbnRlcnVwXCIsICgpID0+IHtcbiAgICAgIGlzUG9pbnRlckRvd24gPSBmYWxzZTtcbiAgICB9KTtcblxuICAgIC8vIFJlZ2lzdGVyIGEgQ29kZU1pcnJvciB2aWV3IHBsdWdpbiB0byBoYW5kbGUgZWRpdCBtb2RlLlxuICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRWRpdG9yRXh0ZW5zaW9uKFxuICAgICAgVmlld1BsdWdpbi5mcm9tQ2xhc3MoXG4gICAgICAgIGNsYXNzIEtWTFBsdWdpbiBpbXBsZW1lbnRzIFBsdWdpblZhbHVlIHtcbiAgICAgICAgICBkZWNvcmF0aW9uczogRGVjb3JhdGlvblNldDtcbiAgICAgICAgICBwYXJzZXI6IExpc3RQYXJzZXI7XG4gICAgICAgICAgdmlldzogRWRpdG9yVmlldztcbiAgICAgICAgICBsaXN0V2lkdGhzOiBMaXN0SXRlbVdpZHRoW107XG4gICAgICAgICAgZWRpdG9yOiBFZGl0b3I7XG4gICAgICAgICAgbGFzdFRvdWNoZWRMaXN0SW5kZXg6IG51bWJlcjtcbiAgICAgICAgICB1cGRhdGVDb3VudGVyOiBudW1iZXI7XG5cbiAgICAgICAgICBjb25zdHJ1Y3Rvcih2aWV3OiBFZGl0b3JWaWV3KSB7XG4gICAgICAgICAgICB0aGlzLnZpZXcgPSB2aWV3O1xuICAgICAgICAgICAgdGhpcy5saXN0V2lkdGhzID0gW107XG4gICAgICAgICAgICB0aGlzLmxhc3RUb3VjaGVkTGlzdEluZGV4ID0gLTE7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUNvdW50ZXIgPSAwO1xuICAgICAgICAgICAgdGhpcy5kZWNvcmF0aW9ucyA9IHRoaXMuYnVpbGREZWNvcmF0aW9ucyh2aWV3LCBbXSk7XG4gICAgICAgICAgICB0aGlzLnNldHVwRWRpdG9yKCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcHJpdmF0ZSBzZXR1cEVkaXRvciA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkID0gdGhpcy52aWV3LnN0YXRlLmZpZWxkKGVkaXRvckluZm9GaWVsZCk7XG4gICAgICAgICAgICAvLyBHZXQgdGhlIGVkaXRvciBmcm9tIHRoZSBmaWVsZCBidXQgY2F0Y2ggYW55IHR5cGUgZXJyb3JzIGhlcmVcbiAgICAgICAgICAgIC8vIGJlY2F1c2UgdGhlIGVkaXRvciBpcyBub3QgYXZhaWxhYmxlIGltbWVkaWF0ZWx5LlxuICAgICAgICAgICAgbGV0IGVkaXRvcjtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIGVkaXRvciA9IGZpZWxkLmVkaXRvcjtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgIGVkaXRvciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghZWRpdG9yKSB7XG4gICAgICAgICAgICAgIHNldFRpbWVvdXQodGhpcy5zZXR1cEVkaXRvciwgMCk7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZWRpdG9yID0gZWRpdG9yO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVDb3VudGVyID0gMTA7XG4gICAgICAgICAgfTtcblxuICAgICAgICAgIHVwZGF0ZSh1cGRhdGU6IFZpZXdVcGRhdGUpIHtcbiAgICAgICAgICAgIGlmIChpc1BvaW50ZXJEb3duKSByZXR1cm47XG5cbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgIXRoaXMuZWRpdG9yIHx8XG4gICAgICAgICAgICAgICFwbHVnaW4uc2V0dGluZ3MuYWN0aXZlSW5FZGl0TW9kZSB8fFxuICAgICAgICAgICAgICBleGNsdWRlRmlsZUZyb21Dc3NDbGFzc2VzKHBsdWdpbilcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICB0aGlzLmRlY29yYXRpb25zID0gRGVjb3JhdGlvbi5ub25lO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIENvbGxlY3QgYWxsIGxpc3RzIGluIHRoZSBjdXJyZW50IHZpZXdwb3J0LlxuICAgICAgICAgICAgY29uc3QgbGlzdHM6IExpc3RbXSA9XG4gICAgICAgICAgICAgIHRoaXMudmlldy52aWV3cG9ydExpbmVCbG9ja3MubGVuZ3RoID4gMCAmJlxuICAgICAgICAgICAgICB0aGlzLnZpZXcudmlzaWJsZVJhbmdlcy5sZW5ndGggPiAwXG4gICAgICAgICAgICAgICAgPyBwYXJzZXJcbiAgICAgICAgICAgICAgICAgICAgLmNvbGxlY3RMaXN0cyhcbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVkaXRvcixcbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVkaXRvci5vZmZzZXRUb1Bvcyh0aGlzLnZpZXcudmlld3BvcnQuZnJvbSkubGluZSxcbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVkaXRvci5vZmZzZXRUb1Bvcyh0aGlzLnZpZXcudmlld3BvcnQudG8pLmxpbmVcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChsaXN0OiBMaXN0KSA9PiBsaXN0LmlzS2V5VmFsdWVMaXN0KVxuICAgICAgICAgICAgICAgIDogW107XG5cbiAgICAgICAgICAgIC8vIElmIHRoZSBudW1iZXIgb2YgbGlzdHMgY2hhbmdlZCwgd2UgbmVlZCB0byByZXNldCB0aGUgbGlzdCB3aWR0aHMuXG4gICAgICAgICAgICBpZiAobGlzdHMubGVuZ3RoICE9IHRoaXMubGlzdFdpZHRocy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgdGhpcy5saXN0V2lkdGhzID0gbGlzdHMubWFwKCgpID0+ICh7XG4gICAgICAgICAgICAgICAga2V5OiAwLFxuICAgICAgICAgICAgICAgIHJvdzogMCxcbiAgICAgICAgICAgICAgICBrZXlOZWVkc1VwZGF0ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICByb3dOZWVkc1VwZGF0ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgY3Vyc29yIGlzIGluc2lkZSBhIGxpc3QuXG4gICAgICAgICAgICBjb25zdCB0b3VjaGVkTGlzdEluZGV4OiBudW1iZXIgPSBsaXN0cy5maW5kSW5kZXgoXG4gICAgICAgICAgICAgIChsaXN0KSA9PiBsaXN0Lmhhc0N1cnNvckluc2lkZVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGNvbnN0IGlzQW55TGlzdFRvdWNoZWQ6IGJvb2xlYW4gPSB0b3VjaGVkTGlzdEluZGV4ID49IDA7XG4gICAgICAgICAgICBpZiAoIWlzQW55TGlzdFRvdWNoZWQgJiYgdGhpcy5sYXN0VG91Y2hlZExpc3RJbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgaWYgKHRoaXMubGlzdFdpZHRoc1t0aGlzLmxhc3RUb3VjaGVkTGlzdEluZGV4XSkge1xuICAgICAgICAgICAgICAgIHRoaXMubGlzdFdpZHRoc1t0aGlzLmxhc3RUb3VjaGVkTGlzdEluZGV4XS5rZXlOZWVkc1VwZGF0ZSA9XG4gICAgICAgICAgICAgICAgICB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMubGlzdFdpZHRoc1t0aGlzLmxhc3RUb3VjaGVkTGlzdEluZGV4XS5yb3dOZWVkc1VwZGF0ZSA9XG4gICAgICAgICAgICAgICAgICBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB0aGlzLmxhc3RUb3VjaGVkTGlzdEluZGV4ID0gLTE7XG5cbiAgICAgICAgICAgICAgLy8gV2hlbiB0aGUgY3Vyc29yIGxlYXZlcyBhIGxpc3QsIHdlIG5lZWQgdG8gdXBkYXRlIHRoZSBkZWNvcmF0aW9uc1xuICAgICAgICAgICAgICAvLyB0d28gYWRkaXRpb25hbCB0aW1lcy4gT25lIHRvIGVuc3VyZSBwcm9wZXIga2V5IHdpZHRoIGFuZCBvbmUgZm9yXG4gICAgICAgICAgICAgIC8vIHRoZSByb3cgd2lkdGguXG4gICAgICAgICAgICAgIHRoaXMudXBkYXRlQ291bnRlciA9IDM7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlzQW55TGlzdFRvdWNoZWQpIHtcbiAgICAgICAgICAgICAgdGhpcy5sYXN0VG91Y2hlZExpc3RJbmRleCA9IHRvdWNoZWRMaXN0SW5kZXg7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgdXBkYXRlLmRvY0NoYW5nZWQgfHxcbiAgICAgICAgICAgICAgdXBkYXRlLnZpZXdwb3J0Q2hhbmdlZCB8fFxuICAgICAgICAgICAgICBpc0FueUxpc3RUb3VjaGVkIHx8XG4gICAgICAgICAgICAgIHRoaXMudXBkYXRlQ291bnRlciB8fFxuICAgICAgICAgICAgICBwYXJzZXIubmVlZHNVcGRhdGVcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICBpZiAodGhpcy51cGRhdGVDb3VudGVyID4gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQ291bnRlci0tO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmIChwYXJzZXIubmVlZHNVcGRhdGUpIHtcbiAgICAgICAgICAgICAgICBwYXJzZXIubmVlZHNVcGRhdGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB0aGlzLmRlY29yYXRpb25zID0gdGhpcy5idWlsZERlY29yYXRpb25zKHVwZGF0ZS52aWV3LCBsaXN0cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgZ2V0TGlzdFdpZHRocyhsaXN0czogTGlzdFtdKSB7XG4gICAgICAgICAgICBsaXN0cy5mb3JFYWNoKChfbGlzdDogTGlzdCwgaW5kZXg6IG51bWJlcikgPT4ge1xuICAgICAgICAgICAgICAvLyBHZXQgdGhlIG1heCB3aWR0aCBvZiB0aGUga2V5IGFuZCB0aGUgcm93IGZvciBldmVyeSBsaW5lIGluIHRoZSBsaXN0LlxuICAgICAgICAgICAgICB0aGlzLmxpc3RXaWR0aHNbaW5kZXhdID0ge1xuICAgICAgICAgICAgICAgIGtleTogTWF0aC5tYXgoXG4gICAgICAgICAgICAgICAgICB0aGlzLmxpc3RXaWR0aHNbaW5kZXhdLmtleU5lZWRzVXBkYXRlXG4gICAgICAgICAgICAgICAgICAgID8gMFxuICAgICAgICAgICAgICAgICAgICA6IHRoaXMubGlzdFdpZHRoc1tpbmRleF0ua2V5LFxuICAgICAgICAgICAgICAgICAgLi4uQXJyYXkuZnJvbShcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShga3ZsLWtleS1pbm5lci0ke2luZGV4fWApXG4gICAgICAgICAgICAgICAgICApLm1hcCgoZWxlbTogRWxlbWVudCkgPT4gZWxlbS5jbGllbnRXaWR0aCArIDIwKVxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgcm93OiBNYXRoLm1heChcbiAgICAgICAgICAgICAgICAgIHRoaXMubGlzdFdpZHRoc1tpbmRleF0ucm93TmVlZHNVcGRhdGVcbiAgICAgICAgICAgICAgICAgICAgPyAwXG4gICAgICAgICAgICAgICAgICAgIDogdGhpcy5saXN0V2lkdGhzW2luZGV4XS5yb3csXG4gICAgICAgICAgICAgICAgICAuLi5BcnJheS5mcm9tKFxuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGBrdmwtcm93LWlubmVyLSR7aW5kZXh9YClcbiAgICAgICAgICAgICAgICAgICkubWFwKFxuICAgICAgICAgICAgICAgICAgICAoZWxlbTogRWxlbWVudCkgPT5cbiAgICAgICAgICAgICAgICAgICAgICBlbGVtLmNoaWxkcmVuWzBdLmNsaWVudFdpZHRoICtcbiAgICAgICAgICAgICAgICAgICAgICBlbGVtLmNoaWxkcmVuWzFdLmNsaWVudFdpZHRoICtcbiAgICAgICAgICAgICAgICAgICAgICBwbHVnaW4uc2V0dGluZ3MuaG9yaXpvbnRhbFBhZGRpbmcgKiAyICtcbiAgICAgICAgICAgICAgICAgICAgICAoZWxlbS5xdWVyeVNlbGVjdG9yKFwiYVwiKSA/IDE2IDogMClcbiAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgIGtleU5lZWRzVXBkYXRlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICByb3dOZWVkc1VwZGF0ZTogdGhpcy5saXN0V2lkdGhzW2luZGV4XS5rZXlOZWVkc1VwZGF0ZSxcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGJ1aWxkRGVjb3JhdGlvbnModmlldzogRWRpdG9yVmlldywgbGlzdHM6IExpc3RbXSk6IERlY29yYXRpb25TZXQge1xuICAgICAgICAgICAgY29uc3QgYnVpbGRlciA9IG5ldyBSYW5nZVNldEJ1aWxkZXI8RGVjb3JhdGlvbj4oKTtcbiAgICAgICAgICAgIGlmICghdGhpcy5lZGl0b3IgfHwgZXhjbHVkZUZpbGVGcm9tQ3NzQ2xhc3NlcyhwbHVnaW4pKSB7XG4gICAgICAgICAgICAgIHJldHVybiBidWlsZGVyLmZpbmlzaCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgY3Vyc29yOiBFZGl0b3JQb3NpdGlvbiA9IHRoaXMuZWRpdG9yLmdldEN1cnNvcigpO1xuICAgICAgICAgICAgdGhpcy5nZXRMaXN0V2lkdGhzKGxpc3RzKTtcblxuICAgICAgICAgICAgY29uc3QgbWF4S2V5V2lkdGg6IG51bWJlciA9XG4gICAgICAgICAgICAgIChwbHVnaW4uc2V0dGluZ3MubWF4S2V5V2lkdGggLyAxMDApICogdmlldy5kb20uY2xpZW50V2lkdGg7XG4gICAgICAgICAgICBjb25zdCBtYXJrZG93blZpZXcgPVxuICAgICAgICAgICAgICBwbHVnaW4uYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKE1hcmtkb3duVmlldyk7XG5cbiAgICAgICAgICAgIGxpc3RzLmZvckVhY2goKGxpc3Q6IExpc3QsIGluZGV4OiBudW1iZXIpID0+IHtcbiAgICAgICAgICAgICAgZm9yIChcbiAgICAgICAgICAgICAgICBsZXQgbGluZU51bWJlcjogbnVtYmVyID0gbGlzdC5zdGFydC5saW5lO1xuICAgICAgICAgICAgICAgIGxpbmVOdW1iZXIgPCBsaXN0LmVuZC5saW5lO1xuICAgICAgICAgICAgICAgIGxpbmVOdW1iZXIrK1xuICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICBpZiAobGluZU51bWJlciA9PT0gY3Vyc29yLmxpbmUpIHtcbiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBsaW5lOiBMaW5lID0gdmlldy5zdGF0ZS5kb2MubGluZShsaW5lTnVtYmVyICsgMSk7XG4gICAgICAgICAgICAgICAgYnVpbGRlci5hZGQoXG4gICAgICAgICAgICAgICAgICBsaW5lLmZyb20sXG4gICAgICAgICAgICAgICAgICBsaW5lLnRvLFxuICAgICAgICAgICAgICAgICAgRGVjb3JhdGlvbi5yZXBsYWNlKHtcbiAgICAgICAgICAgICAgICAgICAgd2lkZ2V0OiBuZXcgS2V5VmFsdWVMaW5lV2lkZ2V0KFxuICAgICAgICAgICAgICAgICAgICAgIHBsdWdpbixcbiAgICAgICAgICAgICAgICAgICAgICBpbmRleCxcbiAgICAgICAgICAgICAgICAgICAgICBsaW5lTnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICAgIGxpbmUudGV4dCxcbiAgICAgICAgICAgICAgICAgICAgICBtYXhLZXlXaWR0aCxcbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxpc3RXaWR0aHNbaW5kZXhdLFxuICAgICAgICAgICAgICAgICAgICAgIG1hcmtkb3duVmlldz8uZmlsZT8ucGF0aCB8fCBcIlwiXG4gICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gYnVpbGRlci5maW5pc2goKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBkZWNvcmF0aW9uczogKHZhbHVlKSA9PlxuICAgICAgICAgICAgcGx1Z2luLnNldHRpbmdzLmFjdGl2ZUluRWRpdE1vZGUgJiZcbiAgICAgICAgICAgICFleGNsdWRlRmlsZUZyb21Dc3NDbGFzc2VzKHBsdWdpbilcbiAgICAgICAgICAgICAgPyB2YWx1ZS5kZWNvcmF0aW9uc1xuICAgICAgICAgICAgICA6IERlY29yYXRpb24ubm9uZSxcbiAgICAgICAgfVxuICAgICAgKVxuICAgICk7XG4gIH1cblxuICBhc3luYyB1bmxvYWQoKSB7fVxufVxuIiwgImltcG9ydCB7IFdpZGdldFR5cGUgfSBmcm9tIFwiQGNvZGVtaXJyb3Ivdmlld1wiO1xuaW1wb3J0IHsgS2V5VmFsdWVQaWVjZSwgTGlzdEl0ZW1XaWR0aCB9IGZyb20gXCIuL3R5cGVzXCI7XG5pbXBvcnQgS2V5VmFsdWVMaXN0UGx1Z2luIGZyb20gXCIuL21haW5cIjtcbmltcG9ydCB7IE1hcmtkb3duUmVuZGVyZXIgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IEtleVZhbHVlTGlzdFBsdWdpblNldHRpbmdzIH0gZnJvbSBcIi4vc2V0dGluZ3NcIjtcblxuZXhwb3J0IGNsYXNzIEtleVZhbHVlTGluZVdpZGdldCBleHRlbmRzIFdpZGdldFR5cGUge1xuICBjb25zdHJ1Y3RvcihcbiAgICByZWFkb25seSBwbHVnaW46IEtleVZhbHVlTGlzdFBsdWdpbixcbiAgICByZWFkb25seSBsaXN0SWQ6IG51bWJlcixcbiAgICByZWFkb25seSBsaXN0SW5kZXg6IG51bWJlcixcbiAgICByZWFkb25seSB0ZXh0TGluZTogc3RyaW5nLFxuICAgIHJlYWRvbmx5IG1heEtleVdpZHRoOiBudW1iZXIsXG4gICAgcmVhZG9ubHkgbGlzdEl0ZW1XaWR0aDogTGlzdEl0ZW1XaWR0aCxcbiAgICByZWFkb25seSBwYXRoOiBzdHJpbmdcbiAgKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIGVxKG90aGVyOiBLZXlWYWx1ZUxpbmVXaWRnZXQpIHtcbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy5saXN0SWQgPT09IG90aGVyLmxpc3RJZCAmJlxuICAgICAgdGhpcy5saXN0SW5kZXggPT09IG90aGVyLmxpc3RJbmRleCAmJlxuICAgICAgdGhpcy50ZXh0TGluZSA9PT0gb3RoZXIudGV4dExpbmUgJiZcbiAgICAgIHRoaXMubWF4S2V5V2lkdGggPT09IG90aGVyLm1heEtleVdpZHRoICYmXG4gICAgICB0aGlzLmxpc3RJdGVtV2lkdGggPT09IG90aGVyLmxpc3RJdGVtV2lkdGggJiZcbiAgICAgIHRoaXMucGF0aCA9PT0gb3RoZXIucGF0aFxuICAgICk7XG4gIH1cblxuICB0b0RPTSgpIHtcbiAgICBjb25zdCBzZXR0aW5nczogS2V5VmFsdWVMaXN0UGx1Z2luU2V0dGluZ3MgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncztcbiAgICBjb25zdCBpc0V2ZW46IGJvb2xlYW4gPSB0aGlzLmxpc3RJbmRleCAlIDIgPT0gMDtcbiAgICBjb25zdCBwaWVjZXM6IEtleVZhbHVlUGllY2UgPSB0aGlzLnBsdWdpbi5wYXJzZXIuZ2V0UGllY2VzRnJvbVN0cmluZyhcbiAgICAgIHRoaXMudGV4dExpbmVcbiAgICApO1xuXG4gICAgLy8gQ29udGFpbmVyXG4gICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgcm93LmlkID0gYGt2bC0ke3RoaXMubGlzdElkfS0ke3RoaXMubGlzdEluZGV4fWA7XG4gICAgcm93LmNsYXNzTmFtZSA9IGBrdmwtcm93IGt2bC1yb3ctJHt0aGlzLmxpc3RJZH0gJHtcbiAgICAgIGlzRXZlbiA/IFwia3ZsLXJvdy1ldmVuXCIgOiBcImt2bC1yb3ctb2RkXCJcbiAgICB9ICR7c2V0dGluZ3Muc3RyaXBlZEJhY2tncm91bmRUeXBlID09PSBcImRlZmF1bHRcIiA/IFwic3RyaXBlZFwiIDogXCJcIn1gO1xuICAgIGlmIChpc0V2ZW4gJiYgc2V0dGluZ3Muc3RyaXBlZEJhY2tncm91bmRUeXBlID09PSBcImN1c3RvbVwiKSB7XG4gICAgICByb3cuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gc2V0dGluZ3Muc3RyaXBlZEJhY2tncm91bmRDb2xvcjtcbiAgICB9XG4gICAgcm93LnN0eWxlLnBhZGRpbmcgPSBgJHtzZXR0aW5ncy52ZXJ0aWNhbFBhZGRpbmd9cHggJHtzZXR0aW5ncy5ob3Jpem9udGFsUGFkZGluZ31weGA7XG4gICAgaWYgKHRoaXMubGlzdEl0ZW1XaWR0aC5yb3cpIHtcbiAgICAgIHJvdy5zdHlsZS5taW5XaWR0aCA9IGAke3RoaXMubGlzdEl0ZW1XaWR0aC5yb3d9cHhgO1xuICAgIH1cblxuICAgIGNvbnN0IHJvd0lubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgcm93SW5uZXIuY2xhc3NOYW1lID0gYGt2bC1yb3ctaW5uZXIga3ZsLXJvdy1pbm5lci0ke3RoaXMubGlzdElkfWA7XG5cbiAgICAvLyBLZXlcbiAgICBjb25zdCBrZXlTcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcbiAgICAgIHNldHRpbmdzLmJvbGRLZXkgPyBcInN0cm9uZ1wiIDogXCJzcGFuXCJcbiAgICApO1xuICAgIGtleVNwYW4uY2xhc3NOYW1lID0gYGt2bC1rZXkga3ZsLWtleS0ke3RoaXMubGlzdElkfWA7XG4gICAgaWYgKHRoaXMubGlzdEl0ZW1XaWR0aC5rZXkpIHtcbiAgICAgIGtleVNwYW4uc3R5bGUubWluV2lkdGggPSBgJHt0aGlzLmxpc3RJdGVtV2lkdGgua2V5fXB4YDtcbiAgICB9XG5cbiAgICBjb25zdCBrZXlTcGFuSW5uZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcbiAgICBpZiAodGhpcy5tYXhLZXlXaWR0aCA+IDApIHtcbiAgICAgIGtleVNwYW5Jbm5lci5zdHlsZS5tYXhXaWR0aCA9IGAke3RoaXMubWF4S2V5V2lkdGh9cHhgO1xuICAgIH1cbiAgICBpZiAoc2V0dGluZ3MuaXNLZXlDb2xvcmVkKSB7XG4gICAgICBrZXlTcGFuSW5uZXIuc3R5bGUuY29sb3IgPSBzZXR0aW5ncy5rZXlDb2xvcjtcbiAgICB9XG4gICAga2V5U3BhbklubmVyLmNsYXNzTmFtZSA9IGBrdmwta2V5LWlubmVyIGt2bC1rZXktaW5uZXItJHt0aGlzLmxpc3RJZH1gO1xuICAgIHRoaXMucmVuZGVyTWFya2Rvd24ocGllY2VzLmtleSwga2V5U3BhbklubmVyKTtcblxuICAgIC8vIFZhbHVlXG4gICAgY29uc3QgdmFsdWVTcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgdmFsdWVTcGFuLmNsYXNzTmFtZSA9IFwia3ZsLXZhbHVlXCI7XG4gICAgaWYgKHNldHRpbmdzLmlzVmFsdWVDb2xvcmVkKSB7XG4gICAgICB2YWx1ZVNwYW4uc3R5bGUuY29sb3IgPSBzZXR0aW5ncy52YWx1ZUNvbG9yO1xuICAgIH1cblxuICAgIHRoaXMucmVuZGVyTWFya2Rvd24ocGllY2VzLnZhbHVlLCB2YWx1ZVNwYW4pO1xuXG4gICAgcm93LmFwcGVuZENoaWxkKHJvd0lubmVyKTtcbiAgICByb3dJbm5lci5hcHBlbmRDaGlsZChrZXlTcGFuKTtcbiAgICBrZXlTcGFuLmFwcGVuZENoaWxkKGtleVNwYW5Jbm5lcik7XG4gICAgcm93SW5uZXIuYXBwZW5kQ2hpbGQodmFsdWVTcGFuKTtcbiAgICByZXR1cm4gcm93O1xuICB9XG5cbiAgcmVuZGVyTWFya2Rvd24oaHRtbDogc3RyaW5nLCBjb250YWluZXI6IEhUTUxFbGVtZW50KSB7XG4gICAgTWFya2Rvd25SZW5kZXJlci5yZW5kZXIoXG4gICAgICB0aGlzLnBsdWdpbi5hcHAsXG4gICAgICBodG1sLFxuICAgICAgY29udGFpbmVyLFxuICAgICAgdGhpcy5wYXRoLFxuICAgICAgdGhpcy5wbHVnaW5cbiAgICApO1xuICB9XG5cbiAgaWdub3JlRXZlbnQoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG4iLCAiaW1wb3J0IHtcbiAgQXBwLFxuICBCdXR0b25Db21wb25lbnQsXG4gIENvbG9yQ29tcG9uZW50LFxuICBQbHVnaW5TZXR0aW5nVGFiLFxuICBTZXR0aW5nLFxuICBTbGlkZXJDb21wb25lbnQsXG4gIFRleHRDb21wb25lbnQsXG4gIFRvZ2dsZUNvbXBvbmVudCxcbn0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgS2V5VmFsdWVMaXN0UGx1Z2luIGZyb20gXCIuL21haW5cIjtcblxuZXhwb3J0IGludGVyZmFjZSBLZXlWYWx1ZUxpc3RQbHVnaW5TZXR0aW5ncyB7XG4gIGFjdGl2ZUluRWRpdE1vZGU6IGJvb2xlYW47XG4gIGFjdGl2ZUluUmVhZE1vZGU6IGJvb2xlYW47XG4gIGRpc3BsYXlCdWxsZXQ6IGJvb2xlYW47XG4gIGRpc3BsYXlCdWxsZXRDaGFyOiBzdHJpbmc7XG4gIGRlbGltaXRlcjogc3RyaW5nO1xuICBkaXNwbGF5RGVsaW1pdGVyOiBib29sZWFuO1xuICBtYXhLZXlXaWR0aDogbnVtYmVyO1xuICB2ZXJ0aWNhbFBhZGRpbmc6IG51bWJlcjtcbiAgaG9yaXpvbnRhbFBhZGRpbmc6IG51bWJlcjtcbiAgYm9sZEtleTogYm9vbGVhbjtcbiAgc3RyaXBlZEJhY2tncm91bmRUeXBlOiBzdHJpbmc7XG4gIHN0cmlwZWRCYWNrZ3JvdW5kQ29sb3I6IHN0cmluZztcbiAgaXNLZXlDb2xvcmVkOiBib29sZWFuO1xuICBrZXlDb2xvcjogc3RyaW5nO1xuICBpc1ZhbHVlQ29sb3JlZDogYm9vbGVhbjtcbiAgdmFsdWVDb2xvcjogc3RyaW5nO1xufVxuXG5leHBvcnQgY29uc3QgREVGQVVMVF9TRVRUSU5HUzogS2V5VmFsdWVMaXN0UGx1Z2luU2V0dGluZ3MgPSB7XG4gIGFjdGl2ZUluRWRpdE1vZGU6IHRydWUsXG4gIGFjdGl2ZUluUmVhZE1vZGU6IHRydWUsXG4gIGRpc3BsYXlCdWxsZXQ6IGZhbHNlLFxuICBkaXNwbGF5QnVsbGV0Q2hhcjogXCItXCIsXG4gIGRlbGltaXRlcjogXCI6XCIsXG4gIGRpc3BsYXlEZWxpbWl0ZXI6IHRydWUsXG4gIG1heEtleVdpZHRoOiA1MCxcbiAgdmVydGljYWxQYWRkaW5nOiAzLFxuICBob3Jpem9udGFsUGFkZGluZzogMTIsXG4gIGJvbGRLZXk6IHRydWUsXG4gIHN0cmlwZWRCYWNrZ3JvdW5kVHlwZTogXCJkZWZhdWx0XCIsXG4gIHN0cmlwZWRCYWNrZ3JvdW5kQ29sb3I6IFwiXCIsXG4gIGlzS2V5Q29sb3JlZDogZmFsc2UsXG4gIGtleUNvbG9yOiBcIlwiLFxuICBpc1ZhbHVlQ29sb3JlZDogZmFsc2UsXG4gIHZhbHVlQ29sb3I6IFwiXCIsXG59O1xuXG5leHBvcnQgY2xhc3MgU2V0dGluZ1RhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xuICBwbHVnaW46IEtleVZhbHVlTGlzdFBsdWdpbjtcblxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBLZXlWYWx1ZUxpc3RQbHVnaW4pIHtcbiAgICBzdXBlcihhcHAsIHBsdWdpbik7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gIH1cblxuICBkaXNwbGF5KCk6IHZvaWQge1xuICAgIGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XG4gICAgY29udGFpbmVyRWwuZW1wdHkoKTtcblxuICAgIGNvbnN0IGZvbGRhYmxlUGFkZGluZyA9IDQyO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIkFjdGl2ZSBpbiBlZGl0IG1vZGVcIilcbiAgICAgIC5zZXREZXNjKFwiSWYgdGhlIHBsdWdpbiBzaG91bGQgYmUgYWN0aXZlIGluIGVkaXQgbW9kZVwiKVxuICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlOiBUb2dnbGVDb21wb25lbnQpID0+XG4gICAgICAgIHRvZ2dsZVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5hY3RpdmVJbkVkaXRNb2RlKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmFjdGl2ZUluRWRpdE1vZGUgPSB2YWx1ZTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVEYXRhKHRoaXMucGx1Z2luLnNldHRpbmdzKTtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnJlZnJlc2goKTtcbiAgICAgICAgICB9KVxuICAgICAgKTtcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJBY3RpdmUgaW4gcmVhZCBtb2RlXCIpXG4gICAgICAuc2V0RGVzYyhcIklmIHRoZSBwbHVnaW4gc2hvdWxkIGJlIGFjdGl2ZSBpbiByZWFkIG1vZGVcIilcbiAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZTogVG9nZ2xlQ29tcG9uZW50KSA9PlxuICAgICAgICB0b2dnbGVcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuYWN0aXZlSW5SZWFkTW9kZSlcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5hY3RpdmVJblJlYWRNb2RlID0gdmFsdWU7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlRGF0YSh0aGlzLnBsdWdpbi5zZXR0aW5ncyk7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5yZWZyZXNoKCk7XG4gICAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiRGlzcGxheSBidWxsZXRcIilcbiAgICAgIC5zZXREZXNjKFwiSWYgdGhlIGJ1bGxldCBzaG91bGQgYmUgZGlzcGxheWVkIG9yIG5vdFwiKVxuICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlOiBUb2dnbGVDb21wb25lbnQpID0+XG4gICAgICAgIHRvZ2dsZVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5kaXNwbGF5QnVsbGV0KVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIGRpc3BsYXlCdWxsZXRDaGFyLnNldHRpbmdFbC50b2dnbGVDbGFzcyhcImRpc2FibGVkXCIsICF2YWx1ZSk7XG4gICAgICAgICAgICBkaXNwbGF5QnVsbGV0Q2hhci5zZXR0aW5nRWwuc3R5bGUuaGVpZ2h0ID0gdmFsdWVcbiAgICAgICAgICAgICAgPyBgJHtkaXNwbGF5QnVsbGV0Q2hhci5zZXR0aW5nRWwuaW5uZXJIZWlnaHQgKyBmb2xkYWJsZVBhZGRpbmd9cHhgXG4gICAgICAgICAgICAgIDogXCIwcHhcIjtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmRpc3BsYXlCdWxsZXQgPSB2YWx1ZTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVEYXRhKHRoaXMucGx1Z2luLnNldHRpbmdzKTtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnJlZnJlc2goKTtcbiAgICAgICAgICB9KVxuICAgICAgKTtcblxuICAgIGNvbnN0IGRpc3BsYXlCdWxsZXRDaGFyID0gbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIkJ1bGxldCBjaGFyYWN0ZXJcIilcbiAgICAgIC5zZXREZXNjKFxuICAgICAgICBcIlRoZSBjaGFyYWN0ZXIocykgdG8gYmUgZGlzcGxheWVkIGZvciBidWxsZXRzLiBUaGUgdHJpZ2dlciBidWxsZXQgd2lsbCBhbHdheXMgYmUgYSBkYXNoICgtKSByZWdhcmRsZXNzIG9mIHRoaXMgc2V0dGluZy5cIlxuICAgICAgKVxuICAgICAgLnNldENsYXNzKFwiZm9sZGFibGUtc2V0dGluZ1wiKVxuICAgICAgLnNldENsYXNzKHRoaXMucGx1Z2luLnNldHRpbmdzLmRpc3BsYXlCdWxsZXQgPyBcImVuYWJsZWRcIiA6IFwiZGlzYWJsZWRcIilcbiAgICAgIC5hZGRUZXh0KCh0ZXh0OiBUZXh0Q29tcG9uZW50KSA9PlxuICAgICAgICB0ZXh0XG4gICAgICAgICAgLnNldFBsYWNlaG9sZGVyKERFRkFVTFRfU0VUVElOR1MuZGlzcGxheUJ1bGxldENoYXIpXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmRpc3BsYXlCdWxsZXRDaGFyKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmRpc3BsYXlCdWxsZXRDaGFyID0gdmFsdWU7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnJlZnJlc2goKTtcbiAgICAgICAgICB9KVxuICAgICAgKVxuICAgICAgLnRoZW4oKHNldHRpbmcpID0+IHtcbiAgICAgICAgc2V0dGluZy5zZXR0aW5nRWwuc3R5bGUuaGVpZ2h0ID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuZGlzcGxheUJ1bGxldFxuICAgICAgICAgID8gYCR7c2V0dGluZy5zZXR0aW5nRWwuY2xpZW50SGVpZ2h0fXB4YFxuICAgICAgICAgIDogXCIwcHhcIjtcbiAgICAgIH0pO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIkRpc3BsYXkgZGVsaW1pdGVyXCIpXG4gICAgICAuc2V0RGVzYyhcIklmIHRoZSBkZWxpbWl0ZXIgc2hvdWxkIGJlIGRpc3BsYXllZCBpbiB0aGUga2V5IG9yIG5vdFwiKVxuICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlOiBUb2dnbGVDb21wb25lbnQpID0+XG4gICAgICAgIHRvZ2dsZVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5kaXNwbGF5RGVsaW1pdGVyKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIGRpc3BsYXlEZWxpbWl0ZXJDaGFyLnNldHRpbmdFbC50b2dnbGVDbGFzcyhcImRpc2FibGVkXCIsICF2YWx1ZSk7XG4gICAgICAgICAgICBkaXNwbGF5RGVsaW1pdGVyQ2hhci5zZXR0aW5nRWwuc3R5bGUuaGVpZ2h0ID0gdmFsdWVcbiAgICAgICAgICAgICAgPyBgJHtcbiAgICAgICAgICAgICAgICAgIGRpc3BsYXlEZWxpbWl0ZXJDaGFyLnNldHRpbmdFbC5pbm5lckhlaWdodCArIGZvbGRhYmxlUGFkZGluZ1xuICAgICAgICAgICAgICAgIH1weGBcbiAgICAgICAgICAgICAgOiBcIjBweFwiO1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZGlzcGxheURlbGltaXRlciA9IHZhbHVlO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZURhdGEodGhpcy5wbHVnaW4uc2V0dGluZ3MpO1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4ucmVmcmVzaCgpO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgY29uc3QgZGlzcGxheURlbGltaXRlckNoYXIgPSBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiRGVsaW1pdGVyXCIpXG4gICAgICAuc2V0RGVzYyhcbiAgICAgICAgXCJUaGUgY2hhcmFjdGVyKHMpIHRoYXQgc2VwYXJhdGUgdGhlIGtleSBmcm9tIHRoZSB2YWx1ZS4gSXQgaXMgcG9zc2libGUgdG8gdXNlIHNldmVyYWwgZGlmZmVyZW50IGRlbGltaXRlcnMsIGJ5IHNlcGFyYXRpbmcgdGhlbSB3aXRoIGNvbW1hc1wiXG4gICAgICApXG4gICAgICAuc2V0Q2xhc3MoXCJmb2xkYWJsZS1zZXR0aW5nXCIpXG4gICAgICAuc2V0Q2xhc3ModGhpcy5wbHVnaW4uc2V0dGluZ3MuZGlzcGxheURlbGltaXRlciA/IFwiZW5hYmxlZFwiIDogXCJkaXNhYmxlZFwiKVxuICAgICAgLmFkZFRleHQoKHRleHQ6IFRleHRDb21wb25lbnQpID0+XG4gICAgICAgIHRleHRcbiAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoREVGQVVMVF9TRVRUSU5HUy5kZWxpbWl0ZXIpXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmRlbGltaXRlcilcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5kZWxpbWl0ZXIgPSB2YWx1ZTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4ucmVmcmVzaCgpO1xuICAgICAgICAgIH0pXG4gICAgICApXG4gICAgICAudGhlbigoc2V0dGluZykgPT4ge1xuICAgICAgICBzZXR0aW5nLnNldHRpbmdFbC5zdHlsZS5oZWlnaHQgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5kaXNwbGF5RGVsaW1pdGVyXG4gICAgICAgICAgPyBgJHtzZXR0aW5nLnNldHRpbmdFbC5jbGllbnRIZWlnaHR9cHhgXG4gICAgICAgICAgOiBcIjBweFwiO1xuICAgICAgfSk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiTWF4IGtleSB3aWR0aFwiKVxuICAgICAgLnNldERlc2MoXG4gICAgICAgIFwiTWF4aW11bSB3aWR0aCBvZiB0aGUga2V5IGluIHBlcmNlbnQgb2YgdGhlIGVkaXRvciB3aWR0aC4gMCA9IG5vIGxpbWl0XCJcbiAgICAgIClcbiAgICAgIC5hZGRTbGlkZXIoKHNsaWRlcjogU2xpZGVyQ29tcG9uZW50KSA9PlxuICAgICAgICBzbGlkZXJcbiAgICAgICAgICAuc2V0TGltaXRzKDAsIDk5LCAxKVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5tYXhLZXlXaWR0aClcbiAgICAgICAgICAuc2V0RHluYW1pY1Rvb2x0aXAoKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWU6IG51bWJlcikgPT4ge1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MubWF4S2V5V2lkdGggPSB2YWx1ZTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVEYXRhKHRoaXMucGx1Z2luLnNldHRpbmdzKTtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnJlZnJlc2goKTtcbiAgICAgICAgICB9KVxuICAgICAgKTtcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJWZXJ0aWNhbCBwYWRkaW5nXCIpXG4gICAgICAuc2V0RGVzYyhcIlZlcnRpY2FsIHBhZGRpbmcgb2YgdGhlIGtleS12YWx1ZSBsaXN0IHJvd3MgKGluIHBpeGVscylcIilcbiAgICAgIC5hZGRUZXh0KCh0ZXh0OiBUZXh0Q29tcG9uZW50KSA9PlxuICAgICAgICB0ZXh0XG4gICAgICAgICAgLnNldFBsYWNlaG9sZGVyKERFRkFVTFRfU0VUVElOR1MudmVydGljYWxQYWRkaW5nLnRvU3RyaW5nKCkpXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnZlcnRpY2FsUGFkZGluZz8udG9TdHJpbmcoKSlcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICBsZXQgbnVtZXJpY1ZhbHVlID0gcGFyc2VJbnQodmFsdWUpO1xuICAgICAgICAgICAgaWYgKGlzTmFOKG51bWVyaWNWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgbnVtZXJpY1ZhbHVlID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnZlcnRpY2FsUGFkZGluZyA9IG51bWVyaWNWYWx1ZTtcbiAgICAgICAgICAgIHRleHQuc2V0VmFsdWUobnVtZXJpY1ZhbHVlLnRvU3RyaW5nKCkpO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5yZWZyZXNoKCk7XG4gICAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiSG9yaXpvbnRhbCBwYWRkaW5nXCIpXG4gICAgICAuc2V0RGVzYyhcIkhvcml6b250YWwgcGFkZGluZyBvZiB0aGUga2V5LXZhbHVlIGxpc3Qgcm93cyAoaW4gcGl4ZWxzKVwiKVxuICAgICAgLmFkZFRleHQoKHRleHQ6IFRleHRDb21wb25lbnQpID0+XG4gICAgICAgIHRleHRcbiAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoREVGQVVMVF9TRVRUSU5HUy5ob3Jpem9udGFsUGFkZGluZy50b1N0cmluZygpKVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5ob3Jpem9udGFsUGFkZGluZz8udG9TdHJpbmcoKSlcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICBsZXQgbnVtZXJpY1ZhbHVlID0gcGFyc2VJbnQodmFsdWUpO1xuICAgICAgICAgICAgaWYgKGlzTmFOKG51bWVyaWNWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgbnVtZXJpY1ZhbHVlID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmhvcml6b250YWxQYWRkaW5nID0gbnVtZXJpY1ZhbHVlO1xuICAgICAgICAgICAgdGV4dC5zZXRWYWx1ZShudW1lcmljVmFsdWUudG9TdHJpbmcoKSk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnJlZnJlc2goKTtcbiAgICAgICAgICB9KVxuICAgICAgKTtcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJCb2xkIGtleXNcIilcbiAgICAgIC5zZXREZXNjKFwiSXQgdGhlIGtleXMgc2hvdWxkIGJlIHJlbmRlcmVkIGluIGEgYm9sZCBmb250XCIpXG4gICAgICAuYWRkVG9nZ2xlKCh0b2dnbGU6IFRvZ2dsZUNvbXBvbmVudCkgPT5cbiAgICAgICAgdG9nZ2xlXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmJvbGRLZXkpXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuYm9sZEtleSA9IHZhbHVlO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZURhdGEodGhpcy5wbHVnaW4uc2V0dGluZ3MpO1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4ucmVmcmVzaCgpO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgY29uc3QgYmFja2dyb3VuZENvbG9yT3B0aW9ucyA9IFtcbiAgICAgIHsga2V5OiBcIm5vbmVcIiwgbGFiZWw6IFwiTm8gYmFja2dyb3VuZCBjb2xvclwiIH0sXG4gICAgICB7IGtleTogXCJkZWZhdWx0XCIsIGxhYmVsOiBcIkRlZmF1bHQgYmFja2dyb3VuZCBjb2xvciAoYmFzZWQgb24gdGhlbWUpXCIgfSxcbiAgICAgIHsga2V5OiBcImN1c3RvbVwiLCBsYWJlbDogXCJDdXN0b20gYmFja2dyb3VuZCBjb2xvclwiIH0sXG4gICAgXTtcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJTdHJpcGVkIGJhY2tncm91bmRcIilcbiAgICAgIC5zZXREZXNjKFwiQ2hvb3NlIGlmIGV2ZW4gcm93cyBzaG91bGQgaGF2ZSBhbm90aGVyIGJhY2tncm91bmQgY29sb3JcIilcbiAgICAgIC5hZGREcm9wZG93bigoZHJvcGRvd24pID0+IHtcbiAgICAgICAgYmFja2dyb3VuZENvbG9yT3B0aW9ucy5mb3JFYWNoKChvcHRpb24pID0+IHtcbiAgICAgICAgICBkcm9wZG93bi5hZGRPcHRpb24ob3B0aW9uLmtleSwgb3B0aW9uLmxhYmVsKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGRyb3Bkb3duLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnN0cmlwZWRCYWNrZ3JvdW5kVHlwZSk7XG4gICAgICAgIGRyb3Bkb3duLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnN0cmlwZWRCYWNrZ3JvdW5kVHlwZSA9IHZhbHVlO1xuICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVEYXRhKHRoaXMucGx1Z2luLnNldHRpbmdzKTtcbiAgICAgICAgICB0aGlzLmRpc3BsYXkoKTtcbiAgICAgICAgICB0aGlzLnBsdWdpbi5yZWZyZXNoKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3Muc3RyaXBlZEJhY2tncm91bmRUeXBlID09PSBcImN1c3RvbVwiKSB7XG4gICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgLnNldE5hbWUoXCJTdHJpcGVkIGJhY2tncm91bmQgY29sb3JcIilcbiAgICAgICAgLnNldERlc2MoXCJDaG9vc2UgdGhlIGNvbG9yIG9mIHRoZSBzdHJpcGVkIGJhY2tncm91bmQuXCIpXG4gICAgICAgIC5hZGRDb2xvclBpY2tlcigoY29sb3I6IENvbG9yQ29tcG9uZW50KSA9PlxuICAgICAgICAgIGNvbG9yXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3Muc3RyaXBlZEJhY2tncm91bmRDb2xvcilcbiAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc3RyaXBlZEJhY2tncm91bmRDb2xvciA9IHZhbHVlO1xuICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlRGF0YSh0aGlzLnBsdWdpbi5zZXR0aW5ncyk7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnJlZnJlc2goKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIkN1c3RvbSBrZXkgY29sb3JcIilcbiAgICAgIC5zZXREZXNjKFwiSWYgYSBjdXN0b20gY29sb3Igc2hvdWxkIGJlIHVzZWQgZm9yIHRoZSBrZXlzXCIpXG4gICAgICAuYWRkVG9nZ2xlKCh0b2dnbGU6IFRvZ2dsZUNvbXBvbmVudCkgPT5cbiAgICAgICAgdG9nZ2xlXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmlzS2V5Q29sb3JlZClcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5pc0tleUNvbG9yZWQgPSB2YWx1ZTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVEYXRhKHRoaXMucGx1Z2luLnNldHRpbmdzKTtcbiAgICAgICAgICAgIHRoaXMuZGlzcGxheSgpO1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4ucmVmcmVzaCgpO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLmlzS2V5Q29sb3JlZCkge1xuICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgIC5zZXROYW1lKFwiS2V5IGNvbG9yXCIpXG4gICAgICAgIC5zZXREZXNjKFwiQ2hvb3NlIHRoZSBjb2xvciBvZiB0aGUga2V5cy5cIilcbiAgICAgICAgLmFkZENvbG9yUGlja2VyKChjb2xvcjogQ29sb3JDb21wb25lbnQpID0+XG4gICAgICAgICAgY29sb3JcbiAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5rZXlDb2xvcilcbiAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Mua2V5Q29sb3IgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZURhdGEodGhpcy5wbHVnaW4uc2V0dGluZ3MpO1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5yZWZyZXNoKCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgIH1cblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJDdXN0b20gdmFsdWUgY29sb3JcIilcbiAgICAgIC5zZXREZXNjKFwiSWYgYSBjdXN0b20gY29sb3Igc2hvdWxkIGJlIHVzZWQgZm9yIHRoZSB2YWx1ZXNcIilcbiAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZTogVG9nZ2xlQ29tcG9uZW50KSA9PlxuICAgICAgICB0b2dnbGVcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuaXNWYWx1ZUNvbG9yZWQpXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuaXNWYWx1ZUNvbG9yZWQgPSB2YWx1ZTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVEYXRhKHRoaXMucGx1Z2luLnNldHRpbmdzKTtcbiAgICAgICAgICAgIHRoaXMuZGlzcGxheSgpO1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4ucmVmcmVzaCgpO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLmlzVmFsdWVDb2xvcmVkKSB7XG4gICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgLnNldE5hbWUoXCJWYWx1ZSBjb2xvclwiKVxuICAgICAgICAuc2V0RGVzYyhcIkNob29zZSB0aGUgY29sb3Igb2YgdGhlIHZhbHVlcy5cIilcbiAgICAgICAgLmFkZENvbG9yUGlja2VyKChjb2xvcjogQ29sb3JDb21wb25lbnQpID0+XG4gICAgICAgICAgY29sb3JcbiAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy52YWx1ZUNvbG9yKVxuICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy52YWx1ZUNvbG9yID0gdmFsdWU7XG4gICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVEYXRhKHRoaXMucGx1Z2luLnNldHRpbmdzKTtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4ucmVmcmVzaCgpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiUmVzZXQgc2V0dGluZ3NcIilcbiAgICAgIC5zZXREZXNjKFwiUmVzZXQgYWxsIHNldHRpbmdzIHRvIHRoZWlyIGRlZmF1bHQgdmFsdWVzXCIpXG4gICAgICAuYWRkQnV0dG9uKChidXR0b246IEJ1dHRvbkNvbXBvbmVudCkgPT5cbiAgICAgICAgYnV0dG9uLnNldEJ1dHRvblRleHQoXCJSZXNldCBzZXR0aW5nc1wiKS5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICBpZiAoY29uZmlybShcIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byByZXNldCB0aGUgc2V0dGluZ3M/XCIpKSB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncyA9IE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfU0VUVElOR1MpO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZURhdGEodGhpcy5wbHVnaW4uc2V0dGluZ3MpO1xuICAgICAgICAgICAgdGhpcy5kaXNwbGF5KCk7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5yZWZyZXNoKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgKTtcbiAgfVxufVxuIiwgImltcG9ydCB7IEVkaXRvclBvc2l0aW9uIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5cbmV4cG9ydCBjbGFzcyBMaXN0IHtcbiAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIHN0YXJ0OiBFZGl0b3JQb3NpdGlvbixcbiAgICBwdWJsaWMgZW5kOiBFZGl0b3JQb3NpdGlvbixcbiAgICBwdWJsaWMgaXNLZXlWYWx1ZUxpc3Q6IGJvb2xlYW4sXG4gICAgcHVibGljIGhhc0N1cnNvckluc2lkZTogYm9vbGVhblxuICApIHt9XG59XG4iLCAiZXhwb3J0IGZ1bmN0aW9uIGVzY2FwZVJlZ0V4cChzdHJpbmc6IHN0cmluZykge1xuICAvLyAkJiBtZWFucyB0aGUgd2hvbGUgbWF0Y2hlZCBzdHJpbmdcbiAgcmV0dXJuIHN0cmluZy5yZXBsYWNlKC9bLiorP14ke30oKXxbXFxdXFxcXF0vZywgXCJcXFxcJCZcIik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZW1vdmVJbnZhbGlkSHRtbFRhZ3MoaW5wdXRTdHJpbmc6IHN0cmluZyk6IHN0cmluZyB7XG4gIGNvbnN0IHRhZ1JlZ2V4ID0gLzxcXC8/KFthLXpdW2EtejAtOV0qKVxcYltePl0qPi9naTtcbiAgbGV0IG1hdGNoOiBSZWdFeHBFeGVjQXJyYXkgfCBudWxsO1xuICBjb25zdCBzdGFjazogeyB0YWdOYW1lOiBzdHJpbmc7IGZ1bGxUYWc6IHN0cmluZyB9W10gPSBbXTtcbiAgY29uc3QgaW52YWxpZFRhZ3M6IHN0cmluZ1tdID0gW107XG5cbiAgLy8gRmluZCBhbGwgdGFncyBhbmQgcHJvY2VzcyB0aGVtXG4gIHdoaWxlICgobWF0Y2ggPSB0YWdSZWdleC5leGVjKGlucHV0U3RyaW5nKSkgIT09IG51bGwpIHtcbiAgICBjb25zdCBmdWxsVGFnOiBzdHJpbmcgPSBtYXRjaFswXTtcbiAgICBjb25zdCB0YWdOYW1lOiBzdHJpbmcgPSBtYXRjaFsxXTtcbiAgICBjb25zdCBpc0Nsb3NpbmdUYWc6IGJvb2xlYW4gPSBmdWxsVGFnWzFdID09PSBcIi9cIjtcblxuICAgIGlmIChpc0Nsb3NpbmdUYWcpIHtcbiAgICAgIGlmIChzdGFjay5sZW5ndGggPT09IDAgfHwgc3RhY2tbc3RhY2subGVuZ3RoIC0gMV0udGFnTmFtZSAhPT0gdGFnTmFtZSkge1xuICAgICAgICAvLyBObyBtYXRjaGluZyBvcGVuaW5nIHRhZywgbWFyayBmb3IgcmVtb3ZhbFxuICAgICAgICBpbnZhbGlkVGFncy5wdXNoKGZ1bGxUYWcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gTWF0Y2hpbmcgb3BlbmluZyB0YWcgZm91bmQsIHJlbW92ZSBpdCBmcm9tIHN0YWNrXG4gICAgICAgIHN0YWNrLnBvcCgpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBPcGVuaW5nIHRhZywgcHVzaCB0byBzdGFjayB3aXRoIGl0cyBpbmRleCBmb3IgbGF0ZXIgcmVtb3ZhbCBpZiB1bm1hdGNoZWRcbiAgICAgIHN0YWNrLnB1c2goeyB0YWdOYW1lLCBmdWxsVGFnIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8vIEFsbCByZW1haW5pbmcgdGFncyBpbiBzdGFjayBhcmUgdW5tYXRjaGVkIG9wZW5pbmcgdGFncywgbWFyayB0aGVtIGZvciByZW1vdmFsXG4gIHN0YWNrLmZvckVhY2goKHRhZykgPT4gaW52YWxpZFRhZ3MucHVzaCh0YWcuZnVsbFRhZykpO1xuXG4gIC8vIFJlbW92ZSBpbnZhbGlkIHRhZ3MgZnJvbSBpbnB1dFN0cmluZ1xuICBsZXQgcmVzdWx0U3RyaW5nOiBzdHJpbmcgPSBpbnB1dFN0cmluZztcbiAgaW52YWxpZFRhZ3MuZm9yRWFjaCgodGFnKSA9PiB7XG4gICAgcmVzdWx0U3RyaW5nID0gcmVzdWx0U3RyaW5nLnJlcGxhY2UodGFnLCBcIlwiKTtcbiAgfSk7XG5cbiAgcmV0dXJuIHJlc3VsdFN0cmluZztcbn1cbiIsICJpbXBvcnQgeyBFZGl0b3IgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IExpc3QgfSBmcm9tIFwiLi9saXN0XCI7XG5pbXBvcnQgS2V5VmFsdWVMaXN0UGx1Z2luIGZyb20gXCIuL21haW5cIjtcbmltcG9ydCB7IGVzY2FwZVJlZ0V4cCwgcmVtb3ZlSW52YWxpZEh0bWxUYWdzIH0gZnJvbSBcIi4vdXRpbHNcIjtcbmltcG9ydCB7IERFRkFVTFRfU0VUVElOR1MgfSBmcm9tIFwiLi9zZXR0aW5nc1wiO1xuaW1wb3J0IHsgS2V5VmFsdWVQaWVjZSB9IGZyb20gXCIuL3R5cGVzXCI7XG5cbmNvbnN0IGxpc3RJdGVtUmVnID0gbmV3IFJlZ0V4cChgXlsgXFx0XSotKC4qKWApO1xuXG5leHBvcnQgY2xhc3MgTGlzdFBhcnNlciB7XG4gIGtleVZhbHVlUmVnOiBSZWdFeHA7XG4gIGxpRWxlbVJlZzogUmVnRXhwO1xuICBuZWVkc1VwZGF0ZSA9IGZhbHNlO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcGx1Z2luOiBLZXlWYWx1ZUxpc3RQbHVnaW4pIHtcbiAgICB0aGlzLnVwZGF0ZSgpO1xuICB9XG5cbiAgdXBkYXRlKCkge1xuICAgIGNvbnN0IGJ1bGxldCA9IFwiLVwiO1xuICAgIGNvbnN0IGRlbGltaXRlcjogc3RyaW5nID0gZXNjYXBlUmVnRXhwKFxuICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZGVsaW1pdGVyIHx8IERFRkFVTFRfU0VUVElOR1MuZGVsaW1pdGVyXG4gICAgKTtcbiAgICAvLyBUcmltIHNwYWNlcyBhbmQgdGFicyBmcm9tIHRoZSBkZWxpbWl0ZXJcbiAgICBjb25zdCBkZWxpbWl0ZXJzID0gZGVsaW1pdGVyXG4gICAgICAuc3BsaXQoXCIsXCIpXG4gICAgICAubWFwKChkKSA9PiBkLnRyaW0oKSkgLy9lc2NhcGVSZWdFeHAoZCkudHJpbSgpKVxuICAgICAgLmpvaW4oXCJ8XCIpO1xuICAgIHRoaXMua2V5VmFsdWVSZWcgPSBuZXcgUmVnRXhwKFxuICAgICAgYF5bIFxcdF0qJHtidWxsZXR9KC4qW146XSkoJHtkZWxpbWl0ZXJzfSkgKC4qKWBcbiAgICApO1xuICAgIHRoaXMubGlFbGVtUmVnID0gbmV3IFJlZ0V4cChgXiguKlteOl0pKCR7ZGVsaW1pdGVyc30pICguKikkYCk7XG4gICAgdGhpcy5uZWVkc1VwZGF0ZSA9IHRydWU7XG4gIH1cblxuICAvKipcbiAgICogQ29sbGVjdHMgYWxsIGxpc3RzIHdpdGhpbiBhIGdpdmVuIHJhbmdlLlxuICAgKiBAcGFyYW0gIHtFZGl0b3J9IGVkaXRvciAgICBUaGUgZWRpdG9yIHRvIHBhcnNlLlxuICAgKiBAcGFyYW0gIHtOdW1iZXJ9IHN0YXJ0TGluZSBUaGUgbGluZSB0byBzdGFydCBwYXJzaW5nIGZyb20uXG4gICAqIEBwYXJhbSAge051bWJlcn0gZW5kTGluZSAgIFRoZSBsaW5lIHRvIHN0b3AgcGFyc2luZyBhdC5cbiAgICogQHJldHVybiB7TGlzdFtdfSAgICAgICAgICAgQSBsaXN0IG9mIGFsbCBsaXN0cyBmb3VuZC5cbiAgICogQHB1YmxpY1xuICAgKi9cbiAgY29sbGVjdExpc3RzKFxuICAgIGVkaXRvcjogRWRpdG9yLFxuICAgIHN0YXJ0TGluZSA9IDAsXG4gICAgZW5kTGluZTogbnVtYmVyID0gZWRpdG9yLmxhc3RMaW5lKClcbiAgKTogTGlzdFtdIHtcbiAgICBjb25zdCBsaXN0czogTGlzdFtdID0gW107XG4gICAgY29uc3QgY3Vyc29yTGluZSA9IGVkaXRvci5nZXRDdXJzb3IoKS5saW5lO1xuXG4gICAgZm9yIChcbiAgICAgIGxldCBjdXJyZW50TGluZTogbnVtYmVyID0gc3RhcnRMaW5lO1xuICAgICAgY3VycmVudExpbmUgPD0gZW5kTGluZTtcbiAgICAgIGN1cnJlbnRMaW5lKytcbiAgICApIHtcbiAgICAgIGNvbnN0IGxpbmUgPSBlZGl0b3IuZ2V0TGluZShjdXJyZW50TGluZSk7XG4gICAgICBpZiAodGhpcy5pc0xpbmVMaXN0KGxpbmUpKSB7XG4gICAgICAgIGxldCBpc0tleVZhbHVlTGlzdCA9IHRydWU7XG4gICAgICAgIGxldCBoYXNDdXJzb3JJbnNpZGUgPSBmYWxzZTtcblxuICAgICAgICBsZXQgbGlzdEVuZExpbmVMb29rdXA6IG51bWJlciA9IGN1cnJlbnRMaW5lO1xuICAgICAgICB3aGlsZSAobGlzdEVuZExpbmVMb29rdXAgPD0gZWRpdG9yLmxhc3RMaW5lKCkpIHtcbiAgICAgICAgICBjb25zdCBsaW5lID0gZWRpdG9yLmdldExpbmUobGlzdEVuZExpbmVMb29rdXApO1xuICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBsaW5lIGlzIGEgbGlzdCBpdGVtXG4gICAgICAgICAgaWYgKCF0aGlzLmlzTGluZUxpc3QobGluZSkpIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoY3Vyc29yTGluZSA9PT0gbGlzdEVuZExpbmVMb29rdXApIHtcbiAgICAgICAgICAgIGhhc0N1cnNvckluc2lkZSA9IHRydWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGxpc3QgaXRlbSBpcyBhIGtleS12YWx1ZSBsaXN0IGl0ZW0gKG9yIHRoZSBjdXJzb3IgaXMgb24gdGhlIGxpbmUpXG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgIXRoaXMuaXNLZXlWYWx1ZUxpc3RJdGVtKGxpbmUpICYmXG4gICAgICAgICAgICBjdXJzb3JMaW5lICE9PSBsaXN0RW5kTGluZUxvb2t1cFxuICAgICAgICAgICkge1xuICAgICAgICAgICAgaXNLZXlWYWx1ZUxpc3QgPSBmYWxzZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAobGlzdEVuZExpbmVMb29rdXAgPj0gZW5kTGluZSkge1xuICAgICAgICAgICAgbGlzdEVuZExpbmVMb29rdXAgPSBlbmRMaW5lO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICAgIGxpc3RFbmRMaW5lTG9va3VwKys7XG4gICAgICAgIH1cbiAgICAgICAgbGlzdHMucHVzaChcbiAgICAgICAgICBuZXcgTGlzdChcbiAgICAgICAgICAgIHsgbGluZTogY3VycmVudExpbmUsIGNoOiAwIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGxpbmU6IGxpc3RFbmRMaW5lTG9va3VwLFxuICAgICAgICAgICAgICBjaDogZWRpdG9yLmdldExpbmUobGlzdEVuZExpbmVMb29rdXApLmxlbmd0aCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc0tleVZhbHVlTGlzdCxcbiAgICAgICAgICAgIGhhc0N1cnNvckluc2lkZVxuICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICAgICAgY3VycmVudExpbmUgPSBsaXN0RW5kTGluZUxvb2t1cDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbGlzdHM7XG4gIH1cblxuICBwcml2YXRlIGlzTGluZUxpc3QobGluZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIGxpc3RJdGVtUmVnLnRlc3QobGluZSk7XG4gIH1cblxuICBwdWJsaWMgaXNLZXlWYWx1ZUxpRWxlbShsaW5lOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5saUVsZW1SZWcudGVzdChsaW5lLnJlcGxhY2UoXCI8YnI+XCIsIFwiXFxuXCIpKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRQaWVjZXNGcm9tTGlFbGVtKGxpc3RJdGVtOiBFbGVtZW50KTogS2V5VmFsdWVQaWVjZSB7XG4gICAgY29uc3QgbWF0Y2ggPSBsaXN0SXRlbS5pbm5lckhUTUxcbiAgICAgIC5yZXBsYWNlKFwiXFxuXCIsIFwiIFwiKVxuICAgICAgLnRyaW0oKVxuICAgICAgLnJlcGxhY2UoXCImZ3Q7XCIsIFwiPlwiKVxuICAgICAgLnJlcGxhY2UoXCImbHQ7XCIsIFwiPFwiKVxuICAgICAgLm1hdGNoKHRoaXMubGlFbGVtUmVnKTtcblxuICAgIGxldCBrZXkgPSBtYXRjaD8uWzFdIHx8IFwiXCI7XG4gICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLmRpc3BsYXlCdWxsZXQpIHtcbiAgICAgIGtleSA9IGAke3RoaXMucGx1Z2luLnNldHRpbmdzLmRpc3BsYXlCdWxsZXRDaGFyfSAke2tleX1gO1xuICAgIH1cblxuICAgIGNvbnN0IGRlbGltaXRlciA9IChtYXRjaD8uWzJdIHx8IFwiXCIpXG4gICAgICAucmVwbGFjZShcIj5cIiwgXCImZ3Q7XCIpXG4gICAgICAucmVwbGFjZShcIjxcIiwgXCImbHQ7XCIpO1xuICAgIGlmICh0aGlzLnBsdWdpbi5zZXR0aW5ncy5kaXNwbGF5RGVsaW1pdGVyKSB7XG4gICAgICBrZXkgPSBgJHtrZXl9JHtkZWxpbWl0ZXJ9YDtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAga2V5OiByZW1vdmVJbnZhbGlkSHRtbFRhZ3Moa2V5KSxcbiAgICAgIGRlbGltaXRlcixcbiAgICAgIHZhbHVlOiByZW1vdmVJbnZhbGlkSHRtbFRhZ3MobWF0Y2g/LlszXSB8fCBcIlwiKSxcbiAgICB9O1xuICB9XG5cbiAgcHVibGljIGdldFBpZWNlc0Zyb21TdHJpbmcobGluZTogc3RyaW5nKTogS2V5VmFsdWVQaWVjZSB7XG4gICAgY29uc3QgbWF0Y2ggPSBsaW5lXG4gICAgICAucmVwbGFjZShcIiZndDtcIiwgXCI+XCIpXG4gICAgICAucmVwbGFjZShcIiZsdDtcIiwgXCI8XCIpXG4gICAgICAubWF0Y2godGhpcy5saUVsZW1SZWcpO1xuXG4gICAgbGV0IGtleSA9IChtYXRjaD8uWzFdIHx8IFwiXCIpLnN1YnN0cmluZygyKTtcbiAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MuZGlzcGxheUJ1bGxldCkge1xuICAgICAga2V5ID0gYFxcXFwke3RoaXMucGx1Z2luLnNldHRpbmdzLmRpc3BsYXlCdWxsZXRDaGFyfSAke2tleX1gO1xuICAgIH1cblxuICAgIC8vIFdlIG5lZWQgdG8gaGFuZGxlIHJvd3Mgc3RhcnRpbmcgd2l0aCBhIGNoZWNrYm94XG4gICAgaWYgKCF0aGlzLnBsdWdpbi5zZXR0aW5ncy5kaXNwbGF5QnVsbGV0ICYmIGtleS5jaGFyQXQoMCkgPT09IFwiW1wiKSB7XG4gICAgICBrZXkgPSBgLSAke2tleX1gO1xuICAgIH0gZWxzZSBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MuZGlzcGxheUJ1bGxldCAmJiBrZXkuc3RhcnRzV2l0aChcIlxcXFwtIFtcIikpIHtcbiAgICAgIGtleSA9IGtleS5zdWJzdHJpbmcoMSk7XG4gICAgfVxuXG4gICAgY29uc3QgZGVsaW1pdGVyID0gKG1hdGNoPy5bMl0gfHwgXCJcIilcbiAgICAgIC5yZXBsYWNlKFwiPlwiLCBcIiZndDtcIilcbiAgICAgIC5yZXBsYWNlKFwiPFwiLCBcIiZsdDtcIik7XG4gICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLmRpc3BsYXlEZWxpbWl0ZXIpIHtcbiAgICAgIGtleSA9IGAke2tleX0ke2RlbGltaXRlcn1gO1xuICAgIH1cblxuICAgIC8vIEVzY2FwZSBhbnkgZm9vdG5vdGVzIGluIHRoZSB2YWx1ZS4gQSBmb290IG5vdGUgaXMgYSBudW1iZXIgYWZ0ZXIgdGhlIF4gc3ltYm9sIGluIHNxdWFyZSBicmFja2V0cy5cbiAgICAvLyBFeGFtcGxlOiBUaGlzIGlzIGEgZm9vdG5vdGVbXjFdXG4gICAgY29uc3QgdmFsdWUgPSAobWF0Y2g/LlszXSB8fCBcIlwiKS5yZXBsYWNlKC9cXFsoXFxeXFxkKylcXF0vZywgXCJcXFxcJDFcIik7XG5cbiAgICByZXR1cm4ge1xuICAgICAga2V5LFxuICAgICAgZGVsaW1pdGVyLFxuICAgICAgdmFsdWUsXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgaXNLZXlWYWx1ZUxpc3RJdGVtKGxpbmU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmtleVZhbHVlUmVnLnRlc3QobGluZSk7XG4gIH1cbn1cbiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxJQUFBQSxtQkFBcUM7OztBQ0NyQyxtQkFBZ0M7QUFDaEMsSUFBQUMsbUJBQW9EO0FBRXBELElBQUFDLGVBT087QUFDUCxJQUFBRCxtQkFBd0M7OztBQ1p4QyxrQkFBMkI7QUFHM0Isc0JBQWlDO0FBRzFCLElBQU0scUJBQU4sY0FBaUMsdUJBQVc7QUFBQSxFQUNqRCxZQUNXLFFBQ0EsUUFDQSxXQUNBLFVBQ0EsYUFDQSxlQUNBLE1BQ1Q7QUFDQSxVQUFNO0FBUkc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQSxFQUdYO0FBQUEsRUFFQSxHQUFHLE9BQTJCO0FBQzVCLFdBQ0UsS0FBSyxXQUFXLE1BQU0sVUFDdEIsS0FBSyxjQUFjLE1BQU0sYUFDekIsS0FBSyxhQUFhLE1BQU0sWUFDeEIsS0FBSyxnQkFBZ0IsTUFBTSxlQUMzQixLQUFLLGtCQUFrQixNQUFNLGlCQUM3QixLQUFLLFNBQVMsTUFBTTtBQUFBLEVBRXhCO0FBQUEsRUFFQSxRQUFRO0FBQ04sVUFBTSxXQUF1QyxLQUFLLE9BQU87QUFD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QUFNLEtBQUs7QUFDaEUsWUFBTSxLQUFLO0FBQUEsSUFDYixXQUFXLEtBQUssT0FBTyxTQUFTLGlCQUFpQixJQUFJLFdBQVcsT0FBTyxHQUFHO0FBQ3hFLFlBQU0sSUFBSSxVQUFVLENBQUM7QUFBQSxJQUN2QjtBQUVBLFVBQU0sY0FBYSwrQkFBUSxPQUFNLElBQzlCLFFBQVEsS0FBSyxNQUFNLEVBQ25CLFFBQVEsS0FBSyxNQUFNO0FBQ3RCLFFBQUksS0FBSyxPQUFPLFNBQVMsa0JBQWtCO0FBQ3pDLFlBQU0sR0FBRyxNQUFNO0FBQUEsSUFDakI7QUFJQSxVQUFNLFVBQVMsK0JBQVEsT0FBTSxJQUFJLFFBQVEsZ0JBQWdCLE1BQU07QUFFL0QsV0FBTztBQUFBLE1BQ0w7QUFBQSxNQUNBO0FBQUEsTUFDQTtBQUFBLElBQ0Y7QUFBQSxFQUNGO0FBQUEsRUFFUSxtQkFBbUIsTUFBdUI7QUFDaEQsV0FBTyxLQUFLLFlBQVksS0FBSyxJQUFJO0FBQUEsRUFDbkM7QUFDRjs7O0FOeEtBLElBQXFCLHFCQUFyQixjQUFnRCx3QkFBTztBQUFBLEVBSXJELE1BQU0sU0FBUztBQUNiLFVBQU0sS0FBSyxhQUFhO0FBQ3hCLFNBQUssU0FBUyxJQUFJLFdBQVcsSUFBSTtBQUNqQyxRQUFJLGFBQWEsTUFBTSxLQUFLLE1BQU0sRUFBRSxLQUFLO0FBR3pDLFNBQUssY0FBYyxJQUFJLFdBQVcsS0FBSyxLQUFLLElBQUksQ0FBQztBQUVqRCxTQUFLO0FBQUEsTUFDSCxLQUFLLElBQUksY0FBYyxHQUFHLFdBQVcsTUFBTTtBQUN6QyxhQUFLLGtCQUFrQjtBQUFBLE1BQ3pCLENBQUM7QUFBQSxJQUNIO0FBQUEsRUFDRjtBQUFBLEVBRUEsb0JBQW9CO0FBR2xCLFVBQU0sT0FBTyxLQUFLLElBQUksVUFBVSxvQkFBb0IsNkJBQVk7QUFDaEUsUUFBSSxNQUFNO0FBQ1IsV0FBSyxZQUFZLFNBQVMsSUFBSTtBQUFBLElBQ2hDO0FBQUEsRUFDRjtBQUFBLEVBRUEsVUFBVTtBQUNSLFNBQUssSUFBSSxVQUFVLGNBQWM7QUFDakMsU0FBSyxPQUFPLE9BQU87QUFDbkIsU0FBSyxrQkFBa0I7QUFBQSxFQUN6QjtBQUFBLEVBRUEsV0FBVztBQUFBLEVBQUM7QUFBQSxFQUVaLE1BQU0sZUFBZTtBQUNuQixTQUFLLFdBQVcsT0FBTyxPQUFPLENBQUMsR0FBRyxrQkFBa0IsTUFBTSxLQUFLLFNBQVMsQ0FBQztBQUFBLEVBQzNFO0FBQUEsRUFFQSxNQUFNLGVBQWU7QUFDbkIsVUFBTSxLQUFLLFNBQVMsS0FBSyxRQUFRO0FBQUEsRUFDbkM7QUFDRjsiLAogICJuYW1lcyI6IFsiaW1wb3J0X29ic2lkaWFuIiwgImltcG9ydF9vYnNpZGlhbiIsICJpbXBvcnRfdmlldyIsICJpbXBvcnRfb2JzaWRpYW4iLCAibGluZSJdCn0K
